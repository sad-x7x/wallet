{"version":3,"file":"941.e77e449fed97d4b53290.js","mappings":"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AM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,GAAM,IAAM,EAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,EAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAC//CC,EAAI,CAAC,GAAM,EAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,EAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,EAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,EAAM,IAAM,IAAM,IAAM,EAAM,EAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,EAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,EAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,GAAM,KAG//CC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,EAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAG1/FC,EAAK,CAAC,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,EAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,SAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,YAG1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,WAAY,WAA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","sources":["webpack://mytonwallet/webpack/runtime/chunk loaded","webpack://mytonwallet/webpack/runtime/startup chunk dependencies","webpack://mytonwallet/./src/api/chains/ton/contracts/JettonStaking/imports/constants.ts","webpack://mytonwallet/./src/api/errors.ts","webpack://mytonwallet/./src/lib/big.js/index.js","webpack://mytonwallet/./src/util/decimals.ts","webpack://mytonwallet/./src/util/random.ts","webpack://mytonwallet/./src/util/bigint.ts","webpack://mytonwallet/./src/util/createPostMessageInterface.ts","webpack://mytonwallet/./src/util/bigintPatch.ts","webpack://mytonwallet/./src/util/account.ts","webpack://mytonwallet/./src/util/isMnemonicPrivateKey.ts","webpack://mytonwallet/./src/lib/ed25519-hd-key/index.ts","webpack://mytonwallet/./src/util/dns.ts","webpack://mytonwallet/./src/util/iteratees.ts","webpack://mytonwallet/./src/api/chains/ton/contracts/DnsItem.ts","webpack://mytonwallet/./src/api/common/utils.ts","webpack://mytonwallet/./src/api/environment.ts","webpack://mytonwallet/./src/api/chains/ton/constants.ts","webpack://mytonwallet/./src/api/chains/ton/util/index.ts","webpack://mytonwallet/./src/api/chains/ton/util/tonCore.ts","webpack://mytonwallet/./src/api/storages/types.ts","webpack://mytonwallet/./src/util/windowProvider/connector.ts","webpack://mytonwallet/./src/util/generateUniqueId.ts","webpack://mytonwallet/./src/util/PostMessageConnector.ts","webpack://mytonwallet/./src/api/storages/capacitorStorage.ts","webpack://mytonwallet/./src/api/storages/extension.ts","webpack://mytonwallet/./src/api/storages/idb.ts","webpack://mytonwallet/./src/api/storages/localStorage.ts","webpack://mytonwallet/./src/api/storages/index.ts","webpack://mytonwallet/./src/api/common/accounts.ts","webpack://mytonwallet/./src/api/common/mnemonic.ts","webpack://mytonwallet/./src/api/chains/ton/util/apiV3.ts","webpack://mytonwallet/./src/api/chains/ton/util/tonapiio.ts","webpack://mytonwallet/./src/api/chains/ton/wallet.ts","webpack://mytonwallet/./src/api/chains/ton/auth.ts","webpack://mytonwallet/./src/util/metadata.ts","webpack://mytonwallet/./src/lib/confusables/util.ts","webpack://mytonwallet/./src/lib/confusables/characters.ts","webpack://mytonwallet/./src/lib/confusables/index.ts","webpack://mytonwallet/./src/api/common/backend.ts","webpack://mytonwallet/./src/api/common/addresses.ts","webpack://mytonwallet/./src/api/db/repository.ts","webpack://mytonwallet/./src/api/db/index.ts","webpack://mytonwallet/./src/api/common/cache.ts","webpack://mytonwallet/./src/api/common/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/util/metadata.ts","webpack://mytonwallet/./src/util/compareActivities.ts","webpack://mytonwallet/./src/util/chain.ts","webpack://mytonwallet/./src/util/fee/transferFee.ts","webpack://mytonwallet/./src/util/tokens.ts","webpack://mytonwallet/./src/util/shortenAddress.ts","webpack://mytonwallet/./src/util/poisoningHash.ts","webpack://mytonwallet/./src/api/chains/ton/util/encryption.ts","webpack://mytonwallet/./src/api/chains/ton/util/diesel.ts","webpack://mytonwallet/./src/api/chains/ton/util/w5diesel.ts","webpack://mytonwallet/./src/api/chains/ton/util/sendExternal.ts","webpack://mytonwallet/./src/util/areDeepEqual.ts","webpack://mytonwallet/./src/api/common/helpers.ts","webpack://mytonwallet/./src/util/Deferred.ts","webpack://mytonwallet/./src/api/common/pendingTransfers.ts","webpack://mytonwallet/./src/api/constants.ts","webpack://mytonwallet/./src/api/chains/ton/walletV5/walletV5.ts","webpack://mytonwallet/./src/api/chains/ton/walletV5/walletV5Actions.ts","webpack://mytonwallet/./src/api/chains/ton/util/dns.ts","webpack://mytonwallet/./src/api/chains/ton/address.ts","webpack://mytonwallet/./src/api/chains/ton/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/transactions.ts","webpack://mytonwallet/./src/api/chains/ton/util/emulation.ts","webpack://mytonwallet/./src/api/chains/ton/nfts.ts","webpack://mytonwallet/./src/api/chains/ton/contracts/NominatorPool.ts","webpack://mytonwallet/./src/api/common/other.ts","webpack://mytonwallet/./src/api/chains/ton/staking.ts","webpack://mytonwallet/./src/util/ton/calcJettonStakingApr.ts","webpack://mytonwallet/./src/api/chains/ton/other.ts","webpack://mytonwallet/./src/util/ton/transfer.ts","webpack://mytonwallet/./src/util/swap/buildSwapId.ts","webpack://mytonwallet/./src/api/common/swap.ts","webpack://mytonwallet/./src/api/chains/ton/swap.ts","webpack://mytonwallet/./src/util/pauseOrFocus.ts","webpack://mytonwallet/./src/api/common/nft.ts","webpack://mytonwallet/./src/api/common/txCallbacks.ts","webpack://mytonwallet/./src/util/callbacks.ts","webpack://mytonwallet/./src/api/chains/ton/priceless.ts","webpack://mytonwallet/./src/api/chains/ton/vesting.ts","webpack://mytonwallet/./src/api/chains/ton/polling.ts","webpack://mytonwallet/./src/api/chains/tron/util/tronweb.ts","webpack://mytonwallet/./src/api/chains/tron/transactions.ts","webpack://mytonwallet/./src/api/chains/tron/wallet.ts","webpack://mytonwallet/./src/api/chains/tron/polling.ts","webpack://mytonwallet/./src/api/chains/tron/constants.ts","webpack://mytonwallet/./src/api/chains/tron/transfer.ts","webpack://mytonwallet/./src/util/stringFormat.ts","webpack://mytonwallet/./src/api/chains/tron/index.ts","webpack://mytonwallet/./src/api/chains/index.ts","webpack://mytonwallet/./src/api/hooks.ts","webpack://mytonwallet/./src/api/methods/dapps.ts","webpack://mytonwallet/./src/api/methods/accounts.ts","webpack://mytonwallet/./src/api/methods/auth.ts","webpack://mytonwallet/./src/api/common/dappPromises.ts","webpack://mytonwallet/./src/api/methods/wallet.ts","webpack://mytonwallet/./src/api/methods/tokens.ts","webpack://mytonwallet/./src/api/methods/transactions.ts","webpack://mytonwallet/./src/api/methods/nfts.ts","webpack://mytonwallet/./src/api/common/prices.ts","webpack://mytonwallet/./src/api/methods/preload.ts","webpack://mytonwallet/./src/api/methods/staking.ts","webpack://mytonwallet/./src/api/methods/other.ts","webpack://mytonwallet/./src/api/methods/swap.ts","webpack://mytonwallet/./src/api/methods/polling.ts","webpack://mytonwallet/./src/api/tonConnect/types/index.ts","webpack://mytonwallet/./src/util/tonConnectEnvironment.ts","webpack://mytonwallet/./src/api/tonConnect/errors.ts","webpack://mytonwallet/./src/api/tonConnect/utils.ts","webpack://mytonwallet/./src/api/tonConnect/index.ts","webpack://mytonwallet/./src/api/tonConnect/sse.ts","webpack://mytonwallet/./src/api/methods/prices.ts","webpack://mytonwallet/./src/api/methods/notifications.ts","webpack://mytonwallet/./src/api/methods/init.ts","webpack://mytonwallet/./src/api/migrations/00016.ts","webpack://mytonwallet/./src/api/providers/worker/provider.ts","webpack://mytonwallet/./src/api/types/errors.ts","webpack://mytonwallet/./src/api/types/misc.ts","webpack://mytonwallet/./src/config.ts","webpack://mytonwallet/./src/lib/aes-js/index.js","webpack://mytonwallet/./src/lib/noble-ed25519/index.js","webpack://mytonwallet/./src/util/assert.ts","webpack://mytonwallet/./src/util/dateFormat.ts","webpack://mytonwallet/./src/util/environment.ts","webpack://mytonwallet/./src/util/fetch.ts","webpack://mytonwallet/./src/util/handleError.ts","webpack://mytonwallet/./src/util/logs.ts","webpack://mytonwallet/./src/util/safeExec.ts","webpack://mytonwallet/./src/util/schedulers.ts","webpack://mytonwallet/./src/util/withCache.ts","webpack://mytonwallet/webpack/bootstrap","webpack://mytonwallet/webpack/runtime/compat get default export","webpack://mytonwallet/webpack/runtime/define property getters","webpack://mytonwallet/webpack/runtime/ensure chunk","webpack://mytonwallet/webpack/runtime/get javascript chunk filename","webpack://mytonwallet/webpack/runtime/get mini-css chunk filename","webpack://mytonwallet/webpack/runtime/global","webpack://mytonwallet/webpack/runtime/hasOwnProperty shorthand","webpack://mytonwallet/webpack/runtime/make namespace object","webpack://mytonwallet/webpack/runtime/publicPath","webpack://mytonwallet/webpack/runtime/importScripts chunk loading","webpack://mytonwallet/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([494,362,776].map(__webpack_require__.e, __webpack_require__)).then(next);\n};","import type { Address, Dictionary } from '@ton/core';\n\nexport type AddrList = Dictionary<Address, Boolean>;\n\nexport const JettonStakingOpCodes = {\n  GET_STATIC_DATA: 0X2FCB26A2,\n  REPORT_STATIC_DATA: 0X8B771735,\n  GET_STORAGE_DATA: 0X5B88E5CC,\n  REPORT_STORAGE_DATA: 0XAAB4A8EF,\n  EXCESSES: 0XD53276DB,\n\n  // Jettons,\n  TRANSFER_JETTON: 0X0F8A7EA5,\n  INTERNAL_TRANSFER: 0X178D4519,\n  TRANSFER_NOTIFICATION: 0X7362D09C,\n  PROVIDE_WALLET_ADDRESS: 0X2C76B973,\n  TAKE_WALLET_ADDRESS: 0XD1735400,\n  BURN_JETTON: 0X595F07BC,\n\n  // Staking pool,\n  STAKE_JETTONS: 0XE3A06989,\n  ADD_REWARDS: 0XDB16AC95,\n  SEND_CLAIMED_REWARDS: 0X44BC1FE3,\n  SEND_UNSTAKED_JETTONS: 0XFB232BC3,\n  APPROVE_STAKE: 0X919DE781,\n  CANCEL_STAKE: 0X9EADA1D9,\n  ADD_REWARD_JETTONS: 0X10676AE7,\n  CLAIM_COMMISSIONS: 0XBCA8F067,\n  REQUEST_UPDATE_REWARDS: 0XF5C5BAA3,\n\n  // Staked jetton wallet,\n  CLAIM_REWARDS: 0X78D9F109,\n  RECEIVE_JETTONS: 0XD68A4AC1,\n  UNSTAKE_JETTONS: 0X499A9262,\n  UNSTAKE_REQUEST: 0X0168D4B7,\n  CANCEL_UNSTAKE_REQUEST: 0XA4910F1A,\n  UPDATE_REWARDS: 0XAE9307CE,\n  CONFIRM_TRANSFER: 0XBC85EB11,\n\n  // Pools admin,\n  DEPLOY_NEW_POOL: 0XDA861F17,\n  SEND_COMMISSIONS: 0XB96ADAEA,\n  SET_CODE: 0xe2d2d211,\n  CHANGE_CREATION_FEE: 0x66D5528B,\n  CHANGE_CONTENT: 0x0ec29200,\n  UPDATE_CODES: 0x85c923cf,\n};\n\nexport const JettonStakingGas = {\n  MIN_RESERVE: 20_000_000n,\n  DEPLOY_POOL: 340_000_000n,\n  NOTIFICATION: 340_000_000n,\n  JETTON_TRANSFER: 55_000_000n,\n  BURN_JETTONS: 340_000_000n,\n  STAKE_JETTONS: 300_000_000n, // It was 340000000n\n  UNSTAKE_JETTONS: 340_000_000n,\n  CANCEL_UNSTAKE: 340_000_000n,\n  SEND_COMMISSIONS: 340_000_000n,\n  SIMPLE_UPDATE_REQUEST: 340_000_000n,\n  ADD_REWARDS: 340_000_000n,\n  APPROVE_TRANSFER: 340_000_000n,\n  SAVE_UPDATED_REWARDS: 340_000_000n,\n  MIN_EXCESS: 10_000_000n,\n  SEND_STAKED_JETTONS: 630_000_000n,\n};\n\nexport const Dividers = {\n  COMMISSION_DIVIDER: 10000n,\n  REWARDS_DIVIDER: 1000,\n  DISTRIBUTION_SPEED_DIVIDER: BigInt(24 * 60 * 60),\n  DISTRIBUTED_REWARDS_DIVIDER: 100000000000000000000000000000000000000n,\n};\n","// eslint-disable-next-line max-classes-per-file\nimport type { ApiAnyDisplayError } from './types';\nimport { ApiCommonError, ApiTransactionError } from './types';\n\nexport class ApiBaseError extends Error {\n  constructor(message?: string, public displayError?: ApiAnyDisplayError) {\n    super(message);\n    this.name = this.constructor.name;\n  }\n}\n\nexport class ApiUserRejectsError extends ApiBaseError {\n  constructor(message: string = 'Canceled by the user') {\n    super(message);\n  }\n}\n\nexport class ApiServerError extends ApiBaseError {\n  constructor(message: string, public statusCode?: number) {\n    super(message, ApiCommonError.ServerError);\n  }\n}\n\nexport class ApiUnsupportedVersionError extends ApiBaseError {\n  constructor(message: string) {\n    super(message, ApiCommonError.UnsupportedVersion);\n  }\n}\n\nexport class ApiHardwareBlindSigningNotEnabled extends ApiBaseError {\n  constructor(message: string = 'Blind signing not enabled') {\n    super(message, ApiTransactionError.HardwareBlindSigningNotEnabled);\n  }\n}\n\nexport class AbortOperationError extends ApiBaseError {\n  constructor(message: string = 'Abort operation') {\n    super(message);\n  }\n}\n\nexport class NotImplemented extends ApiBaseError {\n  constructor(message: string = 'Not implemented') {\n    super(message);\n  }\n}\n\nexport function maybeApiErrors(fn: AnyAsyncFunction) {\n  return async (...args: any) => {\n    try {\n      return await fn(...args);\n    } catch (err) {\n      return handleServerError(err);\n    }\n  };\n}\n\nexport function handleServerError(err: any) {\n  if (err instanceof ApiServerError) {\n    return { error: err.displayError! };\n  }\n  throw err;\n}\n","/*\n *  big.js v6.2.1\n *  A small, fast, easy-to-use library for arbitrary-precision decimal arithmetic.\n *  Copyright (c) 2022 Michael Mclaughlin\n *  https://github.com/MikeMcl/big.js/LICENCE.md\n */\n\n\n/************************************** EDITABLE DEFAULTS *****************************************/\n\n\n  // The default values below must be integers within the stated ranges.\n\n  /*\n   * The maximum number of decimal places (DP) of the results of operations involving division:\n   * div and sqrt, and pow with negative exponents.\n   */\nvar DP = 20,          // 0 to MAX_DP\n\n  /*\n   * The rounding mode (RM) used when rounding to the above decimal places.\n   *\n   *  0  Towards zero (i.e. truncate, no rounding).       (ROUND_DOWN)\n   *  1  To nearest neighbour. If equidistant, round up.  (ROUND_HALF_UP)\n   *  2  To nearest neighbour. If equidistant, to even.   (ROUND_HALF_EVEN)\n   *  3  Away from zero.                                  (ROUND_UP)\n   */\n  RM = 1,             // 0, 1, 2 or 3\n\n  // The maximum value of DP and Big.DP.\n  MAX_DP = 1E6,       // 0 to 1000000\n\n  // The maximum magnitude of the exponent argument to the pow method.\n  MAX_POWER = 1E6,    // 1 to 1000000\n\n  /*\n   * The negative exponent (NE) at and beneath which toString returns exponential notation.\n   * (JavaScript numbers: -7)\n   * -1000000 is the minimum recommended exponent value of a Big.\n   */\n  NE = -7,            // 0 to -1000000\n\n  /*\n   * The positive exponent (PE) at and above which toString returns exponential notation.\n   * (JavaScript numbers: 21)\n   * 1000000 is the maximum recommended exponent value of a Big, but this limit is not enforced.\n   */\n  PE = 21,            // 0 to 1000000\n\n  /*\n   * When true, an error will be thrown if a primitive number is passed to the Big constructor,\n   * or if valueOf is called, or if toNumber is called on a Big which cannot be converted to a\n   * primitive number without a loss of precision.\n   */\n  STRICT = false,     // true or false\n\n\n/**************************************************************************************************/\n\n\n  // Error messages.\n  NAME = '[big.js] ',\n  INVALID = NAME + 'Invalid ',\n  INVALID_DP = INVALID + 'decimal places',\n  INVALID_RM = INVALID + 'rounding mode',\n  DIV_BY_ZERO = NAME + 'Division by zero',\n\n  // The shared prototype object.\n  P = {},\n  UNDEFINED = void 0,\n  NUMERIC = /^-?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n\n/*\n * Create and return a Big constructor.\n */\nfunction _Big_() {\n\n  /*\n   * The Big constructor and exported function.\n   * Create and return a new instance of a Big number object.\n   *\n   * n {number|string|Big} A numeric value.\n   */\n  function Big(n) {\n    var x = this;\n\n    // Enable constructor usage without new.\n    if (!(x instanceof Big)) return n === UNDEFINED ? _Big_() : new Big(n);\n\n    // Duplicate.\n    if (n instanceof Big) {\n      x.s = n.s;\n      x.e = n.e;\n      x.c = n.c.slice();\n    } else {\n      if (typeof n !== 'string') {\n        if (Big.strict === true && typeof n !== 'bigint') {\n          throw TypeError(INVALID + 'value');\n        }\n\n        // Minus zero?\n        n = n === 0 && 1 / n < 0 ? '-0' : String(n);\n      }\n\n      parse(x, n);\n    }\n\n    // Retain a reference to this Big constructor.\n    // Shadow Big.prototype.constructor which points to Object.\n    x.constructor = Big;\n  }\n\n  Big.prototype = P;\n  Big.DP = DP;\n  Big.RM = RM;\n  Big.NE = NE;\n  Big.PE = PE;\n  Big.strict = STRICT;\n  Big.roundDown = 0;\n  Big.roundHalfUp = 1;\n  Big.roundHalfEven = 2;\n  Big.roundUp = 3;\n\n  return Big;\n}\n\n\n/*\n * Parse the number or string value passed to a Big constructor.\n *\n * x {Big} A Big number instance.\n * n {number|string} A numeric value.\n */\nfunction parse(x, n) {\n  var e, i, nl;\n\n  if (!NUMERIC.test(n)) {\n    throw Error(INVALID + 'number');\n  }\n\n  // Determine sign.\n  x.s = n.charAt(0) == '-' ? (n = n.slice(1), -1) : 1;\n\n  // Decimal point?\n  if ((e = n.indexOf('.')) > -1) n = n.replace('.', '');\n\n  // Exponential form?\n  if ((i = n.search(/e/i)) > 0) {\n\n    // Determine exponent.\n    if (e < 0) e = i;\n    e += +n.slice(i + 1);\n    n = n.substring(0, i);\n  } else if (e < 0) {\n\n    // Integer.\n    e = n.length;\n  }\n\n  nl = n.length;\n\n  // Determine leading zeros.\n  for (i = 0; i < nl && n.charAt(i) == '0';) ++i;\n\n  if (i == nl) {\n\n    // Zero.\n    x.c = [x.e = 0];\n  } else {\n\n    // Determine trailing zeros.\n    for (; nl > 0 && n.charAt(--nl) == '0';);\n    x.e = e - i - 1;\n    x.c = [];\n\n    // Convert string to array of digits without leading/trailing zeros.\n    for (e = 0; i <= nl;) x.c[e++] = +n.charAt(i++);\n  }\n\n  return x;\n}\n\n\n/*\n * Round Big x to a maximum of sd significant digits using rounding mode rm.\n *\n * x {Big} The Big to round.\n * sd {number} Significant digits: integer, 0 to MAX_DP inclusive.\n * rm {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n * [more] {boolean} Whether the result of division was truncated.\n */\nfunction round(x, sd, rm, more) {\n  var xc = x.c;\n\n  if (rm === UNDEFINED) rm = x.constructor.RM;\n  if (rm !== 0 && rm !== 1 && rm !== 2 && rm !== 3) {\n    throw Error(INVALID_RM);\n  }\n\n  if (sd < 1) {\n    more =\n      rm === 3 && (more || !!xc[0]) || sd === 0 && (\n      rm === 1 && xc[0] >= 5 ||\n      rm === 2 && (xc[0] > 5 || xc[0] === 5 && (more || xc[1] !== UNDEFINED))\n    );\n\n    xc.length = 1;\n\n    if (more) {\n\n      // 1, 0.1, 0.01, 0.001, 0.0001 etc.\n      x.e = x.e - sd + 1;\n      xc[0] = 1;\n    } else {\n\n      // Zero.\n      xc[0] = x.e = 0;\n    }\n  } else if (sd < xc.length) {\n\n    // xc[sd] is the digit after the digit that may be rounded up.\n    more =\n      rm === 1 && xc[sd] >= 5 ||\n      rm === 2 && (xc[sd] > 5 || xc[sd] === 5 &&\n        (more || xc[sd + 1] !== UNDEFINED || xc[sd - 1] & 1)) ||\n      rm === 3 && (more || !!xc[0]);\n\n    // Remove any digits after the required precision.\n    xc.length = sd;\n\n    // Round up?\n    if (more) {\n\n      // Rounding up may mean the previous digit has to be rounded up.\n      for (; ++xc[--sd] > 9;) {\n        xc[sd] = 0;\n        if (sd === 0) {\n          ++x.e;\n          xc.unshift(1);\n          break;\n        }\n      }\n    }\n\n    // Remove trailing zeros.\n    for (sd = xc.length; !xc[--sd];) xc.pop();\n  }\n\n  return x;\n}\n\n\n/*\n * Return a string representing the value of Big x in normal or exponential notation.\n * Handles P.toExponential, P.toFixed, P.toJSON, P.toPrecision, P.toString and P.valueOf.\n */\nfunction stringify(x, doExponential, isNonzero) {\n  var e = x.e,\n    s = x.c.join(''),\n    n = s.length;\n\n  // Exponential notation?\n  if (doExponential) {\n    s = s.charAt(0) + (n > 1 ? '.' + s.slice(1) : '') + (e < 0 ? 'e' : 'e+') + e;\n\n  // Normal notation.\n  } else if (e < 0) {\n    for (; ++e;) s = '0' + s;\n    s = '0.' + s;\n  } else if (e > 0) {\n    if (++e > n) {\n      for (e -= n; e--;) s += '0';\n    } else if (e < n) {\n      s = s.slice(0, e) + '.' + s.slice(e);\n    }\n  } else if (n > 1) {\n    s = s.charAt(0) + '.' + s.slice(1);\n  }\n\n  return x.s < 0 && isNonzero ? '-' + s : s;\n}\n\n\n// Prototype/instance methods\n\n\n/*\n * Return a new Big whose value is the absolute value of this Big.\n */\nP.abs = function () {\n  var x = new this.constructor(this);\n  x.s = 1;\n  return x;\n};\n\n\n/*\n * Return 1 if the value of this Big is greater than the value of Big y,\n *       -1 if the value of this Big is less than the value of Big y, or\n *        0 if they have the same value.\n */\nP.cmp = function (y) {\n  var isneg,\n    x = this,\n    xc = x.c,\n    yc = (y = new x.constructor(y)).c,\n    i = x.s,\n    j = y.s,\n    k = x.e,\n    l = y.e;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) return !xc[0] ? !yc[0] ? 0 : -j : i;\n\n  // Signs differ?\n  if (i != j) return i;\n\n  isneg = i < 0;\n\n  // Compare exponents.\n  if (k != l) return k > l ^ isneg ? 1 : -1;\n\n  j = (k = xc.length) < (l = yc.length) ? k : l;\n\n  // Compare digit by digit.\n  for (i = -1; ++i < j;) {\n    if (xc[i] != yc[i]) return xc[i] > yc[i] ^ isneg ? 1 : -1;\n  }\n\n  // Compare lengths.\n  return k == l ? 0 : k > l ^ isneg ? 1 : -1;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big divided by the value of Big y, rounded,\n * if necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\n */\nP.div = function (y) {\n  var x = this,\n    Big = x.constructor,\n    a = x.c,                  // dividend\n    b = (y = new Big(y)).c,   // divisor\n    k = x.s == y.s ? 1 : -1,\n    dp = Big.DP;\n\n  if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n    throw Error(INVALID_DP);\n  }\n\n  // Divisor is zero?\n  if (!b[0]) {\n    throw Error(DIV_BY_ZERO);\n  }\n\n  // Dividend is 0? Return +-0.\n  if (!a[0]) {\n    y.s = k;\n    y.c = [y.e = 0];\n    return y;\n  }\n\n  var bl, bt, n, cmp, ri,\n    bz = b.slice(),\n    ai = bl = b.length,\n    al = a.length,\n    r = a.slice(0, bl),   // remainder\n    rl = r.length,\n    q = y,                // quotient\n    qc = q.c = [],\n    qi = 0,\n    p = dp + (q.e = x.e - y.e) + 1;    // precision of the result\n\n  q.s = k;\n  k = p < 0 ? 0 : p;\n\n  // Create version of divisor with leading zero.\n  bz.unshift(0);\n\n  // Add zeros to make remainder as long as divisor.\n  for (; rl++ < bl;) r.push(0);\n\n  do {\n\n    // n is how many times the divisor goes into current remainder.\n    for (n = 0; n < 10; n++) {\n\n      // Compare divisor and remainder.\n      if (bl != (rl = r.length)) {\n        cmp = bl > rl ? 1 : -1;\n      } else {\n        for (ri = -1, cmp = 0; ++ri < bl;) {\n          if (b[ri] != r[ri]) {\n            cmp = b[ri] > r[ri] ? 1 : -1;\n            break;\n          }\n        }\n      }\n\n      // If divisor < remainder, subtract divisor from remainder.\n      if (cmp < 0) {\n\n        // Remainder can't be more than 1 digit longer than divisor.\n        // Equalise lengths using divisor with extra leading zero?\n        for (bt = rl == bl ? b : bz; rl;) {\n          if (r[--rl] < bt[rl]) {\n            ri = rl;\n            for (; ri && !r[--ri];) r[ri] = 9;\n            --r[ri];\n            r[rl] += 10;\n          }\n          r[rl] -= bt[rl];\n        }\n\n        for (; !r[0];) r.shift();\n      } else {\n        break;\n      }\n    }\n\n    // Add the digit n to the result array.\n    qc[qi++] = cmp ? n : ++n;\n\n    // Update the remainder.\n    if (r[0] && cmp) r[rl] = a[ai] || 0;\n    else r = [a[ai]];\n\n  } while ((ai++ < al || r[0] !== UNDEFINED) && k--);\n\n  // Leading zero? Do not remove if result is simply zero (qi == 1).\n  if (!qc[0] && qi != 1) {\n\n    // There can't be more than one zero.\n    qc.shift();\n    q.e--;\n    p--;\n  }\n\n  // Round?\n  if (qi > p) round(q, p, Big.RM, r[0] !== UNDEFINED);\n\n  return q;\n};\n\n\n/*\n * Return true if the value of this Big is equal to the value of Big y, otherwise return false.\n */\nP.eq = function (y) {\n  return this.cmp(y) === 0;\n};\n\n\n/*\n * Return true if the value of this Big is greater than the value of Big y, otherwise return\n * false.\n */\nP.gt = function (y) {\n  return this.cmp(y) > 0;\n};\n\n\n/*\n * Return true if the value of this Big is greater than or equal to the value of Big y, otherwise\n * return false.\n */\nP.gte = function (y) {\n  return this.cmp(y) > -1;\n};\n\n\n/*\n * Return true if the value of this Big is less than the value of Big y, otherwise return false.\n */\nP.lt = function (y) {\n  return this.cmp(y) < 0;\n};\n\n\n/*\n * Return true if the value of this Big is less than or equal to the value of Big y, otherwise\n * return false.\n */\nP.lte = function (y) {\n  return this.cmp(y) < 1;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big minus the value of Big y.\n */\nP.minus = P.sub = function (y) {\n  var i, j, t, xlty,\n    x = this,\n    Big = x.constructor,\n    a = x.s,\n    b = (y = new Big(y)).s;\n\n  // Signs differ?\n  if (a != b) {\n    y.s = -b;\n    return x.plus(y);\n  }\n\n  var xc = x.c.slice(),\n    xe = x.e,\n    yc = y.c,\n    ye = y.e;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) {\n    if (yc[0]) {\n      y.s = -b;\n    } else if (xc[0]) {\n      y = new Big(x);\n    } else {\n      y.s = 1;\n    }\n    return y;\n  }\n\n  // Determine which is the bigger number. Prepend zeros to equalise exponents.\n  if (a = xe - ye) {\n\n    if (xlty = a < 0) {\n      a = -a;\n      t = xc;\n    } else {\n      ye = xe;\n      t = yc;\n    }\n\n    t.reverse();\n    for (b = a; b--;) t.push(0);\n    t.reverse();\n  } else {\n\n    // Exponents equal. Check digit by digit.\n    j = ((xlty = xc.length < yc.length) ? xc : yc).length;\n\n    for (a = b = 0; b < j; b++) {\n      if (xc[b] != yc[b]) {\n        xlty = xc[b] < yc[b];\n        break;\n      }\n    }\n  }\n\n  // x < y? Point xc to the array of the bigger number.\n  if (xlty) {\n    t = xc;\n    xc = yc;\n    yc = t;\n    y.s = -y.s;\n  }\n\n  /*\n   * Append zeros to xc if shorter. No need to add zeros to yc if shorter as subtraction only\n   * needs to start at yc.length.\n   */\n  if ((b = (j = yc.length) - (i = xc.length)) > 0) for (; b--;) xc[i++] = 0;\n\n  // Subtract yc from xc.\n  for (b = i; j > a;) {\n    if (xc[--j] < yc[j]) {\n      for (i = j; i && !xc[--i];) xc[i] = 9;\n      --xc[i];\n      xc[j] += 10;\n    }\n\n    xc[j] -= yc[j];\n  }\n\n  // Remove trailing zeros.\n  for (; xc[--b] === 0;) xc.pop();\n\n  // Remove leading zeros and adjust exponent accordingly.\n  for (; xc[0] === 0;) {\n    xc.shift();\n    --ye;\n  }\n\n  if (!xc[0]) {\n\n    // n - n = +0\n    y.s = 1;\n\n    // Result must be zero.\n    xc = [ye = 0];\n  }\n\n  y.c = xc;\n  y.e = ye;\n\n  return y;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big modulo the value of Big y.\n */\nP.mod = function (y) {\n  var ygtx,\n    x = this,\n    Big = x.constructor,\n    a = x.s,\n    b = (y = new Big(y)).s;\n\n  if (!y.c[0]) {\n    throw Error(DIV_BY_ZERO);\n  }\n\n  x.s = y.s = 1;\n  ygtx = y.cmp(x) == 1;\n  x.s = a;\n  y.s = b;\n\n  if (ygtx) return new Big(x);\n\n  a = Big.DP;\n  b = Big.RM;\n  Big.DP = Big.RM = 0;\n  x = x.div(y);\n  Big.DP = a;\n  Big.RM = b;\n\n  return this.minus(x.times(y));\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big negated.\n */\nP.neg = function () {\n  var x = new this.constructor(this);\n  x.s = -x.s;\n  return x;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big plus the value of Big y.\n */\nP.plus = P.add = function (y) {\n  var e, k, t,\n    x = this,\n    Big = x.constructor;\n\n  y = new Big(y);\n\n  // Signs differ?\n  if (x.s != y.s) {\n    y.s = -y.s;\n    return x.minus(y);\n  }\n\n  var xe = x.e,\n    xc = x.c,\n    ye = y.e,\n    yc = y.c;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) {\n    if (!yc[0]) {\n      if (xc[0]) {\n        y = new Big(x);\n      } else {\n        y.s = x.s;\n      }\n    }\n    return y;\n  }\n\n  xc = xc.slice();\n\n  // Prepend zeros to equalise exponents.\n  // Note: reverse faster than unshifts.\n  if (e = xe - ye) {\n    if (e > 0) {\n      ye = xe;\n      t = yc;\n    } else {\n      e = -e;\n      t = xc;\n    }\n\n    t.reverse();\n    for (; e--;) t.push(0);\n    t.reverse();\n  }\n\n  // Point xc to the longer array.\n  if (xc.length - yc.length < 0) {\n    t = yc;\n    yc = xc;\n    xc = t;\n  }\n\n  e = yc.length;\n\n  // Only start adding at yc.length - 1 as the further digits of xc can be left as they are.\n  for (k = 0; e; xc[e] %= 10) k = (xc[--e] = xc[e] + yc[e] + k) / 10 | 0;\n\n  // No need to check for zero, as +x + +y != 0 && -x + -y != 0\n\n  if (k) {\n    xc.unshift(k);\n    ++ye;\n  }\n\n  // Remove trailing zeros.\n  for (e = xc.length; xc[--e] === 0;) xc.pop();\n\n  y.c = xc;\n  y.e = ye;\n\n  return y;\n};\n\n\n/*\n * Return a Big whose value is the value of this Big raised to the power n.\n * If n is negative, round to a maximum of Big.DP decimal places using rounding\n * mode Big.RM.\n *\n * n {number} Integer, -MAX_POWER to MAX_POWER inclusive.\n */\nP.pow = function (n) {\n  var x = this,\n    one = new x.constructor('1'),\n    y = one,\n    isneg = n < 0;\n\n  if (n !== ~~n || n < -MAX_POWER || n > MAX_POWER) {\n    throw Error(INVALID + 'exponent');\n  }\n\n  if (isneg) n = -n;\n\n  for (;;) {\n    if (n & 1) y = y.times(x);\n    n >>= 1;\n    if (!n) break;\n    x = x.times(x);\n  }\n\n  return isneg ? one.div(y) : y;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big rounded to a maximum precision of sd\n * significant digits using rounding mode rm, or Big.RM if rm is not specified.\n *\n * sd {number} Significant digits: integer, 1 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.prec = function (sd, rm) {\n  if (sd !== ~~sd || sd < 1 || sd > MAX_DP) {\n    throw Error(INVALID + 'precision');\n  }\n  return round(new this.constructor(this), sd, rm);\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big rounded to a maximum of dp decimal places\n * using rounding mode rm, or Big.RM if rm is not specified.\n * If dp is negative, round to an integer which is a multiple of 10**-dp.\n * If dp is not specified, round to 0 decimal places.\n *\n * dp? {number} Integer, -MAX_DP to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.round = function (dp, rm) {\n  if (dp === UNDEFINED) dp = 0;\n  else if (dp !== ~~dp || dp < -MAX_DP || dp > MAX_DP) {\n    throw Error(INVALID_DP);\n  }\n  return round(new this.constructor(this), dp + this.e + 1, rm);\n};\n\n\n/*\n * Return a new Big whose value is the square root of the value of this Big, rounded, if\n * necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\n */\nP.sqrt = function () {\n  var r, c, t,\n    x = this,\n    Big = x.constructor,\n    s = x.s,\n    e = x.e,\n    half = new Big('0.5');\n\n  // Zero?\n  if (!x.c[0]) return new Big(x);\n\n  // Negative?\n  if (s < 0) {\n    throw Error(NAME + 'No square root');\n  }\n\n  // Estimate.\n  s = Math.sqrt(x + '');\n\n  // Math.sqrt underflow/overflow?\n  // Re-estimate: pass x coefficient to Math.sqrt as integer, then adjust the result exponent.\n  if (s === 0 || s === 1 / 0) {\n    c = x.c.join('');\n    if (!(c.length + e & 1)) c += '0';\n    s = Math.sqrt(c);\n    e = ((e + 1) / 2 | 0) - (e < 0 || e & 1);\n    r = new Big((s == 1 / 0 ? '5e' : (s = s.toExponential()).slice(0, s.indexOf('e') + 1)) + e);\n  } else {\n    r = new Big(s + '');\n  }\n\n  e = r.e + (Big.DP += 4);\n\n  // Newton-Raphson iteration.\n  do {\n    t = r;\n    r = half.times(t.plus(x.div(t)));\n  } while (t.c.slice(0, e).join('') !== r.c.slice(0, e).join(''));\n\n  return round(r, (Big.DP -= 4) + r.e + 1, Big.RM);\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big times the value of Big y.\n */\nP.times = P.mul = function (y) {\n  var c,\n    x = this,\n    Big = x.constructor,\n    xc = x.c,\n    yc = (y = new Big(y)).c,\n    a = xc.length,\n    b = yc.length,\n    i = x.e,\n    j = y.e;\n\n  // Determine sign of result.\n  y.s = x.s == y.s ? 1 : -1;\n\n  // Return signed 0 if either 0.\n  if (!xc[0] || !yc[0]) {\n    y.c = [y.e = 0];\n    return y;\n  }\n\n  // Initialise exponent of result as x.e + y.e.\n  y.e = i + j;\n\n  // If array xc has fewer digits than yc, swap xc and yc, and lengths.\n  if (a < b) {\n    c = xc;\n    xc = yc;\n    yc = c;\n    j = a;\n    a = b;\n    b = j;\n  }\n\n  // Initialise coefficient array of result with zeros.\n  for (c = new Array(j = a + b); j--;) c[j] = 0;\n\n  // Multiply.\n\n  // i is initially xc.length.\n  for (i = b; i--;) {\n    b = 0;\n\n    // a is yc.length.\n    for (j = a + i; j > i;) {\n\n      // Current sum of products at this digit position, plus carry.\n      b = c[j] + yc[i] * xc[j - i - 1] + b;\n      c[j--] = b % 10;\n\n      // carry\n      b = b / 10 | 0;\n    }\n\n    c[j] = b;\n  }\n\n  // Increment result exponent if there is a final carry, otherwise remove leading zero.\n  if (b) ++y.e;\n  else c.shift();\n\n  // Remove trailing zeros.\n  for (i = c.length; !c[--i];) c.pop();\n  y.c = c;\n\n  return y;\n};\n\n\n/*\n * Return a string representing the value of this Big in exponential notation rounded to dp fixed\n * decimal places using rounding mode rm, or Big.RM if rm is not specified.\n *\n * dp? {number} Decimal places: integer, 0 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.toExponential = function (dp, rm) {\n  var x = this,\n    n = x.c[0];\n\n  if (dp !== UNDEFINED) {\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n      throw Error(INVALID_DP);\n    }\n    x = round(new x.constructor(x), ++dp, rm);\n    for (; x.c.length < dp;) x.c.push(0);\n  }\n\n  return stringify(x, true, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big in normal notation rounded to dp fixed\n * decimal places using rounding mode rm, or Big.RM if rm is not specified.\n *\n * dp? {number} Decimal places: integer, 0 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n *\n * (-0).toFixed(0) is '0', but (-0.1).toFixed(0) is '-0'.\n * (-0).toFixed(1) is '0.0', but (-0.01).toFixed(1) is '-0.0'.\n */\nP.toFixed = function (dp, rm) {\n  var x = this,\n    n = x.c[0];\n\n  if (dp !== UNDEFINED) {\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n      throw Error(INVALID_DP);\n    }\n    x = round(new x.constructor(x), dp + x.e + 1, rm);\n\n    // x.e may have changed if the value is rounded up.\n    for (dp = dp + x.e + 1; x.c.length < dp;) x.c.push(0);\n  }\n\n  return stringify(x, false, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big.\n * Return exponential notation if this Big has a positive exponent equal to or greater than\n * Big.PE, or a negative exponent equal to or less than Big.NE.\n * Omit the sign for negative zero.\n */\nP[Symbol.for('nodejs.util.inspect.custom')] = P.toJSON = P.toString = function () {\n  var x = this,\n    Big = x.constructor;\n  return stringify(x, x.e <= Big.NE || x.e >= Big.PE, !!x.c[0]);\n};\n\n\n/*\n * Return the value of this Big as a primitve number.\n */\nP.toNumber = function () {\n  var n = Number(stringify(this, true, true));\n  if (this.constructor.strict === true && !this.eq(n.toString())) {\n    throw Error(NAME + 'Imprecise conversion');\n  }\n  return n;\n};\n\n\n/*\n * Return a string representing the value of this Big rounded to sd significant digits using\n * rounding mode rm, or Big.RM if rm is not specified.\n * Use exponential notation if sd is less than the number of digits necessary to represent\n * the integer part of the value in normal notation.\n *\n * sd {number} Significant digits: integer, 1 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.toPrecision = function (sd, rm) {\n  var x = this,\n    Big = x.constructor,\n    n = x.c[0];\n\n  if (sd !== UNDEFINED) {\n    if (sd !== ~~sd || sd < 1 || sd > MAX_DP) {\n      throw Error(INVALID + 'precision');\n    }\n    x = round(new Big(x), sd, rm);\n    for (; x.c.length < sd;) x.c.push(0);\n  }\n\n  return stringify(x, sd <= x.e || x.e <= Big.NE || x.e >= Big.PE, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big.\n * Return exponential notation if this Big has a positive exponent equal to or greater than\n * Big.PE, or a negative exponent equal to or less than Big.NE.\n * Include the sign for negative zero.\n */\nP.valueOf = function () {\n  var x = this,\n    Big = x.constructor;\n  if (Big.strict === true) {\n    throw Error(NAME + 'valueOf disallowed');\n  }\n  return stringify(x, x.e <= Big.NE || x.e >= Big.PE, true);\n};\n\n\n// Export\n\n\nexport var Big = _Big_();\n\n/// <reference types=\"https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/big.js/index.d.ts\" />\nexport default Big;\n","import { TONCOIN } from '../config';\nimport { Big } from '../lib/big.js';\n\nBig.RM = 0; // RoundDown\nBig.NE = -100000; // Disable exponential form\nBig.PE = 100000; // Disable exponential form\n\nconst ten = Big(10);\n\nexport function fromDecimal(value: string | number, decimals?: number) {\n  return BigInt(Big(value).mul(ten.pow(decimals ?? TONCOIN.decimals)).round().toString());\n}\n\nexport function toDecimal(value: bigint | number, decimals?: number, noFloor = false) {\n  return toBig(value, decimals ?? TONCOIN.decimals, noFloor).toString();\n}\n\nexport function toBig(value: bigint | number, decimals: number = TONCOIN.decimals, noFloor = false) {\n  return Big(value.toString()).div(ten.pow(decimals)).round(decimals, noFloor ? Big.roundHalfUp : undefined);\n}\n\nexport function roundDecimal(value: string, decimals: number) {\n  return Big(value).round(decimals).toString();\n}\n","export function random(min: number, max: number) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nexport function sample<T extends any>(arr: T[]) {\n  return arr[random(0, arr.length - 1)];\n}\n\nexport function randomBytes(size: number) {\n  // eslint-disable-next-line no-restricted-globals\n  return self.crypto.getRandomValues(new Uint8Array(size));\n}\n","import { ONE_TON } from '../config';\nimport { fromDecimal } from './decimals';\nimport { randomBytes } from './random';\n\nexport const BIGINT_PREFIX = 'bigint:';\n\nexport function bigintReviver(this: any, key: string, value: any) {\n  if (typeof value === 'string' && value.startsWith(BIGINT_PREFIX)) {\n    return BigInt(value.slice(7));\n  }\n  return value;\n}\n\nexport function bigintAbs(value: bigint) {\n  return value === -0n || value < 0n ? -value : value;\n}\n\nexport function bigintSum(values: bigint[]) {\n  let result = 0n;\n  for (const value of values) result += value;\n  return result;\n}\n\nexport function bigintDivideToNumber(value: bigint, num: number) {\n  return (value * ONE_TON) / fromDecimal(num);\n}\n\nexport function bigintMultiplyToNumber(value: bigint, num: number) {\n  return (value * fromDecimal(num)) / ONE_TON;\n}\n\nexport function bigintRandom(bytes: number) {\n  let value = BigInt(0);\n  for (const randomNumber of randomBytes(bytes)) {\n    const randomBigInt = BigInt(randomNumber);\n    // eslint-disable-next-line no-bitwise\n    value = (value << BigInt(8)) + randomBigInt;\n  }\n  return value;\n}\n\nexport function bigintCountBits(value: bigint) {\n  const binaryString = value.toString(2);\n  return binaryString.length;\n}\n\nexport function bigintMax(value0: bigint, value1: bigint) {\n  return value0 > value1 ? value0 : value1;\n}\n\nexport function bigintMin(value0: bigint, value1: bigint) {\n  return value0 < value1 ? value0 : value1;\n}\n\nexport function bigintMultiplePercent(value: bigint, percent: number) {\n  return (value * fromDecimal(percent / 100)) / ONE_TON;\n}\n","import type {\n  ApiUpdate,\n  CancellableCallback, OriginMessageData, OriginMessageEvent, WorkerMessageData,\n} from './PostMessageConnector';\n\nimport { DETACHED_TAB_URL } from './ledger/tab';\nimport { bigintReviver } from './bigint';\nimport { logDebugError } from './logs';\n\ndeclare const self: WorkerGlobalScope;\n\nconst callbackState = new Map<string, CancellableCallback>();\n\ntype ApiConfig =\n  ((name: string, ...args: any[]) => any | [any, ArrayBuffer[]])\n  | Record<string, Function>;\ntype SendToOrigin = (data: WorkerMessageData, transferables?: Transferable[]) => void;\n\nexport function createPostMessageInterface(\n  api: ApiConfig,\n  channel?: string,\n  target: DedicatedWorkerGlobalScope | Worker = self as DedicatedWorkerGlobalScope,\n  shouldIgnoreErrors?: boolean,\n) {\n  function sendToOrigin(data: WorkerMessageData, transferables?: Transferable[]) {\n    data.channel = channel;\n\n    if (transferables) {\n      target.postMessage(data, transferables);\n    } else {\n      target.postMessage(data);\n    }\n  }\n\n  if (!shouldIgnoreErrors) {\n    handleErrors(sendToOrigin);\n  }\n\n  target.onmessage = (message: OriginMessageEvent) => {\n    if (message.data?.channel === channel) {\n      void onMessage(api, message.data, sendToOrigin);\n    }\n  };\n}\n\nexport function createExtensionInterface(\n  portName: string,\n  api: ApiConfig,\n  channel?: string,\n  cleanUpdater?: (onUpdate: (update: ApiUpdate) => void) => void,\n  withAutoInit = false,\n) {\n  chrome.runtime.onConnect.addListener((port) => {\n    if (port.name !== portName) {\n      return;\n    }\n\n    /**\n     * If the sender's URL includes the DETACHED_TAB_URL, we skip further processing\n     * This condition ensures that we don't interact with tabs that have already been closed.\n     */\n    const url = port.sender?.url;\n    if (url?.includes(DETACHED_TAB_URL)) {\n      return;\n    }\n\n    const origin = url ? new URL(url).origin : undefined;\n\n    const dAppUpdater = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n\n    function sendToOrigin(data: WorkerMessageData) {\n      data.channel = channel;\n      const json = JSON.stringify(data);\n      port.postMessage(json);\n    }\n\n    handleErrors(sendToOrigin);\n\n    port.onMessage.addListener((data: OriginMessageData | string) => {\n      if (typeof data === 'string') {\n        data = JSON.parse(data, bigintReviver) as OriginMessageData;\n      }\n      if (data.channel === channel) {\n        void onMessage(api, data, sendToOrigin, dAppUpdater, origin);\n      }\n    });\n\n    port.onDisconnect.addListener(() => {\n      cleanUpdater?.(dAppUpdater);\n    });\n\n    if (withAutoInit) {\n      void onMessage(api, { type: 'init', name: 'init', args: [] }, sendToOrigin, dAppUpdater);\n    }\n  });\n}\n\nasync function onMessage(\n  api: ApiConfig,\n  data: OriginMessageData,\n  sendToOrigin: SendToOrigin,\n  onUpdate?: (update: ApiUpdate) => void,\n  origin?: string,\n) {\n  if (!onUpdate) {\n    onUpdate = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n  }\n\n  switch (data.type) {\n    case 'init': {\n      const { args } = data;\n      const promise = typeof api === 'function'\n        ? api('init', origin, onUpdate, ...args)\n        : api.init?.(onUpdate, ...args);\n      await promise;\n\n      break;\n    }\n    case 'callMethod': {\n      const {\n        messageId, name, args, withCallback,\n      } = data;\n      try {\n        if (messageId && withCallback) {\n          const callback = (...callbackArgs: any[]) => {\n            const lastArg = callbackArgs[callbackArgs.length - 1];\n\n            sendToOrigin({\n              type: 'methodCallback',\n              messageId,\n              callbackArgs,\n            }, isTransferable(lastArg) ? [lastArg] : undefined);\n          };\n\n          callbackState.set(messageId, callback);\n\n          args.push(callback as never);\n        }\n\n        const response = typeof api === 'function'\n          ? await api(name, origin, ...args)\n          : await api[name](...args);\n        const { arrayBuffer } = (typeof response === 'object' && response && 'arrayBuffer' in response) || {};\n\n        if (messageId) {\n          sendToOrigin(\n            {\n              type: 'methodResponse',\n              messageId,\n              response,\n            },\n            arrayBuffer ? [arrayBuffer] : undefined,\n          );\n        }\n      } catch (err: any) {\n        logDebugError(name, err);\n\n        if (messageId) {\n          sendToOrigin({\n            type: 'methodResponse',\n            messageId,\n            error: { message: err.message },\n          });\n        }\n      }\n\n      if (messageId) {\n        callbackState.delete(messageId);\n      }\n\n      break;\n    }\n    case 'cancelProgress': {\n      const callback = callbackState.get(data.messageId);\n      if (callback) {\n        callback.isCanceled = true;\n      }\n\n      break;\n    }\n  }\n}\n\nfunction isTransferable(obj: any) {\n  return obj instanceof ArrayBuffer || obj instanceof ImageBitmap;\n}\n\nfunction handleErrors(sendToOrigin: SendToOrigin) {\n  self.onerror = (e) => {\n    const message = e.error?.message || 'Uncaught exception in worker';\n    logDebugError(message, e.error);\n\n    sendToOrigin({\n      type: 'unhandledError',\n      error: {\n        message,\n        stack: e.error?.stack,\n      },\n    });\n  };\n\n  self.addEventListener('unhandledrejection', (e) => {\n    const message = e.reason?.message || 'Unhandled rejection in worker';\n    logDebugError(message, e.reason);\n\n    sendToOrigin({\n      type: 'unhandledError',\n      error: {\n        message,\n        stack: e.reason?.stack,\n      },\n    });\n  });\n}\n","import { BIGINT_PREFIX } from './bigint';\n\n// Fixes serialization of objects containing `bigint` values.\n// Extracted to a separate file to avoid leaking into Extension Page Script.\n// @ts-ignore\nBigInt.prototype.toJSON = function toJSON() {\n  return `${BIGINT_PREFIX}${this}`;\n};\n","import type { AccountIdParsed, ApiNetwork } from '../api/types';\n\nexport function parseAccountId(accountId: string): AccountIdParsed {\n  const parts = accountId.split('-');\n  const [id, network = 'mainnet'] = (parts.length === 3 ? [parts[0], parts[2]] : parts) as [string, ApiNetwork];\n  return { id: Number(id), network };\n}\n\nexport function buildAccountId(account: AccountIdParsed) {\n  const { id, network } = account;\n  return `${id}-${network}`;\n}\n","import { PRIVATE_KEY_HEX_LENGTH } from '../config';\n\nexport default function isMnemonicPrivateKey(mnemonic: string[]) {\n  return mnemonic.length === 1 && mnemonic[0].length === PRIVATE_KEY_HEX_LENGTH;\n}\n","import createHmac from 'create-hmac';\nimport * as nacl from 'tweetnacl';\n\ntype Hex = string;\ntype Path = string;\n\ntype Keys = {\n  key: Buffer;\n  chainCode: Buffer;\n};\n\nconst ED25519_CURVE = 'ed25519 seed';\nconst HARDENED_OFFSET = 0x80000000;\n\nconst pathRegex = /^m(\\/[0-9]+')+$/;\nfunction replaceDerive(val: string) {\n  return val.replace(\"'\", '');\n}\n\nexport const getMasterKeyFromSeed = (seed: Hex): Keys => {\n  const hmac = createHmac('sha512', ED25519_CURVE);\n  const I = hmac.update(Buffer.from(seed, 'hex')).digest();\n  const IL = I.slice(0, 32);\n  const IR = I.slice(32);\n  return {\n    key: IL,\n    chainCode: IR,\n  };\n};\n\nexport const CKDPriv = ({ key, chainCode }: Keys, index: number): Keys => {\n  const indexBuffer = Buffer.allocUnsafe(4);\n  indexBuffer.writeUInt32BE(index, 0);\n\n  const data = Buffer.concat([Buffer.alloc(1, 0), key, indexBuffer]);\n\n  const I = createHmac('sha512', chainCode)\n    .update(data)\n    .digest();\n  const IL = I.slice(0, 32);\n  const IR = I.slice(32);\n  return {\n    key: IL,\n    chainCode: IR,\n  };\n};\n\nexport const getPublicKey = (privateKey: Buffer, withZeroByte = true): Buffer => {\n  const keyPair = nacl.sign.keyPair.fromSeed(privateKey);\n  const signPk = keyPair.secretKey.subarray(32);\n  const zero = Buffer.alloc(1, 0);\n  return withZeroByte\n    ? Buffer.concat([zero, Buffer.from(signPk)])\n    : Buffer.from(signPk);\n};\n\nexport const isValidPath = (path: string): boolean => {\n  if (!pathRegex.test(path)) {\n    return false;\n  }\n  return !path\n    .split('/')\n    .slice(1)\n    .map(replaceDerive)\n    // eslint-disable-next-line no-restricted-globals\n    .some(isNaN as any);\n};\n\nexport const derivePath = (path: Path, seed: Hex, offset = HARDENED_OFFSET): Keys => {\n  if (!isValidPath(path)) {\n    throw new Error('Invalid derivation path');\n  }\n\n  const { key, chainCode } = getMasterKeyFromSeed(seed);\n  const segments = path\n    .split('/')\n    .slice(1)\n    .map(replaceDerive)\n    .map((el) => parseInt(el, 10));\n\n  return segments.reduce(\n    (parentKeys, segment) => CKDPriv(parentKeys, segment + offset),\n    { key, chainCode },\n  );\n};\n","import { TON_DNS_ZONES } from '../config';\n\nexport function isDnsDomain(value: string) {\n  return getDnsDomainZone(value) !== undefined;\n}\n\nexport function getDnsDomainZone(domain: string) {\n  for (const zone of TON_DNS_ZONES) {\n    const { suffixes, baseFormat } = zone;\n\n    // Iterating the zones in reverse to prioritize longer zones when multiple zones match (assuming the zones go from\n    // the shortest to the longest). For example, `test.ton.vip` matches both `vip` and `ton.vip`, and `ton.vip` must be\n    // used.\n    for (let i = suffixes.length - 1; i >= 0; i--) {\n      const suffix = suffixes[i];\n      if (!domain.endsWith(`.${suffix}`)) {\n        continue;\n      }\n\n      const base = domain.slice(0, -suffix.length - 1);\n      if (!baseFormat.test(base)) {\n        continue;\n      }\n\n      return { base, zone };\n    }\n  }\n\n  return undefined;\n}\n\nexport function getDnsZoneByCollection(collectionAddress: string) {\n  return TON_DNS_ZONES.find((zone) => zone.resolver === collectionAddress);\n}\n","type CollectionByKey<Member> = Record<number | string, Member>;\ntype GroupedByKey<Member> = Record<number | string, Member[]>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ninterface OrderCallback<T> {\n  (member: T): any;\n}\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: T[], key: keyof T): CollectionByKey<T> {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function groupBy<T extends AnyLiteral>(collection: T[], key: keyof T): GroupedByKey<T> {\n  return collection.reduce((byKey: GroupedByKey<T>, member: T) => {\n    const groupKey = member[key];\n\n    if (!byKey[groupKey]) {\n      byKey[groupKey] = [member];\n    } else {\n      byKey[groupKey]!.push(member);\n    }\n\n    return byKey;\n  }, {});\n}\n\nexport function mapValues<R extends any, M extends any>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key as keyof T] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    if (aValue === bValue) return 0;\n\n    const condition = isAsc ? aValue > bValue : aValue < bValue;\n    return condition ? 1 : -1;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T extends any>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function compact<T extends any>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual(array1: any[], array2: any[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function split<T extends any>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nexport function isLiteralObject(value: any): value is AnyLiteral {\n  return isObject(value) && !Array.isArray(value);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function range(start: number, end: number) {\n  const arr: number[] = [];\n  for (let i = start; i < end;) {\n    arr.push(i++);\n  }\n  return arr;\n}\n\nexport function fromKeyValueArrays<T>(keys: string[], values: T[] | T) {\n  return keys.reduce((acc, key, index) => {\n    acc[key] = Array.isArray(values) ? values[index] : values;\n    return acc;\n  }, {} as Record<string, T>);\n}\n\nexport function extractKey<T, K extends keyof T>(array: T[], key: K): T[K][] {\n  return array.map((value) => value[key]);\n}\n\nexport function findDifference<T>(array1: T[], array2: T[]): T[] {\n  const set2 = new Set(array2);\n\n  return array1.filter((element) => !set2.has(element));\n}\n\nexport function filterValues<M extends any>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => boolean,\n): CollectionByKey<M> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<M>, key, index) => {\n    if (callback(byKey[key], key, index, byKey)) {\n      newByKey[key] = byKey[key];\n    }\n\n    return newByKey;\n  }, {});\n}\n","import type {\n  Address, Cell, Contract, ContractProvider,\n} from '@ton/core';\nimport {\n  beginCell, contractAddress,\n} from '@ton/core';\n\nexport type DnsItemConfig = {};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function dnsItemConfigToCell(config: DnsItemConfig): Cell {\n  return beginCell().endCell();\n}\n\nexport class DnsItem implements Contract {\n  constructor(\n    readonly address: Address,\n    readonly init?: { code: Cell; data: Cell },\n  ) {}\n\n  static createFromAddress(address: Address) {\n    return new DnsItem(address);\n  }\n\n  static createFromConfig(config: DnsItemConfig, code: Cell, workchain = 0) {\n    const data = dnsItemConfigToCell(config);\n    const init = { code, data };\n    return new DnsItem(contractAddress(workchain, init), init);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async getDomain(provider: ContractProvider) {\n    const res = await provider.get('get_domain', []);\n    const domain = res.stack.readString();\n    return domain;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async getTelemintDomain(provider: ContractProvider) {\n    const res = await provider.get('get_domain_full', []);\n    const domain = res.stack.readString();\n    const parts = domain.replace(/\\\\u0000/g, '.').replace(/\\.$/, '').split('.');\n    parts.reverse();\n    return parts.join('.');\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async getNftData(provider: ContractProvider) {\n    const res = await provider.get('get_nft_data', []);\n    const index = res.stack.readBigNumber();\n    const collectionAddress = res.stack.readAddress();\n    const owner = res.stack.readAddressOpt();\n\n    return {\n      index,\n      collectionAddress,\n      owner,\n    };\n  }\n}\n","import { STAKING_POOLS } from '../../config';\n\nexport function sha256(bytes: Uint8Array) {\n  return crypto.subtle.digest('SHA-256', bytes);\n}\n\nexport function bytesToHex(bytes: Uint8Array) {\n  return Buffer.from(bytes).toString('hex');\n}\n\nexport function hexToBytes(hex: string) {\n  return Uint8Array.from(Buffer.from(hex, 'hex'));\n}\n\nexport function bytesToBase64(bytes: Uint8Array) {\n  return Buffer.from(bytes).toString('base64');\n}\n\nexport function base64ToBytes(base64: string) {\n  return Uint8Array.from(Buffer.from(base64, 'base64'));\n}\n\nexport function base64ToString(base64: string) {\n  return Buffer.from(base64, 'base64').toString('utf-8');\n}\n\nexport function isKnownStakingPool(address: string) {\n  return STAKING_POOLS.some((poolPart) => address.endsWith(poolPart));\n}\n","/*\n * This module is to be used instead of /src/util/environment.ts\n * when `window` is not available (e.g. in a web worker).\n */\nimport type { ApiInitArgs } from './types';\n\nimport {\n  ELECTRON_TONCENTER_MAINNET_KEY,\n  ELECTRON_TONCENTER_TESTNET_KEY,\n  IS_CAPACITOR,\n  IS_EXTENSION,\n  TONCENTER_MAINNET_KEY,\n  TONCENTER_TESTNET_KEY,\n} from '../config';\n\nconst ELECTRON_ORIGIN = 'file://';\n\nlet environment: ApiInitArgs & {\n  isDappSupported: boolean;\n  isSseSupported: boolean;\n  apiHeaders?: AnyLiteral;\n  toncenterMainnetKey?: string;\n  toncenterTestnetKey?: string;\n};\n\nexport function setEnvironment(args: ApiInitArgs) {\n  environment = {\n    ...args,\n    isDappSupported: IS_EXTENSION || IS_CAPACITOR || args.isElectron,\n    isSseSupported: args.isElectron || (IS_CAPACITOR && !args.isNativeBottomSheet),\n    // eslint-disable-next-line no-restricted-globals\n    apiHeaders: { 'X-App-Origin': args.isElectron ? ELECTRON_ORIGIN : self?.origin },\n    toncenterMainnetKey: args.isElectron ? ELECTRON_TONCENTER_MAINNET_KEY : TONCENTER_MAINNET_KEY,\n    toncenterTestnetKey: args.isElectron ? ELECTRON_TONCENTER_TESTNET_KEY : TONCENTER_TESTNET_KEY,\n  };\n  return environment;\n}\n\nexport function getEnvironment() {\n  return environment;\n}\n","import type { ApiTonWalletVersion, ContractInfo, ContractName } from './types';\n\nimport { JettonStakingGas } from './contracts/JettonStaking/imports/constants';\n\nexport const TON_BIP39_PATH = \"m/44'/607'/0'\";\n\nexport const ONE_TON = 1_000_000_000n;\nexport const TOKEN_TRANSFER_AMOUNT = 50000000n; // 0.05 TON\nexport const TINY_TOKEN_TRANSFER_AMOUNT = 18000000n; // 0.018 TON\nexport const TOKEN_TRANSFER_REAL_AMOUNT = 32100000n; // 0.0321 TON\nexport const TINY_TOKEN_TRANSFER_REAL_AMOUNT = 8000000n; // 0.008 TON\nexport const TINIEST_TOKEN_TRANSFER_REAL_AMOUNT = 3000000n; // 0.003 TON\nexport const TOKEN_TRANSFER_FORWARD_AMOUNT = 1n; // 0.000000001 TON\nexport const CLAIM_MINTLESS_AMOUNT = 20000000n; // 0.02 TON\n\nexport const NFT_TRANSFER_AMOUNT = 100000000n; // 0.1 TON\nexport const NFT_TRANSFER_REAL_AMOUNT = 5000000n; // 0.005 TON\nexport const NFT_TRANSFER_FORWARD_AMOUNT = 1n; // 0.000000001 TON\n/**\n * When the NFT contract handles the payload we send, it simply adds its data to the payload. If the resulting payload\n * size becomes greater than the cell capacity, the contract fails to send the NFT. To avoid that, we keep some free\n * space in the payload cell we send. This constant is the size of the free space in bits.\n */\nexport const NFT_PAYLOAD_SAFE_MARGIN = 14 * 8;\n\nexport const TON_GAS = {\n  stakeNominators: ONE_TON,\n  unstakeNominators: ONE_TON,\n  stakeLiquid: ONE_TON,\n  unstakeLiquid: ONE_TON,\n  stakeJettonsForward: JettonStakingGas.STAKE_JETTONS,\n  stakeJettons: JettonStakingGas.STAKE_JETTONS + TOKEN_TRANSFER_AMOUNT,\n  unstakeJettons: JettonStakingGas.UNSTAKE_JETTONS,\n  claimJettons: JettonStakingGas.JETTON_TRANSFER + JettonStakingGas.SIMPLE_UPDATE_REQUEST,\n} as const;\n\nexport const TON_GAS_REAL = {\n  stakeNominators: 1_000_052_853n,\n  unstakeNominators: 148_337_433n,\n  stakeLiquid: 20_251_387n,\n  unstakeLiquid: 18_625_604n,\n  stakeJettons: 74_879_996n,\n  unstakeJettons: 59_971_662n,\n  claimJettons: 57_053_859n,\n};\n\nexport const STAKE_COMMENT = 'd';\nexport const UNSTAKE_COMMENT = 'w';\n\nexport const ATTEMPTS = 5;\n\nexport const DEFAULT_DECIMALS = 9;\nexport const DEFAULT_IS_BOUNCEABLE = true;\nexport const WALLET_IS_BOUNCEABLE = false;\n\n// Fee may change, so we add 5% for more reliability. This is only safe for low-fee blockchains such as TON.\nexport const FEE_FACTOR = 1.05;\n\nexport const ALL_WALLET_VERSIONS: ApiTonWalletVersion[] = [\n  'simpleR1', 'simpleR2', 'simpleR3', 'v2R1', 'v2R2', 'v3R1', 'v3R2', 'v4R2', 'W5',\n];\n\nexport enum Workchain {\n  MasterChain = -1,\n  BaseChain = 0,\n}\n\nexport const WORKCHAIN = Workchain.BaseChain;\nexport const TRANSFER_TIMEOUT_SEC = 600; // 10 min.\n\nexport const DEFAULT_MAX_MESSAGES = 4;\nexport const LEDGER_MAX_MESSAGES = 4; // TODO Replace to 1 after DEX support\nexport const W5_MAX_MESSAGES = 255;\n\nexport enum OpCode {\n  Comment = 0,\n  Encrypted = 0x2167da4b,\n}\n\nexport enum JettonOpCode {\n  Transfer = 0xf8a7ea5,\n  TransferNotification = 0x7362d09c,\n  InternalTransfer = 0x178d4519,\n  Excesses = 0xd53276db,\n  Burn = 0x595f07bc,\n  BurnNotification = 0x7bdd97de,\n}\n\nexport enum NftOpCode {\n  TransferOwnership = 0x5fcc3d14,\n  OwnershipAssigned = 0x05138d91,\n}\n\nexport enum LiquidStakingOpCode {\n  // Pool\n  RequestLoan = 0xe642c965,\n  LoanRepayment = 0xdfdca27b,\n  Deposit = 0x47d54391,\n  Withdraw = 0x319B0CDC,\n  Withdrawal = 0x0a77535c,\n  DeployController = 0xb27edcad,\n  Touch = 0x4bc7c2df,\n  Donate = 0x73affe21,\n  // NFT\n  DistributedAsset = 0xdb3b8abd,\n  // Jetton\n  Vote = 0x69fb306c,\n}\n\nexport enum VestingV1OpCode {\n  AddWhitelist = 0x7258a69b,\n}\n\nexport enum SingleNominatorOpCode {\n  Withdraw = 0x1000,\n  ChangeValidator = 0x1001,\n}\n\nexport enum DnsOpCode {\n  ChangeRecord = 0x4eb1f0f9,\n}\n\nexport enum OtherOpCode {\n  TokenBridgePaySwap = 0x8,\n}\n\nexport enum ContractType {\n  Wallet = 'wallet',\n  Staking = 'staking',\n}\n\nexport enum DnsCategory {\n  DnsNextResolver = 'dns_next_resolver',\n  Wallet = 'wallet',\n  Site = 'site',\n  BagId = 'storage',\n  Unknown = 'unknown',\n}\n\nexport const DNS_CATEGORY_HASH_MAP = {\n  dns_next_resolver: '19f02441ee588fdb26ee24b2568dd035c3c9206e11ab979be62e55558a1d17ff',\n  wallet: 'e8d44050873dba865aa7c170ab4cce64d90839a34dcfd6cf71d14e0205443b1b',\n  site: 'fbae041b02c41ed0fd8a4efb039bc780dd6af4a1f0c420f42561ae705dda43fe',\n  storage: '49a25f9feefaffecad0fcd30c50dc9331cff8b55ece53def6285c09e17e6f5d7',\n} as const;\n\nexport const KnownContracts: Record<ContractName, ContractInfo> = {\n  simpleR1: {\n    name: 'simpleR1',\n    hash: '3232dc55b02b3d2a9485adc151cf29c50b94c374d3571cb59390d761b87af8bd',\n    type: ContractType.Wallet,\n  },\n  simpleR2: {\n    name: 'simpleR2',\n    hash: '672ce2b01d2fd487a5e0528611e7e4fc11867148cc13ff772bd773b72fb368df',\n    type: ContractType.Wallet,\n  },\n  simpleR3: {\n    name: 'simpleR3',\n    hash: 'd95417233f66ae218317f533630cbbddc677d6d893d5722be6947c8fad8e9d52',\n    type: ContractType.Wallet,\n  },\n  v2R1: {\n    name: 'v2R1',\n    hash: 'fb3bd539b7e50166f1cfdc0bbd298b1c88f6b261fe5ee61343ea47ab4b256029',\n    type: ContractType.Wallet,\n  },\n  v2R2: {\n    name: 'v2R2',\n    hash: 'b584b6106753b7f34709df505be603e463a44ff6a85adf7fec4e26453c325983',\n    type: ContractType.Wallet,\n  },\n  v3R1: {\n    name: 'v3R1',\n    hash: '11d123ed5c2055128e75a9ef4cf1e837e6d14a9c079c39939885c78dc13626e6',\n    type: ContractType.Wallet,\n  },\n  v3R2: {\n    name: 'v3R2',\n    hash: 'df7bf014ee7ac0c38da19ef1b7fa054e2cc7a4513df1f1aa295109cf3606ac14',\n    type: ContractType.Wallet,\n  },\n  v4R1: {\n    name: 'v4R1',\n    hash: '1bc0dfa40956c911616f8a5db09ecc217601bae48d7d3f9311562c5afcb66dcf',\n    type: ContractType.Wallet,\n  },\n  v4R2: {\n    name: 'v4R2',\n    hash: '5659ce2300f4a09a37b0bdee41246ded52474f032c1d6ffce0d7d31b18b7b2b1',\n    type: ContractType.Wallet,\n  },\n  W5: {\n    name: 'W5',\n    hash: '7e94eaaeaaa423b9396e79747038c42edc4fe98dce65094071f0e0ad2df22fd5',\n    type: ContractType.Wallet,\n  },\n  highloadV2: {\n    name: 'highloadV2',\n    hash: 'fcd7d1f3b3847f0b9bd44bc64a2256c03450979dd1646a24fbc874b075392d6e',\n    type: ContractType.Wallet,\n  },\n  nominatorPool: {\n    name: 'nominatorPool',\n    hash: '26faa2d0fd2a8197ea36ded8dc50ad081cce5244207e9b05c08c1bb655527bff',\n    type: ContractType.Staking,\n  },\n  multisig: {\n    name: 'multisig',\n    hash: '45d890485cdd6b152bcbbe3fb2e16d2df82f6da840440a5b9f34ea13cb0b92d2',\n    type: ContractType.Wallet,\n  },\n  multisigV2: {\n    name: 'multisigV2',\n    hash: 'eb1323c5544d5bf26248dc427d108d722d5c2922dd97dd0bdf903c4cea73ca97',\n    type: ContractType.Wallet,\n  },\n  vesting: {\n    name: 'vesting',\n    hash: '69dc931958f7aa203c4a7bfcf263d25d2d828d573184b542a65dd55c8398ad83',\n    type: ContractType.Wallet,\n  },\n  multisigNew: {\n    name: 'multisigNew',\n    hash: '7cb3678880388acff45d74b2e7e7544caa8039d20b49f57c75b53c051b6fa30f',\n    type: ContractType.Wallet,\n  },\n  dedustPool: {\n    name: 'dedustPool',\n    hash: 'f216ded2b43d32e2d487db6fa6e4d2387f0ef1d7b53ec1ad85f0b4feb8e4ed62',\n    isSwapAllowed: true,\n  },\n  dedustVaultNative: {\n    name: 'dedustVaultNative',\n    hash: '64a42ad66688097422901ae6188670f0d6292ad3bdb4139289666f24187e86cb',\n    isSwapAllowed: true,\n  },\n  dedustVaultJetton: {\n    name: 'dedustVaultJetton',\n    hash: '5bc82f0c5972ccc6732e98cbe31ea4795da818f9e06c991331568182a8362307',\n    isSwapAllowed: true,\n  },\n  stonPtonWallet: {\n    name: 'stonPtonWallet',\n    hash: '6ccbf71a3ed9c7355f84a698a44a7406574bfb8aa34d4bbd86ab75ee9c994880',\n    isSwapAllowed: true,\n  },\n  stonRouter: {\n    name: 'stonRouter',\n    hash: '14ce618a0e9a94adc99fa6e975219ddd675425b30dfa9728f98714c8dc55f9da',\n    isSwapAllowed: true,\n  },\n  stonRouterV2_1: {\n    name: 'stonRouterV2_1',\n    hash: 'd61cb7fb7bee0cc414286a482fccdec53c3f8717e4aae4fc362d98ab6254e6cd',\n    isSwapAllowed: true,\n  },\n  stonPoolV2_1: {\n    name: 'stonPoolV2_1',\n    hash: '16cc513c380e329f45d54f294787e2030e289799eca138961c1cd7e26e882c7c',\n    isSwapAllowed: true,\n  },\n  stonRouterV2_2: {\n    name: 'stonRouterV2_2',\n    hash: '094b5084111addda1b6fac7007c8a8f85ff4ccc63475815ab3dfa3b5b4c6b102',\n    isSwapAllowed: true,\n  },\n  stonPoolV2_2: {\n    name: 'stonPoolV2_2',\n    hash: '11eaf6db706e63adf9327897aaa845c77a631856abfc14375837f19b617cacb4',\n    isSwapAllowed: true,\n  },\n  stonPtonWalletV2: {\n    name: 'stonPtonWalletV2',\n    hash: '2761042202032258de9eb1b672e1ec2e4f13b2af00700195801ada33f7ced1b6',\n    isSwapAllowed: true,\n  },\n  megatonWtonMaster: {\n    name: 'megatonWtonMaster',\n    hash: '4c9790d808ea4470614e021f76c40529efe2fbce8138da4284a29b5f1943ef19',\n    isSwapAllowed: true,\n  },\n  megatonRouter: {\n    name: 'megatonRouter',\n    hash: '5d5f0e3ed9602d1ba96006ead98cb5e9b53f49ce4a5cf675e06e4d440b7d267c',\n    isSwapAllowed: true,\n  },\n};\n","import { bigintRandom, bigintReviver } from '../../../../util/bigint';\n\nexport function cloneDeep<T>(value: T): T {\n  return JSON.parse(JSON.stringify(value), bigintReviver);\n}\n\nexport function stringifyTxId({ lt, hash }: { lt: number | string; hash: string }) {\n  return `${lt}:${hash}`;\n}\n\nexport function parseTxId(txId: string): { lt: number; hash: string } {\n  const [lt, hash] = txId.split(':');\n  return { lt: Number(lt), hash };\n}\n\nexport function generateQueryId() {\n  return bigintRandom(8);\n}\n","import type { OpenedContract } from '@ton/core';\nimport {\n  Address, beginCell, Builder, Cell, Dictionary,\n} from '@ton/core';\nimport { WalletContractV1R1 } from '@ton/ton/dist/wallets/WalletContractV1R1';\nimport { WalletContractV1R2 } from '@ton/ton/dist/wallets/WalletContractV1R2';\nimport { WalletContractV1R3 } from '@ton/ton/dist/wallets/WalletContractV1R3';\nimport { WalletContractV2R1 } from '@ton/ton/dist/wallets/WalletContractV2R1';\nimport { WalletContractV2R2 } from '@ton/ton/dist/wallets/WalletContractV2R2';\nimport { WalletContractV3R1 } from '@ton/ton/dist/wallets/WalletContractV3R1';\nimport { WalletContractV3R2 } from '@ton/ton/dist/wallets/WalletContractV3R2';\nimport { WalletContractV4 } from '@ton/ton/dist/wallets/WalletContractV4';\nimport { WalletContractV5R1 } from '@ton/ton/dist/wallets/WalletContractV5R1';\n\nimport type { ApiNetwork } from '../../../types';\nimport type { ApiTonWalletVersion, TokenTransferBodyParams } from '../types';\n\nimport {\n  DEFAULT_TIMEOUT,\n  TONCENTER_MAINNET_KEY,\n  TONCENTER_MAINNET_URL,\n  TONCENTER_TESTNET_KEY,\n  TONCENTER_TESTNET_URL,\n} from '../../../../config';\nimport { getDnsZoneByCollection } from '../../../../util/dns';\nimport { fromKeyValueArrays, mapValues } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport withCacheAsync from '../../../../util/withCacheAsync';\nimport { DnsItem } from '../contracts/DnsItem';\nimport { JettonMinter } from '../contracts/JettonMaster';\nimport { JettonStakingOpCodes } from '../contracts/JettonStaking/imports/constants';\nimport { StakeWallet } from '../contracts/JettonStaking/StakeWallet';\nimport { StakingPool } from '../contracts/JettonStaking/StakingPool';\nimport { JettonWallet } from '../contracts/JettonWallet';\nimport { hexToBytes } from '../../../common/utils';\nimport { getEnvironment } from '../../../environment';\nimport {\n  DEFAULT_IS_BOUNCEABLE,\n  JettonOpCode,\n  LiquidStakingOpCode,\n  OpCode,\n  WORKCHAIN,\n} from '../constants';\nimport { generateQueryId } from './index';\n\nimport { TonClient } from './TonClient';\n\nexport type TonWalletType = typeof WalletContractV1R1\n| typeof WalletContractV1R2\n| typeof WalletContractV1R3\n| typeof WalletContractV2R1\n| typeof WalletContractV2R2\n| typeof WalletContractV3R1\n| typeof WalletContractV3R2\n| typeof WalletContractV4\n| typeof WalletContractV5R1;\n\nexport type TonWallet = OpenedContract<WalletContractV1R1\n| WalletContractV1R2\n| WalletContractV1R3\n| WalletContractV2R1\n| WalletContractV2R2\n| WalletContractV3R1\n| WalletContractV3R2\n| WalletContractV4\n| WalletContractV5R1>;\n\nconst TON_MAX_COMMENT_BYTES = 127;\n\nlet clientByNetwork: Record<ApiNetwork, TonClient> | undefined;\n\nexport const walletClassMap: Record<ApiTonWalletVersion, TonWalletType> = {\n  simpleR1: WalletContractV1R1,\n  simpleR2: WalletContractV1R2,\n  simpleR3: WalletContractV1R3,\n  v2R1: WalletContractV2R1,\n  v2R2: WalletContractV2R2,\n  v3R1: WalletContractV3R1,\n  v3R2: WalletContractV3R2,\n  v4R2: WalletContractV4,\n  W5: WalletContractV5R1,\n};\n\nexport function getTonClient(network: ApiNetwork = 'mainnet') {\n  if (!clientByNetwork) {\n    clientByNetwork = {\n      mainnet: new TonClient({\n        endpoint: `${TONCENTER_MAINNET_URL}/api/v2/jsonRPC`,\n        timeout: DEFAULT_TIMEOUT,\n        apiKey: TONCENTER_MAINNET_KEY,\n        headers: getEnvironment().apiHeaders,\n      }),\n      testnet: new TonClient({\n        endpoint: `${TONCENTER_TESTNET_URL}/api/v2/jsonRPC`,\n        timeout: DEFAULT_TIMEOUT,\n        apiKey: TONCENTER_TESTNET_KEY,\n        headers: getEnvironment().apiHeaders,\n      }),\n    };\n  }\n\n  return clientByNetwork[network];\n}\n\nexport function getTonWalletContract(publicKeyHex: string, version: ApiTonWalletVersion) {\n  const walletClass = walletClassMap[version];\n  if (!walletClass) {\n    throw new Error('Unsupported wallet contract version');\n  }\n\n  const publicKey = Buffer.from(hexToBytes(publicKeyHex));\n  return walletClass.create({ workchain: WORKCHAIN, publicKey });\n}\n\nexport const resolveTokenWalletAddress = withCacheAsync(\n  async (network: ApiNetwork, address: string, tokenAddress: string) => {\n    const minter = getTonClient(network).open(new JettonMinter(Address.parse(tokenAddress)));\n    const walletAddress = await minter.getWalletAddress(Address.parse(address));\n    return toBase64Address(walletAddress, true, network);\n  },\n);\n\nexport const resolveTokenAddress = withCacheAsync(async (network: ApiNetwork, tokenWalletAddress: string) => {\n  const tokenWallet = getTonClient(network).open(new JettonWallet(Address.parse(tokenWalletAddress)));\n  const data = await tokenWallet.getWalletData();\n  return toBase64Address(data.minter, true, network);\n});\n\nexport const getWalletPublicKey = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  try {\n    const res = await getTonClient(network).callGetMethod(Address.parse(address), 'get_public_key');\n    const bigintKey = res.stack.readBigNumber();\n    const hex = bigintKey.toString(16).padStart(64, '0');\n    return hexToBytes(hex);\n  } catch (err) {\n    logDebugError('getWalletPublicKey', err);\n    return undefined;\n  }\n});\n\nexport const getJettonPoolStakeWallet = withCacheAsync(async (\n  network: ApiNetwork,\n  poolAddress: string,\n  period: number,\n  address: string,\n): Promise<OpenedContract<StakeWallet>> => {\n  const tonClient = getTonClient(network);\n  const pool = tonClient.open(StakingPool.createFromAddress(Address.parse(poolAddress)));\n  const walletAddress = (await pool.getWalletAddress(Address.parse(address), period))!;\n  return tonClient.open(StakeWallet.createFromAddress(walletAddress));\n});\n\nexport function getJettonMinterData(network: ApiNetwork, address: string) {\n  const contract = getTonClient(network).open(new JettonMinter(Address.parse(address)));\n  return contract.getJettonData();\n}\n\nexport function oneCellFromBoc(bytes: Uint8Array) {\n  return Cell.fromBoc(Buffer.from(bytes));\n}\n\nexport function toBase64Address(address: Address | string, isBounceable = DEFAULT_IS_BOUNCEABLE, network?: ApiNetwork) {\n  if (typeof address === 'string') {\n    address = Address.parse(address);\n  }\n  return address.toString({\n    urlSafe: true,\n    bounceable: isBounceable,\n    testOnly: network === 'testnet',\n  });\n}\n\nexport function toRawAddress(address: Address | string) {\n  if (typeof address === 'string') {\n    address = Address.parse(address);\n  }\n  return address.toRawString();\n}\n\nexport function buildTokenTransferBody(params: TokenTransferBodyParams) {\n  const {\n    queryId,\n    tokenAmount,\n    toAddress,\n    responseAddress,\n    forwardAmount,\n    customPayload,\n  } = params;\n  let forwardPayload = params.forwardPayload;\n\n  let builder = new Builder()\n    .storeUint(JettonOpCode.Transfer, 32)\n    .storeUint(queryId || generateQueryId(), 64)\n    .storeCoins(tokenAmount)\n    .storeAddress(Address.parse(toAddress))\n    .storeAddress(Address.parse(responseAddress))\n    .storeMaybeRef(customPayload)\n    .storeCoins(forwardAmount ?? 0n);\n\n  if (forwardPayload instanceof Uint8Array) {\n    const freeBytes = Math.round(builder.availableBits / 8);\n    forwardPayload = packBytesAsSnake(forwardPayload, freeBytes);\n  }\n\n  if (!forwardPayload) {\n    builder.storeBit(false);\n  } else if (typeof forwardPayload === 'string') {\n    builder = builder.storeBit(false)\n      .storeUint(0, 32)\n      .storeBuffer(Buffer.from(forwardPayload));\n  } else if (forwardPayload instanceof Uint8Array) {\n    builder = builder.storeBit(false)\n      .storeBuffer(Buffer.from(forwardPayload));\n  } else {\n    builder = builder.storeBit(true)\n      .storeRef(forwardPayload);\n  }\n\n  return builder.endCell();\n}\n\nexport function parseBase64(base64: string) {\n  try {\n    return Cell.fromBase64(base64);\n  } catch (err) {\n    logDebugError('parseBase64', err);\n    return Uint8Array.from(Buffer.from(base64, 'base64'));\n  }\n}\n\nexport function commentToBytes(comment: string): Uint8Array {\n  const buffer = Buffer.from(comment);\n  const bytes = new Uint8Array(buffer.length + 4);\n\n  const startBuffer = Buffer.alloc(4);\n  startBuffer.writeUInt32BE(OpCode.Comment);\n  bytes.set(startBuffer, 0);\n  bytes.set(buffer, 4);\n\n  return bytes;\n}\n\nexport function packBytesAsSnake(bytes: Uint8Array, maxBytes = TON_MAX_COMMENT_BYTES): Uint8Array | Cell {\n  const buffer = Buffer.from(bytes);\n  if (buffer.length <= maxBytes) {\n    return bytes;\n  }\n\n  return packBytesAsSnakeCell(bytes);\n}\n\nexport function packBytesAsSnakeCell(bytes: Uint8Array): Cell {\n  const bytesPerCell = TON_MAX_COMMENT_BYTES;\n  const cellCount = Math.ceil(bytes.length / bytesPerCell);\n  let headCell: Cell | undefined;\n\n  for (let i = cellCount - 1; i >= 0; i--) {\n    const cellOffset = i * bytesPerCell;\n    const cellLength = Math.min(bytesPerCell, bytes.length - cellOffset);\n    const cellBuffer = Buffer.from(bytes.buffer, bytes.byteOffset + cellOffset, cellLength); // This creates a buffer that references the input bytes instead of copying them\n\n    const nextHeadCell = new Builder().storeBuffer(cellBuffer);\n    if (headCell) {\n      nextHeadCell.storeRef(headCell);\n    }\n    headCell = nextHeadCell.endCell();\n  }\n\n  return headCell ?? Cell.EMPTY;\n}\n\nexport function packBytesAsSnakeForEncryptedData(data: Uint8Array): Uint8Array | Cell {\n  const ROOT_BUILDER_BYTES = 39;\n  const MAX_CELLS_AMOUNT = 16;\n\n  if (data.length > ROOT_BUILDER_BYTES + MAX_CELLS_AMOUNT * TON_MAX_COMMENT_BYTES) {\n    throw new Error('Input text is too long');\n  }\n\n  return new Builder()\n    .storeBuffer(Buffer.from(data.subarray(0, ROOT_BUILDER_BYTES)))\n    .storeRef(packBytesAsSnakeCell(data.subarray(ROOT_BUILDER_BYTES)))\n    .endCell();\n}\n\nexport function buildLiquidStakingDepositBody(queryId?: number) {\n  return new Builder()\n    .storeUint(LiquidStakingOpCode.Deposit, 32)\n    .storeUint(queryId || 0, 64)\n    .asCell();\n}\n\nexport function buildLiquidStakingWithdrawBody(options: {\n  queryId?: number;\n  amount: bigint;\n  responseAddress: string;\n  waitTillRoundEnd?: boolean; // opposite of request_immediate_withdrawal\n  fillOrKill?: boolean;\n}) {\n  const {\n    queryId, amount, responseAddress, waitTillRoundEnd, fillOrKill,\n  } = options;\n\n  const customPayload = buildLiquidStakingWithdrawCustomPayload(waitTillRoundEnd, fillOrKill);\n\n  return new Builder()\n    .storeUint(JettonOpCode.Burn, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeCoins(amount)\n    .storeAddress(Address.parse(responseAddress))\n    .storeBit(1)\n    .storeRef(customPayload)\n    .asCell();\n}\n\nexport function buildLiquidStakingWithdrawCustomPayload(waitTillRoundEnd?: boolean, fillOrKill?: boolean) {\n  return new Builder()\n    .storeUint(Number(waitTillRoundEnd), 1)\n    .storeUint(Number(fillOrKill), 1)\n    .asCell();\n}\n\nexport function getTokenBalance(network: ApiNetwork, walletAddress: string) {\n  const tokenWallet = getTonClient(network).open(new JettonWallet(Address.parse(walletAddress)));\n  return tokenWallet.getJettonBalance();\n}\n\nexport function parseAddress(address: string): {\n  isValid: boolean;\n  isRaw?: boolean;\n  isUserFriendly?: boolean;\n  isBounceable?: boolean;\n  isTestOnly?: boolean;\n  address?: Address;\n} {\n  try {\n    if (Address.isRaw(address)) {\n      return {\n        address: Address.parseRaw(address),\n        isRaw: true,\n        isValid: true,\n      };\n    } else if (Address.isFriendly(address)) {\n      return {\n        ...Address.parseFriendly(address),\n        isUserFriendly: true,\n        isValid: true,\n      };\n    }\n  } catch (err) {\n    // Do nothing\n  }\n\n  return { isValid: false };\n}\n\nexport function getIsRawAddress(address: string) {\n  return Boolean(parseAddress(address).isRaw);\n}\n\nexport async function getDnsItemDomain(network: ApiNetwork, address: Address | string) {\n  if (typeof address === 'string') address = Address.parse(address);\n\n  const contract = getTonClient(network)\n    .open(new DnsItem(address));\n  const nftData = await contract.getNftData();\n  const collectionAddress = toBase64Address(nftData.collectionAddress, true);\n\n  const zone = getDnsZoneByCollection(collectionAddress);\n\n  const base = zone?.isTelemint\n    ? await contract.getTelemintDomain()\n    : await contract.getDomain();\n\n  return `${base}.${zone?.suffixes[0]}`;\n}\n\nexport function buildJettonUnstakePayload(jettonsToUnstake: bigint, forceUnstake?: boolean, queryId?: bigint) {\n  return beginCell()\n    .storeUint(JettonStakingOpCodes.UNSTAKE_JETTONS, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeCoins(jettonsToUnstake)\n    .storeBit(forceUnstake ?? false)\n    .endCell();\n}\n\nexport function buildJettonClaimPayload(poolWallets: string[], queryId?: bigint) {\n  const rewardsToClaim = Dictionary.empty(Dictionary.Keys.Address(), Dictionary.Values.Bool());\n\n  for (const poolWallet of poolWallets) {\n    rewardsToClaim.set(Address.parse(poolWallet), true);\n  }\n\n  return beginCell()\n    .storeUint(JettonStakingOpCodes.CLAIM_REWARDS, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeDict(rewardsToClaim, Dictionary.Keys.Address(), Dictionary.Values.Bool())\n    .endCell();\n}\n\nexport function unpackDicts(obj: Record<string, any | Dictionary<any, any>>): AnyLiteral {\n  if (!isSimpleObject(obj)) {\n    return obj;\n  }\n\n  return mapValues(obj, (value) => {\n    if (value instanceof Dictionary) {\n      return unpackDicts(fromKeyValueArrays(value.keys(), value.values()));\n    }\n    if (isSimpleObject(value)) {\n      return unpackDicts(value);\n    }\n    return value;\n  });\n}\n\nfunction isSimpleObject(obj: any) {\n  // eslint-disable-next-line no-null/no-null\n  return obj !== null\n    && typeof obj === 'object'\n    && Object.getPrototypeOf(obj) === Object.prototype;\n}\n","export enum StorageType {\n  IndexedDb,\n  LocalStorage,\n  ExtensionLocal,\n  CapacitorStorage,\n}\n\nexport interface Storage {\n  getItem(name: StorageKey, force?: boolean): Promise<any>;\n\n  setItem(name: StorageKey, value: any): Promise<void>;\n\n  removeItem(name: StorageKey): Promise<void>;\n\n  clear(): Promise<void>;\n\n  getAll?(): Promise<AnyLiteral>;\n\n  setMany?(items: AnyLiteral): Promise<void>;\n\n  getMany?(keys: string[]): Promise<AnyLiteral>;\n}\n\nexport type StorageKey = 'accounts'\n| 'stateVersion'\n| 'currentAccountId'\n| 'clientId'\n| 'baseCurrency'\n| 'referrer'\n// For extension\n| 'dapps'\n| 'dappMethods:lastAccountId'\n| 'windowId'\n| 'windowState'\n| 'isTonMagicEnabled'\n| 'isTonProxyEnabled'\n| 'isDeeplinkHookEnabled'\n// For TonConnect SSE\n| 'sseLastEventId';\n","import type { Connector } from '../PostMessageConnector';\nimport type { WindowMethodArgs, WindowMethodResponse, WindowMethods } from './types';\n\nimport { WINDOW_PROVIDER_CHANNEL } from '../../config';\n\nimport { createConnector } from '../PostMessageConnector';\n\nlet connector: Connector;\n\nexport function initWindowConnector() {\n  if (!connector) {\n    // eslint-disable-next-line no-restricted-globals\n    connector = createConnector(self as DedicatedWorkerGlobalScope, undefined, WINDOW_PROVIDER_CHANNEL);\n    connector.init();\n  }\n}\n\n// eslint-disable-next-line no-async-without-await/no-async-without-await\nexport function callWindow<T extends keyof WindowMethods>(methodName: T, ...args: WindowMethodArgs<T>) {\n  if (!connector) {\n    throw new Error('API is not initialized');\n  }\n\n  return connector.request({ name: methodName, args }) as EnsurePromise<WindowMethodResponse<T>>;\n}\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n","import { bigintReviver } from './bigint';\nimport generateUniqueId from './generateUniqueId';\nimport { logDebugError } from './logs';\n\nexport interface CancellableCallback {\n  (\n    ...args: any[]\n  ): void;\n\n  isCanceled?: boolean;\n  acceptsBuffer?: boolean;\n}\n\ntype InitData = {\n  channel?: string;\n  type: 'init';\n  messageId?: string;\n  name: 'init';\n  args: any;\n};\n\ntype CallMethodData = {\n  channel?: string;\n  type: 'callMethod';\n  messageId?: string;\n  name: string;\n  args: any;\n  withCallback?: boolean;\n};\n\nexport type OriginMessageData = InitData | CallMethodData | {\n  channel?: string;\n  type: 'cancelProgress';\n  messageId: string;\n};\n\nexport interface OriginMessageEvent {\n  data: OriginMessageData;\n}\n\nexport type ApiUpdate =\n  { type: string }\n  & any;\n\nexport type WorkerMessageData = {\n  channel?: string;\n  type: 'update';\n  update: ApiUpdate;\n} | {\n  channel?: string;\n  type: 'methodResponse';\n  messageId: string;\n  response?: any;\n  error?: { message: string };\n} | {\n  channel?: string;\n  type: 'methodCallback';\n  messageId: string;\n  callbackArgs: any[];\n} | {\n  channel?: string;\n  type: 'unhandledError';\n  error?: { message: string; stack?: string };\n};\n\nexport interface WorkerMessageEvent {\n  data: WorkerMessageData;\n}\n\ninterface RequestStates {\n  messageId: string;\n  resolve: Function;\n  reject: Function;\n  callback: AnyToVoidFunction;\n}\n\ntype InputRequestTypes = Record<string, AnyFunction>;\n\ntype Values<T> = T[keyof T];\nexport type RequestTypes<T extends InputRequestTypes> = Values<{\n  [Name in keyof (T)]: {\n    name: Name & string;\n    args: Parameters<T[Name]>;\n  }\n}>;\n\nclass ConnectorClass<T extends InputRequestTypes> {\n  private requestStates = new Map<string, RequestStates>();\n\n  private requestStatesByCallback = new Map<AnyToVoidFunction, RequestStates>();\n\n  constructor(\n    public target: Worker | Window | chrome.runtime.Port | DedicatedWorkerGlobalScope,\n    private onUpdate?: (update: ApiUpdate) => void,\n    private channel?: string,\n    private shouldUseJson?: boolean,\n    private targetOrigin = '*',\n  ) {\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  public destroy() {\n  }\n\n  init(...args: any[]) {\n    this.postMessage({\n      type: 'init',\n      args,\n    });\n  }\n\n  request(messageData: RequestTypes<T>) {\n    const { requestStates, requestStatesByCallback } = this;\n\n    const messageId = generateUniqueId();\n    const payload: CallMethodData = {\n      type: 'callMethod',\n      messageId,\n      ...messageData,\n    };\n\n    const requestState = { messageId } as RequestStates;\n\n    // Re-wrap type because of `postMessage`\n    const promise: Promise<any> = new Promise((resolve, reject) => {\n      Object.assign(requestState, { resolve, reject });\n    });\n\n    if (typeof payload.args[payload.args.length - 1] === 'function') {\n      payload.withCallback = true;\n\n      const callback = payload.args.pop() as AnyToVoidFunction;\n      requestState.callback = callback;\n      requestStatesByCallback.set(callback, requestState);\n    }\n\n    requestStates.set(messageId, requestState);\n    promise\n      .catch(() => undefined)\n      .finally(() => {\n        requestStates.delete(messageId);\n\n        if (requestState.callback) {\n          requestStatesByCallback.delete(requestState.callback);\n        }\n      });\n\n    this.postMessage(payload);\n\n    return promise;\n  }\n\n  cancelCallback(progressCallback: CancellableCallback) {\n    progressCallback.isCanceled = true;\n\n    const { messageId } = this.requestStatesByCallback.get(progressCallback) || {};\n    if (!messageId) {\n      return;\n    }\n\n    this.postMessage({\n      type: 'cancelProgress',\n      messageId,\n    });\n  }\n\n  onMessage(data: WorkerMessageData | string) {\n    if (typeof data === 'string') {\n      try {\n        data = JSON.parse(data, bigintReviver) as WorkerMessageData;\n      } catch (err: any) {\n        logDebugError('PostMessageConnector: Failed to parse message', err);\n        return;\n      }\n    }\n\n    const { requestStates, channel } = this;\n    if (data.channel !== channel) {\n      return;\n    }\n\n    if (data.type === 'update' && this.onUpdate) {\n      this.onUpdate(data.update);\n    }\n    if (data.type === 'methodResponse') {\n      const requestState = requestStates.get(data.messageId);\n      if (requestState) {\n        if (data.error) {\n          requestState.reject(data.error);\n        } else {\n          requestState.resolve(data.response);\n        }\n      }\n    } else if (data.type === 'methodCallback') {\n      const requestState = requestStates.get(data.messageId);\n      requestState?.callback?.(...data.callbackArgs);\n    } else if (data.type === 'unhandledError') {\n      const error = new Error(data.error?.message);\n      if (data.error?.stack) {\n        error.stack = data.error.stack;\n      }\n      throw error;\n    }\n  }\n\n  private postMessage(data: AnyLiteral) {\n    data.channel = this.channel;\n\n    let rawData: AnyLiteral | string = data;\n    if (this.shouldUseJson) {\n      rawData = JSON.stringify(data);\n    }\n\n    if ('open' in this.target) { // Is Window\n      this.target.postMessage(rawData, this.targetOrigin);\n    } else {\n      this.target.postMessage(rawData);\n    }\n  }\n}\n\nexport function createConnector<T extends InputRequestTypes>(\n  worker: Worker | Window | DedicatedWorkerGlobalScope,\n  onUpdate?: (update: ApiUpdate) => void,\n  channel?: string,\n  targetOrigin?: string,\n) {\n  const connector = new ConnectorClass<T>(worker, onUpdate, channel, undefined, targetOrigin);\n\n  function handleMessage({ data }: WorkerMessageEvent | MessageEvent) {\n    connector.onMessage(data);\n  }\n\n  worker.addEventListener('message', handleMessage as any); // TS weirdly complains here\n\n  connector.destroy = () => {\n    worker.removeEventListener('message', handleMessage as any);\n  };\n\n  return connector;\n}\n\nexport function createExtensionConnector(\n  name: string,\n  onUpdate?: (update: ApiUpdate) => void,\n  getInitArgs?: () => any,\n  channel?: string,\n) {\n  const connector = new ConnectorClass(connect(), onUpdate, channel, true);\n\n  function connect() {\n    // eslint-disable-next-line no-restricted-globals\n    const port = self.chrome.runtime.connect({ name });\n\n    port.onMessage.addListener((data: string | WorkerMessageData) => {\n      connector.onMessage(data);\n    });\n\n    // For some reason port can suddenly get disconnected\n    port.onDisconnect.addListener(() => {\n      connector.target = connect();\n      connector.init(getInitArgs?.());\n    });\n\n    return port;\n  }\n\n  connector.init(getInitArgs?.());\n\n  return connector;\n}\n\nexport type Connector<T extends InputRequestTypes = InputRequestTypes> = ReturnType<typeof createConnector<T>>;\n","import type { Storage, StorageKey } from './types';\n\nimport { bigintReviver } from '../../util/bigint';\nimport { callWindow } from '../../util/windowProvider/connector';\nimport { getEnvironment } from '../environment';\n\nlet cache: AnyLiteral = {};\n\nconst storage: Storage & {\n  getKeys: () => Promise<string[] | undefined>;\n} = {\n  async getItem(key: StorageKey, force?: boolean) {\n    if (getEnvironment().isAndroidApp && key in cache && !force) {\n      return cache[key];\n    }\n\n    const result = await callWindow('capacitorStorageGetItem', key);\n    const value = result ? JSON.parse(result, bigintReviver) : undefined;\n\n    if (getEnvironment().isAndroidApp) {\n      if (value === undefined) {\n        delete cache[key];\n      } else {\n        cache[key] = value;\n      }\n    }\n\n    return value;\n  },\n\n  async setItem(key: StorageKey, value: any) {\n    await callWindow('capacitorStorageSetItem', key, JSON.stringify(value));\n\n    if (getEnvironment().isAndroidApp) {\n      cache[key] = value;\n    }\n  },\n\n  async removeItem(key: StorageKey) {\n    await callWindow('capacitorStorageRemoveItem', key);\n\n    if (getEnvironment().isAndroidApp) {\n      delete cache[key];\n    }\n  },\n\n  async clear() {\n    await callWindow('capacitorStorageClear');\n\n    if (getEnvironment().isAndroidApp) {\n      cache = {};\n    }\n  },\n\n  async getKeys() {\n    const result = await callWindow('capacitorStorageKeys');\n\n    return result?.value;\n  },\n};\n\nexport default storage;\n","import type { Storage } from './types';\n\nimport { IS_EXTENSION } from '../../config';\n\n// eslint-disable-next-line no-restricted-globals\nconst storage = IS_EXTENSION ? self.chrome.storage.local : undefined;\n\nexport default ((storage && {\n  getItem: async (key) => (await storage.get(key))?.[key],\n  setItem: (key, value) => storage.set({ [key]: value }),\n  removeItem: storage.remove.bind(storage),\n  clear: storage.clear.bind(storage),\n  getAll: storage.get.bind(storage),\n  setMany: storage.set.bind(storage),\n  getMany: storage.get.bind(storage),\n}) || {}) as Storage;\n","import * as idb from 'idb-keyval';\n\nimport type { Storage, StorageKey } from './types';\n\nimport { INDEXED_DB_NAME, INDEXED_DB_STORE_NAME } from '../../config';\nimport { fromKeyValueArrays } from '../../util/iteratees';\n\nconst store = idb.createStore(INDEXED_DB_NAME, INDEXED_DB_STORE_NAME);\n\nexport default {\n  getItem: (name: StorageKey) => idb.get(name, store),\n  setItem: (name: StorageKey, value: any) => idb.set(name, value, store),\n  removeItem: (name: StorageKey) => idb.del(name, store),\n  clear: () => idb.clear(store),\n  getAll: async () => {\n    const keys = await idb.keys(store) as string[];\n    const values = await idb.getMany(keys, store);\n    return fromKeyValueArrays(keys, values);\n  },\n  getMany: async (keys) => {\n    const values = await idb.getMany(keys, store);\n    return fromKeyValueArrays(keys, values);\n  },\n  setMany: (items) => {\n    return idb.setMany(Object.entries(items), store);\n  },\n} as Storage;\n","import type { Storage, StorageKey } from './types';\n\nimport { pick } from '../../util/iteratees';\nimport { callWindow } from '../../util/windowProvider/connector';\n\nfunction withPromise(fn: AnyFunction) {\n  return (...args: any) => Promise.resolve(fn(...args));\n}\n\nconst storage: Storage = (typeof localStorage === 'object' ? {\n  getItem: withPromise(localStorage.getItem),\n  setItem: withPromise(localStorage.setItem),\n  removeItem: withPromise(localStorage.removeItem),\n  clear: withPromise(localStorage.clear),\n  getAll: withPromise(() => ({ ...localStorage })),\n  getMany: withPromise((keys: string[]) => pick(localStorage, keys)),\n  setMany: withPromise((items: AnyLiteral) => {\n    Object.assign(localStorage, items);\n  }),\n} : {\n  getItem(key: StorageKey) {\n    return callWindow('localStorageGetItem', key);\n  },\n  setItem(key: StorageKey, value: any) {\n    return callWindow('localStorageSetItem', key, value);\n  },\n  removeItem(key: StorageKey) {\n    return callWindow('localStorageRemoveItem', key);\n  },\n  clear() {\n    return callWindow('localStorageClear');\n  },\n  getAll() {\n    return callWindow('localStorageGetAll');\n  },\n  getMany(keys: StorageKey[]) {\n    return callWindow('localStorageGetMany', keys);\n  },\n  setMany(items: AnyLiteral) {\n    return callWindow('localStorageSetMany', items);\n  },\n});\n\nexport default storage;\n","import { StorageType } from './types';\n\nimport { IS_CAPACITOR, IS_EXTENSION } from '../../config';\nimport capacitorStorage from './capacitorStorage';\nimport extensionStorage from './extension';\nimport idb from './idb';\nimport localStorage from './localStorage';\n\nexport const storage = IS_EXTENSION ? extensionStorage : IS_CAPACITOR ? capacitorStorage : idb;\n\nexport default {\n  [StorageType.IndexedDb]: idb,\n  [StorageType.LocalStorage]: localStorage,\n  [StorageType.ExtensionLocal]: extensionStorage,\n  [StorageType.CapacitorStorage]: capacitorStorage,\n};\n","import type { StorageKey } from '../storages/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic,\n  ApiAccountWithTon,\n  ApiAccountWithTron,\n  ApiBip39Account,\n  ApiChain,\n  ApiNetwork,\n  ApiTonWallet,\n  ApiTronWallet,\n} from '../types';\n\nimport { buildAccountId, parseAccountId } from '../../util/account';\nimport { storage } from '../storages';\n\nconst MIN_ACCOUNT_NUMBER = 0;\n\n// eslint-disable-next-line import/no-mutable-exports\nexport let loginResolve: AnyFunction;\nconst loginPromise = new Promise<void>((resolve) => {\n  loginResolve = resolve;\n});\n\nlet activeAccountId: string | undefined;\n\nexport function getActiveAccountId() {\n  return activeAccountId;\n}\n\nexport function setActiveAccountId(accountId?: string) {\n  activeAccountId = accountId;\n}\n\nexport function isAccountActive(accountId: string) {\n  return activeAccountId === accountId;\n}\n\nexport async function getAccountIds(): Promise<string[]> {\n  return Object.keys(await storage.getItem('accounts') || {});\n}\n\nexport async function getAccountWithMnemonic() {\n  const byId = await fetchStoredAccounts();\n\n  return Object.entries(byId).find(([, { type }]) => type !== 'ledger') as [string, ApiAccountWithMnemonic] | undefined;\n}\n\nexport async function getNewAccountId(network: ApiNetwork) {\n  const ids = (await getAccountIds()).map((accountId) => parseAccountId(accountId).id);\n  const id = ids.length === 0 ? MIN_ACCOUNT_NUMBER : Math.max(...ids) + 1;\n  return buildAccountId({ id, network });\n}\n\nexport async function fetchStoredAddress(accountId: string, chain: ApiChain): Promise<string> {\n  return (await fetchStoredAccount<ApiBip39Account>(accountId))[chain].address;\n}\n\nexport async function fetchStoredTonWallet(accountId: string): Promise<ApiTonWallet> {\n  return (await fetchStoredAccount<ApiAccountWithTon>(accountId)).ton;\n}\n\nexport async function fetchStoredTronWallet(accountId: string): Promise<ApiTronWallet> {\n  return (await fetchStoredAccount<ApiAccountWithTron>(accountId)).tron;\n}\n\nexport function fetchStoredAccount<T extends ApiAccountAny>(accountId: string): Promise<T> {\n  return getAccountValue(accountId, 'accounts');\n}\n\nexport function fetchStoredAccounts(): Promise<Record<string, ApiAccountAny>> {\n  return storage.getItem('accounts');\n}\n\nexport async function updateStoredAccount<T extends ApiAccountAny>(\n  accountId: string,\n  partial: Partial<T>,\n): Promise<void> {\n  const account = await fetchStoredAccount<T>(accountId);\n  return setAccountValue(accountId, 'accounts', {\n    ...account,\n    ...partial,\n  });\n}\n\nexport async function updateStoredTonWallet(accountId: string, partial: Partial<ApiTonWallet>): Promise<void> {\n  const tonWallet = await fetchStoredTonWallet(accountId);\n  return updateStoredAccount(accountId, {\n    ton: {\n      ...tonWallet,\n      ...partial,\n    },\n  });\n}\n\nexport async function getAccountValue(accountId: string, key: StorageKey) {\n  return (await storage.getItem(key))?.[accountId];\n}\n\nexport async function removeAccountValue(accountId: string, key: StorageKey) {\n  const data = await storage.getItem(key);\n  if (!data) return;\n\n  const { [accountId]: removedValue, ...restData } = data;\n  await storage.setItem(key, restData);\n}\n\nexport async function setAccountValue(accountId: string, key: StorageKey, value: any) {\n  const data = await storage.getItem(key);\n  await storage.setItem(key, { ...data, [accountId]: value });\n}\n\nexport async function removeNetworkAccountsValue(network: string, key: StorageKey) {\n  const data = await storage.getItem(key);\n  if (!data) return;\n\n  for (const accountId of Object.keys(data)) {\n    if (parseAccountId(accountId).network === network) {\n      delete data[accountId];\n    }\n  }\n\n  await storage.setItem(key, data);\n}\n\nexport async function getCurrentNetwork() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) return undefined;\n  return parseAccountId(accountId).network;\n}\n\nexport async function getCurrentAccountIdOrFail() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) {\n    throw new Error('The user is not authorized in the wallet');\n  }\n  return accountId;\n}\n\nexport function getCurrentAccountId(): Promise<string | undefined> {\n  return storage.getItem('currentAccountId');\n}\n\nexport function waitLogin() {\n  return loginPromise;\n}\n","import * as bip39 from 'bip39';\n\nimport { type ApiAccountWithMnemonic, ApiCommonError } from '../types';\n\nimport { updateStoredAccount } from './accounts';\n\nconst PBKDF2_IMPORT_KEY_ARGS = [\n  { name: 'PBKDF2' },\n  false,\n  ['deriveBits', 'deriveKey'],\n] as const;\n\nconst PBKDF2_DERIVE_KEY_ARGS = {\n  name: 'PBKDF2',\n  iterations: 100000, // Higher is more secure but slower\n  hash: 'SHA-256',\n};\n\nconst PBKDF2_DERIVE_KEY_TYPE = { name: 'AES-GCM', length: 256 };\n\nexport function generateBip39Mnemonic() {\n  return bip39.generateMnemonic(256).split(' ');\n}\n\nexport function validateBip39Mnemonic(mnemonic: string[]) {\n  return bip39.validateMnemonic(mnemonic.join(' '));\n}\n\nexport async function tryMigratingMnemonicEncryption(accountId: string, mnemonic: string[], password: string) {\n  try {\n    const mnemonicEncrypted = await encryptMnemonic(mnemonic, password);\n\n    // This is a defensive approach against potential corrupted encryption reported by some users\n    const decryptedMnemonic = await decryptMnemonic(mnemonicEncrypted, password)\n      .catch(() => undefined);\n\n    if (!password || !decryptedMnemonic) {\n      return { error: ApiCommonError.DebugError };\n    }\n\n    await updateStoredAccount<ApiAccountWithMnemonic>(accountId, { mnemonicEncrypted });\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n  }\n\n  return undefined;\n}\n\nexport async function encryptMnemonic(mnemonic: string[], password: string) {\n  const plaintext = mnemonic.join(',');\n  const salt = crypto.getRandomValues(new Uint8Array(16)); // generate a 128-bit salt\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    ...PBKDF2_IMPORT_KEY_ARGS,\n  );\n  const key = await crypto.subtle.deriveKey(\n    {\n      salt,\n      ...PBKDF2_DERIVE_KEY_ARGS,\n    },\n    keyMaterial,\n    PBKDF2_DERIVE_KEY_TYPE,\n    false,\n    ['encrypt'],\n  );\n  const iv = crypto.getRandomValues(new Uint8Array(12)); // get 96-bit random iv\n  const ptUint8 = new TextEncoder().encode(plaintext); // encode plaintext as UTF-8\n  const ctBuffer = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, ptUint8); // encrypt plaintext using key\n  const ctArray = Array.from(new Uint8Array(ctBuffer)); // ciphertext as byte array\n  const ctBase64 = btoa(String.fromCharCode(...ctArray)); // encode ciphertext as base64\n  const ivHex = Array.from(iv).map((b) => (`00${b.toString(16)}`).slice(-2)).join(''); // iv as hex string\n  const saltHex = Array.from(salt).map((b) => (`00${b.toString(16)}`).slice(-2)).join(''); // salt as hex string\n\n  return `${saltHex}:${ivHex}:${ctBase64}`;\n}\n\nexport async function decryptMnemonic(encrypted: string, password: string) {\n  if (!encrypted.includes(':')) {\n    return decryptMnemonicLegacy(encrypted, password);\n  }\n\n  const [saltHex, ivHex, encryptedData] = encrypted.split(':');\n  const salt = new Uint8Array(saltHex.match(/.{2}/g)!.map((b) => parseInt(b, 16)));\n  const iv = new Uint8Array(ivHex.match(/.{2}/g)!.map((b) => parseInt(b, 16)));\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    ...PBKDF2_IMPORT_KEY_ARGS,\n  );\n  const key = await crypto.subtle.deriveKey(\n    { salt, ...PBKDF2_DERIVE_KEY_ARGS },\n    keyMaterial,\n    PBKDF2_DERIVE_KEY_TYPE,\n    false,\n    ['decrypt'],\n  );\n  const ctStr = atob(encryptedData); // decode base64 ciphertext\n  const ctUint8 = new Uint8Array(ctStr.match(/[\\s\\S]/g)!.map((ch) => ch.charCodeAt(0))); // ciphertext as Uint8Array\n  const plainBuffer = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ctUint8); // decrypt ciphertext using key\n  const plaintext = new TextDecoder().decode(plainBuffer); // decode password from UTF-8\n\n  return plaintext.split(',');\n}\n\nasync function decryptMnemonicLegacy(encrypted: string, password: string) {\n  const pwUtf8 = new TextEncoder().encode(password); // encode password as UTF-8\n  const pwHash = await crypto.subtle.digest('SHA-256', pwUtf8); // hash the password\n  const iv = encrypted.slice(0, 24).match(/.{2}/g)!.map((byte) => parseInt(byte, 16)); // get iv from ciphertext\n  const alg = { name: 'AES-GCM', iv: new Uint8Array(iv) }; // specify algorithm to use\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']); // use pw to generate key\n  const ctStr = atob(encrypted.slice(24)); // decode base64 ciphertext\n  const ctUint8 = new Uint8Array(ctStr.match(/[\\s\\S]/g)!.map((ch) => ch.charCodeAt(0))); // ciphertext as Uint8Array\n  const plainBuffer = await crypto.subtle.decrypt(alg, key, ctUint8); // decrypt ciphertext using key\n  const plaintext = new TextDecoder().decode(plainBuffer); // decode password from UTF-8\n\n  return plaintext.split(',');\n}\n\nexport async function getMnemonic(accountId: string, password: string, account: ApiAccountWithMnemonic) {\n  try {\n    const { mnemonicEncrypted } = account;\n    const mnemonic = await decryptMnemonic(mnemonicEncrypted, password);\n\n    if (!mnemonicEncrypted.includes(':')) {\n      await tryMigratingMnemonicEncryption(accountId, mnemonic, password);\n    }\n\n    return mnemonic;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    return undefined;\n  }\n}\n","import type { ApiNetwork, ApiWalletInfo } from '../../../types';\nimport type { ApiTransactionExtra } from '../types';\n\nimport { TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL, TONCOIN } from '../../../../config';\nimport { fetchJson } from '../../../../util/fetch';\nimport {\n  buildCollectionByKey, mapValues, omitUndefined, split,\n} from '../../../../util/iteratees';\nimport { getEnvironment } from '../../../environment';\nimport { stringifyTxId } from './index';\nimport { toBase64Address, toRawAddress } from './tonCore';\n\ntype AddressBook = Record<string, { user_friendly: string }>;\n\ntype AccountState = {\n  account_state_hash: string;\n  address: string;\n  balance: string;\n  code_boc: string;\n  code_hash: string;\n  data_boc: string;\n  data_hash: string;\n  frozen_hash: string;\n  last_transaction_hash: string;\n  last_transaction_lt: number;\n  status: string;\n};\n\ntype WalletVersion = keyof typeof VERSION_MAP;\n\ntype WalletState = {\n  address: string;\n  balance: string;\n  code_hash: string;\n  is_signature_allowed: boolean;\n  is_wallet: boolean;\n  last_transaction_hash: string;\n  last_transaction_lt: number;\n  seqno: number;\n  status: string;\n  wallet_id: number;\n  wallet_type: WalletVersion;\n};\n\nconst ADDRESS_BOOK_CHUNK_SIZE = 128;\nconst VERSION_MAP = {\n  'wallet v1 r1': 'simpleR1',\n  'wallet v1 r2': 'simpleR2',\n  'wallet v1 r3': 'simpleR3',\n  'wallet v2 r1': 'v2R1',\n  'wallet v2 r2': 'v2R2',\n  'wallet v3 r1': 'v3R1',\n  'wallet v3 r2': 'v3R2',\n  // 'wallet v4 r1': '', // Not used in production, wrapper is missing\n  'wallet v4 r2': 'v4R2',\n  // 'wallet v5 beta': '', // Not used in production, wrapper is missing\n  'wallet v5 r1': 'W5',\n} as const;\n\nexport async function fetchTransactions(options: {\n  network: ApiNetwork;\n  address: string | string[];\n  limit: number;\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  shouldIncludeFrom?: boolean;\n  shouldIncludeTo?: boolean;\n}): Promise<ApiTransactionExtra[]> {\n  const {\n    network, address, limit, toTimestamp, fromTimestamp,\n    shouldIncludeFrom, shouldIncludeTo,\n  } = options;\n\n  const data: {\n    transactions: any[];\n    address_book: AddressBook;\n  } = await callApiV3(network, '/transactions', {\n    account: address,\n    limit,\n    start_utime: fromTimestamp && msToSec(fromTimestamp) + (!shouldIncludeFrom ? 1 : 0),\n    end_utime: toTimestamp && msToSec(toTimestamp) - (!shouldIncludeTo ? 1 : 0),\n    sort: 'desc',\n  });\n\n  const { transactions: rawTransactions, address_book: addressBook } = data;\n\n  if (!rawTransactions.length) {\n    return [];\n  }\n\n  return rawTransactions\n    .map((rawTx) => parseRawTransaction(network, rawTx, addressBook))\n    .flat();\n}\n\nfunction parseRawTransaction(network: ApiNetwork, rawTx: any, addressBook: AddressBook): ApiTransactionExtra[] {\n  const {\n    now,\n    lt,\n    hash,\n    total_fees: totalFees,\n    description: {\n      compute_ph: {\n        exit_code: exitCode,\n      },\n    },\n  } = rawTx;\n\n  const txId = stringifyTxId({ lt, hash });\n  const timestamp = now as number * 1000;\n  const isIncoming = !!rawTx.in_msg.source;\n  const inMsgHash = rawTx.in_msg.hash;\n  const msgs: any[] = isIncoming ? [rawTx.in_msg] : rawTx.out_msgs;\n\n  if (!msgs.length) return [];\n\n  const oneMsgFee = BigInt(totalFees) / BigInt(msgs.length);\n\n  return msgs.map((msg, i) => {\n    const {\n      source, destination, value, fwd_fee: fwdFee,\n    } = msg;\n    const fromAddress = addressBook[source].user_friendly;\n    const toAddress = addressBook[destination].user_friendly;\n    const normalizedAddress = toBase64Address(isIncoming ? source : destination, true, network);\n    const fee = oneMsgFee + BigInt(fwdFee ?? 0);\n\n    return omitUndefined({\n      txId: msgs.length > 1 ? `${txId}:${i + 1}` : txId,\n      timestamp,\n      isIncoming,\n      fromAddress,\n      toAddress,\n      amount: isIncoming ? BigInt(value) : -BigInt(value),\n      slug: TONCOIN.slug,\n      fee,\n      inMsgHash,\n      normalizedAddress,\n      shouldHide: exitCode ? true : undefined,\n      extraData: {\n        body: getRawBody(msg),\n      },\n    });\n  });\n}\n\nexport async function fetchLatestTxId(network: ApiNetwork, address: string): Promise<string | undefined> {\n  const { transactions }: { transactions: any[] } = await callApiV3(network, '/transactions', {\n    account: address,\n    limit: 1,\n    sort: 'desc',\n  });\n\n  if (!transactions.length) {\n    return undefined;\n  }\n\n  const { lt, hash } = transactions[0];\n\n  return stringifyTxId({ lt, hash });\n}\n\nfunction getRawBody(msg: any) {\n  if (!msg.message_content) return undefined;\n  return msg.message_content.body;\n}\n\nexport async function fetchAddressBook(network: ApiNetwork, addresses: string[]): Promise<AddressBook> {\n  const chunks = split(addresses, ADDRESS_BOOK_CHUNK_SIZE);\n\n  const results = await Promise.all(chunks.map((chunk) => {\n    return callApiV3(network, '/addressBook', {\n      address: chunk,\n    });\n  }));\n\n  return results.reduce((acc, value) => {\n    return Object.assign(acc, value);\n  }, {} as AddressBook);\n}\n\nexport async function fixAddressFormat(network: ApiNetwork, address: string): Promise<string> {\n  const result: { address_book: Record<string, string> } = await callApiV3(network, '/addressBook', { address });\n  return result.address_book[address];\n}\n\nexport async function getWalletStates(network: ApiNetwork, addresses: string[]) {\n  const { wallets: states } = await callApiV3<{\n    addressBook: AddressBook;\n    wallets: WalletState[];\n  }>(network, '/walletStates', { address: addresses.join(',') });\n\n  const addressByRaw = Object.fromEntries(addresses.map((address) => [toRawAddress(address).toUpperCase(), address]));\n  for (const state of states) {\n    state.address = addressByRaw[state.address];\n  }\n  return buildCollectionByKey(states, 'address');\n}\n\nexport async function getWalletInfos(network: ApiNetwork, addresses: string[]): Promise<Record<string, ApiWalletInfo>> {\n  const states = await getWalletStates(network, addresses);\n  return mapValues(states, (state) => {\n    return {\n      address: toBase64Address(state.address, false),\n      version: VERSION_MAP[state.wallet_type],\n      balance: BigInt(state.balance),\n      isInitialized: state.status === 'active',\n      lastTxId: state.last_transaction_lt && state.last_transaction_hash\n        ? stringifyTxId({ lt: state.last_transaction_lt, hash: state.last_transaction_hash })\n        : undefined,\n    };\n  });\n}\n\nexport async function getAccountStates(network: ApiNetwork, addresses: string[]) {\n  const { accounts: states } = await callApiV3<{\n    addressBook: AddressBook;\n    accounts: AccountState[];\n  }>(network, '/accountStates', { address: addresses.join(',') });\n\n  const addressByRaw = Object.fromEntries(addresses.map((address) => [toRawAddress(address), address]));\n  for (const state of states) {\n    state.address = addressByRaw[state.address.toLowerCase()];\n  }\n  return buildCollectionByKey(states, 'address');\n}\n\nfunction callApiV3<T = any>(network: ApiNetwork, path: string, data?: AnyLiteral) {\n  const { apiHeaders, toncenterMainnetKey, toncenterTestnetKey } = getEnvironment();\n  const baseUrl = network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL;\n  const url = `${baseUrl}/api/v3${path}`;\n  const apiKey = network === 'testnet' ? toncenterTestnetKey : toncenterMainnetKey;\n\n  return fetchJson(url, data, {\n    headers: {\n      ...(apiKey && { 'X-Api-Key': apiKey }),\n      ...apiHeaders,\n    },\n  }) as Promise<T>;\n}\n\nfunction msToSec(ms: number) {\n  return Math.floor(ms / 1000);\n}\n","import { Api, HttpClient } from 'tonapi-sdk-js';\n\nimport type { ApiNetwork } from '../../../types';\n\nimport { TONAPIIO_MAINNET_URL, TONAPIIO_TESTNET_URL } from '../../../../config';\nimport { fetchWithRetry } from '../../../../util/fetch';\nimport { getEnvironment } from '../../../environment';\n\nconst MAX_LIMIT = 500;\nconst EVENTS_LIMIT = 100;\n\nlet apiByNetwork: Record<ApiNetwork, Api<unknown>> | undefined;\n\nfunction getApi(network: ApiNetwork) {\n  if (!apiByNetwork) {\n    const headers = {\n      ...getEnvironment().apiHeaders,\n      'Content-Type': 'application/json',\n    };\n\n    apiByNetwork = {\n      mainnet: new Api(new HttpClient({\n        baseUrl: TONAPIIO_MAINNET_URL,\n        baseApiParams: { headers },\n        customFetch: fetchWithRetry as typeof fetch,\n      })),\n      testnet: new Api(new HttpClient({\n        baseUrl: TONAPIIO_TESTNET_URL,\n        baseApiParams: { headers },\n        customFetch: fetchWithRetry as typeof fetch,\n      })),\n    };\n  }\n\n  return apiByNetwork[network];\n}\n\nexport async function fetchJettonBalances(network: ApiNetwork, account: string) {\n  return (await getApi(network).accounts.getAccountJettonsBalances(account, {\n    supported_extensions: ['custom_payload'],\n  })).balances;\n}\n\nexport async function fetchNftItems(network: ApiNetwork, addresses: string[]) {\n  return (await getApi(network).nft.getNftItemsByAddresses({\n    account_ids: addresses,\n  })).nft_items;\n}\n\nexport async function fetchAccountNfts(network: ApiNetwork, address: string, options?: {\n  collection?: string;\n  offset?: number;\n  limit?: number;\n}) {\n  const { collection, offset, limit } = options ?? {};\n\n  return (await getApi(network).accounts.getAccountNftItems(\n    address,\n    {\n      offset: offset ?? 0,\n      limit: limit ?? MAX_LIMIT,\n      indirect_ownership: true,\n      collection,\n    },\n  )).nft_items;\n}\n\nexport function fetchNftByAddress(network: ApiNetwork, nftAddress: string) {\n  return getApi(network).nft.getNftItemByAddress(nftAddress);\n}\n\nexport async function fetchAccountEvents(network: ApiNetwork, address: string, fromSec: number, limit?: number) {\n  return (await getApi(network).accounts.getAccountEvents(address, {\n    limit: limit ?? EVENTS_LIMIT,\n    start_date: fromSec,\n  })).events;\n}\n","import { beginCell, Cell, storeStateInit } from '@ton/core';\n\nimport type { ApiNetwork, ApiTonWallet, ApiWalletInfo } from '../../types';\nimport type { ApiTonWalletVersion, ContractInfo } from './types';\nimport type { TonWallet } from './util/tonCore';\n\nimport { DEFAULT_WALLET_VERSION } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { extractKey, findLast } from '../../../util/iteratees';\nimport withCacheAsync from '../../../util/withCacheAsync';\nimport { stringifyTxId } from './util';\nimport { getWalletInfos } from './util/apiV3';\nimport { fetchJettonBalances } from './util/tonapiio';\nimport {\n  getTonClient, toBase64Address, walletClassMap,\n} from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { base64ToBytes, hexToBytes, sha256 } from '../../common/utils';\nimport { ALL_WALLET_VERSIONS, KnownContracts, WORKCHAIN } from './constants';\n\nexport const isAddressInitialized = withCacheAsync(\n  async (network: ApiNetwork, walletOrAddress: TonWallet | string) => {\n    return (await getWalletInfo(network, walletOrAddress)).isInitialized;\n  },\n);\n\nexport const isActiveSmartContract = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const { isInitialized, isWallet } = await getWalletInfo(network, address);\n  return isInitialized ? !isWallet : undefined;\n}, (value) => value !== undefined);\n\nexport function publicKeyToAddress(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  walletVersion: ApiTonWalletVersion,\n) {\n  const wallet = buildWallet(network, publicKey, walletVersion);\n  return toBase64Address(wallet.address, false, network);\n}\n\nexport function buildWallet(\n  network: ApiNetwork,\n  publicKey: Uint8Array | string,\n  walletVersion: ApiTonWalletVersion,\n): TonWallet {\n  if (typeof publicKey === 'string') {\n    publicKey = hexToBytes(publicKey);\n  }\n  const client = getTonClient(network);\n  const WalletClass = walletClassMap[walletVersion]!;\n  return client.open(\n    WalletClass.create({\n      publicKey: Buffer.from(publicKey),\n      workchain: WORKCHAIN,\n    }),\n  );\n}\n\nexport async function getWalletInfo(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<{\n  isInitialized: boolean;\n  isWallet: boolean;\n  seqno: number;\n  balance: bigint;\n  lastTxId?: string;\n}> {\n  const address = typeof walletOrAddress === 'string'\n    ? walletOrAddress\n    : toBase64Address(walletOrAddress.address, undefined, network);\n\n  const {\n    account_state: accountState,\n    wallet: isWallet,\n    seqno = 0,\n    balance,\n    last_transaction_id: {\n      lt,\n      hash,\n    },\n  } = await getTonClient(network).getWalletInfo(address);\n\n  return {\n    isInitialized: accountState === 'active',\n    isWallet,\n    seqno,\n    balance: BigInt(balance || '0'),\n    lastTxId: lt === '0'\n      ? undefined\n      : stringifyTxId({ lt, hash }),\n  };\n}\n\nexport async function getContractInfo(network: ApiNetwork, address: string): Promise<{\n  isInitialized: boolean;\n  isSwapAllowed?: boolean;\n  isWallet?: boolean;\n  contractInfo?: ContractInfo;\n  codeHash?: string;\n}> {\n  const data = await getTonClient(network).getAddressInfo(address);\n\n  const { code, state } = data;\n\n  const codeHashOld = Buffer.from(await sha256(base64ToBytes(code))).toString('hex');\n  const contractInfo = Object.values(KnownContracts).find((info) => info.hash === codeHashOld);\n  // For inactive addresses, `code` is an empty string. Cell.fromBase64 throws when `code` is an empty string.\n  const codeHash = code && Cell.fromBase64(code).hash().toString('hex');\n\n  const isInitialized = state === 'active';\n  const isWallet = state === 'active' ? contractInfo?.type === 'wallet' : undefined;\n  const isSwapAllowed = contractInfo?.isSwapAllowed;\n\n  return {\n    isInitialized,\n    isWallet,\n    isSwapAllowed,\n    contractInfo,\n    codeHash,\n  };\n}\n\nexport async function getAccountBalance(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return getWalletBalance(network, address);\n}\n\nexport async function getWalletBalance(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<bigint> {\n  return (await getWalletInfo(network, walletOrAddress)).balance;\n}\n\nexport async function getWalletSeqno(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<number> {\n  const { seqno } = await getWalletInfo(network, walletOrAddress);\n  return seqno || 0;\n}\n\nexport async function pickBestWallet(network: ApiNetwork, publicKey: Uint8Array): Promise<{\n  wallet: TonWallet;\n  version: ApiTonWalletVersion;\n  balance: bigint;\n  lastTxId?: string;\n}> {\n  const allWallets = await getWalletVersionInfos(network, publicKey);\n  const defaultWallet = allWallets.filter(({ version }) => version === DEFAULT_WALLET_VERSION)[0];\n\n  if (defaultWallet.lastTxId) {\n    return defaultWallet;\n  }\n\n  const withBiggestBalance = allWallets.reduce<typeof allWallets[0] | undefined>((best, current) => {\n    return current.balance > (best?.balance ?? 0n) ? current : best;\n  }, undefined);\n\n  if (withBiggestBalance) {\n    return withBiggestBalance;\n  }\n\n  const withLastTx = findLast(allWallets, ({ lastTxId }) => !!lastTxId);\n\n  if (withLastTx) {\n    return withLastTx;\n  }\n\n  // Workaround for NOT holders who do not have transactions\n  const v4Wallet = allWallets.find(({ version }) => version === 'v4R2')!;\n  const v4JettonBalances = await fetchJettonBalances(network, v4Wallet.address);\n  if (v4JettonBalances.length > 0) {\n    return v4Wallet;\n  }\n\n  return defaultWallet;\n}\n\nexport async function getWalletVersionInfos(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  versions: ApiTonWalletVersion[] = ALL_WALLET_VERSIONS,\n): Promise<(ApiWalletInfo & { wallet: TonWallet })[]> {\n  const items = versions.map((version) => {\n    const wallet = buildWallet(network, publicKey, version);\n    const address = toBase64Address(wallet.address, false, network);\n    return { wallet, address, version };\n  });\n\n  const walletInfos = await getWalletInfos(network, extractKey(items, 'address'));\n\n  return items.map((item) => {\n    return {\n      ...walletInfos[item.address] ?? {\n        balance: 0n,\n        isInitialized: false,\n      },\n      ...item,\n    };\n  });\n}\n\nexport function getWalletVersions(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  versions: ApiTonWalletVersion[] = ALL_WALLET_VERSIONS,\n): {\n    wallet: TonWallet;\n    address: string;\n    version: ApiTonWalletVersion;\n  }[] {\n  return versions.map((version) => {\n    const wallet = buildWallet(network, publicKey, version);\n    const address = toBase64Address(wallet.address, false, network);\n\n    return {\n      wallet,\n      address,\n      version,\n    };\n  });\n}\n\nexport async function getWalletStateInit(accountId: string, storedWallet: ApiTonWallet) {\n  const wallet = await getTonWallet(accountId, storedWallet);\n\n  return beginCell()\n    .storeWritable(storeStateInit(wallet!.init))\n    .endCell();\n}\n\nexport function pickWalletByAddress(network: ApiNetwork, publicKey: Uint8Array, address: string) {\n  address = toBase64Address(address, false, network);\n\n  const allWallets = getWalletVersions(network, publicKey);\n\n  return allWallets.find((w) => w.address === address)!;\n}\n\nexport async function getTonWallet(accountId: string, tonWallet?: ApiTonWallet) {\n  const { network } = parseAccountId(accountId);\n  const { publicKey, version } = tonWallet ?? await fetchStoredTonWallet(accountId);\n\n  const publicKeyBytes = hexToBytes(publicKey);\n  return buildWallet(network, publicKeyBytes, version);\n}\n\nexport function resolveWalletVersion(wallet: TonWallet) {\n  return Object.entries(walletClassMap)\n    .find(([, walletClass]) => wallet instanceof walletClass)?.[0];\n}\n","import * as tonWebMnemonic from 'tonweb-mnemonic';\nimport * as bip39 from 'bip39';\nimport nacl from 'tweetnacl';\n\nimport type {\n  ApiAccountWithMnemonic,\n  ApiLedgerAccount,\n  ApiNetwork,\n  ApiTonAccount,\n  ApiTonWallet,\n} from '../../types';\nimport type { ApiTonWalletVersion } from './types';\nimport type { TonWallet } from './util/tonCore';\n\nimport * as HDKey from '../../../lib/ed25519-hd-key';\nimport { parseAccountId } from '../../../util/account';\nimport isMnemonicPrivateKey from '../../../util/isMnemonicPrivateKey';\nimport { logDebugError } from '../../../util/logs';\nimport { toBase64Address } from './util/tonCore';\nimport { fetchStoredAccount, getNewAccountId, setAccountValue } from '../../common/accounts';\nimport { getMnemonic } from '../../common/mnemonic';\nimport { bytesToHex, hexToBytes } from '../../common/utils';\nimport { TON_BIP39_PATH } from './constants';\nimport { buildWallet, pickBestWallet, publicKeyToAddress } from './wallet';\n\nexport function generateMnemonic() {\n  return tonWebMnemonic.generateMnemonic();\n}\n\nexport function validateMnemonic(mnemonic: string[]) {\n  return tonWebMnemonic.validateMnemonic(mnemonic);\n}\n\nexport function privateKeyHexToKeyPair(privateKeyHex: string) {\n  return nacl.sign.keyPair.fromSeed(hexToBytes(privateKeyHex));\n}\n\nexport async function fetchPrivateKey(accountId: string, password: string, account?: ApiAccountWithMnemonic) {\n  try {\n    const { secretKey: privateKey } = await fetchKeyPair(accountId, password, account) || {};\n\n    return privateKey;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    return undefined;\n  }\n}\n\nexport async function fetchKeyPair(accountId: string, password: string, account?: ApiAccountWithMnemonic) {\n  try {\n    account = account ?? await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const mnemonic = await getMnemonic(accountId, password, account);\n    if (!mnemonic) {\n      return undefined;\n    }\n\n    if (isMnemonicPrivateKey(mnemonic)) {\n      return privateKeyHexToKeyPair(mnemonic[0]);\n    } else if (account.type === 'bip39') {\n      return bip39MnemonicToKeyPair(mnemonic);\n    } else {\n      return await tonWebMnemonic.mnemonicToKeyPair(mnemonic);\n    }\n  } catch (err) {\n    logDebugError('fetchKeyPair', err);\n\n    return undefined;\n  }\n}\n\nexport async function rawSign(accountId: string, password: string, dataHex: string) {\n  const privateKey = await fetchPrivateKey(accountId, password);\n  if (!privateKey) {\n    return undefined;\n  }\n\n  const signature = nacl.sign.detached(hexToBytes(dataHex), privateKey);\n\n  return bytesToHex(signature);\n}\n\nexport function getWalletFromBip39Mnemonic(\n  network: ApiNetwork,\n  mnemonic: string[],\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet> {\n  const { publicKey } = bip39MnemonicToKeyPair(mnemonic);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nexport async function getWalletFromMnemonic(\n  mnemonic: string[],\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet & { lastTxId?: string }> {\n  const { publicKey } = await tonWebMnemonic.mnemonicToKeyPair(mnemonic);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nexport function getWalletFromPrivateKey(\n  privateKey: string,\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet> {\n  const { publicKey } = privateKeyHexToKeyPair(privateKey);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nasync function getWalletFromKeys(\n  publicKey: Uint8Array,\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet & { lastTxId?: string }> {\n  let wallet: TonWallet;\n  let lastTxId: string | undefined;\n  if (version) {\n    wallet = buildWallet(network, publicKey, version);\n  } else {\n    ({ wallet, version, lastTxId } = await pickBestWallet(network, publicKey));\n  }\n\n  const address = toBase64Address(wallet.address, false, network);\n  const publicKeyHex = bytesToHex(publicKey);\n\n  return {\n    type: 'ton',\n    publicKey: publicKeyHex,\n    address,\n    version,\n    index: 0,\n    lastTxId,\n  };\n}\n\nfunction bip39MnemonicToKeyPair(mnemonic: string[]) {\n  const hexSeed = bip39.mnemonicToSeedSync(mnemonic.join(' '));\n  const { key: privateKey } = HDKey.derivePath(TON_BIP39_PATH, hexSeed.toString('hex'));\n  return nacl.sign.keyPair.fromSeed(privateKey);\n}\n\nexport async function importNewWalletVersion(accountId: string, version: ApiTonWalletVersion) {\n  const { network } = parseAccountId(accountId);\n\n  const account = await fetchStoredAccount<ApiTonAccount | ApiLedgerAccount>(accountId);\n  const publicKey = hexToBytes(account.ton.publicKey);\n\n  const newAddress = publicKeyToAddress(network, publicKey, version);\n  const newAccountId = await getNewAccountId(network);\n  const newAccount: ApiTonAccount | ApiLedgerAccount = {\n    ...account,\n    ton: {\n      type: 'ton',\n      address: newAddress,\n      publicKey: account.ton.publicKey,\n      version,\n      index: account.ton.index,\n    },\n  };\n\n  const ledger = account.type === 'ledger'\n    ? { index: account.ton.index, driver: account.driver }\n    : undefined;\n\n  await setAccountValue(newAccountId, 'accounts', newAccount);\n\n  return {\n    accountId: newAccountId,\n    address: newAddress,\n    ledger,\n  };\n}\n","import { BRILLIANT_API_BASE_URL, IS_CAPACITOR } from '../config';\n\nconst IPFS_GATEWAY_BASE_URL: string = 'https://ipfs.io/ipfs/';\n\nexport function fetchJsonMetadata(url: string) {\n  url = fixIpfsUrl(url);\n\n  const reserveUrl = `${BRILLIANT_API_BASE_URL}/utils/download-json?url=${url}`;\n\n  if (IS_CAPACITOR) {\n    return fetchJson(reserveUrl);\n  }\n\n  return fetchJson(url).catch(() => {\n    return fetchJson(reserveUrl);\n  });\n}\n\nexport function fixIpfsUrl(url: string) {\n  return url.replace('ipfs://', IPFS_GATEWAY_BASE_URL);\n}\n\nasync function fetchJson(url: string) {\n  const response = await fetch(url);\n  if (!response.ok) {\n    throw Error(`Http error ${response.status}`);\n  }\n  return response.json();\n}\n","/* eslint-disable max-len, no-misleading-character-class, no-control-regex, operator-linebreak */\n/** @copyright Mathias Bynens <https://mathiasbynens.be/>. MIT license. */\nconst RE_SYMBOL_WITH_COMBINING_MARKS =\n  /([\\0-\\u02FF\\u0370-\\u1AAF\\u1B00-\\u1DBF\\u1E00-\\u20CF\\u2100-\\uD7FF\\uE000-\\uFE1F\\uFE30-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])([\\u0300-\\u036F\\u1AB0-\\u1AFF\\u1DC0-\\u1DFF\\u20D0-\\u20FF\\uFE20-\\uFE2F]+)/g;\n/** @copyright Mathias Bynens <https://mathiasbynens.be/>. MIT license. */\nconst RE_LINEBREAK_COMBINING_MARKS =\n  /[\\0-\\x08\\x0E-\\x1F\\x7F-\\x84\\x86-\\x9F\\u0300-\\u034E\\u0350-\\u035B\\u0363-\\u036F\\u0483-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u0610-\\u061A\\u061C\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08D4-\\u08E1\\u08E3-\\u0903\\u093A-\\u093C\\u093E-\\u094F\\u0951-\\u0957\\u0962\\u0963\\u0981-\\u0983\\u09BC\\u09BE-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CD\\u09D7\\u09E2\\u09E3\\u0A01-\\u0A03\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70\\u0A71\\u0A75\\u0A81-\\u0A83\\u0ABC\\u0ABE-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AE2\\u0AE3\\u0B01-\\u0B03\\u0B3C\\u0B3E-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B62\\u0B63\\u0B82\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD7\\u0C00-\\u0C03\\u0C3E-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C62\\u0C63\\u0C81-\\u0C83\\u0CBC\\u0CBE-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CE2\\u0CE3\\u0D01-\\u0D03\\u0D3E-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4D\\u0D57\\u0D62\\u0D63\\u0D82\\u0D83\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DF2\\u0DF3\\u0F18\\u0F19\\u0F35\\u0F37\\u0F39\\u0F3E\\u0F3F\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86\\u0F87\\u0F8D-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u180B-\\u180D\\u1885\\u1886\\u18A9\\u1920-\\u192B\\u1930-\\u193B\\u1A17-\\u1A1B\\u1A7F\\u1AB0-\\u1ABE\\u1B00-\\u1B04\\u1B34-\\u1B44\\u1B6B-\\u1B73\\u1B80-\\u1B82\\u1BA1-\\u1BAD\\u1BE6-\\u1BF3\\u1C24-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE8\\u1CED\\u1CF2-\\u1CF4\\u1CF8\\u1CF9\\u1DC0-\\u1DF5\\u1DFB-\\u1DFF\\u200C\\u200E\\u200F\\u202A-\\u202E\\u2066-\\u206F\\u20D0-\\u20F0\\u2CEF-\\u2CF1\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302F\\u3035\\u3099\\u309A\\uA66F-\\uA672\\uA674-\\uA67D\\uA69E\\uA69F\\uA6F0\\uA6F1\\uA802\\uA806\\uA80B\\uA823-\\uA827\\uA880\\uA881\\uA8B4-\\uA8C5\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA953\\uA980-\\uA983\\uA9B3-\\uA9C0\\uAA29-\\uAA36\\uAA43\\uAA4C\\uAA4D\\uAAEB-\\uAAEF\\uAAF5\\uAAF6\\uABE3-\\uABEA\\uABEC\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFFF9-\\uFFFB]|\\uD800[\\uDDFD\\uDEE0\\uDF76-\\uDF7A]|\\uD802[\\uDE01-\\uDE03\\uDE05\\uDE06\\uDE0C-\\uDE0F\\uDE38-\\uDE3A\\uDE3F\\uDEE5\\uDEE6]|\\uD804[\\uDC00-\\uDC02\\uDC38-\\uDC46\\uDC7F-\\uDC82\\uDCB0-\\uDCBA\\uDD00-\\uDD02\\uDD27-\\uDD34\\uDD73\\uDD80-\\uDD82\\uDDB3-\\uDDC0\\uDDCA-\\uDDCC\\uDE2C-\\uDE37\\uDE3E\\uDEDF-\\uDEEA\\uDF00-\\uDF03\\uDF3C\\uDF3E-\\uDF44\\uDF47\\uDF48\\uDF4B-\\uDF4D\\uDF57\\uDF62\\uDF63\\uDF66-\\uDF6C\\uDF70-\\uDF74]|\\uD805[\\uDC35-\\uDC46\\uDCB0-\\uDCC3\\uDDAF-\\uDDB5\\uDDB8-\\uDDC0\\uDDDC\\uDDDD\\uDE30-\\uDE40\\uDEAB-\\uDEB7]|\\uD807[\\uDC2F-\\uDC36\\uDC38-\\uDC3F\\uDC92-\\uDCA7\\uDCA9-\\uDCB6]|\\uD81A[\\uDEF0-\\uDEF4\\uDF30-\\uDF36]|\\uD81B[\\uDF51-\\uDF7E\\uDF8F-\\uDF92]|\\uD82F[\\uDC9D\\uDC9E\\uDCA0-\\uDCA3]|\\uD834[\\uDD65-\\uDD69\\uDD6D-\\uDD82\\uDD85-\\uDD8B\\uDDAA-\\uDDAD\\uDE42-\\uDE44]|\\uD836[\\uDE00-\\uDE36\\uDE3B-\\uDE6C\\uDE75\\uDE84\\uDE9B-\\uDE9F\\uDEA1-\\uDEAF]|\\uD838[\\uDC00-\\uDC06\\uDC08-\\uDC18\\uDC1B-\\uDC21\\uDC23\\uDC24\\uDC26-\\uDC2A]|\\uD83A[\\uDCD0-\\uDCD6\\uDD44-\\uDD4A]|\\uDB40[\\uDC01\\uDC20-\\uDC7F\\uDD00-\\uDDEF]/g;\nconst RE_SPACE_CHARS = /[\\n\\r]/g;\nconst RE_FAKE_DOTS = /[\\u0702\\u0701\\u2024\\u00B7\\u02D9\\u0971\\u1427\\u18DF\\u22C5\\u2027]/g;\nconst RE_EMPTY_CHARS = /[\\u200B-\\u200D\\uFEFF\\u2063]/g;\n/* eslint-enable max-len, no-misleading-character-class, no-control-regex, operator-linebreak */\n\n/** Skippable characters that are not confusables */\nexport const checkLNPRegex = /^(?:[~`!@#%^&*(){}[\\];:\"'<,.>?/\\\\|_+=-]|[a-zA-Z0-9\\s])+$/;\n\nexport function checkLNP(str: string) {\n  return checkLNPRegex.test(str);\n}\n\n/**\n * Utility function to call 2 other functions which remove Combining Marks/Invisible characters\n * @param str The text to clean.\n */\nexport function clean(str: string) {\n  return str\n    .replace(RE_LINEBREAK_COMBINING_MARKS, '')\n    .replace(RE_SYMBOL_WITH_COMBINING_MARKS, '$1')\n    .replace(RE_SPACE_CHARS, ' ')\n    .replace(RE_FAKE_DOTS, '.')\n    .replace(RE_EMPTY_CHARS, '');\n}\n","export const characters = new Map<string, string>([\n  [' ', ' '],\n  ['0', ''],\n  ['1', '111'],\n  ['2', ''],\n  ['3', ''],\n  ['4', ''],\n  ['5', ''],\n  ['6', ''],\n  ['7', ''],\n  ['8', ''],\n  ['9', ''],\n  ['10', ''],\n  ['11', ''],\n  ['12', ''],\n  ['13', ''],\n  ['14', ''],\n  ['15', ''],\n  ['16', ''],\n  ['17', ''],\n  ['18', ''],\n  ['19', ''],\n  ['20', ''],\n  ['ae', ''],\n  ['OE', ''],\n  ['oe', ''],\n  ['pi', ''],\n  ['Nj', ''],\n  ['AE', ''],\n  ['A', ''],\n  ['a', ''],\n  ['B', ''],\n  ['b', ''],\n  ['C', ''],\n  ['c', ''],\n  ['D', ''],\n  ['d', ''],\n  ['E', ''],\n  ['e', ''],\n  ['F', ''],\n  ['f', ''],\n  ['G', ''],\n  ['g', ''],\n  ['H', ''],\n  ['h', ''],\n  ['I', ''],\n  ['i', ''],\n  ['J', ''],\n  ['j', ''],\n  ['K', ''],\n  ['k', ''],\n  ['L', ''],\n  ['l', '|'],\n  ['M', ''],\n  ['m', ''],\n  ['N', ''],\n  ['n', ''],\n  [\n    'O',\n    // eslint-disable-next-line max-len\n    '',\n  ],\n  [\n    'o',\n    // eslint-disable-next-line max-len\n    '',\n  ],\n  ['P', ''],\n  ['p', ''],\n  ['Q', ''],\n  ['q', ''],\n  ['R', ''],\n  ['r', ''],\n  ['S', ''],\n  ['s', ''],\n  ['T', ''],\n  ['t', ''],\n  ['U', ''],\n  ['u', ''],\n  ['V', ''],\n  ['v', ''],\n  ['W', ''],\n  ['w', ''],\n  ['X', ''],\n  ['x', ''],\n  ['Y', ''],\n  ['y', ''],\n  ['Z', ''],\n  ['z', ''],\n]);\n","// Original repo: https://github.com/gc/confusables\n\nimport { checkLNP, clean } from './util';\nimport { characters } from './characters';\n\nconst alphabetMap = new Map<string, string[]>();\nconst confusablesMap = new Map<string, string>();\n\nfor (const [base, alts] of characters.entries()) {\n  alphabetMap.set(base, [...alts]);\n\n  for (const char of alts) {\n    confusablesMap.set(char, base);\n  }\n}\n\nexport function cleanText(str: string) {\n  if (checkLNP(str)) return str;\n\n  let newStr = '';\n\n  for (const char of clean(str)) {\n    newStr += confusablesMap.get(char) || char;\n  }\n\n  return newStr;\n}\n","import { APP_ENV, APP_VERSION, BRILLIANT_API_BASE_URL } from '../../config';\nimport { fetchJson, fetchWithRetry, handleFetchErrors } from '../../util/fetch';\nimport { getEnvironment } from '../environment';\n\nconst BAD_REQUEST_CODE = 400;\n\nexport async function callBackendPost<T>(path: string, data: AnyLiteral, options?: {\n  authToken?: string;\n  isAllowBadRequest?: boolean;\n  method?: string;\n  shouldRetry?: boolean;\n  retries?: number;\n  timeouts?: number | number[];\n}): Promise<T> {\n  const {\n    authToken, isAllowBadRequest, method, shouldRetry, retries, timeouts,\n  } = options ?? {};\n\n  const url = new URL(`${BRILLIANT_API_BASE_URL}${path}`);\n\n  const init: RequestInit = {\n    method: method ?? 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      ...getBackendHeaders(),\n      ...(authToken && { 'X-Auth-Token': authToken }),\n    },\n    body: JSON.stringify(data),\n  };\n\n  const response = shouldRetry\n    ? await fetchWithRetry(url, init, {\n      retries,\n      timeouts,\n      shouldSkipRetryFn: (message) => !message?.includes('signal is aborted'),\n    })\n    : await fetch(url.toString(), init);\n\n  await handleFetchErrors(response, isAllowBadRequest ? [BAD_REQUEST_CODE] : undefined);\n\n  return response.json();\n}\n\nexport function callBackendGet<T = any>(path: string, data?: AnyLiteral, headers?: HeadersInit): Promise<T> {\n  const url = new URL(`${BRILLIANT_API_BASE_URL}${path}`);\n\n  return fetchJson(url, data, {\n    headers: {\n      ...headers,\n      ...getBackendHeaders(),\n    },\n  });\n}\n\nfunction getBackendHeaders() {\n  return {\n    ...getEnvironment().apiHeaders,\n    'X-App-Version': APP_VERSION,\n    'X-App-Env': APP_ENV,\n  } as Record<string, string>;\n}\n","import type { ApiAddressInfo, ApiKnownAddresses } from '../types';\n\nimport { RE_LINK_TEMPLATE, RE_TG_BOT_MENTION } from '../../config';\nimport { cleanText } from '../../lib/confusables';\nimport { logDebugError } from '../../util/logs';\nimport { callBackendGet } from './backend';\n\nlet knownAddresses: ApiKnownAddresses = {};\nlet scamMarkers: RegExp[] = [];\nlet trustedSites: Set<string> = new Set();\nlet trustedCollections: Set<string> = new Set();\n\nexport async function tryUpdateKnownAddresses() {\n  try {\n    const data = await callBackendGet<{\n      knownAddresses: Record<string, ApiKnownAddresses>;\n      scamMarkers: string[];\n      trustedSites: string[];\n      trustedCollections: string[];\n    }>('/known-addresses');\n\n    knownAddresses = data.knownAddresses;\n    scamMarkers = data.scamMarkers.map((x) => new RegExp(x, 'i'));\n    trustedSites = new Set(data.trustedSites);\n    trustedCollections = new Set(data.trustedCollections);\n  } catch (err) {\n    logDebugError('tryUpdateKnownAddresses', err);\n  }\n}\n\nexport function getKnownAddresses() {\n  return knownAddresses;\n}\n\nexport function getScamMarkers() {\n  return scamMarkers;\n}\n\nexport function getKnownAddressInfo(address: string): ApiAddressInfo | undefined {\n  return knownAddresses[address];\n}\n\nexport function checkIsTrustedSite(domain: string) {\n  return trustedSites.has(domain.toLowerCase());\n}\n\nexport function checkIsTrustedCollection(address: string) {\n  return trustedCollections.has(address);\n}\n\nexport function checkHasScamLink(text: string) {\n  const matches = cleanText(text).matchAll(RE_LINK_TEMPLATE);\n\n  for (const match of matches) {\n    const host = match.groups?.host;\n    if (host && !checkIsTrustedSite(host)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function checkHasTelegramBotMention(text: string) {\n  return RE_TG_BOT_MENTION.test(cleanText(text));\n}\n","import type { Table, UpdateSpec } from 'dexie';\n\nconst IGNORED_DEXIE_ERRORS = new Set(['AbortError', 'BulkError', 'UnknownError']);\n\nasync function tryDbQuery<T>(cb: () => Promise<T>) {\n  try {\n    return await cb();\n  } catch (error: any) {\n    if (IGNORED_DEXIE_ERRORS.has(error?.name)) return undefined;\n    else throw error;\n  }\n}\n\nexport class DbRepository<T> {\n  table: Table<T>;\n\n  constructor(table: Table<T>) {\n    this.table = table;\n  }\n\n  all() {\n    return this.table.toArray();\n  }\n\n  find(where: {\n    [key: string]: any;\n  }) {\n    return tryDbQuery(() => {\n      return this.table.where(where).toArray();\n    });\n  }\n\n  put(item: T) {\n    return tryDbQuery(() => {\n      return this.table.put(item);\n    });\n  }\n\n  bulkPut(items: T[]) {\n    return tryDbQuery(() => {\n      return this.table.bulkPut(items);\n    });\n  }\n\n  update(key: string[], update: UpdateSpec<T>) {\n    return tryDbQuery(() => {\n      return this.table.update(key, update);\n    });\n  }\n\n  delete(key: string[]) {\n    return tryDbQuery(() => {\n      return this.table.delete(key);\n    });\n  }\n\n  deleteWhere(where: {\n    [key: string]: any;\n  }) {\n    return tryDbQuery(() => {\n      return this.table.where(where).delete();\n    });\n  }\n\n  clear() {\n    return tryDbQuery(() => {\n      return this.table.clear();\n    });\n  }\n}\n","import type { Table } from 'dexie';\nimport Dexie from 'dexie';\n\nimport type { ApiNft, ApiToken } from '../types';\n\nimport { DbRepository } from './repository';\n\nexport type ApiDbNft = ApiNft & {\n  accountId: string;\n  collectionAddress: string;\n};\n\nexport type ApiDbSseConnection = {\n  clientId: string;\n};\n\nconst DB_NANE = 'tables';\n\nexport class ApiDb extends Dexie {\n  nfts!: Table<ApiDbNft>;\n\n  tokens!: Table<ApiToken>;\n\n  constructor() {\n    super(DB_NANE);\n    this.version(1).stores({\n      nfts: '[accountId+address], accountId, address, collectionAddress',\n    });\n    this.version(2).stores({\n      sseConnections: '&clientId',\n    });\n    this.version(3).stores({\n      tokens: 'tokenAddress, chain, &slug',\n    });\n  }\n}\n\nexport const apiDb = new ApiDb();\n\nexport const nftRepository = new DbRepository(apiDb.nfts);\nexport const tokenRepository = new DbRepository(apiDb.tokens);\n","import type { ApiBaseCurrency, ApiStakingCommonData, ApiTokenPrice } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY } from '../../config';\n\nexport type AccountCache = { stakedAt?: number };\n\nlet stakingCommonCache: ApiStakingCommonData;\nconst accountCache: Record<string, AccountCache> = {};\nconst pricesCache: {\n  baseCurrency: ApiBaseCurrency;\n  bySlug: Record<string, ApiTokenPrice>;\n} = {\n  baseCurrency: DEFAULT_PRICE_CURRENCY,\n  bySlug: {},\n};\n\nexport function getAccountCache(accountId: string, address: string) {\n  return accountCache[`${accountId}:${address}`] ?? {};\n}\n\nexport function updateAccountCache(accountId: string, address: string, partial: Partial<AccountCache>) {\n  const key = `${accountId}:${address}`;\n  accountCache[key] = { ...accountCache[key], ...partial };\n}\n\nexport function setStakingCommonCache(data: ApiStakingCommonData) {\n  stakingCommonCache = data;\n}\n\nexport function getStakingCommonCache() {\n  return stakingCommonCache;\n}\n\nexport function getPricesCache() {\n  return pricesCache;\n}\n","import type {\n  ApiChain, ApiToken, ApiTokenWithPrice, OnApiUpdate,\n} from '../types';\n\nimport { TOKEN_INFO } from '../../config';\nimport { tokenRepository } from '../db';\nimport { getPricesCache } from './cache';\n\nconst tokensCache = {\n  ...TOKEN_INFO,\n} as Record<string, ApiToken>;\n\nexport async function loadTokensCache() {\n  const tokens = await tokenRepository.all();\n  return addTokens(tokens);\n}\n\nexport async function addTokens(tokens: ApiToken[], onUpdate?: OnApiUpdate, shouldForceSend?: boolean) {\n  const newTokens: ApiToken[] = [];\n\n  for (let i = 0; i < tokens.length; i++) {\n    const token = tokens[i];\n    const mergedToken = mergeTokenWithCache(token);\n\n    if (!(token.slug in tokensCache)) {\n      newTokens.push(mergedToken);\n    }\n\n    tokensCache[token.slug] = mergedToken;\n    tokens[i] = mergedToken;\n  }\n\n  await tokenRepository.bulkPut(tokens);\n  if ((shouldForceSend || newTokens.length) && onUpdate) {\n    sendUpdateTokens(onUpdate);\n  }\n}\n\nexport function mergeTokenWithCache(token: ApiToken): ApiToken {\n  const cacheToken = tokensCache[token.slug] || {};\n\n  return { ...cacheToken, ...token };\n}\n\nexport function getTokensCache() {\n  return tokensCache;\n}\n\nexport function getTokenBySlug(slug: string) {\n  return getTokensCache()[slug];\n}\n\nexport function getTokenByAddress(tokenAddress: string) {\n  return getTokenBySlug(buildTokenSlug('ton', tokenAddress));\n}\n\nexport function sendUpdateTokens(onUpdate: OnApiUpdate) {\n  const tokens = getTokensCache();\n  const prices = getPricesCache();\n\n  const entries = Object.values(tokens).map((token) => {\n    return [token.slug, {\n      ...token,\n      quote: prices.bySlug[token.slug] ?? {\n        slug: token.slug,\n        price: 0,\n        priceUsd: 0,\n        percentChange24h: 0,\n      },\n    }] as [string, ApiTokenWithPrice];\n  });\n\n  onUpdate({\n    type: 'updateTokens',\n    tokens: Object.fromEntries(entries),\n    baseCurrency: prices.baseCurrency,\n  });\n}\n\nexport function buildTokenSlug(chain: ApiChain, address: string) {\n  const addressPart = address.replace(/[^a-z\\d]/gi, '').slice(0, 10);\n  return `${chain}-${addressPart}`.toLowerCase();\n}\n","import type { NftItem } from 'tonapi-sdk-js';\nimport type { DictionaryValue } from '@ton/core';\nimport { BitReader } from '@ton/core/dist/boc/BitReader';\nimport { BitString } from '@ton/core/dist/boc/BitString';\nimport { Builder } from '@ton/core/dist/boc/Builder';\nimport { Cell } from '@ton/core/dist/boc/Cell';\nimport { Slice } from '@ton/core/dist/boc/Slice';\nimport { Dictionary } from '@ton/core/dist/dict/Dictionary';\n\nimport type {\n  ApiMtwCardTextType,\n  ApiMtwCardType,\n  ApiNetwork,\n  ApiNft,\n  ApiNftMetadata,\n  ApiParsedPayload,\n  ApiTransactionType,\n} from '../../../types';\nimport type { DnsCategory } from '../constants';\nimport type { ApiTransactionExtra, JettonMetadata } from '../types';\n\nimport {\n  DEBUG,\n  LIQUID_JETTON,\n  MTW_CARDS_COLLECTION,\n  NFT_FRAGMENT_COLLECTIONS,\n  NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX,\n  NFT_FRAGMENT_GIFT_IMAGE_URL_PREFIX,\n} from '../../../../config';\nimport { omitUndefined, pick, range } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport { fetchJsonMetadata, fixIpfsUrl } from '../../../../util/metadata';\nimport { JettonStakingOpCodes } from '../contracts/JettonStaking/imports/constants';\nimport { checkHasScamLink, checkIsTrustedCollection } from '../../../common/addresses';\nimport { buildTokenSlug } from '../../../common/tokens';\nimport { base64ToString, sha256 } from '../../../common/utils';\nimport {\n  DNS_CATEGORY_HASH_MAP,\n  DnsOpCode,\n  JettonOpCode,\n  LiquidStakingOpCode,\n  NftOpCode,\n  OpCode,\n  OtherOpCode,\n  SingleNominatorOpCode,\n  VestingV1OpCode,\n} from '../constants';\nimport { fixAddressFormat } from './apiV3';\nimport { fetchNftItems } from './tonapiio';\nimport {\n  getDnsItemDomain, getJettonMinterData, resolveTokenAddress, toBase64Address,\n} from './tonCore';\n\nconst OFFCHAIN_CONTENT_PREFIX = 0x01;\nconst SNAKE_PREFIX = 0x00;\n\nexport function parseJettonWalletMsgBody(network: ApiNetwork, body?: string) {\n  if (!body) return undefined;\n\n  try {\n    let slice = Cell.fromBase64(body).beginParse();\n    const opCode = slice.loadUint(32);\n    const queryId = slice.loadUintBig(64);\n\n    if (opCode !== JettonOpCode.Transfer && opCode !== JettonOpCode.InternalTransfer) {\n      return undefined;\n    }\n\n    const jettonAmount = slice.loadCoins();\n    const address = slice.loadMaybeAddress();\n    const responseAddress = slice.loadMaybeAddress();\n    let forwardAmount: bigint | undefined;\n    let comment: string | undefined;\n    let encryptedComment: string | undefined;\n    let type: ApiTransactionType | undefined;\n\n    if (responseAddress) {\n      if (opCode === JettonOpCode.Transfer) {\n        slice.loadBit();\n      }\n      forwardAmount = slice.loadCoins();\n      const isSeparateCell = slice.remainingBits && slice.loadBit();\n      if (isSeparateCell && slice.remainingRefs) {\n        slice = slice.loadRef().beginParse();\n      }\n      if (slice.remainingBits > 32) {\n        const forwardOpCode = slice.loadUint(32);\n        if (forwardOpCode === OpCode.Comment) {\n          const buffer = readSnakeBytes(slice);\n          comment = buffer.toString('utf-8');\n\n          if (comment === 'Jettons unstaked') {\n            type = 'unstake';\n          }\n        } else if (forwardOpCode === OpCode.Encrypted) {\n          const buffer = readSnakeBytes(slice);\n          encryptedComment = buffer.toString('base64');\n        } else if (forwardOpCode === JettonStakingOpCodes.STAKE_JETTONS) {\n          type = 'stake';\n        }\n      }\n    }\n\n    return {\n      operation: JettonOpCode[opCode] as keyof typeof JettonOpCode,\n      queryId,\n      jettonAmount,\n      responseAddress,\n      address: address ? toBase64Address(address, undefined, network) : undefined,\n      forwardAmount,\n      comment,\n      encryptedComment,\n      type,\n    };\n  } catch (err) {\n    logDebugError('parseJettonWalletMsgBody', err);\n  }\n\n  return undefined;\n}\n\nexport function fixBase64ImageData(data: string) {\n  const decodedData = base64ToString(data);\n  if (decodedData.includes('<svg')) {\n    return `data:image/svg+xml;base64,${data}`;\n  }\n  return `data:image/png;base64,${data}`;\n}\n\nconst dictSnakeBufferValue: DictionaryValue<Buffer> = {\n  parse: (slice) => {\n    const buffer = Buffer.from('');\n\n    const sliceToVal = (s: Slice, v: Buffer, isFirst: boolean) => {\n      if (isFirst && s.loadUint(8) !== SNAKE_PREFIX) {\n        throw new Error('Only snake format is supported');\n      }\n\n      v = Buffer.concat([v, s.loadBuffer(s.remainingBits / 8)]);\n      if (s.remainingRefs === 1) {\n        v = sliceToVal(s.loadRef().beginParse(), v, false);\n      }\n\n      return v;\n    };\n\n    return sliceToVal(slice.loadRef().beginParse() as any, buffer, true);\n  },\n  serialize: () => {\n    // pass\n  },\n};\n\nconst jettonOnChainMetadataSpec: {\n  [key in keyof JettonMetadata]: 'utf8' | 'ascii' | undefined;\n} = {\n  uri: 'ascii',\n  name: 'utf8',\n  description: 'utf8',\n  image: 'ascii',\n  symbol: 'utf8',\n  decimals: 'utf8',\n  custom_payload_api_uri: 'ascii',\n};\n\nexport async function fetchJettonMetadata(network: ApiNetwork, address: string) {\n  const { content } = await getJettonMinterData(network, address);\n\n  let metadata: JettonMetadata;\n\n  const slice = content.asSlice();\n  const prefix = slice.loadUint(8);\n\n  if (prefix === OFFCHAIN_CONTENT_PREFIX) {\n    const bytes = readSnakeBytes(slice);\n    const contentUri = bytes.toString('utf-8');\n    metadata = await fetchJettonOffchainMetadata(contentUri);\n  } else {\n    // On-chain content\n    metadata = await parseJettonOnchainMetadata(slice);\n    if (metadata.uri) {\n      // Semi-chain content\n      const offchainMetadata = await fetchJettonOffchainMetadata(metadata.uri);\n      metadata = { ...offchainMetadata, ...metadata };\n    }\n  }\n\n  return metadata;\n}\n\nexport async function parseJettonOnchainMetadata(slice: Slice): Promise<JettonMetadata> {\n  const dict = slice.loadDict(Dictionary.Keys.Buffer(32), dictSnakeBufferValue);\n\n  const res: { [s in keyof JettonMetadata]?: string } = {};\n\n  for (const [key, value] of Object.entries(jettonOnChainMetadataSpec)) {\n    const sha256Key = Buffer.from(await sha256(Buffer.from(key, 'ascii')));\n    const val = dict.get(sha256Key)?.toString(value);\n\n    if (val) {\n      res[key as keyof JettonMetadata] = val;\n    }\n  }\n\n  return res as JettonMetadata;\n}\n\nexport async function fetchJettonOffchainMetadata(uri: string): Promise<JettonMetadata> {\n  const metadata = await fetchJsonMetadata(uri);\n  return pick(metadata, [\n    'name',\n    'description',\n    'symbol',\n    'decimals',\n    'image',\n    'image_data',\n    'custom_payload_api_uri',\n  ]);\n}\n\nexport async function parseWalletTransactionBody(\n  network: ApiNetwork, transaction: ApiTransactionExtra,\n): Promise<ApiTransactionExtra> {\n  const body = transaction.extraData?.body;\n  if (!body || transaction.comment || transaction.encryptedComment) {\n    return transaction;\n  }\n\n  try {\n    const slice = dataToSlice(body);\n\n    if (slice.remainingBits > 32) {\n      const address = transaction.isIncoming ? transaction.fromAddress : transaction.toAddress;\n\n      const parsedPayload = await parsePayloadSlice(\n        network, address, slice, false, transaction,\n      );\n      transaction.extraData!.parsedPayload = parsedPayload;\n\n      if (parsedPayload?.type === 'comment') {\n        transaction = {\n          ...transaction,\n          comment: parsedPayload.comment,\n        };\n      } else if (parsedPayload?.type === 'encrypted-comment') {\n        transaction = {\n          ...transaction,\n          encryptedComment: parsedPayload.encryptedComment,\n        };\n      }\n    }\n  } catch (err) {\n    logDebugError('parseTransactionBody', err);\n  }\n\n  return transaction;\n}\n\nexport async function parsePayloadBase64(\n  network: ApiNetwork,\n  address: string,\n  base64: string,\n): Promise<ApiParsedPayload> {\n  const slice = dataToSlice(base64);\n  const result: ApiParsedPayload = { type: 'unknown', base64 };\n\n  if (!slice) return result;\n\n  return await parsePayloadSlice(network, address, slice, true) ?? result;\n}\n\nexport async function parsePayloadSlice(\n  network: ApiNetwork,\n  address: string,\n  slice: Slice,\n  shouldLoadItems?: boolean,\n  transactionDebug?: ApiTransactionExtra,\n): Promise<ApiParsedPayload | undefined> {\n  let opCode: number | undefined;\n  try {\n    opCode = slice.loadUint(32);\n\n    if (opCode === OpCode.Comment) {\n      const buffer = readSnakeBytes(slice);\n      const comment = buffer.toString('utf-8');\n      return { type: 'comment', comment };\n    } else if (opCode === OpCode.Encrypted) {\n      const buffer = readSnakeBytes(slice);\n      const encryptedComment = buffer.toString('base64');\n      return { type: 'encrypted-comment', encryptedComment };\n    } else if (slice.remainingBits < 64) {\n      return undefined;\n    }\n\n    const queryId = slice.loadUintBig(64);\n\n    switch (opCode) {\n      case JettonOpCode.Transfer: {\n        const tokenAddress = await resolveTokenAddress(network, address).catch(() => '');\n        const slug = buildTokenSlug('ton', tokenAddress);\n\n        const amount = slice.loadCoins();\n        const destination = slice.loadAddress();\n        const responseDestination = slice.loadMaybeAddress();\n\n        if (!responseDestination) {\n          return {\n            type: 'tokens:transfer-non-standard',\n            queryId,\n            destination: toBase64Address(destination, undefined, network),\n            amount,\n            slug,\n          };\n        }\n\n        const customPayload = slice.loadMaybeRef();\n        const forwardAmount = slice.loadCoins();\n        let forwardPayload = slice.loadMaybeRef();\n        let forwardPayloadOpCode: number | undefined;\n\n        if (!forwardPayload && slice.remainingBits) {\n          const builder = new Builder().storeBits(slice.loadBits(slice.remainingBits));\n          range(0, slice.remainingRefs).forEach(() => {\n            builder.storeRef(slice.loadRef());\n          });\n          forwardPayload = builder.endCell();\n        }\n\n        if (forwardPayload) {\n          const forwardPayloadSlice = forwardPayload.beginParse();\n          if (forwardPayloadSlice.remainingBits > 32) {\n            forwardPayloadOpCode = forwardPayloadSlice.loadUint(32);\n          }\n        }\n\n        return {\n          type: 'tokens:transfer',\n          queryId,\n          amount,\n          destination: toBase64Address(destination, undefined, network),\n          responseDestination: toBase64Address(responseDestination, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          forwardAmount,\n          forwardPayload: forwardPayload?.toBoc().toString('base64'),\n          forwardPayloadOpCode,\n          slug,\n        };\n      }\n      case NftOpCode.TransferOwnership: {\n        const newOwner = slice.loadAddress();\n        const responseDestination = slice.loadAddress();\n        const customPayload = slice.loadMaybeRef();\n        const forwardAmount = slice.loadCoins();\n        const forwardPayload = readForwardPayloadCell(slice);\n        const comment = forwardPayload ? readComment(forwardPayload.asSlice()) : undefined;\n\n        let nft: ApiNft | undefined;\n        if (shouldLoadItems) {\n          const [rawNft] = await fetchNftItems(network, [address]);\n          if (rawNft) {\n            nft = buildNft(network, rawNft);\n          }\n        }\n\n        return {\n          type: 'nft:transfer',\n          queryId,\n          newOwner: toBase64Address(newOwner, undefined, network),\n          responseDestination: toBase64Address(responseDestination, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          forwardAmount,\n          forwardPayload: forwardPayload?.toBoc().toString('base64'),\n          nftAddress: address,\n          nftName: nft?.name,\n          nft,\n          comment,\n        };\n      }\n      case NftOpCode.OwnershipAssigned: {\n        const prevOwner = slice.loadAddress();\n        const forwardPayload = readForwardPayloadCell(slice);\n        const comment = forwardPayload ? readComment(forwardPayload.asSlice()) : undefined;\n\n        let nft: ApiNft | undefined;\n        if (shouldLoadItems) {\n          const [rawNft] = await fetchNftItems(network, [address]);\n          if (rawNft) {\n            nft = buildNft(network, rawNft);\n          }\n        }\n\n        return {\n          type: 'nft:ownership-assigned',\n          queryId,\n          prevOwner: toBase64Address(prevOwner, undefined, network),\n          comment,\n          nftAddress: address,\n          nft,\n        };\n      }\n      case JettonOpCode.Burn: {\n        const tokenAddress = await resolveTokenAddress(network, address);\n        const slug = buildTokenSlug('ton', tokenAddress);\n\n        const amount = slice.loadCoins();\n        const addressObj = slice.loadAddress();\n        const customPayload = slice.loadMaybeRef();\n        const isLiquidUnstakeRequest = tokenAddress === LIQUID_JETTON;\n\n        return {\n          type: 'tokens:burn',\n          queryId,\n          amount,\n          address: toBase64Address(addressObj, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          slug,\n          isLiquidUnstakeRequest,\n        };\n      }\n      case LiquidStakingOpCode.DistributedAsset: {\n        return {\n          type: 'liquid-staking:withdrawal-nft',\n          queryId,\n        };\n      }\n      case LiquidStakingOpCode.Withdrawal: {\n        return {\n          type: 'liquid-staking:withdrawal',\n          queryId,\n        };\n      }\n      case LiquidStakingOpCode.Deposit: {\n        let appId: bigint | undefined;\n        if (slice.remainingBits > 0) {\n          appId = slice.loadUintBig(64);\n        }\n        return {\n          type: 'liquid-staking:deposit',\n          queryId,\n          appId,\n        };\n      }\n      case VestingV1OpCode.AddWhitelist: {\n        const toAddress = slice.loadAddress();\n        const addressString = shouldLoadItems\n          ? await fixAddressFormat(network, toAddress.toRawString())\n          : '';\n\n        return {\n          type: 'vesting:add-whitelist',\n          queryId,\n          address: addressString,\n        };\n      }\n      case SingleNominatorOpCode.Withdraw: {\n        const amount = slice.loadCoins();\n        return {\n          type: 'single-nominator:withdraw',\n          queryId,\n          amount,\n        };\n      }\n      case SingleNominatorOpCode.ChangeValidator: {\n        const toAddress = slice.loadAddress();\n        const addressString = shouldLoadItems\n          ? await fixAddressFormat(network, toAddress.toRawString())\n          : '';\n\n        return {\n          type: 'single-nominator:change-validator',\n          queryId,\n          address: addressString,\n        };\n      }\n      case LiquidStakingOpCode.Vote: {\n        const votingAddress = slice.loadAddress();\n        const expirationDate = slice.loadUint(48);\n        const vote = slice.loadBit();\n        const needConfirmation = slice.loadBit();\n\n        return {\n          type: 'liquid-staking:vote',\n          queryId,\n          votingAddress: toBase64Address(votingAddress, true),\n          expirationDate,\n          vote,\n          needConfirmation,\n        };\n      }\n      case DnsOpCode.ChangeRecord: {\n        const hash = slice.loadBuffer(32).toString('hex');\n        const category = Object.entries(DNS_CATEGORY_HASH_MAP)\n          .find(([, value]) => hash === value)?.[0] as DnsCategory ?? 'unknown';\n        const toAddress = slice.loadAddress();\n        const domain = shouldLoadItems\n          ? await getDnsItemDomain(network, toAddress)\n          : '';\n\n        if (category === 'wallet') {\n          if (slice.remainingRefs > 0) {\n            const dataSlice = slice.loadRef().beginParse();\n            slice.endParse();\n\n            const dataAddress = dataSlice.loadAddress();\n            const flags = dataSlice.loadUint(8);\n\n            const addressString = shouldLoadItems\n              ? await fixAddressFormat(network, dataAddress.toRawString())\n              : '';\n\n            return {\n              type: 'dns:change-record',\n              queryId,\n              record: {\n                type: 'wallet',\n                value: addressString,\n                flags,\n              },\n              domain,\n            };\n          } else {\n            return {\n              type: 'dns:change-record',\n              queryId,\n              record: {\n                type: 'wallet',\n                value: undefined,\n              },\n              domain,\n            };\n          }\n        } else if (slice.remainingRefs > 0) {\n          const value = slice.loadRef();\n          return {\n            type: 'dns:change-record',\n            queryId,\n            record: category === 'unknown' ? {\n              type: 'unknown',\n              key: hash,\n              value: value.toBoc().toString('base64'),\n            } : {\n              type: category,\n              value: value.toBoc().toString('base64'),\n            },\n            domain,\n          };\n        } else {\n          return {\n            type: 'dns:change-record',\n            queryId,\n            record: category === 'unknown' ? {\n              type: 'unknown',\n              key: hash,\n            } : {\n              type: category,\n            },\n            domain,\n          };\n        }\n      }\n      case OtherOpCode.TokenBridgePaySwap: {\n        const swapId = slice.loadBuffer(32).toString('hex');\n        return {\n          type: 'token-bridge:pay-swap',\n          queryId,\n          swapId,\n        };\n      }\n      case JettonStakingOpCodes.UNSTAKE_JETTONS: {\n        const amount = slice.loadCoins();\n        const isForce = slice.loadBoolean();\n        return {\n          type: 'jetton-staking:unstake',\n          queryId,\n          amount,\n          isForce,\n        };\n      }\n    }\n  } catch (err) {\n    if (DEBUG) {\n      const debugTxString = transactionDebug\n        && `${transactionDebug.txId} ${new Date(transactionDebug.timestamp)}`;\n      const opCodeHex = `0x${opCode?.toString(16).padStart(8, '0')}`;\n      logDebugError('parsePayload', opCodeHex, debugTxString, '\\n', err);\n    }\n  }\n\n  return undefined;\n}\n\nfunction dataToSlice(data: string | Buffer | Uint8Array): Slice {\n  let buffer: Buffer;\n  if (typeof data === 'string') {\n    buffer = Buffer.from(data, 'base64');\n  } else if (data instanceof Buffer) {\n    buffer = data;\n  } else {\n    buffer = Buffer.from(data);\n  }\n\n  try {\n    return Cell.fromBoc(buffer)[0].beginParse();\n  } catch (err: any) {\n    if (err?.message !== 'Invalid magic') {\n      throw err;\n    }\n  }\n\n  return new Slice(new BitReader(new BitString(buffer, 0, buffer.length * 8)), []);\n}\n\nfunction readComment(slice: Slice) {\n  if (slice.remainingBits < 32) {\n    return undefined;\n  }\n\n  const opCode = slice.loadUint(32);\n  if (opCode !== OpCode.Comment || (!slice.remainingBits && !slice.remainingRefs)) {\n    return undefined;\n  }\n\n  const buffer = readSnakeBytes(slice);\n  return buffer.toString('utf-8');\n}\n\nfunction readForwardPayloadCell(slice: Slice) {\n  let forwardPayload = slice.loadBit() && slice.remainingRefs ? slice.loadRef() : undefined;\n\n  if (!forwardPayload && slice.remainingBits) {\n    const builder = new Builder().storeBits(slice.loadBits(slice.remainingBits));\n    range(0, slice.remainingRefs).forEach(() => {\n      builder.storeRef(slice.loadRef());\n    });\n    forwardPayload = builder.endCell();\n  }\n\n  return forwardPayload ?? undefined;\n}\n\nexport function readSnakeBytes(slice: Slice) {\n  let buffer = Buffer.alloc(0);\n\n  while (slice.remainingBits >= 8) {\n    buffer = Buffer.concat([buffer, slice.loadBuffer(slice.remainingBits / 8)]);\n    if (slice.remainingRefs) {\n      slice = slice.loadRef().beginParse();\n    } else {\n      break;\n    }\n  }\n\n  return buffer;\n}\n\nfunction buildMtwCardsNftMetadata(metadata: Record<string, any>): ApiNftMetadata | undefined {\n  const { image, id } = metadata as { image?: string; id?: number };\n\n  let mtwCardType: ApiMtwCardType | undefined;\n  let mtwCardTextType: ApiMtwCardTextType | undefined;\n  let result: ApiNftMetadata = {};\n  if (image) result.imageUrl = image;\n  if (id !== undefined) result.mtwCardId = id;\n\n  if ('attributes' in metadata && Array.isArray(metadata.attributes) && metadata.attributes.length) {\n    mtwCardType = metadata.attributes\n      .find((attribute) => attribute.trait_type === 'Card Type')?.value\n      // Clean non-ascii characters with regex\n      .replace(/[^\\x20-\\x7E]/g, '')\n      .trim()\n      .toLowerCase();\n\n    if (mtwCardType) {\n      mtwCardTextType = metadata.attributes.find((attribute) => attribute.trait_type === 'Text')?.value.toLowerCase();\n\n      result.mtwCardType = mtwCardType;\n      if (mtwCardType === 'standard') {\n        result.mtwCardBorderShineType = metadata.attributes.find((attribute) => {\n          return attribute.trait_type === 'Shine';\n        })?.value.toLowerCase();\n      }\n\n      if (mtwCardTextType === 'dark' || mtwCardType === 'silver') {\n        result.mtwCardTextType = 'dark';\n      } else {\n        result.mtwCardTextType = 'light';\n      }\n\n      result = omitUndefined(result);\n    }\n  }\n\n  return Object.keys(result).length ? result : undefined;\n}\n\nexport function buildNft(network: ApiNetwork, rawNft: NftItem): ApiNft | undefined {\n  if (!rawNft.metadata) {\n    return undefined;\n  }\n\n  try {\n    const {\n      address,\n      index,\n      collection,\n      metadata: rawMetadata,\n      previews,\n      sale,\n      trust,\n      owner,\n    } = rawNft;\n\n    const {\n      name, image, description, render_type: renderType, lottie,\n    } = rawMetadata as {\n      name?: string;\n      image?: string;\n      description?: string;\n      render_type?: string;\n      lottie?: string;\n    };\n\n    const collectionAddress = collection && toBase64Address(collection.address, true, network);\n    let hasScamLink = false;\n\n    if (!collectionAddress || !checkIsTrustedCollection(collectionAddress)) {\n      for (const text of [name, description].filter(Boolean)) {\n        if (checkHasScamLink(text)) {\n          hasScamLink = true;\n        }\n      }\n    }\n\n    const isWhitelisted = trust === 'whitelist';\n    const isScam = hasScamLink || description === 'SCAM' || trust === 'blacklist';\n    const isHidden = renderType === 'hidden' || isScam;\n    const imageFromPreview = previews!.find((x) => x.resolution === '1500x1500')!.url;\n    const isFragmentGift = image?.startsWith(NFT_FRAGMENT_GIFT_IMAGE_URL_PREFIX);\n\n    const metadata = {\n      ...(isWhitelisted && { lottie }),\n      ...(collectionAddress === MTW_CARDS_COLLECTION && buildMtwCardsNftMetadata(rawMetadata)),\n      ...(isFragmentGift && { fragmentUrl: image!.replace(NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX, 'https://$1') }),\n    };\n\n    return omitUndefined<ApiNft>({\n      index,\n      name,\n      ownerAddress: owner ? toBase64Address(owner.address, false, network) : undefined,\n      address: toBase64Address(address, true, network),\n      image: fixIpfsUrl(imageFromPreview || image || ''),\n      thumbnail: previews!.find((x) => x.resolution === '500x500')!.url,\n      isOnSale: Boolean(sale),\n      isHidden,\n      isScam,\n      description,\n      ...(collection && {\n        collectionAddress,\n        collectionName: collection.name,\n        isOnFragment: isFragmentGift || NFT_FRAGMENT_COLLECTIONS.has(collection.address),\n      }),\n      metadata,\n    });\n  } catch (err) {\n    logDebugError('buildNft', err);\n    return undefined;\n  }\n}\n","import type { ApiActivity } from '../api/types';\n\nexport function compareActivities(a: ApiActivity, b: ApiActivity, isAsc = false) {\n  let value = a.timestamp - b.timestamp;\n  if (value === 0) {\n    value = a.id > b.id ? 1 : a.id < b.id ? -1 : 0;\n  }\n  return isAsc ? value : -value;\n}\n","import type { ApiChain } from '../api/types';\n\nimport { CHAIN_CONFIG } from '../config';\n\nexport function getChainConfig<T extends ApiChain>(chain: T) {\n  return CHAIN_CONFIG[chain];\n}\n\nexport function findChainConfig(chain: any) {\n  return chain in CHAIN_CONFIG ? CHAIN_CONFIG[chain as ApiChain] : undefined;\n}\n","import type { ApiCheckTransactionDraftResult, ApiFetchEstimateDieselResult } from '../../api/chains/ton/types';\nimport type { FeePrecision, FeeTerms } from './types';\n\nimport { TONCOIN } from '../../config';\nimport { Big } from '../../lib/big.js';\nimport { bigintMax, bigintMin } from '../bigint';\nimport { getIsNativeToken } from '../tokens';\n\ntype ApiFee = Pick<ApiCheckTransactionDraftResult, 'fee' | 'realFee' | 'diesel'> & {\n  /** The slug of the token that is being transferred */\n  tokenSlug: string;\n};\n\nexport type ExplainedTransferFee = {\n  /** Whether the result implies paying the fee with a diesel */\n  isGasless: boolean;\n  /**\n   * The fee that will be sent with the transfer. The wallet must have it on the balance to send the transfer.\n   * Show this in the transfer form when the input amount is  the balance, but the remaining balance can't cover the\n   * full fee; show `realFee` otherwise. Undefined means that it's unknown.\n   */\n  fullFee?: {\n    precision: FeePrecision;\n    terms: FeeTerms<bigint>;\n    /** The sum of `terms` measured in the native token */\n    nativeSum: bigint;\n  };\n  /**\n   * The real fee (the full fee minus the excess). Undefined means that it's unknown. There is no need to fall back to\n   * `fullFee` when `realFee` is undefined (because it's undefined too in this case).\n   */\n  realFee?: {\n    precision: FeePrecision;\n    terms: FeeTerms<bigint>;\n    /** The sum of `terms` measured in the native token */\n    nativeSum: bigint;\n  };\n  /** The excess fee. Measured in the native token. It's always approximate. Undefined means that it's unknown. */\n  excessFee?: bigint;\n  /**\n   * Whether the full token balance can be transferred despite the fee.\n   * If yes, the fee will be taken from the transferred amount.\n   */\n  canTransferFullBalance: boolean;\n};\n\ntype AvailableDiesel = ApiFetchEstimateDieselResult & { amount: bigint };\ntype ApiFeeWithDiesel = ApiFee & { diesel: AvailableDiesel };\n\ntype MaxTransferAmountInput = {\n  /** The wallet balance of the transferred token. Undefined means that it's unknown. */\n  tokenBalance: bigint | undefined;\n  /** The slug of the token that is being transferred */\n  tokenSlug: string;\n  /** The full fee terms calculated by `explainApiTransferFee`. Undefined means that they're unknown. */\n  fullFee: FeeTerms<bigint> | undefined;\n  /** Whether the full token balance can be transferred despite the fee. */\n  canTransferFullBalance: boolean;\n};\n\ntype BalanceSufficientForTransferInput = Omit<MaxTransferAmountInput, 'tokenSlug'> & {\n  /** The wallet balance of the native token of the transfer chain. Undefined means that it's unknown. */\n  nativeTokenBalance: bigint | undefined;\n  /** The transferred amount. Use 0 for NFT transfers. Undefined means that it's unspecified. */\n  transferAmount: bigint | undefined;\n};\n\n/**\n * Converts the transfer fee data returned from API into data that is ready to be displayed in the transfer form UI.\n */\nexport function explainApiTransferFee(input: ApiFee): ExplainedTransferFee {\n  return shouldUseDiesel(input)\n    ? explainGaslessTransferFee(input)\n    : explainGasfullTransferFee(input);\n}\n\n/**\n * Calculates the maximum amount available for the transfer.\n * Returns undefined when it can't be calculated because of insufficient input data.\n */\nexport function getMaxTransferAmount({\n  tokenBalance,\n  tokenSlug,\n  fullFee,\n  canTransferFullBalance,\n}: MaxTransferAmountInput): bigint | undefined {\n  if (tokenBalance === undefined) {\n    return undefined;\n  }\n\n  // Returning the full balance when the fee is unknown for a better UX\n  if (canTransferFullBalance || !fullFee) {\n    return tokenBalance;\n  }\n\n  let fee = fullFee.token ?? 0n;\n  if (getIsNativeToken(tokenSlug)) {\n    // When the token is native, both `token` and `native` refer to the same currency, so they should be added\n    fee += fullFee.native ?? 0n;\n  }\n\n  return bigintMax(tokenBalance - fee, 0n);\n}\n\n/**\n * Decides whether the balance is sufficient to transfer the amount and pay the fees.\n * Returns undefined when it can't be calculated because of insufficient input data.\n */\nexport function isBalanceSufficientForTransfer({\n  tokenBalance,\n  nativeTokenBalance,\n  transferAmount,\n  fullFee,\n  canTransferFullBalance,\n}: BalanceSufficientForTransferInput) {\n  if (transferAmount === undefined || tokenBalance === undefined || nativeTokenBalance === undefined || !fullFee) {\n    return undefined;\n  }\n\n  const isFullTokenTransfer = transferAmount === tokenBalance && canTransferFullBalance;\n  const tokenRequiredAmount = (fullFee.token ?? 0n) + (isFullTokenTransfer ? 0n : transferAmount);\n  const nativeTokenRequiredAmount = fullFee.native ?? 0n;\n\n  return tokenRequiredAmount <= tokenBalance && nativeTokenRequiredAmount <= nativeTokenBalance;\n}\n\nexport function isDieselAvailable(diesel: ApiFetchEstimateDieselResult): diesel is AvailableDiesel {\n  return diesel.status !== 'not-available' && diesel.amount !== undefined;\n}\n\nexport function getDieselTokenAmount(diesel: ApiFetchEstimateDieselResult) {\n  return diesel.status === 'stars-fee' ? 0n : (diesel.amount ?? 0n);\n}\n\nfunction shouldUseDiesel(input: ApiFee): input is ApiFeeWithDiesel {\n  return input.diesel !== undefined && isDieselAvailable(input.diesel);\n}\n\n/**\n * Converts the data of a transfer not involving diesel\n */\nfunction explainGasfullTransferFee(input: ApiFee) {\n  const result: ExplainedTransferFee = {\n    isGasless: false,\n    canTransferFullBalance: input.tokenSlug === TONCOIN.slug,\n  };\n\n  if (input.fee !== undefined) {\n    result.fullFee = {\n      precision: input.realFee === input.fee ? 'exact' : 'lessThan',\n      terms: { native: input.fee },\n      nativeSum: input.fee,\n    };\n    result.realFee = result.fullFee;\n  }\n\n  if (input.realFee !== undefined) {\n    result.realFee = {\n      precision: input.realFee === input.fee ? 'exact' : 'approximate',\n      terms: { native: input.realFee },\n      nativeSum: input.realFee,\n    };\n  }\n\n  if (input.fee !== undefined && input.realFee !== undefined) {\n    result.excessFee = input.fee - input.realFee;\n  }\n\n  return result;\n}\n\n/**\n * Converts the diesel of semi-diesel transfer data\n */\nfunction explainGaslessTransferFee({ diesel }: ApiFeeWithDiesel) {\n  const isStarsDiesel = diesel.status === 'stars-fee';\n  const dieselKey = isStarsDiesel ? 'stars' : 'token';\n  const realFeeInDiesel = convertFee(diesel.realFee, diesel.nativeAmount, diesel.amount);\n  // Cover as much displayed real fee as possible with diesel, because in the excess it will return as the native token.\n  const dieselRealFee = bigintMin(diesel.amount, realFeeInDiesel);\n  // Cover the remaining real fee with the native token.\n  const nativeRealFee = bigintMax(0n, diesel.realFee - diesel.nativeAmount);\n\n  return {\n    isGasless: true,\n    canTransferFullBalance: false,\n    fullFee: {\n      precision: 'lessThan',\n      terms: {\n        [dieselKey]: diesel.amount,\n        native: diesel.remainingFee,\n      },\n      nativeSum: diesel.nativeAmount + diesel.remainingFee,\n    },\n    realFee: {\n      precision: 'approximate',\n      terms: {\n        [dieselKey]: dieselRealFee,\n        native: nativeRealFee,\n      },\n      nativeSum: diesel.realFee,\n    },\n    excessFee: diesel.nativeAmount + diesel.remainingFee - diesel.realFee,\n  } satisfies ExplainedTransferFee;\n}\n\n/**\n * `exampleFromAmount` and `exampleToAmount` define the exchange rate used to convert `amount`.\n * `exampleFromAmount` is defined in the same currency as `amount`. Mustn't be 0.\n * `exampleToAmount` is defined in the currency you want to get.\n */\nfunction convertFee(\n  amount: bigint,\n  exampleFromAmount: bigint,\n  exampleToAmount: bigint,\n) {\n  const exchangeRate = Big(exampleToAmount.toString()).div(exampleFromAmount.toString());\n  return BigInt(Big(amount.toString()).mul(exchangeRate).round().toString());\n}\n","import type { ApiChain, ApiToken, ApiTokenWithPrice } from '../api/types';\nimport type { UserToken } from '../global/types';\n\nimport { CHAIN_CONFIG, TONCOIN } from '../config';\nimport { getChainConfig } from './chain';\nimport { pick } from './iteratees';\n\nconst chainByNativeSlug = Object.fromEntries(\n  Object.entries(CHAIN_CONFIG).map(([chain, { nativeToken }]) => [nativeToken.slug, chain]),\n) as Record<string, ApiChain>;\n\nexport function getIsNativeToken(slug?: string) {\n  return slug ? slug in chainByNativeSlug : false;\n}\n\nexport function getIsTonToken(slug: string, withNative?: boolean) {\n  return Boolean(slug.startsWith('ton-') || (withNative && slug === TONCOIN.slug));\n}\n\nexport function getNativeToken(chain: ApiChain): ApiToken {\n  return getChainConfig(chain).nativeToken;\n}\n\nexport function getTransactionHashFromTxId(chain: ApiChain, txId: string) {\n  if (chain === 'tron') {\n    const localIdSign = txId.indexOf('|');\n\n    return localIdSign !== -1 ? txId.substring(0, localIdSign) : txId;\n  }\n\n  const [, transactionHash] = (txId || '').split(':');\n  return transactionHash;\n}\n\nexport function getChainBySlug(slug: string) {\n  const items = slug.split('-');\n  return items.length > 1 ? items[0] as ApiChain : chainByNativeSlug[slug];\n}\n\nexport function buildUserToken(token: ApiTokenWithPrice | ApiToken): UserToken {\n  return {\n    ...pick(token, [\n      'symbol',\n      'slug',\n      'name',\n      'image',\n      'decimals',\n      'keywords',\n      'chain',\n      'tokenAddress',\n    ]),\n    amount: 0n,\n    totalValue: '0',\n    price: 0,\n    priceUsd: 0,\n    change24h: 0,\n  };\n}\n","import withCache from './withCache';\n\nexport const MEANINGFUL_CHAR_LENGTH = 6;\nconst FILLER = '...';\nconst FILLER_LENGTH = FILLER.length;\n\nexport const shortenAddress = withCache((address: string, shift = MEANINGFUL_CHAR_LENGTH, fromRight = shift) => {\n  if (!address) return undefined;\n\n  if (address.length <= shift + fromRight + FILLER_LENGTH) return address;\n\n  return `${address.slice(0, shift)}${FILLER}${address.slice(-fromRight)}`;\n});\n","import type { ApiTransaction } from '../api/types';\n\nimport { TRANSACTION_ADDRESS_SHIFT } from '../config';\nimport { shortenAddress } from './shortenAddress';\n\nconst cache: Map<string, {\n  timestamp: number;\n  amount: bigint;\n  address: string;\n}> = new Map();\n\nfunction getKey(address: string) {\n  return shortenAddress(address, TRANSACTION_ADDRESS_SHIFT)!;\n}\n\nfunction addToCache(address: string, amount: bigint, timestamp: number) {\n  const key = getKey(address);\n\n  cache.set(key, {\n    address,\n    amount,\n    timestamp,\n  });\n}\n\nfunction getFromCache(address: string) {\n  const key = getKey(address);\n\n  return cache.get(key);\n}\n\nexport function updatePoisoningCache(tx: ApiTransaction) {\n  const { fromAddress: address, amount, timestamp } = tx;\n\n  const cached = getFromCache(address);\n\n  if (!cached || cached.timestamp < timestamp || (cached.timestamp === timestamp && cached.amount > amount)) {\n    addToCache(address, amount, timestamp);\n  }\n}\n\nexport function getIsTransactionWithPoisoning(tx: ApiTransaction) {\n  const { fromAddress: address } = tx;\n\n  const cached = getFromCache(address);\n\n  return cached && cached.address !== address;\n}\n\nexport function clearPoisoningCache() {\n  cache.clear();\n}\n","// This JS library implements TON message comment encryption and decryption for Web\n// Reference C++ code - SimpleEncryptionV2 - https://github.com/ton-blockchain/ton/blob/cc0eb453cb3bf69f92693160103d33112856c056/tonlib/tonlib/keys/SimpleEncryption.cpp#L110\n// Dependencies:\n// - TonWeb 0.0.60\n// - aes-js - 3.1.2 - https://github.com/ricmoo/aes-js/releases/tag/v3.1.2 - for aes-cbc without padding\n// - noble-ed25519 - 1.7.3 - // https://github.com/paulmillr/noble-ed25519/releases/tag/1.7.3 - for getSharedKey\n\nimport type { Address } from '@ton/core';\n\nimport { OpCode } from '../constants';\nimport { toBase64Address } from './tonCore';\n\nconst ed25519 = require('../../../../lib/noble-ed25519');\nconst aesjs = require('../../../../lib/aes-js');\n\nasync function hmacSha512(key: Uint8Array, data: Uint8Array): Promise<Uint8Array> {\n  const hmacAlgo = { name: 'HMAC', hash: 'SHA-512' };\n  const hmacKey = await crypto.subtle.importKey('raw', key, hmacAlgo, false, ['sign']);\n  const signature = await crypto.subtle.sign(hmacAlgo, hmacKey, data);\n  const result = new Uint8Array(signature);\n  if (result.length !== 512 / 8) throw new Error();\n  return result;\n}\n\nfunction getAesCbcState(hash: Uint8Array): Promise<any> {\n  if (hash.length < 48) throw new Error();\n  const key = hash.slice(0, 32);\n  const iv = hash.slice(32, 32 + 16);\n\n  // Note that native crypto.subtle AES-CBC not suitable here because\n  // even if the data IS a multiple of 16 bytes, padding will still be added\n  // So we use aes-js\n\n  // eslint-disable-next-line new-cap\n  return new aesjs.ModeOfOperation.cbc(key, iv);\n}\n\nfunction getRandomPrefix(dataLength: number, minPadding: number): Uint8Array {\n  // eslint-disable-next-line no-bitwise\n  const prefixLength = ((minPadding + 15 + dataLength) & -16) - dataLength;\n  const prefix = crypto.getRandomValues(new Uint8Array(prefixLength));\n  prefix[0] = prefixLength;\n  if ((prefixLength + dataLength) % 16 !== 0) throw new Error();\n  return prefix;\n}\n\nfunction combineSecrets(a: Uint8Array, b: Uint8Array) {\n  return hmacSha512(a, b);\n}\n\nasync function encryptDataWithPrefix(data: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array) {\n  if (data.length % 16 !== 0) throw new Error();\n  const dataHash = await combineSecrets(salt, data);\n  const msgKey = dataHash.slice(0, 16);\n\n  const res = new Uint8Array(data.length + 16);\n  res.set(msgKey, 0);\n\n  const cbcStateSecret = await combineSecrets(sharedSecret, msgKey);\n  const encrypted = (await getAesCbcState(cbcStateSecret)).encrypt(data);\n  res.set(encrypted, 16);\n\n  return res;\n}\n\nasync function encryptDataImpl(data: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array) {\n  const prefix = await getRandomPrefix(data.length, 16);\n  const combined = new Uint8Array(prefix.length + data.length);\n  combined.set(prefix, 0);\n  combined.set(data, prefix.length);\n  return encryptDataWithPrefix(combined, sharedSecret, salt);\n}\n\nexport async function encryptData(\n  data: Uint8Array, myPublicKey: Uint8Array, theirPublicKey: Uint8Array, privateKey: Uint8Array, salt: Uint8Array,\n) {\n  const sharedSecret = await ed25519.getSharedSecret(privateKey, theirPublicKey);\n\n  const encrypted = await encryptDataImpl(data, sharedSecret, salt);\n  const prefixedEncrypted = new Uint8Array(myPublicKey.length + encrypted.length);\n  for (let i = 0; i < myPublicKey.length; i++) {\n    // eslint-disable-next-line no-bitwise\n    prefixedEncrypted[i] = theirPublicKey[i] ^ myPublicKey[i];\n  }\n  prefixedEncrypted.set(encrypted, myPublicKey.length);\n  return prefixedEncrypted;\n}\n\nexport async function encryptMessageComment(\n  comment: string,\n  myPublicKey: Uint8Array,\n  theirPublicKey: Uint8Array,\n  myPrivateKey: Uint8Array,\n  senderAddress: Address | string,\n) {\n  if (!comment || !comment.length) throw new Error('empty comment');\n\n  if (myPrivateKey.length === 64) {\n    myPrivateKey = myPrivateKey.slice(0, 32); // convert nacl private key\n  }\n\n  const commentBytes = new TextEncoder().encode(comment);\n\n  const salt = new TextEncoder().encode(toBase64Address(senderAddress, true));\n\n  const encryptedBytes = await encryptData(commentBytes, myPublicKey, theirPublicKey, myPrivateKey, salt);\n\n  const payload = new Uint8Array(encryptedBytes.length + 4);\n\n  const buffer = Buffer.alloc(4);\n  buffer.writeUInt32BE(OpCode.Encrypted);\n\n  payload.set(buffer, 0);\n  payload.set(encryptedBytes, 4);\n\n  return payload;\n}\n\nasync function doDecrypt(\n  cbcStateSecret: Uint8Array, msgKey: Uint8Array, encryptedData: Uint8Array, salt: Uint8Array,\n): Promise<Uint8Array> {\n  const decryptedData = (await getAesCbcState(cbcStateSecret)).decrypt(encryptedData);\n  const dataHash = await combineSecrets(salt, decryptedData);\n  const gotMsgKey = dataHash.slice(0, 16);\n  if (msgKey.join(',') !== gotMsgKey.join(',')) {\n    throw new Error('Failed to decrypt: hash mismatch');\n  }\n  const prefixLength = decryptedData[0];\n  if (prefixLength > decryptedData.length || prefixLength < 16) {\n    throw new Error('Failed to decrypt: invalid prefix size');\n  }\n  return decryptedData.slice(prefixLength);\n}\n\nasync function decryptDataImpl(\n  encryptedData: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array,\n): Promise<Uint8Array> {\n  if (encryptedData.length < 16) throw new Error('Failed to decrypt: data is too small');\n  if (encryptedData.length % 16 !== 0) throw new Error('Failed to decrypt: data size is not divisible by 16');\n  const msgKey = encryptedData.slice(0, 16);\n  const data = encryptedData.slice(16);\n  const cbcStateSecret = await combineSecrets(sharedSecret, msgKey);\n  const res = await doDecrypt(cbcStateSecret, msgKey, data, salt);\n  return res;\n}\n\nexport async function decryptData(data: Uint8Array, publicKey: Uint8Array, privateKey: Uint8Array, salt: Uint8Array) {\n  if (data.length < publicKey.length) {\n    throw new Error('Failed to decrypt: data is too small');\n  }\n  const theirPublicKey = new Uint8Array(publicKey.length);\n  for (let i = 0; i < publicKey.length; i++) {\n    // eslint-disable-next-line no-bitwise\n    theirPublicKey[i] = data[i] ^ publicKey[i];\n  }\n  const sharedSecret = await ed25519.getSharedSecret(privateKey, theirPublicKey);\n\n  const decrypted = await decryptDataImpl(data.slice(publicKey.length), sharedSecret, salt);\n  return decrypted;\n}\n\nexport async function decryptMessageComment(\n  encryptedData: Uint8Array, myPublicKey: Uint8Array, myPrivateKey: Uint8Array, senderAddress: Address | string,\n) {\n  if (myPrivateKey.length === 64) {\n    myPrivateKey = myPrivateKey.slice(0, 32); // convert nacl private key\n  }\n\n  const salt = new TextEncoder().encode(toBase64Address(senderAddress, true));\n\n  const decryptedBytes = await decryptData(encryptedData, myPublicKey, myPrivateKey, salt);\n  return new TextDecoder().decode(decryptedBytes);\n}\n","import { callBackendPost } from '../../../common/backend';\n\nconst DIESEL_URL = '/diesel';\n\nexport function dieselSendBoc(boc: string) {\n  return callBackendPost<{ result: string; paymentLink?: string }>(\n    `${DIESEL_URL}/sendBoc`, { boc, isAddition: true }, { shouldRetry: true },\n  );\n}\n","import { callBackendPost } from '../../../common/backend';\n\nconst DIESEL_URL = '/diesel';\n\nexport function dieselW5SendRequest(boc: string) {\n  return callBackendPost<{ result: string; paymentLink?: string }>(\n    `${DIESEL_URL}/w5/sendBoc`, { boc, isAddition: true }, { shouldRetry: true },\n  );\n}\n","import type { Cell } from '@ton/core';\nimport { beginCell, external, storeMessage } from '@ton/core';\n\nimport type { GaslessType } from '../transactions';\nimport type { TonClient } from './TonClient';\nimport type { TonWallet } from './tonCore';\n\nimport { dieselSendBoc } from './diesel';\nimport { dieselW5SendRequest } from './w5diesel';\n\nexport async function sendExternal(\n  client: TonClient,\n  wallet: TonWallet,\n  message: Cell,\n  gaslessType?: GaslessType,\n) {\n  const {\n    address,\n    init,\n  } = wallet;\n\n  let neededInit: { data: Cell; code: Cell } | undefined;\n  if (init && !await client.isContractDeployed(address)) {\n    neededInit = init;\n  }\n\n  const ext = external({\n    to: address,\n    init: neededInit ? {\n      code: neededInit.code,\n      data: neededInit.data,\n    } : undefined,\n    body: message,\n  });\n\n  const cell = beginCell()\n    .store(storeMessage(ext))\n    .endCell();\n\n  const isW5Gasless = gaslessType === 'w5';\n\n  const msgHash = cell.hash().toString('base64');\n  const bodyMessageHash = message.hash().toString('base64');\n  const boc = cell.toBoc().toString('base64');\n\n  let paymentLink;\n  if (isW5Gasless) {\n    const result = await dieselW5SendRequest(boc);\n    paymentLink = result.paymentLink;\n  } else if (gaslessType === 'diesel') {\n    const result = await dieselSendBoc(boc);\n    paymentLink = result.paymentLink;\n  } else {\n    await client.sendFile(boc);\n  }\n\n  return {\n    boc,\n    msgHash: isW5Gasless ? bodyMessageHash : msgHash,\n    paymentLink,\n  };\n}\n","export function areDeepEqual<T extends any>(value1: T, value2: T): boolean {\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n  if (type1 !== type2) {\n    return false;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  if (type1 !== 'object' || value1 === null || value2 === null) {\n    return value1 === value2;\n  }\n\n  const isArray1 = Array.isArray(value1);\n  const isArray2 = Array.isArray(value2);\n\n  if (isArray1 !== isArray2) {\n    return false;\n  }\n\n  if (isArray1) {\n    const array1 = value1 as any[];\n    const array2 = value2 as any[];\n\n    if (array1.length !== array2.length) {\n      return false;\n    }\n\n    return array1.every((member1, i) => areDeepEqual(member1, array2[i]));\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (!keys1.every((key1) => object2.hasOwnProperty(key1))) {\n    return false;\n  }\n  if (!keys2.every((key2) => object1.hasOwnProperty(key2))) {\n    return false;\n  }\n\n  return keys1.every((key1) => areDeepEqual(object1[key1], object2[key1]));\n}\n","import type chains from '../chains';\nimport type { ApiTransactionExtra } from '../chains/ton/types';\nimport type { ApiDbSseConnection } from '../db';\nimport type { StorageKey } from '../storages/types';\nimport type {\n  ApiLocalTransactionParams,\n  ApiTonAccount,\n  ApiTonWallet,\n  ApiTransaction,\n  ApiTransactionActivity,\n  OnApiUpdate,\n} from '../types';\n\nimport {\n  IS_CAPACITOR, IS_CORE_WALLET, IS_EXTENSION, MAIN_ACCOUNT_ID,\n} from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { assert } from '../../util/assert';\nimport { logDebugError } from '../../util/logs';\nimport { toBase64Address } from '../chains/ton/util/tonCore';\nimport { getEnvironment } from '../environment';\nimport * as migrations from '../migrations';\nimport { storage } from '../storages';\nimport capacitorStorage from '../storages/capacitorStorage';\nimport idbStorage from '../storages/idb';\nimport localStorage from '../storages/localStorage';\nimport { isAccountActive } from './accounts';\nimport {\n  checkHasScamLink, checkHasTelegramBotMention, getKnownAddresses, getScamMarkers,\n} from './addresses';\nimport { hexToBytes } from './utils';\n\nlet localCounter = 0;\nconst getNextLocalId = () => `${Date.now()}|${localCounter++}`;\n\nconst actualStateVersion = 17;\nlet migrationEnsurePromise: Promise<void>;\n\nexport function buildLocalTransaction(\n  params: ApiLocalTransactionParams,\n  normalizedAddress: string,\n): ApiTransactionActivity {\n  const { amount, txId, ...restParams } = params;\n\n  const transaction: ApiTransaction = updateTransactionMetadata({\n    ...restParams,\n    txId: txId ? `${txId}|` : getNextLocalId(),\n    timestamp: Date.now(),\n    isIncoming: false,\n    amount: -amount,\n    normalizedAddress,\n    extraData: {},\n  });\n\n  return {\n    ...transaction,\n    id: transaction.txId,\n    kind: 'transaction',\n  };\n}\n\nexport function updateTransactionMetadata(transaction: ApiTransactionExtra): ApiTransactionExtra {\n  const {\n    normalizedAddress, comment, type, isIncoming, nft,\n  } = transaction;\n  let { metadata = {} } = transaction;\n\n  const isNftTransfer = type === 'nftTransferred' || type === 'nftReceived' || Boolean(nft);\n  const knownAddresses = getKnownAddresses();\n  const hasScamMarkers = comment ? getScamMarkers().some((sm) => sm.test(comment)) : false;\n  const shouldCheckComment = !hasScamMarkers && comment && isIncoming\n    && (isNftTransfer || comment.toLowerCase().includes('claim'));\n  const hasScamInComment = shouldCheckComment\n    ? (checkHasScamLink(comment) || checkHasTelegramBotMention(comment))\n    : false;\n\n  if (normalizedAddress in knownAddresses) {\n    metadata = { ...metadata, ...knownAddresses[normalizedAddress] };\n  }\n\n  if (hasScamMarkers || hasScamInComment) {\n    metadata.isScam = true;\n  }\n\n  return { ...transaction, metadata };\n}\n\nlet currentOnUpdate: OnApiUpdate | undefined;\n\nexport function connectUpdater(onUpdate: OnApiUpdate) {\n  currentOnUpdate = onUpdate;\n}\n\nexport function disconnectUpdater() {\n  currentOnUpdate = undefined;\n}\n\nexport function isAlive(_onUpdate: OnApiUpdate, accountId: string) {\n  return isUpdaterAlive(_onUpdate) && isAccountActive(accountId);\n}\n\nexport function isUpdaterAlive(onUpdate: OnApiUpdate) {\n  return currentOnUpdate === onUpdate;\n}\n\nexport function startStorageMigration(onUpdate: OnApiUpdate, ton: typeof chains.ton) {\n  migrationEnsurePromise = migrateStorage(onUpdate, ton)\n    .catch((err) => {\n      logDebugError('Migration error', err);\n      currentOnUpdate?.({\n        type: 'showError',\n        error: 'Migration error',\n      });\n    });\n  return migrationEnsurePromise;\n}\n\nexport function waitStorageMigration() {\n  return migrationEnsurePromise;\n}\n\nexport async function migrateStorage(onUpdate: OnApiUpdate, ton: typeof chains.ton) {\n  let version = Number(await storage.getItem('stateVersion', true));\n\n  if (version === actualStateVersion) {\n    return;\n  }\n\n  if (IS_CORE_WALLET && !version) {\n    await migrateCoreWallet(onUpdate);\n  }\n\n  if (IS_CAPACITOR && !version) {\n    if (await storage.getItem('accounts' as StorageKey, true)) {\n      // Fix broken version\n      version = 10;\n    } else {\n      // Prepare for migration to secure storage\n      const idbVersion = await idbStorage.getItem('stateVersion');\n      if (idbVersion) {\n        version = Number(idbVersion);\n      }\n    }\n  }\n\n  // Migration to chrome.storage\n  if (IS_EXTENSION && !version && !(await storage.getItem('addresses' as StorageKey))) {\n    version = await idbStorage.getItem('stateVersion');\n\n    if (version) {\n      // Switching from IndexedDB to `chrome.storage.local`\n      const idbData = await idbStorage.getAll!();\n      await storage.setMany!(idbData);\n    }\n  }\n\n  if (!version) {\n    await storage.setItem('stateVersion', actualStateVersion);\n    return;\n  }\n\n  // First version (v1)\n  if (!version) {\n    // Support multi-accounts\n    const mnemonicEncrypted = await storage.getItem('mnemonicEncrypted' as StorageKey);\n    if (mnemonicEncrypted) {\n      await storage.setItem('mnemonicsEncrypted' as StorageKey, JSON.stringify({\n        [MAIN_ACCOUNT_ID]: mnemonicEncrypted,\n      }));\n      await storage.removeItem('mnemonicEncrypted' as StorageKey);\n    }\n\n    // Change accountId format ('0' -> '0-ton', '1-ton-mainnet' -> '1-ton')\n    if (!mnemonicEncrypted) {\n      for (const field of ['mnemonicsEncrypted', 'addresses', 'publicKeys'] as unknown as StorageKey[]) {\n        const raw = await storage.getItem(field);\n        if (!raw) continue;\n\n        const oldItem = JSON.parse(raw);\n\n        const newItem = Object.entries(oldItem).reduce((prevValue, [accountId, data]) => {\n          const [id, chain = 'ton'] = accountId.split('-');\n          const internalAccountId = [id, chain].join('-');\n          prevValue[internalAccountId] = data;\n          return prevValue;\n        }, {} as any);\n\n        await storage.setItem(field, JSON.stringify(newItem));\n      }\n    }\n\n    version = 1;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 1) {\n    const addresses = await storage.getItem('addresses' as StorageKey) as string | undefined;\n    if (addresses && addresses.includes('-undefined')) {\n      for (const field of ['mnemonicsEncrypted', 'addresses', 'publicKeys'] as unknown as StorageKey[]) {\n        const newValue = (await storage.getItem(field) as string).replace('-undefined', '-ton');\n        await storage.setItem(field, newValue);\n      }\n    }\n\n    version = 2;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version >= 2 && version <= 4) {\n    for (const key of ['addresses', 'mnemonicsEncrypted', 'publicKeys', 'dapps'] as StorageKey[]) {\n      const rawData = await storage.getItem(key);\n      if (typeof rawData === 'string') {\n        await storage.setItem(key, JSON.parse(rawData));\n      }\n    }\n\n    version = 5;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 5) {\n    const dapps = await storage.getItem('dapps');\n    if (dapps) {\n      for (const accountDapps of Object.values(dapps) as any[]) {\n        for (const dapp of Object.values(accountDapps) as any[]) {\n          dapp.connectedAt = 1;\n        }\n      }\n      await storage.setItem('dapps', dapps);\n    }\n\n    version = 6;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 6) {\n    for (const key of ['addresses', 'mnemonicsEncrypted', 'publicKeys', 'accounts', 'dapps'] as StorageKey[]) {\n      let data = await storage.getItem(key) as AnyLiteral;\n      if (!data) continue;\n\n      data = Object.entries(data).reduce((byAccountId, [internalAccountId, accountData]) => {\n        const parsed = parseAccountId(internalAccountId);\n        const mainnetAccountId = buildOldAccountId({ ...parsed, network: 'mainnet' });\n        const testnetAccountId = buildOldAccountId({ ...parsed, network: 'testnet' });\n        return {\n          ...byAccountId,\n          [mainnetAccountId]: accountData,\n          [testnetAccountId]: accountData,\n        };\n      }, {} as AnyLiteral);\n\n      await storage.setItem(key, data);\n    }\n\n    version = 7;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 7) {\n    const addresses = (await storage.getItem('addresses' as StorageKey)) as Record<string, string> | undefined;\n\n    if (addresses) {\n      const publicKeys = (await storage.getItem('publicKeys' as StorageKey)) as Record<string, string>;\n      const accounts = (await storage.getItem('accounts') ?? {}) as Record<string, ApiTonWallet>;\n\n      for (const [accountId, oldAddress] of Object.entries(addresses)) {\n        const newAddress = toBase64Address(oldAddress, false);\n\n        accounts[accountId] = {\n          ...accounts[accountId],\n          address: newAddress,\n          publicKey: publicKeys[accountId],\n        };\n\n        onUpdate({\n          type: 'updateAccount',\n          accountId,\n          partial: {\n            address: newAddress,\n          },\n        });\n      }\n\n      await storage.setItem('accounts', accounts);\n\n      await storage.removeItem('addresses' as StorageKey);\n      await storage.removeItem('publicKeys' as StorageKey);\n    }\n\n    version = 8;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 8) {\n    if (getEnvironment().isSseSupported) {\n      const dapps = await storage.getItem('dapps');\n\n      if (dapps) {\n        const items: ApiDbSseConnection[] = [];\n\n        for (const accountDapps of Object.values(dapps) as any[]) {\n          for (const dapp of Object.values(accountDapps) as any[]) {\n            if (dapp.sse?.appClientId) {\n              items.push({ clientId: dapp.sse?.appClientId });\n            }\n          }\n        }\n      }\n    }\n\n    version = 9;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 9) {\n    if (IS_CAPACITOR) {\n      const data = await idbStorage.getAll!();\n\n      for (const [key, value] of Object.entries(data)) {\n        await capacitorStorage.setItem(key as StorageKey, value);\n        const newValue = await capacitorStorage.getItem(key as StorageKey, true);\n\n        if (!areDeepEqual(value, newValue)) {\n          throw new Error('Migration error!');\n        }\n      }\n      await idbStorage.clear();\n    }\n\n    version = 10;\n    await storage.setItem('stateVersion', version);\n  }\n\n  let isIosKeychainModeMigrated = false;\n  if (getEnvironment().isIosApp && version >= 10 && version <= 13) {\n    await iosBackupAndMigrateKeychainMode();\n    isIosKeychainModeMigrated = true;\n  }\n\n  if (version === 10 || version === 11 || version === 12) {\n    const accounts: Record<string, {\n      publicKey: string;\n      address: string;\n      version?: string;\n    }> | undefined = await storage.getItem('accounts', true);\n\n    if (accounts) {\n      for (const account of Object.values(accounts)) {\n        const { publicKey, address, version: walletVersion } = account;\n\n        if (walletVersion || !publicKey) continue;\n\n        const publicKeyBytes = hexToBytes(publicKey);\n        const walletInfo = ton.pickWalletByAddress('mainnet', publicKeyBytes, address);\n\n        account.version = walletInfo.version;\n      }\n\n      await storage.setItem('accounts', accounts);\n    }\n\n    version = 13;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 13) {\n    const accounts: Record<string, {\n      publicKey: string;\n      address: string;\n      version?: string;\n    }> | undefined = await storage.getItem('accounts', true);\n\n    if (accounts) {\n      for (const [accountId, account] of Object.entries(accounts)) {\n        const { network } = parseAccountId(accountId);\n        if (network === 'testnet') {\n          account.address = toBase64Address(account.address, false, network);\n\n          onUpdate({\n            type: 'updateAccount',\n            accountId,\n            partial: {\n              address: account.address,\n            },\n          });\n        }\n      }\n\n      version = 14;\n      await storage.setItem('accounts', accounts);\n    }\n  }\n\n  if (version === 14 || version === 15) {\n    if (getEnvironment().isIosApp && !isIosKeychainModeMigrated) {\n      await iosBackupAndMigrateKeychainMode();\n    }\n\n    version = 16;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 16) {\n    await migrations.migration16.start();\n\n    version = 17;\n    await storage.setItem('stateVersion', version);\n  }\n}\n\nfunction buildOldAccountId(account: { id: number; network: string }) {\n  const { id, network } = account;\n  return `${id}-ton-${network}`;\n}\n\nasync function iosBackupAndMigrateKeychainMode() {\n  const keys = await capacitorStorage.getKeys();\n\n  if (keys?.length) {\n    const items: [string, any][] = [];\n\n    for (const key of keys) {\n      if (key.startsWith('backup_')) {\n        continue;\n      }\n\n      const backupKey = `backup_${key}` as StorageKey;\n      const value = await capacitorStorage.getItem(key as StorageKey, true);\n\n      assert(value !== undefined, 'Empty value!');\n      await capacitorStorage.setItem(backupKey, value);\n      const backupValue = await capacitorStorage.getItem(backupKey);\n      assert(areDeepEqual(value, backupValue), 'Data has not been saved!');\n\n      items.push([key, value]);\n    }\n\n    for (const [key, value] of items) {\n      let shouldRewrite = false;\n      await capacitorStorage.setItem(key as StorageKey, value).catch(() => {\n        shouldRewrite = true;\n      });\n\n      if (shouldRewrite) {\n        await capacitorStorage.removeItem(key as StorageKey);\n        await capacitorStorage.setItem(key as StorageKey, value);\n      }\n    }\n  }\n}\n\nasync function migrateCoreWallet(onUpdate: OnApiUpdate) {\n  const currentStorage = IS_EXTENSION ? storage : localStorage;\n\n  const [\n    // Default Core Wallet version is v3R2\n    // https://github.com/toncenter/ton-wallet/blob/master/src/js/Controller.js#L128\n    walletVersion = 'v3R2',\n    isTestnet,\n    address,\n    words,\n    publicKey,\n    isTonProxyEnabled,\n    isTonMagicEnabled,\n  ] = await Promise.all([\n    currentStorage.getItem('walletVersion' as StorageKey),\n    currentStorage.getItem('isTestnet' as StorageKey),\n    currentStorage.getItem('address' as StorageKey),\n    currentStorage.getItem('words' as StorageKey),\n    currentStorage.getItem('publicKey' as StorageKey),\n    currentStorage.getItem('proxy' as StorageKey),\n    currentStorage.getItem('magic' as StorageKey),\n  ]);\n\n  if (isTestnet) {\n    onUpdate({\n      type: 'updateSettings',\n      settings: {\n        isTestnet: true,\n      },\n    });\n  }\n\n  const network = isTestnet ? 'testnet' : 'mainnet';\n  const accountId = `0-ton-${network}`;\n\n  if (address && words && publicKey) {\n    const secondNetwork = network === 'mainnet' ? 'testnet' : 'mainnet';\n    const secondAccountId = `0-ton-${secondNetwork}`;\n    const secondAddress = toBase64Address(address, false, secondNetwork);\n\n    const newAccountById: Record<string, ApiTonAccount> = {};\n    newAccountById[accountId] = {\n      type: 'ton',\n      mnemonicEncrypted: words,\n      ton: {\n        type: 'ton',\n        address,\n        version: walletVersion,\n        publicKey,\n        index: 0,\n      },\n    };\n\n    newAccountById[secondAccountId] = {\n      type: 'ton',\n      mnemonicEncrypted: words,\n      ton: {\n        type: 'ton',\n        address: secondAddress,\n        version: walletVersion,\n        publicKey,\n        index: 0,\n      },\n    };\n\n    await storage.setItem('accounts', newAccountById);\n\n    onUpdate({\n      type: 'migrateCoreApplication',\n      isTestnet,\n      accountId,\n      address,\n      secondAccountId,\n      secondAddress,\n      isTonProxyEnabled,\n      isTonMagicEnabled,\n    });\n\n    // Clean up storage after migrate the app from Core Wallet\n    [\n      'walletVersion', 'isTestnet', 'words', 'address', 'publicKey', 'magic', 'proxy', 'isLedger',\n      'ledgerTransportType', '__time', 'isDebug',\n    ].forEach((key) => {\n      void currentStorage.removeItem(key as StorageKey);\n    });\n  }\n}\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import type { ApiNetwork } from '../types';\n\nimport Deferred from '../../util/Deferred';\nimport generateUniqueId from '../../util/generateUniqueId';\n\nconst byId: Record<string, Deferred> = {};\nconst byAddress: Record<string, Deferred> = {};\n\nexport async function waitAndCreatePendingTransfer(network: ApiNetwork, address: string) {\n  const key = `${network}:${address}`;\n  const prevPending = byAddress[key];\n\n  const id = generateUniqueId();\n  const pendingTransfer = new Deferred();\n  byAddress[key] = pendingTransfer;\n  byId[id] = pendingTransfer;\n\n  if (prevPending) {\n    await prevPending.promise;\n  }\n\n  return { id, pendingTransfer };\n}\n\nexport function getPendingTransfer(id: string): Deferred | undefined {\n  return byId[id];\n}\n","export const SEC = 1000;\nexport const MINUTE = 60 * SEC;\nexport const DAYS_IN_YEAR = 365;\nexport const FIRST_TRANSACTIONS_LIMIT = 50;\n","import { beginCell, type Cell } from '@ton/core';\nimport { sign } from '@ton/crypto';\n\nconst Opcodes = {\n  action_send_msg: 0x0ec3c86d,\n  action_set_code: 0xad4de08e,\n  action_extended_set_data: 0x1ff8ea0b,\n  action_extended_add_extension: 0x02,\n  action_extended_remove_extension: 0x03,\n  action_extended_set_signature_auth_allowed: 0x04,\n  auth_extension: 0x6578746e,\n  auth_signed: 0x7369676e,\n  auth_signed_internal: 0x73696e74,\n};\n\nexport function bufferToBigInt(buffer: Buffer): bigint {\n  return BigInt(`0x${buffer.toString('hex')}`);\n}\n\nexport function createBody(actionsList: Cell, seqno: number, secretKey: Buffer, timeout: number) {\n  const payload = beginCell()\n    .storeUint(Opcodes.auth_signed_internal, 32)\n    // TODO: calculate walletId\n    .storeUint(2147483409n, 32)\n    .storeUint(Math.floor((Date.now() + timeout) / 1000), 32)\n    .storeUint(seqno, 32)\n    .storeSlice(actionsList.beginParse())\n    .endCell();\n\n  const signature = sign(payload.hash(), secretKey);\n  return beginCell()\n    .storeSlice(payload.beginParse())\n    .storeUint(bufferToBigInt(signature), 512)\n    .endCell();\n}\n","import type { Cell, MessageRelaxed } from '@ton/core';\nimport { beginCell, SendMode, storeMessageRelaxed } from '@ton/core';\n\nexport type OutAction = ActionSendMsg;\n\nexport class ActionSendMsg {\n  public static readonly tag = 0x0ec3c86d;\n\n  public readonly tag = ActionSendMsg.tag;\n\n  constructor(public readonly mode: SendMode, public readonly outMsg: MessageRelaxed) {}\n\n  public serialize(): Cell {\n    return beginCell()\n      .storeUint(this.tag, 32)\n      .storeUint(this.mode || SendMode.IGNORE_ERRORS, 8)\n      .storeRef(beginCell().store(storeMessageRelaxed(this.outMsg)).endCell())\n      .endCell();\n  }\n}\n\nfunction packActionsListOut(actions: OutAction[]): Cell {\n  if (actions.length === 0) {\n    return beginCell().endCell();\n  }\n\n  const [action, ...rest] = actions;\n\n  return beginCell()\n    .storeRef(packActionsListOut(rest))\n    .storeSlice(action.serialize().beginParse())\n    .endCell();\n}\n\nfunction packActionsListExtended(actions: OutAction[]): Cell {\n  const outActions: OutAction[] = actions;\n\n  let builder = beginCell();\n  if (outActions.length === 0) {\n    builder = builder.storeUint(0, 1);\n  } else {\n    builder = builder.storeMaybeRef(packActionsListOut(outActions.slice().reverse()));\n  }\n  builder = builder.storeUint(0, 1);\n  return builder.endCell();\n}\n\nexport function packActionsList(actions: OutAction[]): Cell {\n  return packActionsListExtended(actions);\n}\n","/* Source https://github.com/toncenter/tonweb/blob/master/src/contract/dns/DnsUtils.js */\nimport type { Cell, Slice } from '@ton/core';\nimport { Address, Builder } from '@ton/core';\n\nimport type { TonClient } from './TonClient';\n\nimport { sha256 } from '../../../common/utils';\nimport { DnsCategory } from '../constants';\n\nexport type DnsResult = Cell | Address | string | undefined;\n\nasync function categoryToBigInt(category?: string) {\n  if (!category) return 0n; // all categories\n  const categoryBytes = new TextEncoder().encode(category);\n  const categoryHashHex = Buffer.from(await sha256(categoryBytes)).toString('hex');\n  return BigInt(`0x${categoryHashHex}`);\n}\n\nfunction parseSmartContractAddressImpl(cell: Cell, prefix0: number, prefix1: number): Address | undefined {\n  const slice = cell.asSlice();\n\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== prefix0 || byte1 !== prefix1) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  return parseAddress(slice);\n}\n\nfunction parseSmartContractAddressRecord(cell: Cell): Address | undefined {\n  return parseSmartContractAddressImpl(cell, 0x9f, 0xd3);\n}\n\nfunction parseNextResolverRecord(cell: Cell): Address | undefined {\n  return parseSmartContractAddressImpl(cell, 0xba, 0x93);\n}\n\nfunction parseStorageBagIdRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== 0x74 || byte1 !== 0x73) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  const buffer = slice.loadBuffer(4);\n  return buffer.toString('hex');\n}\n\nfunction parseSiteRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 === 0xad || byte1 === 0x01) {\n    return parseAdnlAddressRecord(cell);\n  } else {\n    return parseStorageBagIdRecord(cell);\n  }\n}\n\nfunction parseAdnlAddressRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== 0xad || byte1 !== 0x01) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  const buffer = slice.loadBuffer(4);\n  return buffer.toString('hex');\n}\n\nasync function dnsResolveImpl(\n  client: TonClient,\n  dnsAddress: string,\n  rawDomainBytes: Uint8Array,\n  category?: DnsCategory,\n  oneStep?: boolean,\n): Promise<DnsResult> {\n  const len = rawDomainBytes.length * 8;\n\n  const domainCell = new Builder()\n    .storeBuffer(Buffer.from(rawDomainBytes))\n    .asCell();\n\n  const categoryBN = await categoryToBigInt(category);\n  const { stack } = await client.callGetMethod(Address.parse(dnsAddress), 'dnsresolve', [\n    { type: 'slice', cell: domainCell },\n    { type: 'int', value: BigInt(categoryBN.toString()) },\n  ]);\n\n  const resultLen = stack.readNumber();\n\n  let cell: Cell | undefined;\n\n  try {\n    cell = stack.readCell();\n  } catch (err) {\n    // Do nothing\n  }\n\n  if (resultLen === 0) {\n    return undefined; // domain cannot be resolved\n  }\n\n  if (resultLen % 8 !== 0) {\n    throw new Error('domain split not at a component boundary');\n  }\n  // if (rawDomainBytes[resultLen] !== 0) {\n  //     throw new Error('domain split not at a component boundary');\n  // }\n  if (resultLen > len) {\n    throw new Error(`invalid response ${resultLen}/${len}`);\n  } else if (resultLen === len) {\n    if (category === DnsCategory.DnsNextResolver) {\n      return cell ? parseNextResolverRecord(cell) : undefined;\n    } else if (category === DnsCategory.Wallet) {\n      return cell ? parseSmartContractAddressRecord(cell) : undefined;\n    } else if (category === DnsCategory.Site) {\n      return cell ? parseSiteRecord(cell) : undefined;\n    } else if (category === DnsCategory.BagId) {\n      return cell ? parseStorageBagIdRecord(cell) : undefined;\n    } else {\n      return cell;\n    }\n  } else if (!cell) {\n    return undefined; // domain cannot be resolved\n  } else {\n    const nextAddress = parseNextResolverRecord(cell)!;\n    if (oneStep) {\n      if (category === DnsCategory.DnsNextResolver) {\n        return nextAddress;\n      } else {\n        return undefined;\n      }\n    } else {\n      return dnsResolveImpl(client, nextAddress.toString(), rawDomainBytes.slice(resultLen / 8), category, false);\n    }\n  }\n}\n\nfunction domainToBytes(domain: string): Uint8Array {\n  if (!domain || !domain.length) {\n    throw new Error('empty domain');\n  }\n  if (domain === '.') {\n    return new Uint8Array([0]);\n  }\n\n  domain = domain.toLowerCase();\n\n  for (let i = 0; i < domain.length; i++) {\n    if (domain.charCodeAt(i) <= 32) {\n      throw new Error('bytes in range 0..32 are not allowed in domain names');\n    }\n  }\n\n  for (let i = 0; i < domain.length; i++) {\n    const s = domain.substring(i, i + 1);\n    for (let c = 127; c <= 159; c++) { // another control codes range\n      if (s === String.fromCharCode(c)) {\n        throw new Error('bytes in range 127..159 are not allowed in domain names');\n      }\n    }\n  }\n\n  const arr = domain.split('.');\n\n  arr.forEach((part) => {\n    if (!part.length) {\n      throw new Error('domain name cannot have an empty component');\n    }\n  });\n\n  let rawDomain = `${arr.reverse().join('\\0')}\\0`;\n  if (rawDomain.length < 126) {\n    rawDomain = `\\0${rawDomain}`;\n  }\n\n  return new TextEncoder().encode(rawDomain);\n}\n\nexport function dnsResolve(\n  client: TonClient,\n  rootDnsAddress: string,\n  domain: string,\n  category?: DnsCategory,\n  oneStep?: boolean,\n): Promise<DnsResult> {\n  const rawDomainBytes = domainToBytes(domain);\n\n  return dnsResolveImpl(client, rootDnsAddress, rawDomainBytes, category, oneStep);\n}\n\nfunction parseAddress(slice: Slice): Address | undefined {\n  slice.loadUint(3);\n  let n = slice.loadUintBig(8);\n  if (n > 127n) { // Maybe it's not necessary?\n    n -= 256n;\n  }\n\n  const hashPart = slice.loadUintBig(256);\n  if (`${n.toString(10)}:${hashPart.toString(16)}` === '0:0') {\n    return undefined;\n  }\n  const s = `${n.toString(10)}:${hashPart.toString(16).padStart(64, '0')}`;\n  return Address.parse(s);\n}\n","import { Address } from '@ton/core';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { getDnsDomainZone, isDnsDomain } from '../../../util/dns';\nimport { fetchAddressBook } from './util/apiV3';\nimport { dnsResolve } from './util/dns';\nimport { getTonClient, toBase64Address } from './util/tonCore';\nimport { getKnownAddressInfo } from '../../common/addresses';\nimport { DnsCategory } from './constants';\n\nexport async function resolveAddress(network: ApiNetwork, address: string): Promise<{\n  address: string;\n  name?: string;\n  isMemoRequired?: boolean;\n  isScam?: boolean;\n} | undefined> {\n  const isDomain = isDnsDomain(address);\n  let domain: string | undefined;\n\n  if (isDomain) {\n    const resolvedAddress = await resolveAddressByDomain(network, address);\n    if (!resolvedAddress) {\n      return undefined;\n    }\n\n    const addressBook = await fetchAddressBook(network, [resolvedAddress]);\n\n    domain = address;\n    address = addressBook[resolvedAddress].user_friendly;\n  }\n\n  const normalizedAddress = normalizeAddress(address);\n  const known = getKnownAddressInfo(normalizedAddress);\n\n  if (known) {\n    return {\n      address,\n      ...known,\n      name: domain ?? known.name,\n    };\n  }\n\n  return { address, name: domain };\n}\n\nasync function resolveAddressByDomain(network: ApiNetwork, domain: string) {\n  try {\n    const zoneMatch = getDnsDomainZone(domain);\n    if (!zoneMatch) {\n      return undefined;\n    }\n\n    const result = await dnsResolve(\n      getTonClient(network),\n      zoneMatch.zone.resolver,\n      zoneMatch.base,\n      DnsCategory.Wallet,\n    );\n\n    if (!(result instanceof Address)) {\n      return undefined;\n    }\n\n    return toBase64Address(result, undefined, network);\n  } catch (err: any) {\n    if (!err.message?.includes('exit_code')) {\n      throw err;\n    }\n    return undefined;\n  }\n}\n\nexport function normalizeAddress(address: string, network?: ApiNetwork) {\n  return toBase64Address(address, true, network);\n}\n","import type { JettonBalance } from 'tonapi-sdk-js';\nimport { Address, Cell } from '@ton/core';\n\nimport type { ApiNetwork, ApiToken } from '../../types';\nimport type {\n  AnyPayload, ApiTransactionExtra, JettonMetadata, TonTransferParams,\n} from './types';\n\nimport { TON_USDT_SLUG } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { fetchJsonWithProxy } from '../../../util/fetch';\nimport { logDebugError } from '../../../util/logs';\nimport { fixIpfsUrl } from '../../../util/metadata';\nimport {\n  fetchJettonMetadata,\n  fixBase64ImageData,\n  parseJettonWalletMsgBody,\n  parsePayloadBase64,\n} from './util/metadata';\nimport { fetchJettonBalances } from './util/tonapiio';\nimport {\n  buildTokenTransferBody,\n  getTokenBalance,\n  getTonClient,\n  resolveTokenAddress,\n  resolveTokenWalletAddress,\n  toBase64Address, toRawAddress,\n} from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { buildTokenSlug, getTokenByAddress } from '../../common/tokens';\nimport {\n  CLAIM_MINTLESS_AMOUNT,\n  DEFAULT_DECIMALS,\n  TINIEST_TOKEN_TRANSFER_REAL_AMOUNT,\n  TINY_TOKEN_TRANSFER_AMOUNT,\n  TINY_TOKEN_TRANSFER_REAL_AMOUNT,\n  TOKEN_TRANSFER_AMOUNT,\n  TOKEN_TRANSFER_FORWARD_AMOUNT,\n  TOKEN_TRANSFER_REAL_AMOUNT,\n} from './constants';\nimport { isActiveSmartContract } from './wallet';\n\nexport type TokenBalanceParsed = {\n  slug: string;\n  balance: bigint;\n  token: ApiToken;\n  jettonWallet: string;\n};\n\nexport async function getAccountTokenBalances(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return getTokenBalances(network, address);\n}\n\nexport async function getTokenBalances(network: ApiNetwork, address: string) {\n  const balancesRaw = await fetchJettonBalances(network, address);\n  return balancesRaw.map((balance) => parseTokenBalance(network, balance)).filter(Boolean);\n}\n\nfunction parseTokenBalance(network: ApiNetwork, balanceRaw: JettonBalance): TokenBalanceParsed | undefined {\n  if (!balanceRaw.jetton) {\n    return undefined;\n  }\n\n  try {\n    const { balance, jetton, wallet_address: walletAddress } = balanceRaw;\n    const tokenAddress = toBase64Address(jetton.address, true, network);\n    const token = buildTokenByMetadata(tokenAddress, jetton);\n\n    return {\n      slug: token.slug,\n      balance: BigInt(balance),\n      token,\n      jettonWallet: toBase64Address(walletAddress.address, undefined, network),\n    };\n  } catch (err) {\n    logDebugError('parseTokenBalance', err);\n    return undefined;\n  }\n}\n\nexport function parseTokenTransaction(\n  network: ApiNetwork,\n  tx: ApiTransactionExtra,\n  slug: string,\n  walletAddress: string,\n): ApiTransactionExtra | undefined {\n  const { extraData } = tx;\n  if (!extraData?.body) {\n    return undefined;\n  }\n\n  const parsedData = parseJettonWalletMsgBody(network, extraData.body);\n  if (!parsedData) {\n    return undefined;\n  }\n\n  const {\n    operation,\n    jettonAmount,\n    address,\n    comment,\n    encryptedComment,\n    type,\n  } = parsedData;\n  const isIncoming = operation === 'InternalTransfer';\n\n  const fromAddress = isIncoming ? (address ?? tx.fromAddress) : walletAddress;\n  const toAddress = isIncoming ? walletAddress : address!;\n  const normalizedAddress = toBase64Address(isIncoming ? fromAddress : toAddress, true);\n\n  return {\n    ...tx,\n    type,\n    slug,\n    fromAddress,\n    toAddress,\n    normalizedAddress,\n    amount: isIncoming ? jettonAmount : -jettonAmount,\n    comment,\n    encryptedComment,\n    isIncoming,\n  };\n}\n\nexport async function insertMintlessPayload(\n  network: ApiNetwork,\n  fromAddress: string,\n  tokenAddress: string,\n  transfer: TonTransferParams,\n): Promise<TonTransferParams> {\n  const { toAddress, payload } = transfer;\n\n  const token = getTokenByAddress(tokenAddress);\n  if (typeof payload !== 'string' || !token?.customPayloadApiUrl) {\n    return transfer;\n  }\n\n  const parsedPayload = await parsePayloadBase64(network, toAddress, payload);\n  if (parsedPayload.type !== 'tokens:transfer') {\n    throw new Error('Invalid payload');\n  }\n\n  const {\n    mintlessTokenBalance,\n    isMintlessClaimed,\n    stateInit,\n    customPayload,\n  } = await getMintlessParams({\n    network,\n    token,\n    fromAddress,\n    tokenWalletAddress: transfer.toAddress,\n  });\n\n  if (!mintlessTokenBalance || isMintlessClaimed) {\n    return transfer;\n  }\n\n  const newPayload = buildTokenTransferBody({\n    toAddress: parsedPayload.destination,\n    queryId: parsedPayload.queryId,\n    tokenAmount: parsedPayload.amount,\n    forwardAmount: parsedPayload.forwardAmount,\n    forwardPayload: Cell.fromBase64(parsedPayload.forwardPayload!),\n    responseAddress: parsedPayload.responseDestination,\n    customPayload: Cell.fromBase64(customPayload!),\n  });\n\n  return {\n    ...transfer,\n    stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    payload: newPayload,\n    isBase64Payload: false,\n  };\n}\n\nexport async function buildTokenTransfer(options: {\n  network: ApiNetwork;\n  tokenAddress: string;\n  fromAddress: string;\n  toAddress: string;\n  amount: bigint;\n  payload?: AnyPayload;\n  shouldSkipMintless?: boolean;\n  forwardAmount?: bigint;\n}) {\n  const {\n    network,\n    tokenAddress,\n    fromAddress,\n    toAddress,\n    amount,\n    shouldSkipMintless,\n    forwardAmount = TOKEN_TRANSFER_FORWARD_AMOUNT,\n  } = options;\n  let { payload } = options;\n\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, fromAddress, tokenAddress);\n  const token = getTokenByAddress(tokenAddress)!;\n\n  const {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress)),\n    isMintlessClaimed,\n    mintlessTokenBalance,\n    customPayload,\n    stateInit,\n  } = await getMintlessParams({\n    network, fromAddress, token, tokenWalletAddress, shouldSkipMintless,\n  });\n\n  if (isTokenWalletDeployed) {\n    const realTokenAddress = await resolveTokenAddress(network, tokenWalletAddress);\n    if (tokenAddress !== realTokenAddress) {\n      throw new Error('Invalid contract');\n    }\n  }\n\n  payload = buildTokenTransferBody({\n    tokenAmount: amount,\n    toAddress,\n    forwardAmount,\n    forwardPayload: payload,\n    responseAddress: fromAddress,\n    customPayload: customPayload ? Cell.fromBase64(customPayload) : undefined,\n  });\n\n  // eslint-disable-next-line prefer-const\n  let { amount: toncoinAmount, realAmount } = getToncoinAmountForTransfer(\n    token, Boolean(mintlessTokenBalance) && !isMintlessClaimed,\n  );\n\n  if (forwardAmount > TOKEN_TRANSFER_FORWARD_AMOUNT) {\n    toncoinAmount += forwardAmount;\n  }\n\n  return {\n    amount: toncoinAmount,\n    realAmount,\n    toAddress: tokenWalletAddress,\n    payload,\n    stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    mintlessTokenBalance,\n    isTokenWalletDeployed,\n  };\n}\n\nexport async function getTokenBalanceWithMintless(network: ApiNetwork, accountAddress: string, tokenAddress: string) {\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, accountAddress, tokenAddress);\n  const token = getTokenByAddress(tokenAddress)!;\n\n  const {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress)),\n    mintlessTokenBalance,\n  } = await getMintlessParams({\n    network, fromAddress: accountAddress, token, tokenWalletAddress,\n  });\n\n  return calculateTokenBalanceWithMintless(network, tokenWalletAddress, isTokenWalletDeployed, mintlessTokenBalance);\n}\n\nexport async function calculateTokenBalanceWithMintless(\n  network: ApiNetwork,\n  tokenWalletAddress: string,\n  isTokenWalletDeployed?: boolean,\n  mintlessTokenBalance = 0n,\n) {\n  let balance = 0n;\n  if (isTokenWalletDeployed) {\n    balance += await getTokenBalance(network, tokenWalletAddress);\n  }\n  if (mintlessTokenBalance) {\n    balance += mintlessTokenBalance;\n  }\n  return balance;\n}\n\nasync function getMintlessParams(options: {\n  network: ApiNetwork;\n  fromAddress: string;\n  token: ApiToken;\n  tokenWalletAddress: string;\n  shouldSkipMintless?: boolean;\n}) {\n  const {\n    network, fromAddress, token, tokenWalletAddress, shouldSkipMintless,\n  } = options;\n\n  const isMintlessToken = !!token.customPayloadApiUrl;\n  let isTokenWalletDeployed: boolean | undefined;\n  let customPayload: string | undefined;\n  let stateInit: string | undefined;\n\n  let isMintlessClaimed: boolean | undefined;\n  let mintlessTokenBalance: bigint | undefined;\n\n  if (isMintlessToken && !shouldSkipMintless) {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress));\n    isMintlessClaimed = isTokenWalletDeployed && await checkMintlessTokenWalletIsClaimed(network, tokenWalletAddress);\n\n    if (!isMintlessClaimed) {\n      const data = await fetchMintlessTokenWalletData(token.customPayloadApiUrl!, fromAddress);\n      const isExpired = data\n        ? Date.now() > new Date(Number(data.compressed_info.expired_at) * 1000).getTime()\n        : true;\n\n      if (data && !isExpired) {\n        customPayload = data.custom_payload;\n        mintlessTokenBalance = BigInt(data.compressed_info.amount);\n\n        if (!isTokenWalletDeployed) {\n          stateInit = data.state_init;\n        }\n      }\n    }\n  }\n\n  return {\n    isTokenWalletDeployed,\n    isMintlessClaimed,\n    mintlessTokenBalance,\n    customPayload,\n    stateInit,\n  };\n}\n\nexport async function checkMintlessTokenWalletIsClaimed(network: ApiNetwork, tokenWalletAddress: string) {\n  const res = await getTonClient(network)\n    .runMethod(Address.parse(tokenWalletAddress), 'is_claimed');\n  return res.stack.readBoolean();\n}\n\nasync function fetchMintlessTokenWalletData(customPayloadApiUrl: string, address: string) {\n  const rawAddress = toRawAddress(address);\n\n  return (await fetchJsonWithProxy(`${customPayloadApiUrl}/wallet/${rawAddress}`).catch(() => undefined)) as {\n    custom_payload: string;\n    state_init: string;\n    compressed_info: {\n      amount: string;\n      start_from: string;\n      expired_at: string;\n    };\n  } | undefined;\n}\n\nexport async function fetchToken(network: ApiNetwork, address: string) {\n  const metadata = await fetchJettonMetadata(network, address);\n\n  return buildTokenByMetadata(address, metadata);\n}\n\nfunction buildTokenByMetadata(address: string, metadata: JettonMetadata): ApiToken {\n  const {\n    name,\n    symbol,\n    image,\n    image_data: imageData,\n    decimals,\n    custom_payload_api_uri: customPayloadApiUrl,\n  } = metadata;\n\n  return {\n    slug: buildTokenSlug('ton', address),\n    name,\n    symbol,\n    decimals: decimals === undefined ? DEFAULT_DECIMALS : Number(decimals),\n    chain: 'ton',\n    tokenAddress: address,\n    image: (image && fixIpfsUrl(image)) || (imageData && fixBase64ImageData(imageData)) || undefined,\n    customPayloadApiUrl,\n  };\n}\n\n/**\n * A pure function guessing the \"fee\" that needs to be attached to the token transfer.\n * In contrast to the blockchain fee, this fee is a part of the transfer itself.\n *\n * `amount` is what should be attached (acts as a fee for the user);\n * `realAmount` is approximately what will be actually spent (the rest will return in the excess).\n */\nexport function getToncoinAmountForTransfer(token: ApiToken, willClaimMintless: boolean) {\n  let amount = 0n;\n  let realAmount = 0n;\n\n  if (token.slug === TON_USDT_SLUG) {\n    amount += TINY_TOKEN_TRANSFER_AMOUNT;\n    realAmount += TINIEST_TOKEN_TRANSFER_REAL_AMOUNT;\n  } else if (token.isTiny) {\n    amount += TINY_TOKEN_TRANSFER_AMOUNT;\n    realAmount += TINY_TOKEN_TRANSFER_REAL_AMOUNT;\n  } else {\n    amount += TOKEN_TRANSFER_AMOUNT;\n    realAmount += TOKEN_TRANSFER_REAL_AMOUNT;\n  }\n\n  if (willClaimMintless) {\n    amount += CLAIM_MINTLESS_AMOUNT;\n    realAmount += CLAIM_MINTLESS_AMOUNT;\n  }\n\n  return { amount, realAmount };\n}\n","import {\n  beginCell, Cell, external, internal, loadStateInit, SendMode, storeMessage,\n} from '@ton/core';\n\nimport type { DieselStatus } from '../../../global/types';\nimport type Deferred from '../../../util/Deferred';\nimport type { CheckTransactionDraftOptions } from '../../methods/types';\nimport type {\n  ApiAccountWithMnemonic,\n  ApiActivity,\n  ApiAnyDisplayError,\n  ApiEmulationResult,\n  ApiNetwork,\n  ApiNft,\n  ApiSignedTransfer,\n  ApiToken,\n  ApiTransaction,\n  ApiTransactionActivity,\n  ApiTransactionType,\n} from '../../types';\nimport type {\n  AnyPayload,\n  ApiCheckMultiTransactionDraftResult,\n  ApiCheckTransactionDraftResult,\n  ApiFetchEstimateDieselResult,\n  ApiSubmitMultiTransferResult,\n  ApiSubmitTransferOptions,\n  ApiSubmitTransferTonResult,\n  ApiSubmitTransferWithDieselResult,\n  ApiTonWalletVersion,\n  ApiTransactionExtra,\n  TonTransferParams,\n} from './types';\nimport type { TonWallet } from './util/tonCore';\nimport { ApiTransactionDraftError, ApiTransactionError } from '../../types';\n\nimport { DEFAULT_FEE, DIESEL_ADDRESS, TONCOIN } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintMultiplyToNumber } from '../../../util/bigint';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { fromDecimal, toDecimal } from '../../../util/decimals';\nimport { getDieselTokenAmount, isDieselAvailable } from '../../../util/fee/transferFee';\nimport { buildCollectionByKey, omit, pick } from '../../../util/iteratees';\nimport { logDebug, logDebugError } from '../../../util/logs';\nimport { updatePoisoningCache } from '../../../util/poisoningHash';\nimport { safeExecAsync } from '../../../util/safeExec';\nimport { pause } from '../../../util/schedulers';\nimport withCacheAsync from '../../../util/withCacheAsync';\nimport { parseTxId } from './util';\nimport { fetchAddressBook, fetchLatestTxId, fetchTransactions } from './util/apiV3';\nimport { emulateTrace, parseEmulation } from './util/emulation';\nimport { decryptMessageComment, encryptMessageComment } from './util/encryption';\nimport { buildNft, parseWalletTransactionBody } from './util/metadata';\nimport { sendExternal } from './util/sendExternal';\nimport { fetchNftItems } from './util/tonapiio';\nimport {\n  commentToBytes,\n  getTonClient,\n  getTonWalletContract,\n  getWalletPublicKey,\n  packBytesAsSnake,\n  packBytesAsSnakeForEncryptedData,\n  parseAddress,\n  parseBase64,\n  resolveTokenWalletAddress,\n  toBase64Address,\n} from './util/tonCore';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\nimport { updateTransactionMetadata } from '../../common/helpers';\nimport { getPendingTransfer, waitAndCreatePendingTransfer } from '../../common/pendingTransfers';\nimport { getTokenByAddress, getTokenBySlug } from '../../common/tokens';\nimport { base64ToBytes, isKnownStakingPool } from '../../common/utils';\nimport { MINUTE, SEC } from '../../constants';\nimport { ApiServerError, handleServerError } from '../../errors';\nimport { createBody } from './walletV5/walletV5';\nimport { ActionSendMsg, packActionsList } from './walletV5/walletV5Actions';\nimport { resolveAddress } from './address';\nimport { fetchKeyPair, fetchPrivateKey } from './auth';\nimport {\n  ATTEMPTS,\n  FEE_FACTOR,\n  STAKE_COMMENT,\n  TON_GAS,\n  TRANSFER_TIMEOUT_SEC,\n  UNSTAKE_COMMENT,\n} from './constants';\nimport {\n  buildTokenTransfer,\n  calculateTokenBalanceWithMintless,\n  getTokenBalanceWithMintless,\n  getToncoinAmountForTransfer,\n  parseTokenTransaction,\n} from './tokens';\nimport {\n  getContractInfo,\n  getTonWallet,\n  getWalletBalance,\n  getWalletInfo,\n} from './wallet';\n\nconst GET_TRANSACTIONS_LIMIT = 128;\nconst GET_TRANSACTIONS_MAX_LIMIT = 100;\nconst WAIT_TRANSFER_TIMEOUT = MINUTE;\nconst WAIT_PAUSE = SEC;\n\nconst MAX_BALANCE_WITH_CHECK_DIESEL = 100000000n; // 0.1 TON\nconst PENDING_DIESEL_TIMEOUT = 15 * 60 * 1000; // 15 min\n\nconst DIESEL_NOT_AVAILABLE: ApiFetchEstimateDieselResult = {\n  status: 'not-available',\n  nativeAmount: 0n,\n  remainingFee: 0n,\n  realFee: 0n,\n};\n\nexport const checkHasTransaction = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const transactions = await fetchTransactions({ network, address, limit: 1 });\n  return Boolean(transactions.length);\n});\n\nexport async function checkTransactionDraft(\n  options: CheckTransactionDraftOptions,\n): Promise<ApiCheckTransactionDraftResult> {\n  const {\n    accountId,\n    amount = 0n,\n    tokenAddress,\n    shouldEncrypt,\n    isBase64Data,\n    stateInit: stateInitString,\n    forwardAmount,\n    allowGasless,\n  } = options;\n  let { toAddress, data } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  let result: ApiCheckTransactionDraftResult = {};\n\n  try {\n    result = await checkToAddress(network, toAddress);\n    if ('error' in result) {\n      return result;\n    }\n\n    toAddress = result.resolvedAddress!;\n\n    const { isInitialized } = await getContractInfo(network, toAddress);\n\n    if (stateInitString && !isBase64Data) {\n      return {\n        ...result,\n        error: ApiTransactionDraftError.StateInitWithoutBin,\n      };\n    }\n\n    let stateInit;\n\n    if (stateInitString) {\n      try {\n        stateInit = Cell.fromBase64(stateInitString);\n      } catch {\n        return {\n          ...result,\n          error: ApiTransactionDraftError.InvalidStateInit,\n        };\n      }\n    }\n\n    if (result.isBounceable && !isInitialized && !stateInit) {\n      result.isToAddressNew = !(await checkHasTransaction(network, toAddress));\n      return {\n        ...result,\n        error: ApiTransactionDraftError.InactiveContract,\n      };\n    }\n\n    result.resolvedAddress = toAddress;\n\n    if (amount < 0n) {\n      return {\n        ...result,\n        error: ApiTransactionDraftError.InvalidAmount,\n      };\n    }\n\n    const wallet = await getTonWallet(accountId);\n\n    if (typeof data === 'string' && isBase64Data) {\n      data = base64ToBytes(data);\n    }\n\n    if (data && typeof data === 'string' && shouldEncrypt) {\n      const toPublicKey = await getWalletPublicKey(network, toAddress);\n      if (!toPublicKey) {\n        return {\n          ...result,\n          error: ApiTransactionDraftError.WalletNotInitialized,\n        };\n      }\n    }\n\n    const { address, isInitialized: isWalletInitialized } = await fetchStoredTonWallet(accountId);\n\n    if (data && typeof data === 'string' && !isBase64Data) {\n      data = commentToBytes(data);\n    }\n\n    const toncoinBalance = await getWalletBalance(network, wallet);\n    let balance: bigint;\n    let toncoinAmount: bigint;\n    let fee: bigint;\n    let realFee: bigint;\n\n    if (!tokenAddress) {\n      balance = toncoinBalance;\n      toncoinAmount = amount;\n      fee = 0n;\n      realFee = 0n;\n\n      if (data instanceof Uint8Array) {\n        data = shouldEncrypt ? packBytesAsSnakeForEncryptedData(data) : packBytesAsSnake(data);\n      }\n    } else {\n      const tokenTransfer = await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress: address,\n        toAddress,\n        amount,\n        payload: data,\n        forwardAmount,\n      });\n      ({ amount: toncoinAmount, toAddress, payload: data } = tokenTransfer);\n      const { realAmount: realToncoinAmount, isTokenWalletDeployed, mintlessTokenBalance } = tokenTransfer;\n\n      // When the token is transferred, actually some TON is transferred, and the token sits inside the payload.\n      // From the user perspective, this TON amount is a fee.\n      fee = toncoinAmount;\n      realFee = realToncoinAmount;\n\n      const tokenWalletAddress = toAddress;\n      balance = await calculateTokenBalanceWithMintless(\n        network, tokenWalletAddress, isTokenWalletDeployed, mintlessTokenBalance,\n      );\n    }\n\n    const isFullTonTransfer = !tokenAddress && toncoinBalance === amount;\n    const { transaction } = await signTransaction({\n      network,\n      wallet,\n      toAddress,\n      amount: toncoinAmount,\n      payload: data,\n      stateInit,\n      isFullBalance: isFullTonTransfer,\n      shouldEncrypt,\n    });\n    const blockchainFee = await calculateFee(network, wallet, transaction, isWalletInitialized);\n    const safeBlockchainFee = bigintMultiplyToNumber(blockchainFee, FEE_FACTOR);\n    fee += safeBlockchainFee;\n    realFee += safeBlockchainFee;\n    result.fee = fee;\n    result.realFee = realFee;\n    result.diesel = DIESEL_NOT_AVAILABLE;\n\n    let isEnoughBalance: boolean;\n\n    if (!tokenAddress) {\n      isEnoughBalance = isFullTonTransfer\n        ? toncoinBalance > blockchainFee\n        : toncoinBalance >= fee + amount;\n    } else {\n      const canTransferGasfully = toncoinBalance >= fee;\n\n      if (allowGasless) {\n        result.diesel = await getDiesel({\n          accountId,\n          tokenAddress,\n          canTransferGasfully,\n          toncoinBalance,\n          tokenBalance: balance,\n        });\n      }\n\n      if (isDieselAvailable(result.diesel)) {\n        isEnoughBalance = amount + getDieselTokenAmount(result.diesel) <= balance;\n      } else {\n        isEnoughBalance = canTransferGasfully && amount <= balance;\n      }\n    }\n\n    return isEnoughBalance ? result : {\n      ...result,\n      error: ApiTransactionDraftError.InsufficientBalance,\n    };\n  } catch (err: any) {\n    return {\n      ...handleServerError(err),\n      ...result,\n    };\n  }\n}\n\nfunction estimateDiesel(\n  address: string,\n  tokenAddress: string,\n  toncoinAmount: string,\n  isW5?: boolean,\n  isStars?: boolean,\n) {\n  return callBackendGet<{\n    status: DieselStatus;\n    // The amount is defined only when the status is \"available\" or \"stars-fee\": https://github.com/mytonwallet-org/mytonwallet-backend/blob/44c1bf43fb776286152db8901b45fe8341752e35/src/endpoints/diesel.ts#L163\n    amount?: string;\n    pendingCreatedAt?: string;\n  }>('/diesel/estimate', {\n    address, tokenAddress, toncoinAmount, isW5, isStars,\n  });\n}\n\nexport async function checkToAddress(network: ApiNetwork, toAddress: string) {\n  const result: {\n    addressName?: string;\n    isScam?: boolean;\n    resolvedAddress?: string;\n    isToAddressNew?: boolean;\n    isBounceable?: boolean;\n    isMemoRequired?: boolean;\n  } = {};\n\n  const resolved = await resolveAddress(network, toAddress);\n  if (resolved) {\n    result.addressName = resolved.name;\n    result.resolvedAddress = resolved.address;\n    result.isMemoRequired = resolved.isMemoRequired;\n    result.isScam = resolved.isScam;\n    toAddress = resolved.address;\n  } else {\n    return {\n      ...result,\n      error: ApiTransactionDraftError.DomainNotResolved,\n    };\n  }\n\n  const {\n    isValid, isUserFriendly, isTestOnly, isBounceable,\n  } = parseAddress(toAddress);\n\n  result.isBounceable = isBounceable;\n\n  if (!isValid) {\n    return {\n      ...result,\n      error: ApiTransactionDraftError.InvalidToAddress,\n    };\n  }\n\n  const regex = /[+=/]/;\n  const isUrlSafe = !regex.test(toAddress);\n\n  if (!isUserFriendly || !isUrlSafe || (network === 'mainnet' && isTestOnly)) {\n    return {\n      ...result,\n      error: ApiTransactionDraftError.InvalidAddressFormat,\n    };\n  }\n\n  return result;\n}\n\nexport async function submitTransfer(options: ApiSubmitTransferOptions): Promise<ApiSubmitTransferTonResult> {\n  const {\n    accountId,\n    password,\n    amount,\n    tokenAddress,\n    shouldEncrypt,\n    isBase64Data,\n    forwardAmount,\n  } = options;\n  let { stateInit } = options;\n\n  let { toAddress, data } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const { address: fromAddress, isInitialized } = account.ton;\n    const wallet = await getTonWallet(accountId, account.ton);\n    const { publicKey, secretKey } = (await fetchKeyPair(accountId, password, account))!;\n\n    let encryptedComment: string | undefined;\n\n    if (typeof data === 'string') {\n      ({ payload: data, encryptedComment } = await stringToPayload({\n        network, toAddress, fromAddress, data, secretKey, publicKey, shouldEncrypt, isBase64Data,\n      }));\n    }\n\n    let toncoinAmount: bigint;\n\n    if (!tokenAddress) {\n      toncoinAmount = amount;\n\n      if (data instanceof Uint8Array) {\n        data = shouldEncrypt ? packBytesAsSnakeForEncryptedData(data) : packBytesAsSnake(data);\n      }\n    } else {\n      ({\n        amount: toncoinAmount,\n        toAddress,\n        payload: data,\n        stateInit,\n      } = await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress,\n        toAddress,\n        amount,\n        payload: data,\n        forwardAmount,\n      }));\n    }\n\n    const { pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress);\n\n    const toncoinBalance = await getWalletBalance(network, wallet);\n    const isFullTonTransfer = !tokenAddress && toncoinBalance === amount;\n\n    const { seqno, transaction } = await signTransaction({\n      network,\n      wallet,\n      toAddress,\n      amount: toncoinAmount,\n      payload: data,\n      stateInit,\n      privateKey: secretKey,\n      isFullBalance: isFullTonTransfer,\n      shouldEncrypt,\n    });\n\n    const blockchainFee = await calculateFee(network, wallet!, transaction, isInitialized);\n\n    const isEnoughBalance = isFullTonTransfer\n      ? toncoinBalance > blockchainFee\n      : toncoinBalance >= toncoinAmount + blockchainFee;\n\n    if (!isEnoughBalance) {\n      return { error: ApiTransactionError.InsufficientBalance };\n    }\n\n    const client = getTonClient(network);\n    const { msgHash, boc } = await sendExternal(client, wallet!, transaction);\n\n    void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n    return {\n      amount, seqno, encryptedComment, toAddress, msgHash,\n    };\n  } catch (err: any) {\n    logDebugError('submitTransfer', err);\n\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nexport async function submitTransferWithDiesel(options: {\n  accountId: string;\n  password: string;\n  toAddress: string;\n  amount: bigint;\n  data?: AnyPayload;\n  tokenAddress: string;\n  shouldEncrypt?: boolean;\n  dieselAmount: bigint;\n  isGaslessWithStars?: boolean;\n}): Promise<ApiSubmitTransferWithDieselResult> {\n  try {\n    const {\n      toAddress,\n      amount,\n      accountId,\n      password,\n      tokenAddress,\n      shouldEncrypt,\n      dieselAmount,\n      isGaslessWithStars,\n    } = options;\n\n    let { data } = options;\n\n    const { network } = parseAccountId(accountId);\n\n    const [{ address: fromAddress }, keyPair] = await Promise.all([\n      fetchStoredTonWallet(accountId),\n      fetchKeyPair(accountId, password),\n    ]);\n\n    const { publicKey, secretKey } = keyPair!;\n\n    let encryptedComment: string | undefined;\n\n    if (typeof data === 'string') {\n      ({ payload: data, encryptedComment } = await stringToPayload({\n        network, toAddress, fromAddress, data, secretKey, publicKey, shouldEncrypt,\n      }));\n    }\n\n    const messages: TonTransferParams[] = [\n      await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress,\n        toAddress,\n        amount,\n        payload: data,\n      }),\n    ];\n\n    if (!isGaslessWithStars) {\n      messages.push(\n        await buildTokenTransfer({\n          network,\n          tokenAddress,\n          fromAddress,\n          toAddress: DIESEL_ADDRESS,\n          amount: dieselAmount,\n          shouldSkipMintless: true,\n        }),\n      );\n    }\n\n    const result = await submitMultiTransfer({\n      accountId,\n      password,\n      messages,\n      isGasless: true,\n    });\n\n    return { ...result, encryptedComment };\n  } catch (err) {\n    logDebugError('submitTransferWithDiesel', err);\n\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nasync function stringToPayload({\n  network, toAddress, data, shouldEncrypt, publicKey, secretKey, fromAddress, isBase64Data,\n}: {\n  network: ApiNetwork;\n  data: string;\n  shouldEncrypt?: boolean;\n  toAddress: string;\n  publicKey: Uint8Array;\n  secretKey: Uint8Array;\n  fromAddress: string;\n  isBase64Data?: boolean;\n}): Promise<{\n    payload?: Uint8Array | Cell;\n    encryptedComment?: string;\n  }> {\n  let payload: Uint8Array | Cell | undefined;\n  let encryptedComment: string | undefined;\n\n  if (!data) {\n    payload = undefined;\n  } else if (isBase64Data) {\n    payload = parseBase64(data);\n  } else if (shouldEncrypt) {\n    const toPublicKey = (await getWalletPublicKey(network, toAddress))!;\n    payload = await encryptMessageComment(data, publicKey, toPublicKey, secretKey, fromAddress);\n    encryptedComment = Buffer.from(payload.slice(4)).toString('base64');\n  } else {\n    payload = commentToBytes(data);\n  }\n\n  return { payload, encryptedComment };\n}\n\nexport function resolveTransactionError(error: any): ApiAnyDisplayError | string {\n  if (error instanceof ApiServerError) {\n    if (error.message.includes('exitcode=35,')) {\n      return ApiTransactionError.IncorrectDeviceTime;\n    } else if (error.statusCode === 400) {\n      return error.message;\n    } else if (error.displayError) {\n      return error.displayError;\n    }\n  }\n  return ApiTransactionError.UnsuccesfulTransfer;\n}\n\nasync function signTransaction({\n  network,\n  wallet,\n  toAddress,\n  amount,\n  payload,\n  stateInit,\n  privateKey,\n  isFullBalance,\n  expireAt,\n  shouldEncrypt,\n}: {\n  network: ApiNetwork;\n  wallet: TonWallet;\n  toAddress: string;\n  amount: bigint;\n  payload?: AnyPayload;\n  stateInit?: Cell;\n  privateKey?: Uint8Array;\n  isFullBalance?: boolean;\n  expireAt?: number;\n  shouldEncrypt?: boolean;\n}) {\n  const { seqno } = await getWalletInfo(network, wallet);\n\n  if (!privateKey) {\n    privateKey = new Uint8Array(64);\n  } else {\n    logDebug('Signing transactions', { seqno, toAddress, amount });\n  }\n\n  if (!expireAt) {\n    expireAt = Math.round(Date.now() / 1000) + TRANSFER_TIMEOUT_SEC;\n  }\n\n  if (payload instanceof Uint8Array) {\n    payload = shouldEncrypt\n      ? packBytesAsSnakeForEncryptedData(payload) as Cell\n      : packBytesAsSnake(payload, 0) as Cell;\n  }\n\n  const init = stateInit ? loadStateInit(\n    stateInit.asSlice(),\n  ) : undefined;\n\n  const sendMode = isFullBalance\n    ? SendMode.CARRY_ALL_REMAINING_BALANCE\n    : SendMode.PAY_GAS_SEPARATELY + (payload ? 0 : SendMode.IGNORE_ERRORS);\n\n  const transaction = wallet.createTransfer({\n    seqno,\n    secretKey: Buffer.from(privateKey),\n    messages: [internal({\n      value: amount,\n      to: toAddress,\n      body: payload,\n      init,\n      bounce: parseAddress(toAddress).isBounceable,\n    })],\n    sendMode,\n    timeout: expireAt,\n  });\n\n  return { seqno, transaction };\n}\n\nexport async function getAccountNewestTxId(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return fetchNewestTxId(network, address);\n}\n\nexport async function fetchAccountTransactionSlice(\n  accountId: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  let transactions = await fetchTransactions({\n    network,\n    address,\n    limit: limit ?? GET_TRANSACTIONS_LIMIT,\n    toTimestamp,\n    fromTimestamp,\n  });\n\n  transactions = await Promise.all(\n    transactions.map((transaction) => parseWalletTransactionBody(network, transaction)),\n  );\n\n  await populateTransactions(network, transactions);\n\n  return transactions\n    .map(updateTransactionType)\n    .map(updateTransactionMetadata)\n    .map(omitExtraData)\n    .map(transactionToActivity);\n}\n\nasync function populateTransactions(network: ApiNetwork, transactions: ApiTransactionExtra[]) {\n  const nftAddresses = new Set<string>();\n  const addressesForFixFormat = new Set<string>();\n\n  for (const tx of transactions) {\n    const { extraData: { parsedPayload } } = tx;\n    if (parsedPayload?.type === 'nft:ownership-assigned') {\n      nftAddresses.add(parsedPayload.nftAddress);\n      addressesForFixFormat.add(parsedPayload.prevOwner);\n    } else if (parsedPayload?.type === 'nft:transfer') {\n      nftAddresses.add(parsedPayload.nftAddress);\n      addressesForFixFormat.add(parsedPayload.newOwner);\n    }\n\n    updatePoisoningCache(tx);\n  }\n\n  if (nftAddresses.size) {\n    const [rawNfts, addressBook] = await Promise.all([\n      fetchNftItems(network, [...nftAddresses]),\n      fetchAddressBook(network, [...addressesForFixFormat]),\n    ]);\n\n    const nfts = rawNfts\n      .map((rawNft) => buildNft(network, rawNft))\n      .filter(Boolean) as ApiNft[];\n\n    const nftsByAddress = buildCollectionByKey(nfts, 'address');\n\n    for (const transaction of transactions) {\n      const { extraData: { parsedPayload } } = transaction;\n\n      if (parsedPayload?.type === 'nft:ownership-assigned') {\n        const nft = nftsByAddress[parsedPayload.nftAddress];\n        transaction.nft = nft;\n        if (nft?.isScam) {\n          transaction.metadata = { ...transaction.metadata, isScam: true };\n        } else {\n          transaction.fromAddress = addressBook[parsedPayload.prevOwner].user_friendly;\n        }\n      } else if (parsedPayload?.type === 'nft:transfer') {\n        const nft = nftsByAddress[parsedPayload.nftAddress];\n        transaction.nft = nft;\n        if (nft?.isScam) {\n          transaction.metadata = { ...transaction.metadata, isScam: true };\n        } else {\n          transaction.toAddress = addressBook[parsedPayload.newOwner].user_friendly;\n        }\n      }\n    }\n  }\n}\n\nexport async function getAllTransactionSlice(\n  accountId: string,\n  toTimestamp: number,\n  limit: number,\n  tokenSlugs: string[],\n) {\n  const tonTxs = await fetchAccountTransactionSlice(accountId, toTimestamp, undefined, limit);\n\n  if (!tonTxs.length) {\n    return [];\n  }\n\n  const fromTimestamp = tonTxs[tonTxs.length - 1].timestamp;\n\n  const tokenResults = await Promise.all(tokenSlugs.map((slug) => {\n    return fetchTokenTransactionSlice(\n      accountId, slug, toTimestamp, fromTimestamp, GET_TRANSACTIONS_MAX_LIMIT, true,\n    );\n  }));\n\n  const allTxs = [...tonTxs, ...tokenResults.flat()];\n  allTxs.sort(compareActivities);\n\n  return allTxs;\n}\n\nexport async function fetchTokenTransactionSlice(\n  accountId: string,\n  tokenSlug: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n  shouldIncludeFrom?: boolean,\n): Promise<ApiTransactionActivity[]> {\n  if (tokenSlug === TONCOIN.slug) {\n    return fetchAccountTransactionSlice(accountId, toTimestamp, fromTimestamp, limit);\n  }\n\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const token = getTokenBySlug(tokenSlug);\n  const { tokenAddress } = token;\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, address, tokenAddress!);\n\n  const transactions = await fetchTransactions({\n    network,\n    address: tokenWalletAddress,\n    limit: limit ?? GET_TRANSACTIONS_LIMIT,\n    fromTimestamp,\n    toTimestamp,\n    shouldIncludeFrom,\n  });\n\n  return transactions\n    .map((tx) => parseTokenTransaction(network, tx, tokenSlug, address))\n    .filter(Boolean)\n    .map(updateTransactionMetadata)\n    .map(omitExtraData)\n    .map(transactionToActivity);\n}\n\nfunction omitExtraData(tx: ApiTransactionExtra): ApiTransaction {\n  return omit(tx, ['extraData']);\n}\n\nfunction updateTransactionType(transaction: ApiTransactionExtra) {\n  const { amount, extraData } = transaction;\n  let { comment } = transaction;\n\n  const normalizedFromAddress = toBase64Address(transaction.fromAddress, true);\n  const normalizedToAddress = toBase64Address(transaction.toAddress, true);\n\n  let type: ApiTransactionType | undefined;\n\n  if (isKnownStakingPool(normalizedFromAddress) && amount > TON_GAS.unstakeNominators) {\n    type = 'unstake';\n  } else if (isKnownStakingPool(normalizedToAddress)) {\n    if (comment === STAKE_COMMENT) {\n      type = 'stake';\n    } else if (comment === UNSTAKE_COMMENT) {\n      type = 'unstakeRequest';\n    }\n  } else if (extraData?.parsedPayload && !transaction.metadata?.isScam) {\n    const payload = extraData.parsedPayload;\n\n    if (payload.type === 'tokens:burn' && payload.isLiquidUnstakeRequest) {\n      type = 'unstakeRequest';\n    } else if (payload.type === 'liquid-staking:deposit') {\n      type = 'stake';\n    } else if (payload.type === 'liquid-staking:withdrawal' || payload.type === 'liquid-staking:withdrawal-nft') {\n      type = 'unstake';\n    } else if (payload.type === 'nft:transfer') {\n      type = 'nftTransferred';\n      comment = payload.comment;\n    } else if (payload.type === 'nft:ownership-assigned') {\n      type = 'nftReceived';\n      comment = payload.comment;\n    } else if (payload.type === 'jetton-staking:unstake') {\n      type = 'unstakeRequest';\n    }\n  }\n\n  return {\n    ...transaction,\n    type,\n    comment,\n  };\n}\n\nfunction transactionToActivity(transaction: ApiTransaction): ApiTransactionActivity {\n  return {\n    ...transaction,\n    kind: 'transaction',\n    id: transaction.txId,\n  };\n}\n\nexport async function checkMultiTransactionDraft(\n  accountId: string,\n  messages: TonTransferParams[],\n  withDiesel?: boolean,\n  // If true and the emulation is successful, the result `fee` property will miss\n  withEmulation?: boolean,\n): Promise<ApiCheckMultiTransactionDraftResult> {\n  const result: { fee?: bigint; emulation?: ApiEmulationResult } = {};\n  let totalAmount: bigint = 0n;\n\n  const { network } = parseAccountId(accountId);\n  const { isInitialized, version, address } = await fetchStoredTonWallet(accountId);\n\n  try {\n    for (const { toAddress, amount } of messages) {\n      if (amount < 0n) {\n        return { ...result, error: ApiTransactionDraftError.InvalidAmount };\n      }\n\n      const isMainnet = network === 'mainnet';\n      const { isValid, isTestOnly } = parseAddress(toAddress);\n\n      if (!isValid || (isMainnet && isTestOnly)) {\n        return { ...result, error: ApiTransactionDraftError.InvalidToAddress };\n      }\n      totalAmount += amount;\n    }\n\n    const wallet = await getTonWallet(accountId);\n    const { balance } = await getWalletInfo(network, wallet);\n\n    const { transaction } = await signMultiTransaction({\n      network, wallet, messages, version,\n    });\n\n    if (withEmulation) {\n      result.emulation = await safeExecAsync(async () => {\n        const emulation = await emulateTrace(network, wallet, transaction, isInitialized);\n        return emulation && parseEmulation(network, address, emulation);\n      });\n    }\n\n    if (!result.emulation) {\n      const blockchainFee = await calculateFee(network, wallet, transaction, isInitialized);\n      result.fee = bigintMultiplyToNumber(blockchainFee, FEE_FACTOR);\n    }\n\n    const fee = result.emulation?.totalFee ?? result.fee ?? 0n;\n    // TODO Should `totalAmount` be `0` for `withDiesel`?\n    if (!withDiesel && balance < totalAmount + fee) {\n      return { ...result, error: ApiTransactionDraftError.InsufficientBalance };\n    }\n\n    return result;\n  } catch (err: any) {\n    return handleServerError(err);\n  }\n}\n\nexport type GaslessType = 'diesel' | 'w5';\n\ninterface SubmitMultiTransferOptions {\n  accountId: string;\n  password: string;\n  messages: TonTransferParams[];\n  expireAt?: number;\n  isGasless?: boolean;\n}\n\nexport async function submitMultiTransfer({\n  accountId, password, messages, expireAt, isGasless,\n}: SubmitMultiTransferOptions): Promise<ApiSubmitMultiTransferResult> {\n  const { network } = parseAccountId(accountId);\n\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  const { address: fromAddress, isInitialized, version } = account.ton;\n  const { pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress);\n\n  try {\n    const wallet = await getTonWallet(accountId, account.ton);\n    const privateKey = await fetchPrivateKey(accountId, password, account);\n\n    let totalAmount = 0n;\n    messages.forEach((message) => {\n      totalAmount += BigInt(message.amount);\n    });\n\n    const { balance } = await getWalletInfo(network, wallet!);\n\n    const gaslessType = isGasless ? version === 'W5' ? 'w5' : 'diesel' : undefined;\n    const withW5Gasless = gaslessType === 'w5';\n\n    const { seqno, transaction } = await signMultiTransaction({\n      network, wallet: wallet!, messages, version, privateKey, expireAt, withW5Gasless,\n    });\n\n    if (!isGasless) {\n      const fee = await calculateFee(network, wallet!, transaction, isInitialized);\n      if (balance < totalAmount + fee) {\n        return { error: ApiTransactionError.InsufficientBalance };\n      }\n    }\n\n    const client = getTonClient(network);\n    const { msgHash, boc, paymentLink } = await sendExternal(\n      client, wallet!, transaction, gaslessType,\n    );\n\n    if (!isGasless) {\n      void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n    } else {\n      // TODO: Wait for gasless transfer\n      pendingTransfer.resolve();\n    }\n\n    const clearedMessages = messages.map((message) => {\n      if (typeof message.payload !== 'string' && typeof message.payload !== 'undefined') {\n        return omit(message, ['payload']);\n      }\n      return message;\n    });\n\n    return {\n      seqno,\n      amount: totalAmount.toString(),\n      messages: clearedMessages,\n      boc,\n      msgHash,\n      paymentLink,\n    };\n  } catch (err) {\n    pendingTransfer.resolve();\n\n    logDebugError('submitMultiTransfer', err);\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nasync function signMultiTransaction({\n  network,\n  wallet,\n  messages,\n  version,\n  privateKey,\n  expireAt,\n  withW5Gasless,\n}: {\n  network: ApiNetwork;\n  wallet: TonWallet;\n  messages: TonTransferParams[];\n  version: ApiTonWalletVersion;\n  privateKey?: Uint8Array;\n  expireAt?: number;\n  withW5Gasless?: boolean;\n}) {\n  const { seqno } = await getWalletInfo(network, wallet);\n\n  if (!privateKey) {\n    privateKey = new Uint8Array(64);\n  } else {\n    logDebug('Signing transaction', {\n      seqno,\n      messages: messages.map((msg) => pick(msg, ['toAddress', 'amount'])),\n    });\n  }\n\n  if (!expireAt) {\n    expireAt = Math.round(Date.now() / 1000) + TRANSFER_TIMEOUT_SEC;\n  }\n\n  let hasPayload = false;\n\n  const preparedMessages = messages.map((message) => {\n    const {\n      amount, toAddress, stateInit, isBase64Payload,\n    } = message;\n    let { payload } = message;\n\n    if (isBase64Payload && typeof payload === 'string') {\n      payload = Cell.fromBase64(payload);\n    }\n\n    const init = stateInit ? loadStateInit(\n      stateInit.asSlice(),\n    ) : undefined;\n\n    if (!hasPayload && payload) {\n      hasPayload = true;\n    }\n\n    return internal({\n      value: amount,\n      to: toAddress,\n      body: payload as Cell | string | undefined, // TODO Fix Uint8Array type\n      bounce: parseAddress(toAddress).isBounceable,\n      init,\n    });\n  });\n\n  if (version === 'W5' && !withW5Gasless) {\n    // TODO Remove it. There is bug in @ton/ton library that causes transactions to be executed in reverse order.\n    preparedMessages.reverse();\n  }\n\n  let transaction;\n  if (withW5Gasless) {\n    const actionList = packActionsList(preparedMessages.map(\n      (msg) => new ActionSendMsg(SendMode.PAY_GAS_SEPARATELY, msg),\n    ));\n\n    transaction = createBody(\n      actionList,\n      seqno,\n      Buffer.from(privateKey),\n      PENDING_DIESEL_TIMEOUT,\n    );\n  } else {\n    transaction = wallet.createTransfer({\n      seqno,\n      secretKey: Buffer.from(privateKey),\n      messages: preparedMessages,\n      sendMode: SendMode.PAY_GAS_SEPARATELY + (hasPayload ? 0 : SendMode.IGNORE_ERRORS),\n      timeout: expireAt,\n    });\n  }\n\n  const externalMessage = toExternalMessage(wallet, seqno, transaction);\n\n  return { seqno, transaction, externalMessage };\n}\n\nfunction toExternalMessage(\n  contract: TonWallet,\n  seqno: number,\n  body: Cell,\n) {\n  return beginCell()\n    .storeWritable(\n      storeMessage(\n        external({\n          to: contract.address,\n          init: seqno === 0 ? contract.init : undefined,\n          body,\n        }),\n      ),\n    )\n    .endCell();\n}\n\nasync function retrySendBoc(\n  network: ApiNetwork,\n  address: string,\n  boc: string,\n  seqno: number,\n  pendingTransfer?: Deferred,\n) {\n  const tonClient = getTonClient(network);\n  const waitUntil = Date.now() + WAIT_TRANSFER_TIMEOUT;\n\n  while (Date.now() < waitUntil) {\n    const [error, walletInfo] = await Promise.all([\n      tonClient.sendFile(boc).catch((err) => String(err)),\n      getWalletInfo(network, address).catch(() => undefined),\n    ]);\n\n    // Errors mean that `seqno` was changed or not enough of balance\n    if (error?.match(/(exitcode=33|exitcode=133|inbound external message rejected by account)/)) {\n      break;\n    }\n\n    // seqno here may change before exit code appears\n    if (walletInfo && walletInfo.seqno > seqno) {\n      break;\n    }\n\n    await pause(WAIT_PAUSE);\n  }\n\n  pendingTransfer?.resolve();\n}\n\nasync function calculateFee(network: ApiNetwork, wallet: TonWallet, transaction: Cell, isInitialized?: boolean) {\n  // eslint-disable-next-line no-null/no-null\n  const { code = null, data = null } = !isInitialized ? wallet.init : {};\n\n  const { source_fees: fees } = await getTonClient(network).estimateExternalMessageFee(wallet.address, {\n    body: transaction,\n    initCode: code,\n    initData: data,\n    ignoreSignature: true,\n  });\n\n  return BigInt(fees.in_fwd_fee + fees.storage_fee + fees.gas_fee + fees.fwd_fee);\n}\n\nexport async function sendSignedMessage(accountId: string, message: ApiSignedTransfer, pendingTransferId?: string) {\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress, publicKey, version } = await fetchStoredTonWallet(accountId);\n  const client = getTonClient(network);\n  const wallet = client.open(getTonWalletContract(publicKey, version!));\n  const { base64, seqno } = message;\n  const pendingTransfer = pendingTransferId ? getPendingTransfer(pendingTransferId) : undefined;\n\n  try {\n    const { msgHash, boc } = await sendExternal(client, wallet, Cell.fromBase64(base64));\n\n    void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n    return { boc, msgHash };\n  } catch (err) {\n    pendingTransfer?.resolve();\n    throw err;\n  }\n}\n\nexport async function sendSignedMessages(accountId: string, messages: ApiSignedTransfer[]) {\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress, publicKey, version } = await fetchStoredTonWallet(accountId);\n  const client = getTonClient(network);\n  const wallet = client.open(getTonWalletContract(publicKey, version!));\n\n  const attempts = ATTEMPTS + messages.length;\n  let index = 0;\n  let attempt = 0;\n\n  let firstBoc: string | undefined;\n\n  const msgHashes: string[] = [];\n  let pendingTransfer: Deferred | undefined;\n\n  while (index < messages.length && attempt < attempts) {\n    const { base64, seqno } = messages[index];\n    try {\n      ({ pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress));\n\n      const { msgHash, boc } = await sendExternal(client, wallet, Cell.fromBase64(base64));\n      msgHashes.push(msgHash);\n\n      if (index === 0) {\n        firstBoc = boc;\n      }\n\n      void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n      index++;\n    } catch (err) {\n      pendingTransfer?.resolve();\n      logDebugError('sendSignedMessages', err);\n    }\n    attempt++;\n  }\n\n  return { successNumber: index, firstBoc, msgHashes };\n}\n\nexport async function decryptComment(\n  accountId: string, encryptedComment: string, fromAddress: string, password: string,\n) {\n  const keyPair = await fetchKeyPair(accountId, password);\n  if (!keyPair) {\n    return undefined;\n  }\n\n  const { secretKey, publicKey } = keyPair;\n\n  const buffer = Buffer.from(encryptedComment, 'base64');\n\n  return decryptMessageComment(buffer, publicKey, secretKey, fromAddress);\n}\n\nexport async function waitUntilTransactionAppears(network: ApiNetwork, address: string, txId: string) {\n  const { lt } = parseTxId(txId);\n\n  if (lt === 0) {\n    return;\n  }\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const latestTxId = await fetchLatestTxId(network, address);\n    if (latestTxId && parseTxId(latestTxId).lt >= lt) {\n      return;\n    }\n    await pause(WAIT_PAUSE);\n  }\n}\n\nexport async function fetchNewestTxId(network: ApiNetwork, address: string) {\n  const transactions = await fetchTransactions({ network, address, limit: 1 });\n\n  if (!transactions.length) {\n    return undefined;\n  }\n\n  return transactions[0].txId;\n}\n\nexport async function fixTokenActivitiesAddressForm(network: ApiNetwork, activities: ApiActivity[]) {\n  const tokenAddresses: Set<string> = new Set();\n\n  for (const activity of activities) {\n    if (activity.kind === 'transaction' && activity.slug !== TONCOIN.slug) {\n      tokenAddresses.add(activity.fromAddress);\n      tokenAddresses.add(activity.toAddress);\n    }\n  }\n\n  if (!tokenAddresses.size) {\n    return;\n  }\n\n  const addressBook = await fetchAddressBook(network, Array.from(tokenAddresses));\n\n  for (const activity of activities) {\n    if (activity.kind === 'transaction' && activity.slug !== TONCOIN.slug) {\n      activity.fromAddress = addressBook[activity.fromAddress].user_friendly;\n      activity.toAddress = addressBook[activity.toAddress].user_friendly;\n    }\n  }\n}\n\n/**\n * The goal of the function is acting like `checkTransactionDraft` but return only the diesel information\n */\nexport function fetchEstimateDiesel(\n  accountId: string, tokenAddress: string,\n): Promise<ApiFetchEstimateDieselResult> {\n  return getDiesel({\n    accountId,\n    tokenAddress,\n    // We pass `false` because `fetchEstimateDiesel` assumes that the transfer is gasless anyway\n    canTransferGasfully: false,\n  });\n}\n\n/**\n * Decides whether the transfer must be gasless and fetches the diesel estimate from the backend.\n */\nasync function getDiesel({\n  accountId,\n  tokenAddress,\n  canTransferGasfully,\n  toncoinBalance,\n  tokenBalance,\n}: {\n  accountId: string;\n  tokenAddress: string;\n  canTransferGasfully: boolean;\n  // The below fields allow to avoid network requests if you already have these data\n  toncoinBalance?: bigint;\n  tokenBalance?: bigint;\n}): Promise<ApiFetchEstimateDieselResult> {\n  const { network } = parseAccountId(accountId);\n  if (network !== 'mainnet') return DIESEL_NOT_AVAILABLE;\n\n  const storedTonWallet = await fetchStoredTonWallet(accountId);\n  const wallet = await getTonWallet(accountId, storedTonWallet);\n\n  const token = getTokenByAddress(tokenAddress)!;\n  if (!token.isGaslessEnabled && !token.isStarsEnabled) return DIESEL_NOT_AVAILABLE;\n\n  const { address, version } = storedTonWallet;\n  toncoinBalance ??= await getWalletBalance(network, wallet);\n  const fee = getDieselToncoinFee(token);\n  const toncoinNeeded = fee.amount - toncoinBalance;\n\n  if (toncoinBalance >= MAX_BALANCE_WITH_CHECK_DIESEL || toncoinNeeded <= 0n) return DIESEL_NOT_AVAILABLE;\n\n  const rawDiesel = await estimateDiesel(\n    address,\n    tokenAddress,\n    toDecimal(toncoinNeeded),\n    version === 'W5',\n    fee.isStars,\n  );\n  const diesel: ApiFetchEstimateDieselResult = {\n    status: rawDiesel.status,\n    amount: rawDiesel.amount === undefined\n      ? undefined\n      : fromDecimal(rawDiesel.amount, rawDiesel.status === 'stars-fee' ? 0 : token.decimals),\n    nativeAmount: toncoinNeeded,\n    remainingFee: toncoinBalance,\n    realFee: fee.realFee,\n  };\n\n  const tokenAmount = getDieselTokenAmount(diesel);\n  if (tokenAmount === 0n) {\n    return diesel;\n  }\n\n  tokenBalance ??= await getTokenBalanceWithMintless(network, address, tokenAddress);\n  const canPayDiesel = tokenBalance >= tokenAmount;\n  const isAwaitingNotExpiredPrevious = Boolean(\n    rawDiesel.pendingCreatedAt\n      && Date.now() - new Date(rawDiesel.pendingCreatedAt).getTime() < PENDING_DIESEL_TIMEOUT,\n  );\n\n  // When both TON and diesel are insufficient, we want to show the TON fee\n  const shouldBeGasless = (!canTransferGasfully && canPayDiesel) || isAwaitingNotExpiredPrevious;\n  return shouldBeGasless ? diesel : DIESEL_NOT_AVAILABLE;\n}\n\n/**\n * Guesses the total TON fee (including the gas attached to the transaction) that will be spent on a diesel transfer.\n *\n * `amount` is what will be taken from the wallet;\n * `realFee` is approximately what will be actually spent (the rest will return in the excess);\n * `isStars` tells whether the fee is estimated considering that the diesel will be paid in stars.\n */\nfunction getDieselToncoinFee(token: ApiToken) {\n  const isStars = !token.isGaslessEnabled && token.isStarsEnabled;\n  let { amount, realAmount: realFee } = getToncoinAmountForTransfer(token, false);\n\n  // Multiplying by 2 because the diesel transfer has 2 transactions:\n  // - for the transfer itself,\n  // - for sending the diesel to the MTW wallet.\n  if (!isStars) {\n    amount *= 2n;\n    realFee *= 2n;\n  }\n\n  amount += DEFAULT_FEE;\n  realFee += DEFAULT_FEE;\n\n  return { amount, realFee, isStars };\n}\n","import type { Cell } from '@ton/core';\nimport { beginCell, external, storeMessage } from '@ton/core';\n\nimport type { ApiEmulatedTransaction, ApiEmulationResult, ApiNetwork, ApiTransaction } from '../../../types';\nimport type { TonWallet } from './tonCore';\n\nimport { TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL, TONCOIN } from '../../../../config';\nimport { bigintAbs, bigintMultiplyToNumber } from '../../../../util/bigint';\nimport { fetchWithRetry } from '../../../../util/fetch';\nimport { groupBy, omitUndefined } from '../../../../util/iteratees';\nimport { FEE_FACTOR } from '../constants';\nimport { stringifyTxId } from './index';\nimport { toBase64Address, toRawAddress } from './tonCore';\n\ntype Transaction = {\n  account: string;\n  lt: string;\n  prev_trans_hash: string;\n  prev_trans_lt: string;\n  now: number;\n  orig_status: string;\n  end_status: string;\n  in_msg: Message;\n  out_msgs: Message[];\n  total_fees: number;\n  account_state_hash_before: string;\n  account_state_hash_after: string;\n  description: TransactionDescription;\n};\n\ntype Message = {\n  hash: string;\n  source: string | null;\n  destination: string;\n  value: number | null;\n  fwd_fee: number | null;\n  ihr_fee: number | null;\n  created_lt: string | null;\n  created_at: number | null;\n  opcode: string;\n  ihr_disabled: boolean | null;\n  bounce: boolean | null;\n  bounced: boolean | null;\n  import_fee: number | null;\n  body_boc: string;\n  init_state_boc: string | null;\n};\n\ntype TransactionDescription = {\n  credit_first: boolean;\n  storage_ph: StoragePhase;\n  credit_ph: CreditPhase | null;\n  compute_ph: ComputePhase;\n  action: ActionPhase | null;\n  aborted: boolean;\n  bounce: boolean | null;\n  destroyed: boolean;\n};\n\ntype StoragePhase = {\n  storage_fees_collected: number;\n  storage_fees_due: number | null;\n  status_change: string;\n};\n\ntype CreditPhase = {\n  due_fees_collected: number | null;\n  credit: number;\n};\n\ntype ComputePhase = {\n  account_activated?: boolean;\n  exit_arg?: null;\n  exit_code: number;\n  gas_credit?: number | null;\n  gas_fees: number;\n  gas_limit: number;\n  gas_used: number;\n  mode: number;\n  msg_state_used: boolean;\n  skipped: boolean;\n  success: boolean;\n  vm_final_state_hash: string;\n  vm_init_state_hash: string;\n  vm_steps: number;\n  reason?: string;\n};\n\ntype ActionPhase = {\n  success: boolean;\n  valid: boolean;\n  no_funds: boolean;\n  status_change: string;\n  total_fwd_fees: number | null;\n  total_action_fees: number | null;\n  result_code: number;\n  result_arg: null;\n  tot_actions: number;\n  spec_actions: number;\n  skipped_actions: number;\n  msgs_created: number;\n  action_list_hash: string;\n  tot_msg_size: {\n    cells: number;\n    bits: number;\n  };\n};\n\ntype AccountState = {\n  balance: number;\n  account_status: string;\n  frozen_hash: string | null;\n  code_hash: string;\n  data_hash: string;\n  last_trans_hash: string;\n  last_trans_lt: string;\n  timestamp: number;\n};\n\ntype Trace = {\n  tx_hash: string;\n  in_msg_hash: string;\n  children: Trace[];\n};\n\nexport type EmulationResponse = {\n  mc_block_seqno: number;\n  trace: Trace;\n  transactions: {\n    [key: string]: Transaction;\n  };\n  account_states: {\n    [key: string]: AccountState;\n  };\n  rand_seed: string;\n};\n\ntype ExtendedApiTransaction = ApiTransaction & {\n  hash: string;\n  opCode?: number;\n};\n\nexport function parseEmulation(network: ApiNetwork, address: string, emulation: EmulationResponse): ApiEmulationResult {\n  const rawAddress = toRawAddress(address).toUpperCase();\n\n  const transactions = Object.entries(emulation.transactions)\n    .map(([hash, rawTx]) => parseTransaction(network, hash, rawTx))\n    .flat();\n\n  const byHash = groupBy(transactions, 'hash');\n  const byTransactionIndex: ApiEmulatedTransaction[] = [];\n\n  function processTrace(trace: Trace, _index?: number) {\n    const txs = byHash[trace.tx_hash];\n\n    for (const [i, { toAddress, amount, fee, isIncoming }] of txs.entries()) {\n      const index = _index ?? i;\n\n      if (!(index in byTransactionIndex)) {\n        byTransactionIndex.push({\n          received: 0n,\n          fee: bigintMultiplyToNumber(fee, FEE_FACTOR),\n        });\n      }\n\n      if (toAddress === rawAddress && isIncoming) {\n        byTransactionIndex[index].received += bigintAbs(amount);\n      }\n    }\n\n    for (const [i, children] of trace.children.entries()) {\n      processTrace(children, _index ?? i);\n    }\n  }\n\n  processTrace(emulation.trace);\n\n  return {\n    totalFee: byTransactionIndex.reduce((sum, { fee }) => sum + fee, 0n),\n    totalReceived: byTransactionIndex.reduce((sum, { received }) => sum + received, 0n),\n    byTransactionIndex,\n  };\n}\n\nexport function emulateTrace(network: ApiNetwork, wallet: TonWallet, body: Cell, isInitialized?: boolean) {\n  const boc = buildExternalBoc(wallet, body, isInitialized);\n  return fetchEmulateTrace(network, boc);\n}\n\nfunction parseTransaction(\n  network: ApiNetwork,\n  hash: string,\n  rawTx: Transaction,\n): ExtendedApiTransaction[] {\n  const {\n    now,\n    lt,\n    total_fees: totalFees,\n    description: {\n      compute_ph: {\n        exit_code: exitCode,\n      },\n    },\n  } = rawTx;\n\n  const txId = stringifyTxId({ lt, hash });\n  const timestamp = now as number * 1000;\n  const isIncoming = !!rawTx.in_msg.source;\n  const inMsgHash = rawTx.in_msg.hash;\n  const msgs: Message[] = isIncoming ? [rawTx.in_msg] : rawTx.out_msgs;\n\n  if (!msgs.length) return [];\n\n  const oneMsgFee = BigInt(totalFees) / BigInt(msgs.length);\n\n  const txs = msgs.map((msg, i) => {\n    const {\n      source, destination, value, fwd_fee: fwdFee, opcode,\n    } = msg;\n    const normalizedAddress = toBase64Address(isIncoming ? source! : destination, true, network);\n    const fee = oneMsgFee + BigInt(fwdFee ?? 0);\n\n    const tx: ExtendedApiTransaction = omitUndefined({\n      txId: msgs.length > 1 ? `${txId}:${i + 1}` : txId,\n      timestamp,\n      isIncoming,\n      fromAddress: source!,\n      toAddress: destination,\n      amount: BigInt(value ?? 0),\n      slug: TONCOIN.slug,\n      fee,\n      inMsgHash,\n      normalizedAddress,\n      shouldHide: exitCode ? true : undefined,\n      hash,\n      opCode: Number(opcode) || undefined,\n    });\n\n    return tx;\n  });\n\n  return txs;\n}\n\nfunction buildExternalBoc(wallet: TonWallet, body: Cell, isInitialized?: boolean) {\n  const externalMessage = external({\n    to: wallet.address,\n    init: !isInitialized ? {\n      code: wallet.init.code,\n      data: wallet.init.data,\n    } : undefined,\n    body,\n  });\n\n  return beginCell()\n    .store(storeMessage(externalMessage))\n    .endCell()\n    .toBoc()\n    .toString('base64');\n}\n\nasync function fetchEmulateTrace(network: ApiNetwork, boc: string): Promise<EmulationResponse> {\n  const baseUrl = network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL;\n\n  const response = await fetchWithRetry(`${baseUrl}/api/emulate/v1/emulateTrace`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      boc,\n      ignore_chksig: true,\n      include_code_data: false,\n      with_actions: false,\n    }),\n  });\n\n  return response.json();\n}\n","import type { NftItem } from 'tonapi-sdk-js';\nimport type { Cell } from '@ton/core';\nimport { Address, Builder } from '@ton/core';\n\nimport type { ApiNft, ApiNftUpdate } from '../../types';\nimport type { ApiCheckTransactionDraftResult } from './types';\n\nimport {\n  BURN_ADDRESS,\n  NFT_BATCH_SIZE,\n  NOTCOIN_EXCHANGERS,\n  NOTCOIN_FORWARD_TON_AMOUNT,\n  NOTCOIN_VOUCHERS_ADDRESS,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintMultiplyToNumber } from '../../../util/bigint';\nimport { compact } from '../../../util/iteratees';\nimport { generateQueryId } from './util';\nimport { buildNft } from './util/metadata';\nimport {\n  fetchAccountEvents, fetchAccountNfts, fetchNftByAddress, fetchNftItems,\n} from './util/tonapiio';\nimport { commentToBytes, packBytesAsSnake, toBase64Address } from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport {\n  NFT_PAYLOAD_SAFE_MARGIN,\n  NFT_TRANSFER_AMOUNT,\n  NFT_TRANSFER_FORWARD_AMOUNT,\n  NFT_TRANSFER_REAL_AMOUNT,\n  NftOpCode,\n} from './constants';\nimport { checkMultiTransactionDraft, checkToAddress, submitMultiTransfer } from './transactions';\nimport { isActiveSmartContract } from './wallet';\n\nexport async function getAccountNfts(accountId: string, offset?: number, limit?: number): Promise<ApiNft[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const rawNfts = await fetchAccountNfts(network, address, { offset, limit });\n  return compact(rawNfts.map((rawNft) => buildNft(network, rawNft)).filter(Boolean) as ApiNft[]);\n}\n\nexport async function checkNftOwnership(accountId: string, nftAddress: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const rawNft = await fetchNftByAddress(network, nftAddress);\n  const nft = buildNft(network, rawNft);\n\n  return address === nft?.ownerAddress;\n}\n\nexport async function getNftUpdates(accountId: string, fromSec: number) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const events = await fetchAccountEvents(network, address, fromSec);\n  fromSec = events[0]?.timestamp ?? fromSec;\n  events.reverse();\n  const updates: ApiNftUpdate[] = [];\n\n  for (const event of events) {\n    for (const action of event.actions) {\n      let to: string;\n      let nftAddress: string;\n      let rawNft: NftItem | undefined;\n      const isPurchase = !!action.NftPurchase;\n\n      if (action.NftItemTransfer) {\n        const { sender, recipient, nft: rawNftAddress } = action.NftItemTransfer;\n        if (!sender || !recipient) continue;\n        to = toBase64Address(recipient.address, undefined, network);\n        nftAddress = toBase64Address(rawNftAddress, true, network);\n      } else if (action.NftPurchase) {\n        const { buyer } = action.NftPurchase;\n        to = toBase64Address(buyer.address, undefined, network);\n        rawNft = action.NftPurchase.nft;\n        if (!rawNft) {\n          continue;\n        }\n        nftAddress = toBase64Address(rawNft.address, true, network);\n      } else {\n        continue;\n      }\n\n      if (to === address) {\n        if (!rawNft) {\n          [rawNft] = await fetchNftItems(network, [nftAddress]);\n        }\n\n        if (rawNft) {\n          const nft = buildNft(network, rawNft);\n\n          if (nft) {\n            updates.push({\n              type: 'nftReceived',\n              accountId,\n              nftAddress,\n              nft,\n            });\n          }\n        }\n      } else if (!isPurchase && await isActiveSmartContract(network, to)) {\n        updates.push({\n          type: 'nftPutUpForSale',\n          accountId,\n          nftAddress,\n        });\n      } else {\n        updates.push({\n          type: 'nftSent',\n          accountId,\n          nftAddress,\n          newOwnerAddress: to,\n        });\n      }\n    }\n  }\n\n  return [fromSec, updates] as [number, ApiNftUpdate[]];\n}\n\nexport async function checkNftTransferDraft(options: {\n  accountId: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}): Promise<ApiCheckTransactionDraftResult> {\n  const { accountId, nfts, comment } = options;\n  let { toAddress } = options;\n\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result: ApiCheckTransactionDraftResult = await checkToAddress(network, toAddress);\n  if ('error' in result) {\n    return result;\n  }\n\n  toAddress = result.resolvedAddress!;\n\n  const messages = nfts\n    .slice(0, NFT_BATCH_SIZE) // We only need to check the first batch of a multi-transaction\n    .map((nft) => buildNftTransferMessage(nft, fromAddress, toAddress, comment));\n\n  const transactionResult = await checkMultiTransactionDraft(accountId, messages);\n\n  if (transactionResult.fee !== undefined) {\n    const batchFee = transactionResult.fee;\n    result.fee = calculateNftTransferFee(nfts.length, messages.length, batchFee, NFT_TRANSFER_AMOUNT);\n    result.realFee = calculateNftTransferFee(nfts.length, messages.length, batchFee, NFT_TRANSFER_REAL_AMOUNT);\n  }\n\n  if ('error' in transactionResult) {\n    result.error = transactionResult.error;\n  }\n\n  return result;\n}\n\nexport async function submitNftTransfers(options: {\n  accountId: string;\n  password: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}) {\n  const {\n    accountId, password, nfts, toAddress, comment,\n  } = options;\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n  const messages = nfts.map((nft) => buildNftTransferMessage(nft, fromAddress, toAddress, comment));\n  return submitMultiTransfer({ accountId, password, messages });\n}\n\nfunction buildNftTransferMessage(nft: ApiNft, fromAddress: string, toAddress: string, comment?: string) {\n  const isNotcoinBurn = nft.collectionAddress === NOTCOIN_VOUCHERS_ADDRESS\n    && (toAddress === BURN_ADDRESS || NOTCOIN_EXCHANGERS.includes(toAddress as any));\n  const payload = isNotcoinBurn\n    ? buildNotcoinVoucherExchange(fromAddress, nft.address, nft.index)\n    : buildNftTransferPayload(fromAddress, toAddress, comment);\n\n  return {\n    payload,\n    amount: NFT_TRANSFER_AMOUNT,\n    toAddress: nft.address,\n  };\n}\n\nfunction buildNotcoinVoucherExchange(fromAddress: string, nftAddress: string, nftIndex: number) {\n  // eslint-disable-next-line no-bitwise\n  const first4Bits = Address.parse(nftAddress).hash.readUint8() >> 4;\n  const toAddress = NOTCOIN_EXCHANGERS[first4Bits];\n\n  const payload = new Builder()\n    .storeUint(0x5fec6642, 32)\n    .storeUint(nftIndex, 64)\n    .endCell();\n\n  return buildNftTransferPayload(fromAddress, toAddress, payload, NOTCOIN_FORWARD_TON_AMOUNT);\n}\n\nfunction buildNftTransferPayload(\n  fromAddress: string,\n  toAddress: string,\n  payload?: string | Cell,\n  forwardAmount = NFT_TRANSFER_FORWARD_AMOUNT,\n) {\n  let builder = new Builder()\n    .storeUint(NftOpCode.TransferOwnership, 32)\n    .storeUint(generateQueryId(), 64)\n    .storeAddress(Address.parse(toAddress))\n    .storeAddress(Address.parse(fromAddress))\n    .storeBit(false) // null custom_payload\n    .storeCoins(forwardAmount);\n\n  let forwardPayload: Cell | Uint8Array | undefined;\n\n  if (payload) {\n    if (typeof payload === 'string') {\n      const bytes = commentToBytes(payload);\n      const freeBytes = Math.floor((builder.availableBits - NFT_PAYLOAD_SAFE_MARGIN) / 8);\n      forwardPayload = packBytesAsSnake(bytes, freeBytes);\n    } else {\n      forwardPayload = payload;\n    }\n  }\n\n  if (forwardPayload instanceof Uint8Array) {\n    builder.storeBit(0);\n    builder = builder.storeBuffer(Buffer.from(forwardPayload));\n  } else {\n    builder = builder.storeMaybeRef(forwardPayload);\n  }\n\n  return builder.endCell();\n}\n\nexport function calculateNftTransferFee(\n  totalNftCount: number,\n  // How many NFTs were added to the multi-transaction before estimating it\n  estimatedBatchSize: number,\n  // The blockchain fee of the estimated multi-transaction\n  estimatedBatchBlockchainFee: bigint,\n  // How much TON is attached to each NFT during the transfer\n  amountPerNft: bigint,\n) {\n  const fullBatchCount = Math.floor(totalNftCount / estimatedBatchSize);\n  let remainingBatchSize = totalNftCount % estimatedBatchSize;\n\n  // The blockchain fee for the first NFT in a batch is almost twice higher than the fee for the other NFTs. Therefore,\n  // simply using the average NFT fee to calculate the last incomplete batch fee gives an insufficient number. To fix\n  // that, we increase the last batch size.\n  //\n  // A real life example:\n  // 1 NFT  in the batch: 0.002939195 TON\n  // 2 NFTs in the batch: 0.004470516 TON\n  // 3 NFTs in the batch: 0.006001837 TON\n  // 4 NFTs in the batch: 0.007533158 TON\n  if (remainingBatchSize > 0 && remainingBatchSize < estimatedBatchSize) {\n    remainingBatchSize += 1;\n  }\n\n  const totalBlockchainFee = bigintMultiplyToNumber(\n    estimatedBatchBlockchainFee,\n    (fullBatchCount * estimatedBatchSize + remainingBatchSize) / estimatedBatchSize,\n  );\n  return totalBlockchainFee + BigInt(totalNftCount) * amountPerNft;\n}\n","import type {\n  Cell, Contract, ContractProvider,\n} from '@ton/core';\nimport {\n  Address, beginCell, contractAddress, TupleReader,\n} from '@ton/core';\n\nexport type NominatorPoolConfig = {};\n\nexport type Nominator = {\n  address: Address;\n  amount: bigint;\n  pendingDepositAmount: bigint;\n  withdrawRequested: boolean;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function nominatorPoolConfigToCell(config: NominatorPoolConfig): Cell {\n  return beginCell().endCell();\n}\n\nexport class NominatorPool implements Contract {\n  constructor(readonly address: Address, readonly init?: { code: Cell; data: Cell }) {}\n\n  static createFromAddress(address: Address) {\n    return new NominatorPool(address);\n  }\n\n  static createFromConfig(config: NominatorPoolConfig, code: Cell, workchain = 0) {\n    const data = nominatorPoolConfigToCell(config);\n    const init = { code, data };\n    return new NominatorPool(contractAddress(workchain, init), init);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async getListNominators(provider: ContractProvider): Promise<Nominator[]> {\n    const res = await provider.get('list_nominators', []);\n    const tupleReader = (res.stack as TupleReader).readTuple();\n    const itemsArray = (tupleReader as any).items as bigint[][];\n\n    return itemsArray.map((items: bigint[]) => {\n      const tupleItems = items.map((value) => ({ type: 'int' as const, value }));\n      const tuple = new TupleReader(tupleItems);\n\n      const hash = tuple.readBigNumber().toString(16).padStart(64, '0');\n      const address = Address.parse(`0:${hash}`);\n      const amount = tuple.readBigNumber();\n      const pendingDepositAmount = tuple.readBigNumber();\n      const withdrawRequested = Boolean(tuple.readNumber());\n\n      return {\n        address,\n        amount,\n        pendingDepositAmount,\n        withdrawRequested,\n      };\n    });\n  }\n}\n","import { randomBytes } from '../../util/random';\nimport { storage } from '../storages';\n\nlet clientId: string | undefined;\n\nexport async function getClientId() {\n  clientId = await storage.getItem('clientId');\n\n  if (!clientId) {\n    clientId = Buffer.from(randomBytes(10)).toString('hex');\n\n    const referrer = await storage.getItem('referrer');\n    if (referrer) clientId = `${clientId}:${referrer}`;\n\n    await storage.setItem('clientId', clientId);\n  }\n  return clientId;\n}\n","import { Address } from '@ton/core';\n\nimport type {\n  ApiBackendStakingState,\n  ApiJettonStakingState,\n  ApiLoyaltyType,\n  ApiNetwork,\n  ApiStakingCommonData,\n  ApiStakingJettonPool,\n  ApiStakingState,\n} from '../../types';\nimport type { StakingPoolConfigUnpacked } from './contracts/JettonStaking/StakingPool';\nimport type { Nominator } from './contracts/NominatorPool';\nimport type {\n  ApiCheckTransactionDraftResult,\n  ApiSubmitTransferTonResult,\n  TonTransferParams,\n} from './types';\nimport {\n  ApiLiquidUnstakeMode,\n  ApiTransactionDraftError,\n} from '../../types';\n\nimport {\n  LIQUID_JETTON,\n  LIQUID_POOL,\n  TONCOIN,\n  VALIDATION_PERIOD_MS,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintDivideToNumber, bigintMultiplyToNumber } from '../../../util/bigint';\nimport { fromDecimal } from '../../../util/decimals';\nimport calcJettonStakingApr from '../../../util/ton/calcJettonStakingApr';\nimport {\n  buildJettonClaimPayload,\n  buildJettonUnstakePayload,\n  buildLiquidStakingDepositBody,\n  buildLiquidStakingWithdrawBody,\n  getJettonPoolStakeWallet,\n  getTokenBalance,\n  getTonClient,\n  resolveTokenWalletAddress,\n  toBase64Address,\n  unpackDicts,\n} from './util/tonCore';\nimport { StakeWallet } from './contracts/JettonStaking/StakeWallet';\nimport { StakingPool } from './contracts/JettonStaking/StakingPool';\nimport { NominatorPool } from './contracts/NominatorPool';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\nimport { getAccountCache, getStakingCommonCache, updateAccountCache } from '../../common/cache';\nimport { getClientId } from '../../common/other';\nimport { getTokenByAddress, getTokenBySlug } from '../../common/tokens';\nimport { isKnownStakingPool } from '../../common/utils';\nimport { nftRepository } from '../../db';\nimport { STAKE_COMMENT, TON_GAS, UNSTAKE_COMMENT } from './constants';\nimport { checkTransactionDraft, submitTransfer } from './transactions';\nimport { isAddressInitialized } from './wallet';\n\nexport async function checkStakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  let result: ApiCheckTransactionDraftResult;\n\n  switch (state.type) {\n    case 'nominators': {\n      if (amount < TON_GAS.stakeNominators) {\n        return { error: ApiTransactionDraftError.InvalidAmount };\n      }\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.pool,\n        amount: amount + TON_GAS.stakeNominators,\n        data: STAKE_COMMENT,\n      });\n      if ('fee' in result && result.fee) {\n        result.fee = TON_GAS.stakeNominators + result.fee;\n      }\n      break;\n    }\n    case 'liquid': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: LIQUID_POOL,\n        amount: amount + TON_GAS.stakeLiquid,\n        data: buildLiquidStakingDepositBody(),\n      });\n      if ('fee' in result && result.fee) {\n        result.fee = TON_GAS.stakeLiquid + result.fee;\n      }\n      break;\n    }\n    case 'jetton': {\n      const { tokenSlug, pool, period } = state;\n      const { tokenAddress } = getTokenBySlug(tokenSlug);\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: pool,\n        tokenAddress,\n        amount,\n        data: StakingPool.stakePayload(period),\n        forwardAmount: TON_GAS.stakeJettonsForward,\n      });\n      break;\n    }\n  }\n\n  return result;\n}\n\nexport async function checkUnstakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const commonData = getStakingCommonCache();\n\n  let result: ApiCheckTransactionDraftResult;\n  let tokenAmount: bigint | undefined;\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.pool,\n        amount: TON_GAS.unstakeNominators,\n        data: UNSTAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      if (amount > state.balance) {\n        return { error: ApiTransactionDraftError.InsufficientBalance };\n      } else if (amount === state.balance) {\n        tokenAmount = state.tokenBalance;\n      } else {\n        tokenAmount = bigintDivideToNumber(amount, commonData.liquid.currentRate);\n      }\n\n      const params = await buildLiquidStakingWithdraw(network, address, tokenAmount);\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: params.toAddress,\n        amount: params.amount,\n        data: params.payload,\n      });\n      break;\n    }\n    case 'jetton': {\n      tokenAmount = amount;\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.stakeWalletAddress,\n        amount: TON_GAS.unstakeJettons,\n        data: buildJettonUnstakePayload(amount, true),\n      });\n      break;\n    }\n  }\n\n  return {\n    ...result,\n    type: state.type,\n    tokenAmount,\n  };\n}\n\nexport async function submitStake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n) {\n  let result: ApiSubmitTransferTonResult;\n\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: toBase64Address(state.pool, true, network),\n        amount: amount + TON_GAS.stakeNominators,\n        data: STAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: LIQUID_POOL,\n        amount: amount + TON_GAS.stakeLiquid,\n        data: buildLiquidStakingDepositBody(),\n      });\n      break;\n    }\n    case 'jetton': {\n      const { tokenSlug, pool, period } = state;\n      const { tokenAddress } = getTokenBySlug(tokenSlug);\n\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: pool,\n        tokenAddress,\n        amount,\n        data: StakingPool.stakePayload(period),\n        forwardAmount: TON_GAS.stakeJettonsForward,\n      });\n      if (!('error' in result)) {\n        result.toAddress = pool;\n      }\n      break;\n    }\n  }\n\n  if (!('error' in result)) {\n    updateAccountCache(accountId, address, { stakedAt: Date.now() });\n  }\n\n  return result;\n}\n\nexport async function submitUnstake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  let result: ApiSubmitTransferTonResult;\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: toBase64Address(state.pool, true, network),\n        amount: TON_GAS.unstakeNominators,\n        data: UNSTAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      const mode = !state.instantAvailable\n        ? ApiLiquidUnstakeMode.BestRate\n        : ApiLiquidUnstakeMode.Default;\n\n      const params = await buildLiquidStakingWithdraw(network, address, amount, mode);\n\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: params.toAddress,\n        amount: params.amount,\n        data: params.payload,\n      });\n      break;\n    }\n    case 'jetton': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: state.stakeWalletAddress,\n        amount: TON_GAS.unstakeJettons,\n        data: buildJettonUnstakePayload(amount, true),\n      });\n    }\n  }\n\n  return result;\n}\n\nexport async function buildLiquidStakingWithdraw(\n  network: ApiNetwork,\n  address: string,\n  amount: bigint,\n  mode: ApiLiquidUnstakeMode = ApiLiquidUnstakeMode.Default,\n): Promise<TonTransferParams> {\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, address, LIQUID_JETTON);\n\n  const payload = buildLiquidStakingWithdrawBody({\n    amount,\n    responseAddress: address,\n    fillOrKill: mode === ApiLiquidUnstakeMode.Instant,\n    waitTillRoundEnd: mode === ApiLiquidUnstakeMode.BestRate,\n  });\n\n  return {\n    amount: TON_GAS.unstakeLiquid,\n    toAddress: tokenWalletAddress,\n    payload,\n  };\n}\n\ntype StakingStateOptions = {\n  accountId: string;\n  backendState: ApiBackendStakingState;\n  commonData: ApiStakingCommonData;\n  address: string;\n  loyaltyType?: ApiLoyaltyType;\n  network: ApiNetwork;\n};\n\nexport async function getStakingStates(\n  accountId: string,\n  commonData: ApiStakingCommonData,\n  backendState: ApiBackendStakingState,\n): Promise<ApiStakingState[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const {\n    loyaltyType,\n    shouldUseNominators,\n    type: backendType,\n  } = backendState;\n\n  const options: StakingStateOptions = {\n    accountId, backendState, commonData, address, loyaltyType, network,\n  };\n\n  const promises: Promise<ApiStakingState>[] = [buildLiquidState(options)];\n\n  for (const poolConfig of commonData.jettonPools) {\n    promises.push(buildJettonState(options, poolConfig));\n  }\n\n  if (shouldUseNominators || backendType === 'nominators') {\n    promises.push(buildNominatorsState(options));\n  }\n\n  return Promise.all(promises);\n}\n\nasync function buildLiquidState({\n  accountId,\n  address,\n  backendState,\n  commonData,\n  loyaltyType,\n}: StakingStateOptions): Promise<ApiStakingState> {\n  const { currentRate, collection } = commonData.liquid;\n  const tokenBalance = await getLiquidStakingTokenBalance(accountId);\n  let unstakeAmount = 0n;\n\n  if (collection) {\n    const nfts = await nftRepository.find({\n      accountId,\n      collectionAddress: collection,\n    });\n\n    for (const nft of nfts ?? []) {\n      const billAmount = nft.name?.match(/Bill for (?<amount>[\\d.]+) Pool Jetton/)?.groups?.amount;\n      if (billAmount) {\n        unstakeAmount += fromDecimal(billAmount);\n      }\n    }\n  }\n\n  const accountCache = getAccountCache(accountId, address);\n  const stakedAt = Math.max(accountCache.stakedAt ?? 0, backendState.stakedAt ?? 0);\n\n  const isInstantUnstake = Date.now() - stakedAt > VALIDATION_PERIOD_MS;\n  const liquidAvailable = isInstantUnstake ? commonData.liquid.available : 0n;\n\n  let liquidApy = commonData.liquid.apy;\n  if (loyaltyType && loyaltyType in commonData.liquid.loyaltyApy) {\n    liquidApy = commonData.liquid.loyaltyApy[loyaltyType];\n  }\n\n  const fullTokenAmount = tokenBalance + unstakeAmount;\n  const balance = bigintMultiplyToNumber(fullTokenAmount, currentRate);\n\n  return {\n    type: 'liquid',\n    id: 'liquid',\n    tokenSlug: TONCOIN.slug,\n    pool: LIQUID_POOL,\n    balance,\n    annualYield: liquidApy,\n    yieldType: 'APY',\n    tokenBalance,\n    isUnstakeRequested: unstakeAmount > 0n,\n    unstakeRequestAmount: unstakeAmount,\n    instantAvailable: liquidAvailable,\n  };\n}\n\nasync function buildNominatorsState({\n  network,\n  address,\n  backendState,\n  commonData,\n}: StakingStateOptions): Promise<ApiStakingState> {\n  const balance = backendState.balance;\n  const { address: pool, apy } = backendState.nominatorsPool;\n\n  const isPrevRoundUnlocked = Date.now() > commonData.prevRound.unlock;\n  const start = isPrevRoundUnlocked ? commonData.round.start : commonData.prevRound.start;\n  const end = isPrevRoundUnlocked ? commonData.round.unlock : commonData.prevRound.unlock;\n\n  let currentNominator: Nominator | undefined;\n\n  if (backendState.type === 'nominators') {\n    const nominatorPool = getTonClient(network).open(new NominatorPool(Address.parse(pool)));\n    const nominators = await nominatorPool.getListNominators();\n    const addressObject = Address.parse(address);\n    currentNominator = nominators.find((n) => n.address.equals(addressObject));\n  }\n\n  return {\n    type: 'nominators',\n    id: 'nominators',\n    tokenSlug: TONCOIN.slug,\n    balance: currentNominator ? balance : 0n,\n    annualYield: apy,\n    yieldType: 'APY',\n    pool,\n    start,\n    end,\n    pendingDepositAmount: currentNominator?.pendingDepositAmount ?? 0n,\n    isUnstakeRequested: currentNominator?.withdrawRequested ?? false,\n  };\n}\n\nasync function buildJettonState(\n  options: StakingStateOptions,\n  poolConfig: ApiStakingJettonPool,\n): Promise<ApiJettonStakingState> {\n  const { network } = options;\n\n  // common\n  const {\n    pool: poolAddress,\n    token: tokenAddress,\n  } = poolConfig;\n\n  const { decimals, slug: tokenSlug } = getTokenByAddress(tokenAddress)!;\n\n  const tonClient = getTonClient(network);\n  const pool = tonClient.open(StakingPool.createFromAddress(Address.parse(poolAddress)));\n\n  // pool\n  const poolData = await pool.getStorageData();\n  const { tvl, rewardJettons } = unpackDicts(poolData) as StakingPoolConfigUnpacked;\n  const { rewardsDeposits } = Object.values(rewardJettons!)[0];\n  const now = Math.floor(Date.now() / 1000);\n\n  let dailyReward: bigint = 0n;\n  for (const { startTime, endTime, distributionSpeed } of Object.values(rewardsDeposits)) {\n    if (startTime < now && endTime > now) {\n      dailyReward += distributionSpeed;\n    }\n  }\n\n  const apr = calcJettonStakingApr({ tvl, dailyReward, decimals });\n\n  // wallet\n  const { address } = options;\n  const periodConfig = poolConfig.periods[0];\n\n  const stakeWallet = await getJettonPoolStakeWallet(network, poolAddress, periodConfig.period, address);\n  const walletData = await stakeWallet.getStorageData().catch(() => undefined);\n\n  let unclaimedRewards = 0n;\n  let balance = 0n;\n  let poolWallets: string[] | undefined;\n\n  if (walletData) {\n    const poolWalletAddress = await resolveTokenWalletAddress(network, poolAddress, tokenAddress);\n    const rewards = walletData && StakeWallet.getAvailableRewards(walletData, poolData);\n    unclaimedRewards = (rewards && rewards[poolWalletAddress]) ?? 0n;\n    balance = walletData.jettonBalance;\n    poolWallets = Object.keys(rewards);\n  }\n\n  const state: ApiJettonStakingState = {\n    type: 'jetton',\n    id: poolAddress,\n    pool: poolAddress,\n    tokenAddress,\n    tokenSlug,\n    annualYield: apr,\n    yieldType: 'APR',\n    balance,\n    unclaimedRewards,\n    poolWallets,\n    stakeWalletAddress: toBase64Address(stakeWallet.address, true),\n    tokenAmount: 0n,\n    tvl,\n    dailyReward,\n    period: periodConfig.period,\n  };\n\n  return state;\n}\n\nasync function getLiquidStakingTokenBalance(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  if (network !== 'mainnet') {\n    return 0n;\n  }\n\n  const { address } = await fetchStoredTonWallet(accountId);\n  const walletAddress = await resolveTokenWalletAddress(network, address, LIQUID_JETTON);\n  const isInitialized = await isAddressInitialized(network, walletAddress);\n\n  if (!isInitialized) {\n    return 0n;\n  }\n\n  return getTokenBalance(network, walletAddress);\n}\n\nexport async function getBackendStakingState(accountId: string): Promise<ApiBackendStakingState> {\n  const { address } = await fetchStoredTonWallet(accountId);\n  const state = await fetchBackendStakingState(address);\n  return {\n    ...state,\n    nominatorsPool: {\n      ...state.nominatorsPool,\n      start: state.nominatorsPool.start * 1000,\n      end: state.nominatorsPool.end * 1000,\n    },\n  };\n}\n\nexport async function fetchBackendStakingState(address: string): Promise<ApiBackendStakingState> {\n  const clientId = await getClientId();\n  const stakingState = await callBackendGet(`/staking/state/${address}`, undefined, {\n    'X-App-ClientID': clientId,\n  });\n\n  stakingState.balance = fromDecimal(stakingState.balance);\n  stakingState.totalProfit = fromDecimal(stakingState.totalProfit);\n\n  if (!isKnownStakingPool(stakingState.nominatorsPool.address)) {\n    throw Error('Unexpected pool address, likely a malicious activity');\n  }\n\n  return stakingState;\n}\n\nexport function submitStakingClaim(\n  accountId: string,\n  password: string,\n  state: ApiJettonStakingState,\n) {\n  return submitTransfer({\n    accountId,\n    password,\n    toAddress: state.stakeWalletAddress,\n    amount: TON_GAS.claimJettons,\n    data: buildJettonClaimPayload(state.poolWallets!),\n  });\n}\n","import { DAYS_IN_YEAR } from '../../api/constants';\nimport { toBig } from '../decimals';\n\nexport default function calcJettonStakingApr({\n  tvl, dailyReward, decimals,\n}: {\n  tvl: bigint;\n  dailyReward: bigint;\n  decimals: number;\n}) {\n  if (!tvl) {\n    return 0;\n  }\n\n  const apr = toBig(dailyReward, decimals)\n    .div(toBig(tvl, decimals))\n    .mul(DAYS_IN_YEAR)\n    .mul(100)\n    .toFixed(2);\n\n  return Number(apr);\n}\n","import { Builder, Cell } from '@ton/core';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { getTonClient } from './util/tonCore';\n\nexport function packPayloadToBoc(payload: string | Uint8Array) {\n  let cell = new Cell();\n  if (payload) {\n    if (payload instanceof Cell) {\n      cell = payload;\n    } else if (typeof payload === 'string') {\n      if (payload.length > 0) {\n        cell = new Builder()\n          .storeUint(0, 32)\n          .storeStringTail(payload)\n          .asCell();\n      }\n    } else {\n      cell = new Builder()\n        .storeBuffer(Buffer.from(payload))\n        .asCell();\n    }\n  }\n  return cell.toBoc().toString('base64');\n}\n\nexport async function checkApiAvailability(network: ApiNetwork) {\n  try {\n    await getTonClient(network).getMasterchainInfo();\n    return true;\n  } catch (err: any) {\n    return false;\n  }\n}\n","import type {\n  ApiNftTransferPayload,\n  ApiParsedPayload,\n  ApiTokensTransferNonStandardPayload,\n  ApiTokensTransferPayload,\n} from '../../api/types';\n\nexport function isNftTransferPayload(payload: ApiParsedPayload | undefined): payload is ApiNftTransferPayload {\n  return payload?.type === 'nft:transfer';\n}\n\nexport function isTokenTransferPayload(\n  payload: ApiParsedPayload | undefined,\n): payload is ApiTokensTransferPayload | ApiTokensTransferNonStandardPayload {\n  return payload?.type === 'tokens:transfer' || payload?.type === 'tokens:transfer-non-standard';\n}\n","export function buildSwapId(backendId: string) {\n  return `swap:${backendId}`;\n}\n","import type { SwapHistoryRange } from '../methods';\nimport type { ApiSwapActivity, ApiSwapHistoryItem } from '../types';\n\nimport { SWAP_API_VERSION, TONCOIN } from '../../config';\nimport { buildSwapId } from '../../util/swap/buildSwapId';\nimport { callBackendGet, callBackendPost } from './backend';\nimport { buildTokenSlug, getTokenByAddress } from './tokens';\n\nexport function swapGetHistory(address: string, params: {\n  fromLt?: number;\n  toLt?: number;\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  status?: ApiSwapHistoryItem['status'];\n  isCex?: boolean;\n  asset?: string;\n}): Promise<ApiSwapHistoryItem[]> {\n  return callBackendGet(`/swap/history/${address}`, {\n    ...params,\n    swapVersion: SWAP_API_VERSION,\n  });\n}\n\nexport function swapGetHistoryByRanges(address: string, ranges: SwapHistoryRange[]): Promise<ApiSwapHistoryItem[]> {\n  return callBackendPost(`/swap/history-ranges/${address}`, {\n    swapVersion: SWAP_API_VERSION,\n    ranges,\n  });\n}\n\nexport function swapGetHistoryItem(address: string, id: string): Promise<ApiSwapHistoryItem> {\n  return callBackendGet(`/swap/history/${address}/${id}`, {\n    swapVersion: SWAP_API_VERSION,\n  });\n}\n\nexport function swapItemToActivity(swap: ApiSwapHistoryItem): ApiSwapActivity {\n  return {\n    ...swap,\n    id: buildSwapId(swap.id),\n    kind: 'swap',\n    from: getSwapItemSlug(swap, swap.from),\n    to: getSwapItemSlug(swap, swap.to),\n  };\n}\n\nexport function getSwapItemSlug(item: ApiSwapHistoryItem, asset: string) {\n  if (asset === TONCOIN.symbol) {\n    return TONCOIN.slug;\n  }\n  if (item.cex) {\n    return getTokenByAddress(asset)?.slug ?? asset;\n  }\n  return buildTokenSlug('ton', asset);\n}\n\nexport async function patchSwapItem(options: {\n  address: string;\n  swapId: string;\n  authToken: string;\n  msgHash?: string;\n  error?: string;\n}) {\n  const {\n    address, swapId, authToken, msgHash, error,\n  } = options;\n  await callBackendPost(`/swap/history/${address}/${swapId}/update`, {\n    swapVersion: SWAP_API_VERSION,\n    msgHash,\n    error,\n  }, {\n    method: 'PATCH',\n    authToken,\n  });\n}\n","import type { SwapHistoryRange } from '../../methods';\nimport type {\n  ApiActivity,\n  ApiNetwork,\n  ApiSwapBuildRequest,\n  ApiSwapHistoryItem,\n  ApiTokensTransferPayload,\n  ApiTransaction,\n  ApiTransactionActivity,\n} from '../../types';\nimport type { TonTransferParams } from './types';\n\nimport { DIESEL_ADDRESS, SWAP_FEE_ADDRESS, TONCOIN } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { assert as originalAssert } from '../../../util/assert';\nimport { fromDecimal } from '../../../util/decimals';\nimport { logDebugError } from '../../../util/logs';\nimport { pause } from '../../../util/schedulers';\nimport { isTokenTransferPayload } from '../../../util/ton/transfer';\nimport { parseTxId } from './util';\nimport { parsePayloadBase64 } from './util/metadata';\nimport { resolveTokenWalletAddress, toBase64Address } from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { swapGetHistory, swapGetHistoryByRanges, swapItemToActivity } from '../../common/swap';\nimport { getTokenByAddress, getTokenBySlug } from '../../common/tokens';\nimport { getContractInfo } from './wallet';\n\ntype LtRange = [number, number];\n\nconst FEE_ADDRESSES = [SWAP_FEE_ADDRESS, DIESEL_ADDRESS];\nconst MEGATON_WTON_MINTER = 'EQCajaUU1XXSAjTD-xOV7pE49fGtg4q8kF3ELCOJtGvQFQ2C';\nconst MAX_NETWORK_FEE = 1000000000n; // 1 TON\n\nconst SWAP_MAX_LT = 50;\nconst SWAP_WAITING_TIME = 5 * 60 * 1_000; // 5 min\nconst SWAP_WAITING_PAUSE = 1_000; // 1 sec\nconst MAX_OLD_SWAP_ID = 41276;\n\nexport async function validateDexSwapTransfers(\n  network: ApiNetwork,\n  address: string,\n  request: ApiSwapBuildRequest,\n  transfers: TonTransferParams[],\n) {\n  const assert = (condition: boolean, message: string) => {\n    originalAssert(condition, message, {\n      network, address, request, transfers,\n    });\n  };\n\n  assert(transfers.length <= 2, 'Too many transfers');\n\n  const [mainTransfer, feeTransfer] = transfers;\n\n  if (request.from === TONCOIN.symbol) {\n    const maxAmount = fromDecimal(request.fromAmount) + MAX_NETWORK_FEE;\n    const { isSwapAllowed, codeHash } = await getContractInfo(network, mainTransfer.toAddress);\n\n    assert(!!isSwapAllowed, `Not allowed swap contract: ${codeHash}`);\n    assert(mainTransfer.amount <= maxAmount, 'Main transfer amount is too big');\n\n    if (feeTransfer) {\n      assert(feeTransfer.amount <= mainTransfer.amount, 'Fee transfer amount is too big');\n      assert(feeTransfer.amount + mainTransfer.amount < maxAmount, 'Total amount is too big');\n      assert(FEE_ADDRESSES.includes(toBase64Address(feeTransfer.toAddress, false)), 'Unexpected fee transfer address');\n    }\n  } else {\n    const token = getTokenByAddress(request.from)!;\n    assert(!!token, 'Unknown \"from\" token');\n\n    const maxAmount = fromDecimal(request.fromAmount, token.decimals)\n      + fromDecimal(request.ourFee ?? 0, token.decimals)\n      + fromDecimal(request.dieselFee ?? 0, token.decimals);\n    const maxTonAmount = MAX_NETWORK_FEE;\n\n    const walletAddress = await resolveTokenWalletAddress(network, address, token.tokenAddress!);\n    const parsedPayload = await parsePayloadBase64(network, mainTransfer.toAddress, mainTransfer.payload as string);\n\n    let destination: string;\n    let tokenAmount = 0n;\n\n    if (mainTransfer.toAddress === MEGATON_WTON_MINTER) {\n      destination = mainTransfer.toAddress;\n      assert(mainTransfer.toAddress === token.tokenAddress, 'Main transfer address is not the token address');\n    } else {\n      assert(mainTransfer.toAddress === walletAddress, 'Main transfer address is not the token wallet address');\n      assert(isTokenTransferPayload(parsedPayload), 'Main transfer payload is not a token transfer');\n\n      ({ amount: tokenAmount, destination } = parsedPayload as ApiTokensTransferPayload);\n      assert(tokenAmount <= maxAmount, 'Main transfer token amount is too big');\n    }\n\n    assert(mainTransfer.amount < maxTonAmount, 'Main transfer TON amount is too big');\n\n    const { isSwapAllowed } = await getContractInfo(network, destination);\n\n    assert(!!isSwapAllowed, 'Main transfer destination is not a swap smart contract');\n\n    if (feeTransfer) {\n      const feePayload = await parsePayloadBase64(network, feeTransfer.toAddress, feeTransfer.payload as string);\n\n      assert(feeTransfer.amount + mainTransfer.amount < maxTonAmount, 'Total TON amount is too big');\n      assert(feeTransfer.toAddress === walletAddress, 'Fee transfer address is not the token wallet address');\n      assert(isTokenTransferPayload(feePayload), 'Fee transfer payload is not a token transfer');\n\n      const { amount: tokenFeeAmount, destination: feeDestination } = feePayload as ApiTokensTransferPayload;\n\n      assert(tokenAmount + tokenFeeAmount <= maxAmount, 'Total token amount is too big');\n      assert(FEE_ADDRESSES.includes(toBase64Address(feeDestination, false)), 'Unexpected fee transfer destination');\n    }\n  }\n}\n\nexport async function swapReplaceTransactions(\n  accountId: string,\n  transactions: ApiTransactionActivity[],\n  network: ApiNetwork,\n  slug?: string,\n): Promise<ApiActivity[]> {\n  if (!transactions.length || network === 'testnet') {\n    return transactions;\n  }\n\n  try {\n    const { address } = await fetchStoredTonWallet(accountId);\n    const asset = slug ? getTokenBySlug(slug).tokenAddress ?? TONCOIN.symbol : undefined;\n    const {\n      fromLt, toLt, fromTime, toTime,\n    } = buildSwapHistoryRange(transactions);\n\n    const swaps = await swapGetHistory(address, {\n      fromLt,\n      toLt,\n      fromTimestamp: fromTime,\n      toTimestamp: toTime,\n      asset,\n    });\n\n    if (!swaps.length) {\n      return transactions;\n    }\n\n    return replaceTransactions(transactions, swaps);\n  } catch (err) {\n    logDebugError('swapReplaceTransactions', err);\n    return transactions;\n  }\n}\n\nexport async function swapReplaceTransactionsByRanges(\n  accountId: string,\n  transactions: ApiTransactionActivity[],\n  chunks: ApiTransactionActivity[][],\n  isFirstLoad?: boolean,\n): Promise<ApiActivity[]> {\n  transactions = transactions.slice();\n\n  const { network } = parseAccountId(accountId);\n\n  if (!chunks.length || network === 'testnet') {\n    return transactions;\n  }\n\n  try {\n    const { address } = await fetchStoredTonWallet(accountId);\n\n    if (!isFirstLoad) {\n      await waitPendingDexSwap(address);\n    }\n\n    const ranges = chunks.map((txs) => buildSwapHistoryRange(txs));\n    const swaps = await swapGetHistoryByRanges(address, ranges);\n\n    if (!swaps.length) {\n      return transactions;\n    }\n\n    return replaceTransactions(transactions, swaps);\n  } catch (err) {\n    logDebugError('swapReplaceTransactionsByRanges', err);\n    return transactions;\n  }\n}\n\nfunction replaceTransactions(transactions: ApiTransactionActivity[], swaps: ApiSwapHistoryItem[]) {\n  const result: ApiActivity[] = [];\n  const hiddenTxIds = new Set<string>();\n\n  const skipLtRanges: LtRange[] = []; // TODO Remove it after applying correcting script in backend\n\n  for (const swap of swaps) {\n    swap.txIds?.forEach((txId) => {\n      hiddenTxIds.add(txId);\n    });\n\n    if (swap.lt && Number(swap.id) < MAX_OLD_SWAP_ID) {\n      skipLtRanges.push([swap.lt, swap.lt + SWAP_MAX_LT]);\n    }\n\n    const swapActivity = swapItemToActivity(swap);\n\n    result.push(swapActivity);\n  }\n\n  for (let transaction of transactions) {\n    const [ltString, hash] = transaction.txId.split(':');\n    const lt = Number(ltString);\n    const shortenedTxId = `${lt}:${hash}`;\n\n    const shouldHide = Boolean(\n      hiddenTxIds.has(shortenedTxId)\n      || skipLtRanges.find(([startLt, endLt]) => lt >= startLt && lt <= endLt),\n    );\n\n    if (shouldHide) {\n      transaction = { ...transaction, shouldHide };\n    }\n    result.push(transaction);\n  }\n\n  return result;\n}\n\nasync function waitPendingDexSwap(address: string) {\n  const waitUntil = Date.now() + SWAP_WAITING_TIME;\n\n  while (Date.now() < waitUntil) {\n    const pendingSwaps = await swapGetHistory(address, {\n      status: 'pending',\n      isCex: false,\n    });\n\n    if (!pendingSwaps.length) {\n      break;\n    }\n\n    const areAllStale = pendingSwaps.every((swap) => (\n      Date.now() - swap.timestamp > SWAP_WAITING_TIME * 2\n    ));\n    if (areAllStale) {\n      break;\n    }\n\n    await pause(SWAP_WAITING_PAUSE);\n  }\n}\n\nfunction buildSwapHistoryRange(transactions: ApiTransaction[]): SwapHistoryRange {\n  const firstLt = parseTxId(transactions[0].txId).lt;\n  const lastLt = parseTxId(transactions[transactions.length - 1].txId).lt;\n\n  const firstTimestamp = transactions[0].timestamp;\n  const lastTimestamp = transactions[transactions.length - 1].timestamp;\n\n  const [fromLt, fromTime] = firstLt > lastLt ? [lastLt, lastTimestamp] : [firstLt, firstTimestamp];\n  const [toLt, toTime] = firstLt > lastLt ? [firstLt, firstTimestamp] : [lastLt, lastTimestamp];\n\n  const slug = transactions[0].slug;\n  const asset = slug === TONCOIN.slug ? TONCOIN.symbol : getTokenBySlug(slug).tokenAddress!;\n\n  return {\n    asset,\n    fromLt: Math.floor(fromLt / 100) * 100,\n    toLt,\n    fromTime,\n    toTime,\n  };\n}\n","import { pause } from './schedulers';\n\nimport Deferred from './Deferred';\n\nconst deferreds = new Set<Deferred>();\n\nlet isFocused = true;\n\nexport function pauseOrFocus(ms: number, msWhenNotFocused = ms) {\n  const deferred = new Deferred();\n\n  deferreds.add(deferred);\n\n  void deferred.promise.then(() => {\n    deferreds.delete(deferred);\n  });\n\n  void pause(isFocused ? ms : msWhenNotFocused).then(deferred.resolve);\n\n  return deferred.promise;\n}\n\nexport function setIsAppFocused(_isFocused: boolean) {\n  isFocused = _isFocused;\n\n  if (_isFocused) {\n    deferreds.forEach((d) => d.resolve());\n  }\n}\n","import type { ApiNft, ApiUpdate, OnApiUpdate } from '../types';\n\nimport { type ApiDbNft, nftRepository } from '../db';\n\nexport async function processNftUpdates(accountId: string, updates: ApiUpdate[], onUpdate: OnApiUpdate) {\n  updates.filter((update) => !(update.type === 'nftReceived' && update.nft.isHidden)).forEach(onUpdate);\n\n  for (const update of updates) {\n    if (update.type === 'nftSent') {\n      const key = [accountId, update.nftAddress];\n      await nftRepository.delete(key);\n    } else if (update.type === 'nftReceived') {\n      const dbNft = convertToDbEntity(accountId, update.nft);\n      await nftRepository.put(dbNft);\n    } else if (update.type === 'nftPutUpForSale') {\n      const key = [accountId, update.nftAddress];\n      await nftRepository.update(key, { isOnSale: true });\n    }\n  }\n}\n\nexport async function updateAccountNfts(accountId: string, nfts: ApiNft[], onUpdate: OnApiUpdate) {\n  onUpdate({\n    type: 'updateNfts',\n    accountId,\n    nfts,\n  });\n\n  const dbNfts = nfts.map((nft) => convertToDbEntity(accountId, nft));\n\n  await nftRepository.deleteWhere({ accountId });\n  await nftRepository.bulkPut(dbNfts);\n}\n\nfunction convertToDbEntity(accountId: string, nft: ApiNft): ApiDbNft {\n  return {\n    ...nft,\n    collectionAddress: nft.collectionAddress ?? '',\n    accountId,\n  };\n}\n","import type { ApiTransactionActivity } from '../types';\n\nimport { createCallbackManager } from '../../util/callbacks';\n\nexport const txCallbacks = createCallbackManager();\n\nexport function whenTxComplete(normalizedAddress: string, amount: bigint) {\n  return new Promise<{ result: boolean; transaction: ApiTransactionActivity }>((resolve) => {\n    txCallbacks.addCallback(\n      function callback(transaction: ApiTransactionActivity) {\n        if (transaction.normalizedAddress === normalizedAddress && transaction.amount === -amount) {\n          txCallbacks.removeCallback(callback);\n          resolve({ result: true, transaction });\n        }\n      },\n    );\n  });\n}\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n\nexport class EventEmitter {\n  private channels = new Map<string, CallbackManager>();\n\n  on(name: string, handler: AnyToVoidFunction) {\n    this.resolveChannel(name).addCallback(handler);\n    return this;\n  }\n\n  removeListener(name: string, handler: AnyToVoidFunction) {\n    this.resolveChannel(name).removeCallback(handler);\n    return this;\n  }\n\n  emit(name: string, ...args: any) {\n    this.resolveChannel(name).runCallbacks(...args);\n    return this;\n  }\n\n  private resolveChannel(name: string) {\n    let channel = this.channels.get(name);\n    if (!channel) {\n      channel = createCallbackManager();\n      this.channels.set(name, channel);\n    }\n\n    return channel;\n  }\n}\n","import type { ApiNetwork, ApiToken, OnApiUpdate } from '../../types';\n\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { getAccountStates } from './util/apiV3';\nimport { addTokens } from '../../common/tokens';\n\nexport async function updateTokenHashes(network: ApiNetwork, tokens: ApiToken[], onUpdate?: OnApiUpdate) {\n  const tokensToFetch = tokens.filter((token) => (\n    token.chain === 'ton'\n    && !token.codeHash\n    && ['LP', 'STAKED', 'POOL'].some((option) => token.symbol.toUpperCase().includes(option))\n  ));\n\n  if (!tokensToFetch.length) {\n    return;\n  }\n\n  const tokensByAddress = buildCollectionByKey(tokensToFetch, 'tokenAddress');\n\n  try {\n    const states = await getAccountStates(network, tokensToFetch.map((token) => token.tokenAddress!));\n\n    for (const address of Object.keys(states)) {\n      if (!tokensByAddress[address]) continue;\n      tokensByAddress[address].codeHash = Buffer.from(states[address].code_hash, 'base64').toString('hex');\n    }\n\n    await addTokens(Object.values(tokensByAddress).filter((token) => token.codeHash), onUpdate, true);\n  } catch (err) {\n    logDebugError('Failed to fetch contract code hashes for tokens', err);\n  }\n}\n","import type { ApiVestingInfo } from '../../types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\n\nexport async function fetchVestings(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const isTestnet = network === 'testnet';\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return callBackendGet<ApiVestingInfo[]>(`/vesting/${address}`, { isTestnet });\n}\n","import type {\n  ApiBalanceBySlug,\n  ApiNetwork,\n  ApiNftUpdate,\n  ApiStakingState,\n  ApiTransactionActivity,\n  ApiTxTimestamps,\n  ApiVestingInfo,\n  ApiWalletInfo,\n  OnApiUpdate,\n} from '../../types';\nimport type { TokenBalanceParsed } from './tokens';\n\nimport {\n  IS_CORE_WALLET,\n  LEDGER_WALLET_VERSIONS,\n  POPULAR_WALLET_VERSIONS,\n  TONCOIN,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { areDeepEqual } from '../../../util/areDeepEqual';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { pauseOrFocus } from '../../../util/pauseOrFocus';\nimport {\n  fetchStoredAccount, fetchStoredAccounts,\n  fetchStoredTonWallet, getActiveAccountId,\n  updateStoredTonWallet,\n} from '../../common/accounts';\nimport { getStakingCommonCache } from '../../common/cache';\nimport { isAlive, isUpdaterAlive } from '../../common/helpers';\nimport { processNftUpdates, updateAccountNfts } from '../../common/nft';\nimport { addTokens } from '../../common/tokens';\nimport { txCallbacks } from '../../common/txCallbacks';\nimport { hexToBytes } from '../../common/utils';\nimport { FIRST_TRANSACTIONS_LIMIT, SEC } from '../../constants';\nimport { AbortOperationError } from '../../errors';\nimport { getAccountNfts, getNftUpdates } from './nfts';\nimport { updateTokenHashes } from './priceless';\nimport { getBackendStakingState, getStakingStates } from './staking';\nimport { swapReplaceTransactionsByRanges } from './swap';\nimport { getAccountTokenBalances } from './tokens';\nimport { fetchTokenTransactionSlice, fixTokenActivitiesAddressForm, waitUntilTransactionAppears } from './transactions';\nimport { fetchVestings } from './vesting';\nimport { getWalletInfo, getWalletVersionInfos, isAddressInitialized } from './wallet';\n\nconst BALANCE_BASED_INTERVAL = 1.1 * SEC;\nconst BALANCE_BASED_INTERVAL_WHEN_NOT_FOCUSED = 10 * SEC;\nconst DOUBLE_CHECK_TOKENS_PAUSE = 30 * SEC;\nconst NFT_FULL_INTERVAL = 60 * SEC;\n\nconst STAKING_INTERVAL = 5 * SEC;\nconst STAKING_INTERVAL_WHEN_NOT_FOCUSED = 10 * SEC;\n\nconst VERSIONS_INTERVAL = 5 * 60 * SEC;\nconst VERSIONS_INTERVAL_WHEN_NOT_FOCUSED = 15 * 60 * SEC;\nconst VESTING_INTERVAL = 10 * SEC;\nconst VESTING_INTERVAL_WHEN_NOT_FOCUSED = 60 * SEC;\n\nconst BALANCE_NOT_ACTIVE_ACCOUNTS_INTERVAL = 30 * SEC;\nconst BALANCE_NOT_ACTIVE_ACCOUNTS_INTERVAL_WHEN_NOT_FOCUSED = 60 * SEC;\n\nconst lastBalanceCache: Record<string, ApiBalanceBySlug> = {};\n\nexport function setupPolling(accountId: string, onUpdate: OnApiUpdate, newestTxTimestamps: ApiTxTimestamps) {\n  void setupBalanceBasedPolling(accountId, onUpdate, newestTxTimestamps);\n  void setupWalletVersionsPolling(accountId, onUpdate);\n\n  if (!IS_CORE_WALLET) {\n    void setupStakingPolling(accountId, onUpdate);\n    void setupVestingPolling(accountId, onUpdate);\n  }\n}\n\nasync function setupBalanceBasedPolling(\n  accountId: string,\n  onUpdate: OnApiUpdate,\n  newestTxTimestamps: ApiTxTimestamps = {},\n) {\n  delete lastBalanceCache[accountId];\n\n  const { network } = parseAccountId(accountId);\n  // eslint-disable-next-line prefer-const\n  let { address, isInitialized } = await fetchStoredTonWallet(accountId);\n\n  let nftFromSec = Math.round(Date.now() / 1000);\n  let nftUpdates: ApiNftUpdate[];\n  let lastNftFullUpdate = 0;\n  let doubleCheckTokensTime: number | undefined;\n\n  async function updateBalance(cache: ApiBalanceBySlug, newBalances: ApiBalanceBySlug, changedSlugs: string[]) {\n    const { balance, lastTxId } = await getWalletInfo(network, address);\n    const isToncoinBalanceChanged = balance !== undefined && balance !== cache[TONCOIN.slug];\n\n    newBalances[TONCOIN.slug] = balance;\n    if (isToncoinBalanceChanged) {\n      changedSlugs.push(TONCOIN.slug);\n    }\n\n    return { lastTxId, isToncoinBalanceChanged };\n  }\n\n  async function updateNfts(isToncoinBalanceChanged: boolean) {\n    if (Date.now() - lastNftFullUpdate < NFT_FULL_INTERVAL) {\n      // Partial update\n      if (isToncoinBalanceChanged) {\n        const nftResult = await getNftUpdates(accountId, nftFromSec).catch(logAndRescue);\n\n        throwErrorIfUpdaterNotAlive(onUpdate, accountId);\n\n        if (nftResult) {\n          [nftFromSec, nftUpdates] = nftResult;\n          void processNftUpdates(accountId, nftUpdates, onUpdate);\n        }\n      }\n    } else {\n      // Full update\n      const nfts = await getAccountNfts(accountId).catch(logAndRescue);\n      lastNftFullUpdate = Date.now();\n\n      throwErrorIfUpdaterNotAlive(onUpdate, accountId);\n\n      if (nfts) {\n        nftFromSec = Math.round(Date.now() / 1000);\n        void updateAccountNfts(accountId, nfts, onUpdate);\n      }\n    }\n  }\n\n  async function updateTokenBalances(\n    isToncoinBalanceChanged: boolean,\n    cache: ApiBalanceBySlug,\n    newBalances: ApiBalanceBySlug,\n    changedSlugs: string[],\n  ) {\n    let tokenBalances: TokenBalanceParsed[] = [];\n\n    if (isToncoinBalanceChanged || (doubleCheckTokensTime && doubleCheckTokensTime < Date.now())) {\n      doubleCheckTokensTime = isToncoinBalanceChanged ? Date.now() + DOUBLE_CHECK_TOKENS_PAUSE : undefined;\n      tokenBalances = await getAccountTokenBalances(accountId);\n\n      throwErrorIfUpdaterNotAlive(onUpdate, accountId);\n\n      const tokens = tokenBalances.filter(Boolean).map(({ token }) => token);\n      await addTokens(tokens, onUpdate);\n      await updateTokenHashes(network, tokens, onUpdate);\n\n      tokenBalances.forEach(({ slug, balance: tokenBalance }) => {\n        newBalances[slug] = tokenBalance;\n        if (cache[slug] !== tokenBalance) {\n          changedSlugs.push(slug);\n        }\n      });\n    }\n\n    return tokenBalances;\n  }\n\n  async function updateActivities(\n    tokenBalances: TokenBalanceParsed[],\n    changedSlugs: string[],\n    lastTxId?: string,\n  ) {\n    if (changedSlugs.length) {\n      if (lastTxId) {\n        await waitUntilTransactionAppears(network, address, lastTxId);\n      }\n\n      const changedTokenSlugs = changedSlugs.filter((slug) => slug !== TONCOIN.slug);\n      const newTxTimestamps = await processNewActivities(\n        accountId, newestTxTimestamps, changedTokenSlugs, onUpdate, tokenBalances,\n      );\n      newestTxTimestamps = { ...newestTxTimestamps, ...newTxTimestamps };\n    }\n\n    onUpdate({ type: 'updatingStatus', kind: 'activities', isUpdating: false });\n  }\n\n  while (isAlive(onUpdate, accountId)) {\n    try {\n      onUpdate({ type: 'updatingStatus', kind: 'activities', isUpdating: true });\n      onUpdate({ type: 'updatingStatus', kind: 'balance', isUpdating: true });\n\n      const newBalances: ApiBalanceBySlug = {};\n      const changedSlugs: string[] = [];\n      const cache = lastBalanceCache[accountId] ?? {};\n\n      const {\n        lastTxId,\n        isToncoinBalanceChanged,\n      } = await updateBalance(cache, newBalances, changedSlugs);\n\n      throwErrorIfUpdaterNotAlive(onUpdate, accountId);\n\n      const tokenBalances = await updateTokenBalances(isToncoinBalanceChanged, cache, newBalances, changedSlugs);\n\n      lastBalanceCache[accountId] = newBalances;\n\n      if (changedSlugs.length) {\n        onUpdate({\n          type: 'updateBalances',\n          accountId,\n          chain: 'ton',\n          balances: newBalances,\n        });\n      }\n\n      onUpdate({ type: 'updatingStatus', kind: 'balance', isUpdating: false });\n\n      await Promise.all([\n        updateActivities(tokenBalances, changedSlugs, lastTxId),\n        updateNfts(isToncoinBalanceChanged),\n      ]);\n\n      if (isToncoinBalanceChanged && !isInitialized && await isAddressInitialized(network, address)) {\n        isInitialized = true;\n        await updateStoredTonWallet(accountId, { isInitialized });\n      }\n    } catch (err) {\n      if (err instanceof AbortOperationError) {\n        return;\n      }\n      logDebugError('setupBalanceBasedPolling', err);\n    }\n\n    await pauseOrFocus(BALANCE_BASED_INTERVAL, BALANCE_BASED_INTERVAL_WHEN_NOT_FOCUSED);\n  }\n}\n\nfunction throwErrorIfUpdaterNotAlive(onUpdate: OnApiUpdate, accountId: string) {\n  if (!isAlive(onUpdate, accountId)) {\n    throw new AbortOperationError();\n  }\n}\n\nasync function setupStakingPolling(accountId: string, onUpdate: OnApiUpdate) {\n  const { network } = parseAccountId(accountId);\n\n  if (network !== 'mainnet') {\n    return;\n  }\n\n  let lastStates: ApiStakingState[] | undefined;\n\n  while (isAlive(onUpdate, accountId)) {\n    try {\n      const common = getStakingCommonCache();\n      const backendState = await getBackendStakingState(accountId);\n      const { shouldUseNominators, totalProfit } = backendState;\n      const states = await getStakingStates(accountId, common, backendState);\n\n      if (!isAlive(onUpdate, accountId)) return;\n\n      if (!areDeepEqual(states, lastStates)) {\n        lastStates = states;\n        onUpdate({\n          type: 'updateStaking',\n          accountId,\n          states,\n          common,\n          totalProfit,\n          shouldUseNominators,\n        });\n      }\n    } catch (err) {\n      logDebugError('setupStakingPolling', err);\n    }\n\n    await pauseOrFocus(STAKING_INTERVAL, STAKING_INTERVAL_WHEN_NOT_FOCUSED);\n  }\n}\n\nasync function processNewActivities(\n  accountId: string,\n  newestTxTimestamps: ApiTxTimestamps,\n  tokenSlugs: string[],\n  onUpdate: OnApiUpdate,\n  tokenBalances?: TokenBalanceParsed[],\n): Promise<ApiTxTimestamps> {\n  const { network } = parseAccountId(accountId);\n\n  const chunks: ApiTransactionActivity[][] = [];\n  const result: ApiTxTimestamps = {};\n\n  // Process TON transactions first\n  {\n    const slug = TONCOIN.slug;\n    let newestTxTimestamp = newestTxTimestamps[slug];\n\n    const transactions = await fetchTokenTransactionSlice(\n      accountId, slug, undefined, newestTxTimestamp, FIRST_TRANSACTIONS_LIMIT,\n    );\n\n    if (transactions.length) {\n      newestTxTimestamp = transactions[0]!.timestamp;\n      chunks.push(transactions);\n    }\n\n    result[slug] = newestTxTimestamp;\n\n    // Find affected token wallets\n    const tokenBalanceByAddress = buildCollectionByKey(tokenBalances ?? [], 'jettonWallet');\n    transactions.forEach(({ isIncoming, toAddress, fromAddress }) => {\n      const address = isIncoming ? fromAddress : toAddress;\n      const tokenBalance: TokenBalanceParsed | undefined = tokenBalanceByAddress[address];\n\n      if (tokenBalance && !tokenSlugs.includes(tokenBalance.slug)) {\n        tokenSlugs = tokenSlugs.concat([tokenBalance.slug]);\n      }\n    });\n  }\n\n  // Process token transactions\n  await Promise.all(tokenSlugs.map(async (slug) => {\n    let newestTxTimestamp = newestTxTimestamps[slug];\n\n    const transactions = await fetchTokenTransactionSlice(\n      accountId, slug, undefined, newestTxTimestamp, FIRST_TRANSACTIONS_LIMIT,\n    );\n\n    if (transactions.length) {\n      newestTxTimestamp = transactions[0]!.timestamp;\n      chunks.push(transactions);\n    }\n\n    result[slug] = newestTxTimestamp;\n  }));\n\n  const allTransactions = chunks.flat().sort(compareActivities);\n\n  const isFirstRun = !Object.values(newestTxTimestamps).some(Boolean);\n  const activities = await swapReplaceTransactionsByRanges(accountId, allTransactions, chunks, isFirstRun);\n\n  allTransactions.slice().reverse().forEach((transaction) => {\n    txCallbacks.runCallbacks(transaction);\n  });\n\n  await fixTokenActivitiesAddressForm(network, activities);\n\n  activities.sort(compareActivities);\n\n  onUpdate({\n    type: 'newActivities',\n    chain: 'ton',\n    activities,\n    accountId,\n  });\n\n  return result;\n}\n\nfunction logAndRescue(err: Error) {\n  logDebugError('Polling error', err);\n\n  return undefined;\n}\n\nasync function setupWalletVersionsPolling(accountId: string, onUpdate: OnApiUpdate) {\n  const account = await fetchStoredAccount(accountId);\n\n  if (account.type === 'bip39') {\n    return;\n  }\n\n  const isLedger = account.type === 'ledger';\n  const { publicKey, version } = account.ton;\n  const publicKeyBytes = hexToBytes(publicKey);\n  const { network } = parseAccountId(accountId);\n\n  const versions = (isLedger ? LEDGER_WALLET_VERSIONS : POPULAR_WALLET_VERSIONS)\n    .filter((value) => value !== version);\n  let lastResult: ApiWalletInfo[] | undefined;\n\n  while (isAlive(onUpdate, accountId)) {\n    try {\n      const versionInfos = (await getWalletVersionInfos(\n        network, publicKeyBytes, versions,\n      )).filter((versionInfo) => !!versionInfo.lastTxId || versionInfo.version === 'W5');\n\n      const filteredVersions = versionInfos.map(({ wallet, ...rest }) => rest);\n\n      if (!isAlive(onUpdate, accountId)) return;\n\n      if (!areDeepEqual(versionInfos, lastResult)) {\n        lastResult = versionInfos;\n        onUpdate({\n          type: 'updateWalletVersions',\n          accountId,\n          currentVersion: version,\n          versions: filteredVersions,\n        });\n      }\n    } catch (err) {\n      logDebugError('setupWalletVersionsPolling', err);\n    }\n\n    await pauseOrFocus(VERSIONS_INTERVAL, VERSIONS_INTERVAL_WHEN_NOT_FOCUSED);\n  }\n}\n\nasync function setupVestingPolling(accountId: string, onUpdate: OnApiUpdate) {\n  let lastVestingInfo: ApiVestingInfo[] | undefined;\n\n  while (isAlive(onUpdate, accountId)) {\n    try {\n      const vestingInfo = await fetchVestings(accountId);\n\n      if (!isAlive(onUpdate, accountId)) return;\n      if (!areDeepEqual(lastVestingInfo, vestingInfo)) {\n        lastVestingInfo = vestingInfo;\n        onUpdate({\n          type: 'updateVesting',\n          accountId,\n          vestingInfo,\n        });\n      }\n    } catch (err) {\n      logDebugError('setupVestingPolling', err);\n    }\n\n    await pauseOrFocus(VESTING_INTERVAL, VESTING_INTERVAL_WHEN_NOT_FOCUSED);\n  }\n}\n\nexport async function setupInactiveAccountsBalancePolling(onUpdate: OnApiUpdate) {\n  interface BalancePollingAccount {\n    id: string;\n    network: ApiNetwork;\n    address: string;\n  }\n  let addressToAccountsMap: { [address: string]: BalancePollingAccount[] } = {};\n  let activeAccountId: string | undefined;\n\n  const localOnUpdate = onUpdate;\n\n  async function updateAddressToAccountsMap() {\n    const accountsById = await fetchStoredAccounts();\n    addressToAccountsMap = {};\n\n    Object.entries(accountsById)\n      .filter(([id]) => id !== activeAccountId)\n      .forEach(([accountId, account]) => {\n        const { network } = parseAccountId(accountId);\n        const { address } = account.ton;\n\n        const balancePollingAccount: BalancePollingAccount = {\n          id: accountId,\n          network,\n          address,\n        };\n\n        if (!addressToAccountsMap[address]) {\n          addressToAccountsMap[address] = [];\n        }\n        addressToAccountsMap[address].push(balancePollingAccount);\n      });\n  }\n\n  async function updateBalance(\n    account: BalancePollingAccount,\n    cache: ApiBalanceBySlug,\n    newBalances: ApiBalanceBySlug,\n    changedSlugs: string[],\n  ) {\n    const { balance, lastTxId } = await getWalletInfo(account.network, account.address);\n    const isToncoinBalanceChanged = balance !== undefined && balance !== cache[TONCOIN.slug];\n    newBalances[TONCOIN.slug] = balance;\n\n    if (isToncoinBalanceChanged) {\n      changedSlugs.push(TONCOIN.slug);\n    }\n\n    return { lastTxId, isToncoinBalanceChanged };\n  }\n\n  async function updateTokenBalances(\n    account: BalancePollingAccount,\n    cache: ApiBalanceBySlug,\n    newBalances: ApiBalanceBySlug,\n    changedSlugs: string[],\n  ) {\n    const tokenBalances = await getAccountTokenBalances(account.id);\n\n    if (!activeAccountId) {\n      throw new AbortOperationError();\n    }\n    throwErrorIfUpdaterNotAlive(localOnUpdate, activeAccountId);\n\n    if (!tokenBalances) {\n      return;\n    }\n\n    const tokens = tokenBalances.filter(Boolean).map(({ token }) => token);\n    await addTokens(tokens, onUpdate);\n    await updateTokenHashes(account.network, tokens, onUpdate);\n\n    tokenBalances.forEach(({ slug, balance: tokenBalance }) => {\n      newBalances[slug] = tokenBalance;\n      if (cache[slug] !== tokenBalance) {\n        changedSlugs.push(slug);\n      }\n    });\n  }\n\n  while (isUpdaterAlive(localOnUpdate)) {\n    try {\n      activeAccountId = getActiveAccountId();\n      await updateAddressToAccountsMap();\n      for (const address of Object.keys(addressToAccountsMap)) {\n        const account = addressToAccountsMap[address][0];\n        const cache = lastBalanceCache[account.id] ?? {};\n        const newBalances: ApiBalanceBySlug = {};\n        const changedSlugs: string[] = [];\n\n        const { isToncoinBalanceChanged } = await updateBalance(account, cache, newBalances, changedSlugs);\n\n        if (isUpdaterAlive(localOnUpdate) && isToncoinBalanceChanged) {\n          await updateTokenBalances(account, cache, newBalances, changedSlugs);\n\n          lastBalanceCache[account.id] = newBalances;\n\n          if (changedSlugs.length) {\n            // Notify all accounts with the same address\n            addressToAccountsMap[account.address].forEach((acc) => {\n              onUpdate({\n                type: 'updateBalances',\n                accountId: acc.id,\n                chain: 'ton',\n                balances: newBalances,\n              });\n            });\n          }\n        }\n      }\n    } catch (err) {\n      if (err instanceof AbortOperationError) {\n        break;\n      }\n      logDebugError('setupBalancesPolling', err);\n    }\n\n    await pauseOrFocus(BALANCE_NOT_ACTIVE_ACCOUNTS_INTERVAL, BALANCE_NOT_ACTIVE_ACCOUNTS_INTERVAL_WHEN_NOT_FOCUSED);\n  }\n}\n","import { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork } from '../../../types';\n\nimport { getChainConfig } from '../../../../util/chain';\n\nlet clientByNetwork: Record<ApiNetwork, TronWeb> | undefined;\n\nconst parametersByNetwork: {\n  [network in ApiNetwork]?: {\n    energyUnitFee: number;\n    bandwidthUnitFee: number;\n  }\n} = {};\n\nconst chainConfig = getChainConfig('tron');\n\nexport function getTronClient(network: ApiNetwork = 'mainnet') {\n  if (!clientByNetwork) {\n    clientByNetwork = {\n      mainnet: new TronWeb({\n        fullHost: chainConfig.mainnet.apiUrl,\n      }),\n      testnet: new TronWeb({\n        fullHost: chainConfig.testnet.apiUrl,\n      }),\n    };\n  }\n\n  return clientByNetwork[network];\n}\n\nexport async function getChainParameters(network: ApiNetwork) {\n  if (!(network in parametersByNetwork)) {\n    const chainParameters = await getTronClient(network).trx.getChainParameters();\n    const energyUnitFee = chainParameters.find((param) => param.key === 'getEnergyFee')!.value;\n    const bandwidthUnitFee = chainParameters.find((param) => param.key === 'getTransactionFee')!.value;\n    parametersByNetwork[network] = { energyUnitFee, bandwidthUnitFee };\n  }\n\n  return parametersByNetwork[network]!;\n}\n","import { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork, ApiTransactionActivity } from '../../types';\n\nimport { TRX } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getChainConfig } from '../../../util/chain';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { fetchJson } from '../../../util/fetch';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { fetchStoredTronWallet } from '../../common/accounts';\nimport { buildTokenSlug, getTokenBySlug } from '../../common/tokens';\n\nexport async function getTokenTransactionSlice(\n  accountId: string,\n  slug: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTronWallet(accountId);\n\n  if (slug === TRX.slug) {\n    const rawTransactions = await getTrxTransactions(network, address, {\n      min_timestamp: fromTimestamp ? fromTimestamp + 1000 : undefined,\n      max_timestamp: toTimestamp ? toTimestamp - 1000 : undefined,\n      limit,\n    });\n    return rawTransactions.map((rawTx) => parseRawTrxTransaction(address, rawTx)).filter(Boolean);\n  } else {\n    const { tokenAddress } = getTokenBySlug(slug);\n    const rawTransactions = await getTrc20Transactions(network, address, {\n      contract_address: tokenAddress,\n      min_timestamp: fromTimestamp ? fromTimestamp + 1000 : undefined,\n      max_timestamp: toTimestamp ? toTimestamp - 1000 : undefined,\n      limit,\n    });\n    return rawTransactions.map((rawTx) => parseRawTrc20Transaction(address, rawTx));\n  }\n}\n\nexport async function getAllTransactionSlice(\n  accountId: string,\n  toTimestamp: number,\n  limit: number,\n  tokenSlugs: string[],\n) {\n  const chunks = (await Promise.all([\n    getTokenTransactionSlice(accountId, TRX.slug, toTimestamp, undefined, limit),\n    ...tokenSlugs.map((slug) => getTokenTransactionSlice(\n      accountId, slug, toTimestamp, undefined, limit,\n    )),\n  ])).filter((chunk) => chunk.length);\n\n  if (!chunks.length) {\n    return [];\n  }\n\n  // TODO ,     \" \",          .\n  //         .\n  const mainChunk = chunks.reduce((prevChunk, chunk) => {\n    if (prevChunk.length > chunk.length) return prevChunk;\n    if (prevChunk.length < chunk.length) return chunk;\n    if (prevChunk[prevChunk.length - 1].timestamp < chunk[chunk.length - 1].timestamp) return chunk;\n    return prevChunk;\n  }, [] as ApiTransactionActivity[]);\n\n  const fromTimestamp = mainChunk[mainChunk.length - 1].timestamp;\n\n  const [trxChunk, ...tokenChunks] = chunks;\n\n  return mergeTransactions(trxChunk, tokenChunks.flat())\n    .flat()\n    .filter(({ timestamp }) => timestamp >= fromTimestamp)\n    .sort(compareActivities);\n}\n\nasync function getTrxTransactions(\n  network: ApiNetwork,\n  address: string,\n  queryParams: {\n    only_confirmed?: boolean;\n    only_unconfirmed?: boolean;\n    only_to?: boolean;\n    only_from?: boolean;\n    limit?: number;\n    fingerprint?: string;\n    order_by?: 'block_timestamp,asc' | 'block_timestamp,desc';\n    min_timestamp?: number;\n    max_timestamp?: number;\n    search_internal?: boolean;\n  } = {},\n): Promise<any[]> {\n  const baseUrl = getChainConfig('tron')[network].apiUrl;\n  const url = new URL(`${baseUrl}/v1/accounts/${address}/transactions`);\n\n  const result = await fetchJson(url.toString(), queryParams);\n\n  return result.data;\n}\n\nfunction parseRawTrxTransaction(address: string, rawTx: any): ApiTransactionActivity | undefined {\n  const {\n    raw_data: rawData,\n    txID: txId,\n    energy_fee: energyFee,\n    net_fee: netFee,\n    block_timestamp: timestamp,\n  } = rawTx;\n\n  const amount = BigInt(rawData.contract[0].parameter.value.amount ?? 0);\n  const fromAddress = TronWeb.address.fromHex(rawData.contract[0].parameter.value.owner_address);\n  const toAddress = TronWeb.address.fromHex(rawData.contract[0].parameter.value.to_address!);\n\n  const slug = TRX.slug;\n  const isIncoming = toAddress === address;\n  const normalizedAddress = isIncoming ? fromAddress : toAddress;\n  const fee = BigInt(energyFee + netFee);\n  const shouldHide = rawData.contract[0].type === 'TransferAssetContract';\n\n  return {\n    id: txId,\n    kind: 'transaction',\n    txId,\n    timestamp,\n    fromAddress,\n    toAddress,\n    amount: isIncoming ? amount : -amount,\n    slug,\n    isIncoming,\n    normalizedAddress,\n    fee,\n    shouldHide,\n  };\n}\n\nasync function getTrc20Transactions(\n  network: ApiNetwork,\n  address: string,\n  queryParams: {\n    only_confirmed?: boolean;\n    only_unconfirmed?: boolean;\n    limit?: number;\n    fingerprint?: string;\n    order_by?: 'block_timestamp,asc' | 'block_timestamp,desc';\n    min_timestamp?: number;\n    max_timestamp?: number;\n    contract_address?: string;\n    only_to?: boolean;\n    only_from?: boolean;\n  } = {},\n): Promise<any[]> {\n  const baseUrl = getChainConfig('tron')[network].apiUrl;\n  const url = new URL(`${baseUrl}/v1/accounts/${address}/transactions/trc20`);\n\n  const result = await fetchJson(url.toString(), queryParams);\n\n  return result.data;\n}\n\nfunction parseRawTrc20Transaction(address: string, rawTx: any): ApiTransactionActivity {\n  const {\n    transaction_id: txId,\n    block_timestamp: timestamp,\n    from: fromAddress,\n    to: toAddress,\n    value,\n    token_info: tokenInfo,\n  } = rawTx;\n\n  const amount = BigInt(value);\n  const slug = buildTokenSlug(TRX.chain, tokenInfo.address);\n  const isIncoming = toAddress === address;\n  const normalizedAddress = isIncoming ? fromAddress : toAddress;\n  const fee = 0n;\n\n  return {\n    id: txId,\n    kind: 'transaction',\n    txId,\n    timestamp,\n    fromAddress,\n    toAddress,\n    amount: isIncoming ? amount : -amount,\n    slug,\n    isIncoming,\n    normalizedAddress,\n    fee,\n  };\n}\n\nexport function mergeTransactions(trxTxs: ApiTransactionActivity[], tokenTxs: ApiTransactionActivity[]) {\n  const tokenTxById = buildCollectionByKey(tokenTxs, 'id');\n  const trxTxsCleared: ApiTransactionActivity[] = [];\n\n  for (const tx of trxTxs) {\n    const tokenTx = tokenTxById[tx.id];\n    if (tx.toAddress) {\n      trxTxsCleared.push(tx);\n    } else if (tokenTx) {\n      tokenTx.fee = tx.fee;\n    }\n  }\n\n  return [trxTxsCleared, tokenTxs];\n}\n","import type { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { logDebugError } from '../../../util/logs';\nimport { getTronClient } from './util/tronweb';\n\nexport async function getWalletBalance(network: ApiNetwork, address: string) {\n  const tronWeb = getTronClient(network);\n  return BigInt(await tronWeb.trx.getBalance(address));\n}\n\nexport async function getTrc20Balance(network: ApiNetwork, tokenAddress: string, address: string) {\n  const result = await callContract(getTronClient(network), tokenAddress, 'balanceOf(address)', [\n    { type: 'address', value: address },\n  ], address);\n\n  if (!result.length) {\n    return 0n;\n  }\n\n  return BigInt(`0x${result[0]}`);\n}\n\nexport async function callContract(\n  tronWeb: TronWeb,\n  address: string,\n  functions: string,\n  parameters: any[] = [],\n  issuerAddress: string,\n) {\n  try {\n    const result = await tronWeb.transactionBuilder.triggerSmartContract(\n      address,\n      functions,\n      { _isConstant: true },\n      parameters,\n      issuerAddress,\n    );\n    return result && result.result ? result.constant_result : [];\n  } catch (err: any) {\n    logDebugError('callContract', err);\n    return [];\n  }\n}\n","import type { ApiTxTimestamps, OnApiUpdate } from '../../types';\n\nimport { TRX } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getChainConfig } from '../../../util/chain';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { logDebugError } from '../../../util/logs';\nimport { pauseOrFocus } from '../../../util/pauseOrFocus';\nimport { fetchStoredTronWallet } from '../../common/accounts';\nimport { isAlive } from '../../common/helpers';\nimport { buildTokenSlug } from '../../common/tokens';\nimport { txCallbacks } from '../../common/txCallbacks';\nimport { FIRST_TRANSACTIONS_LIMIT, SEC } from '../../constants';\nimport { getTokenTransactionSlice, mergeTransactions } from './transactions';\nimport { getTrc20Balance, getWalletBalance } from './wallet';\n\nconst BALANCE_INTERVAL = 1.1 * SEC;\nconst BALANCE_INTERVAL_WHEN_NOT_FOCUSED = 10 * SEC;\n\nexport async function setupPolling(accountId: string, onUpdate: OnApiUpdate, newestTxTimestamps: ApiTxTimestamps) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTronWallet(accountId);\n\n  const { usdtAddress } = getChainConfig('tron')[network];\n  const usdtSlug = buildTokenSlug('tron', usdtAddress);\n  const slugs = [TRX.slug, usdtSlug];\n\n  let lastTrxBalance: bigint | undefined;\n  let lastUsdtBalance: bigint | undefined;\n\n  while (isAlive(onUpdate, accountId)) {\n    try {\n      const [trxBalance, usdtBalance] = await Promise.all([\n        getWalletBalance(network, address),\n        getTrc20Balance(network, usdtAddress, address),\n      ]);\n\n      if (trxBalance !== lastTrxBalance || usdtBalance !== lastUsdtBalance) {\n        onUpdate({\n          type: 'updateBalances',\n          accountId,\n          chain: 'tron',\n          balances: {\n            [TRX.slug]: trxBalance,\n            [usdtSlug]: usdtBalance,\n          },\n        });\n\n        newestTxTimestamps = await processNewActivities(accountId, newestTxTimestamps, slugs, onUpdate);\n        lastTrxBalance = trxBalance;\n        lastUsdtBalance = usdtBalance;\n      }\n    } catch (err) {\n      logDebugError('tron:setupPolling', err);\n    }\n\n    await pauseOrFocus(BALANCE_INTERVAL, BALANCE_INTERVAL_WHEN_NOT_FOCUSED);\n  }\n}\n\nasync function processNewActivities(\n  accountId: string,\n  newestTxTimestamps: ApiTxTimestamps,\n  tokenSlugs: string[],\n  onUpdate: OnApiUpdate,\n) {\n  const result: ApiTxTimestamps = {};\n\n  const chunks = await Promise.all(tokenSlugs.map(async (slug) => {\n    let newestTxTimestamp = newestTxTimestamps[slug];\n    const transactions = await getTokenTransactionSlice(\n      accountId, slug, undefined, newestTxTimestamp, FIRST_TRANSACTIONS_LIMIT,\n    );\n    if (transactions.length) {\n      newestTxTimestamp = transactions[0]!.timestamp;\n    }\n    result[slug] = newestTxTimestamp;\n    return transactions;\n  }));\n\n  const [trxChunk, ...tokenChunks] = chunks;\n  const transactions = mergeTransactions(trxChunk, tokenChunks.flat())\n    .flat()\n    .sort(compareActivities);\n\n  transactions.slice().reverse().forEach((transaction) => {\n    txCallbacks.runCallbacks(transaction);\n  });\n\n  onUpdate({\n    type: 'newActivities',\n    chain: 'tron',\n    activities: transactions,\n    accountId,\n  });\n\n  return result;\n}\n","export const TRON_GAS = {\n  transferTrc20Estimated: 28_214_970n,\n};\n\nexport const ONE_TRX = 1_000_000n;\n","// Importing from `tronweb/lib/commonjs/types` breaks eslint (eslint doesn't like any of import placement options)\n// eslint-disable-next-line simple-import-sort/imports\nimport type { TronWeb } from 'tronweb';\n\nimport type { ApiSubmitTransferOptions, CheckTransactionDraftOptions } from '../../methods/types';\nimport type { ApiCheckTransactionDraftResult } from '../ton/types';\nimport { ApiTransactionDraftError, ApiTransactionError } from '../../types';\nimport type { ApiAccountWithMnemonic, ApiBip39Account, ApiNetwork } from '../../types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { logDebugError } from '../../../util/logs';\nimport { getChainParameters, getTronClient } from './util/tronweb';\nimport { fetchStoredAccount, fetchStoredTronWallet } from '../../common/accounts';\nimport { getMnemonic } from '../../common/mnemonic';\nimport { handleServerError } from '../../errors';\nimport { getTrc20Balance, getWalletBalance } from './wallet';\nimport type { ApiSubmitTransferTronResult } from './types';\nimport { hexToString } from '../../../util/stringFormat';\nimport { ONE_TRX, TRON_GAS } from './constants';\n\nconst SIGNATURE_SIZE = 65;\n\nexport async function checkTransactionDraft(\n  options: CheckTransactionDraftOptions,\n): Promise<ApiCheckTransactionDraftResult> {\n  const {\n    accountId, amount, toAddress, tokenAddress,\n  } = options;\n  const { network } = parseAccountId(accountId);\n\n  const tronWeb = getTronClient(network);\n  const result: ApiCheckTransactionDraftResult = {};\n\n  try {\n    if (!tronWeb.isAddress(toAddress)) {\n      return { error: ApiTransactionDraftError.InvalidToAddress };\n    }\n\n    result.resolvedAddress = toAddress;\n\n    const { address } = await fetchStoredTronWallet(accountId);\n    const [trxBalance, bandwidth, { energyUnitFee, bandwidthUnitFee }] = await Promise.all([\n      getWalletBalance(network, address),\n      tronWeb.trx.getBandwidth(address),\n      getChainParameters(network),\n    ]);\n\n    let fee: bigint;\n\n    if (tokenAddress) {\n      fee = await estimateTrc20TransferFee(tronWeb, {\n        network,\n        toAddress,\n        tokenAddress,\n        amount,\n        energyUnitFee,\n        fromAddress: address,\n      });\n    } else {\n      // This call throws \"Error: Invalid amount provided\" when the amount is 0.\n      // It doesn't throw when the amount is > than the balance.\n      const [transaction, account] = await Promise.all([\n        tronWeb.transactionBuilder.sendTrx(toAddress, Number(amount ?? 1), address),\n        tronWeb.trx.getAccount(toAddress),\n      ]);\n\n      const size = 9 + 60 + Buffer.from(transaction.raw_data_hex, 'hex').byteLength + SIGNATURE_SIZE;\n      fee = bandwidth > size ? 0n : BigInt(size) * BigInt(bandwidthUnitFee);\n\n      // If the account is not activated, we pay an extra 1 TRX for activation\n      if (account.balance === undefined) {\n        fee += ONE_TRX;\n      }\n    }\n\n    result.fee = fee;\n    result.realFee = fee;\n\n    const trxAmount = tokenAddress ? fee : (amount ?? 0n) + fee;\n    const isEnoughTrx = trxBalance >= trxAmount;\n\n    if (!isEnoughTrx) {\n      result.error = ApiTransactionDraftError.InsufficientBalance;\n    }\n\n    // todo: Check that the amount  the token balance (in case of a token transfer)\n\n    return result;\n  } catch (err) {\n    logDebugError('tron:checkTransactionDraft', err);\n    return {\n      ...handleServerError(err),\n      ...result,\n    };\n  }\n}\n\nexport async function submitTransfer(options: ApiSubmitTransferOptions): Promise<ApiSubmitTransferTronResult> {\n  const {\n    accountId, password, toAddress, amount, fee = 0n, tokenAddress,\n  } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const tronWeb = getTronClient(network);\n\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const { address } = (account as ApiBip39Account).tron;\n    const trxBalance = await getWalletBalance(network, address);\n\n    const trxAmount = tokenAddress ? fee : fee + amount;\n    const isEnoughTrx = trxBalance >= trxAmount;\n\n    if (!isEnoughTrx) {\n      return { error: ApiTransactionError.InsufficientBalance };\n    }\n\n    // todo: Check that the amount  the token balance (in case of a token transfer)\n\n    const mnemonic = await getMnemonic(accountId, password, account);\n    const privateKey = tronWeb.fromMnemonic(mnemonic!.join(' ')).privateKey.slice(2);\n\n    if (tokenAddress) {\n      const { transaction } = await buildTrc20Transfer(tronWeb, {\n        toAddress, tokenAddress, amount, feeLimit: fee, fromAddress: address,\n      });\n\n      const signedTx = await tronWeb.trx.sign(transaction, privateKey);\n      const result = await tronWeb.trx.sendRawTransaction(signedTx);\n\n      return { amount, toAddress, txId: result.transaction.txID };\n    } else {\n      const result = await tronWeb.trx.sendTransaction(toAddress, Number(amount), {\n        privateKey,\n      });\n\n      if ('code' in result && !('result' in result && result.result)) {\n        const error = 'message' in result && result.message\n          ? hexToString(result.message)\n          : result.code.toString();\n\n        logDebugError('submitTransfer', { error, result });\n\n        return { error };\n      }\n\n      return { amount, toAddress, txId: result.transaction.txID };\n    }\n  } catch (err: any) {\n    logDebugError('submitTransfer', err);\n    return { error: ApiTransactionError.UnsuccesfulTransfer };\n  }\n}\n\nasync function estimateTrc20TransferFee(tronWeb: TronWeb, options: {\n  network: ApiNetwork;\n  tokenAddress: string;\n  toAddress: string;\n  amount?: bigint;\n  energyUnitFee: number;\n  fromAddress: string;\n}) {\n  const {\n    network, tokenAddress, toAddress, energyUnitFee, fromAddress,\n  } = options;\n\n  let { amount } = options;\n  const tokenBalance = await getTrc20Balance(network, tokenAddress, fromAddress);\n\n  if (!tokenBalance) {\n    return TRON_GAS.transferTrc20Estimated;\n  }\n\n  if (amount === undefined || amount > tokenBalance) {\n    amount = 1n;\n  }\n\n  // This call throws \"Error: REVERT opcode executed\" when the given amount is more than the token balance.\n  // It doesn't throw when the amount is 0.\n  const { energy_required: energyRequired } = await tronWeb.transactionBuilder.estimateEnergy(\n    tokenAddress,\n    'transfer(address,uint256)',\n    {},\n    [\n      { type: 'address', value: toAddress },\n      { type: 'uint256', value: Number(amount) },\n    ],\n    fromAddress,\n  );\n\n  return BigInt(energyUnitFee * energyRequired);\n}\n\nasync function buildTrc20Transfer(tronWeb: TronWeb, options: {\n  tokenAddress: string;\n  toAddress: string;\n  amount: bigint;\n  feeLimit: bigint;\n  fromAddress: string;\n}) {\n  const {\n    amount, tokenAddress, toAddress, feeLimit, fromAddress,\n  } = options;\n\n  const { transaction } = await tronWeb.transactionBuilder.triggerSmartContract(\n    tokenAddress,\n    'transfer(address,uint256)',\n    { feeLimit: Number(feeLimit) },\n    [\n      { type: 'address', value: toAddress },\n      { type: 'uint256', value: Number(amount) },\n    ],\n    fromAddress,\n  );\n\n  return { transaction };\n}\n","export function isAscii(str: string) {\n  for (let i = 0; i < str.length; i++) {\n    if (str.charCodeAt(i) > 127) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function insertSubstring(str: string, start: number, newSubStr: string) {\n  if (start < 0) {\n    start = str.length - start;\n  }\n  return str.slice(0, start) + newSubStr + str.slice(start);\n}\n\nexport function hexToString(hex: string): string {\n  let result = '';\n  for (let i = 0; i < hex.length; i += 2) {\n    result += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));\n  }\n\n  return result;\n}\n","import type { ApiNetwork, ApiTronWallet } from '../../types';\n\nimport { getTronClient } from './util/tronweb';\n\nexport { setupPolling } from './polling';\nexport { checkTransactionDraft, submitTransfer } from './transfer';\nexport { getWalletBalance } from './wallet';\nexport { getAllTransactionSlice, getTokenTransactionSlice } from './transactions';\n\nexport function getWalletFromBip39Mnemonic(network: ApiNetwork, mnemonic: string[]): ApiTronWallet {\n  const { address, publicKey } = getTronClient(network).fromMnemonic(mnemonic.join(' '));\n  return {\n    type: 'tron',\n    address,\n    publicKey,\n    index: 0,\n  };\n}\n\nexport function checkApiAvailability(network: ApiNetwork) {\n  const isConnected = getTronClient(network).isConnected();\n  return Boolean(isConnected);\n}\n","import * as ton from './ton';\nimport * as tron from './tron';\n\nexport default {\n  ton,\n  tron,\n};\n","import { logDebugError } from '../util/logs';\n\ninterface Hooks {\n  onFirstLogin: AnyFunction;\n  onFullLogout: AnyFunction;\n  onWindowNeeded: AnyFunction;\n  onDappDisconnected: (accountId: string, origin: string) => any;\n  onDappsChanged: AnyFunction;\n  onSwapCreated: (accountId: string, fromTimestamp: number) => any;\n}\n\nconst hooks: Partial<{\n  [K in keyof Hooks]: Hooks[K][];\n}> = {};\n\nexport function addHooks(partial: Partial<Hooks>) {\n  for (const [name, hook] of Object.entries(partial) as Entries<Hooks>) {\n    hooks[name] = (hooks[name] ?? []).concat([hook]);\n  }\n}\n\nexport async function callHook<T extends keyof Hooks>(name: T, ...args: Parameters<Hooks[T]>) {\n  for (const hook of hooks[name] ?? []) {\n    try {\n      // @ts-ignore\n      await hook(...args);\n    } catch (err) {\n      logDebugError(`callHooks:${name}`, err);\n    }\n  }\n}\n","import type {\n  ApiDapp, ApiDappsState, ApiNetwork, ApiSite, ApiSiteCategory, OnApiUpdate,\n} from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport {\n  getAccountValue, removeAccountValue, removeNetworkAccountsValue, setAccountValue,\n} from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { callHook } from '../hooks';\nimport { storage } from '../storages';\n\nconst activeDappByAccountId: Record<string, string> = {};\n\nlet onUpdate: OnApiUpdate;\n\nexport function initDapps(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport function onActiveDappAccountUpdated(accountId: string) {\n  const activeDappOrigin = getActiveDapp(accountId);\n\n  onUpdate({\n    type: 'updateActiveDapp',\n    accountId,\n    origin: activeDappOrigin,\n  });\n}\n\nexport function activateDapp(accountId: string, origin: string) {\n  const oldAccountId = findActiveDappAccount(origin);\n  activeDappByAccountId[accountId] = origin;\n\n  // The method can be called in headless mode (tonConnect:reconnect)\n  if (!onUpdate || !isUpdaterAlive(onUpdate)) {\n    return;\n  }\n\n  if (oldAccountId) {\n    onUpdate({\n      type: 'updateActiveDapp',\n      accountId: oldAccountId,\n    });\n  }\n\n  onUpdate({\n    type: 'updateActiveDapp',\n    accountId,\n    origin,\n  });\n}\n\nexport function getActiveDapp(accountId: string) {\n  return activeDappByAccountId[accountId];\n}\n\nexport function deactivateDapp(origin: string) {\n  const accountId = findActiveDappAccount(origin);\n  if (!accountId) {\n    return false;\n  }\n\n  deactivateAccountDapp(accountId);\n\n  return true;\n}\n\nexport function findActiveDappAccount(origin: string) {\n  return Object.keys(activeDappByAccountId).find((acc) => origin === activeDappByAccountId[acc]);\n}\n\nexport function deactivateAccountDapp(accountId: string) {\n  const activeOrigin = activeDappByAccountId[accountId];\n  if (!activeOrigin) {\n    return false;\n  }\n\n  delete activeDappByAccountId[accountId];\n\n  if (onUpdate && isUpdaterAlive(onUpdate)) {\n    onUpdate({\n      type: 'updateActiveDapp',\n      accountId,\n    });\n  }\n\n  return true;\n}\n\nexport function deactivateAllDapps() {\n  for (const [accountId, value] of Object.entries(activeDappByAccountId)) {\n    if (!value) {\n      continue;\n    }\n\n    delete activeDappByAccountId[accountId];\n\n    onUpdate({\n      type: 'updateActiveDapp',\n      accountId,\n    });\n  }\n}\n\nexport function isDappActive(accountId: string, origin: string) {\n  return activeDappByAccountId[accountId] === origin;\n}\n\nexport async function updateDapp(accountId: string, origin: string, update: Partial<ApiDapp>) {\n  const dapp = await getDapp(accountId, origin);\n  await addDapp(accountId, { ...dapp!, ...update });\n}\n\nexport async function getDapp(accountId: string, origin: string): Promise<ApiDapp | undefined> {\n  return (await getAccountValue(accountId, 'dapps'))?.[origin];\n}\n\nexport async function addDapp(accountId: string, dapp: ApiDapp) {\n  const dapps = await getDappsByOrigin(accountId);\n  dapps[dapp.origin] = dapp;\n  await setAccountValue(accountId, 'dapps', dapps);\n}\n\nexport async function deleteDapp(accountId: string, origin: string, dontNotifyDapp?: boolean) {\n  const dapps = await getDappsByOrigin(accountId);\n  if (!(origin in dapps)) {\n    return false;\n  }\n\n  if (isDappActive(accountId, origin)) {\n    deactivateAccountDapp(accountId);\n  }\n\n  delete dapps[origin];\n  await setAccountValue(accountId, 'dapps', dapps);\n\n  if (onUpdate && isUpdaterAlive(onUpdate)) {\n    onUpdate({\n      type: 'dappDisconnect',\n      accountId,\n      origin,\n    });\n  }\n\n  if (!dontNotifyDapp) {\n    await callHook('onDappDisconnected', accountId, origin);\n  }\n\n  await callHook('onDappsChanged');\n\n  return true;\n}\n\nexport async function deleteAllDapps(accountId: string) {\n  deactivateAccountDapp(accountId);\n\n  const origins = Object.keys(await getDappsByOrigin(accountId));\n  await setAccountValue(accountId, 'dapps', {});\n\n  origins.forEach((origin) => {\n    onUpdate({\n      type: 'dappDisconnect',\n      accountId,\n      origin,\n    });\n    void callHook('onDappDisconnected', accountId, origin);\n  });\n\n  await callHook('onDappsChanged');\n}\n\nexport async function getDapps(accountId: string): Promise<ApiDapp[]> {\n  return Object.values(await getDappsByOrigin(accountId));\n}\n\nexport async function getDappsByOrigin(accountId: string): Promise<Record<string, ApiDapp>> {\n  return await getAccountValue(accountId, 'dapps') || {};\n}\n\nexport async function findLastConnectedAccount(network: ApiNetwork, origin: string) {\n  const dapps = await getDappsState() || {};\n\n  let connectedAt = 0;\n  let lastConnectedAccountId: string | undefined;\n\n  Object.entries(dapps).forEach(([accountId, byOrigin]) => {\n    if (!(origin in byOrigin)) return;\n    if (parseAccountId(accountId).network !== network) return;\n\n    if ((byOrigin[origin].connectedAt) > connectedAt) {\n      connectedAt = byOrigin[origin].connectedAt;\n      lastConnectedAccountId = accountId;\n    }\n  });\n\n  return lastConnectedAccountId;\n}\n\nexport function getDappsState(): Promise<ApiDappsState | undefined> {\n  return storage.getItem('dapps');\n}\n\nexport async function removeAccountDapps(accountId: string) {\n  await removeAccountValue(accountId, 'dapps');\n\n  void callHook('onDappsChanged');\n}\n\nexport async function removeAllDapps() {\n  await storage.removeItem('dapps');\n\n  await callHook('onDappsChanged');\n}\n\nexport function removeNetworkDapps(network: ApiNetwork) {\n  return removeNetworkAccountsValue(network, 'dapps');\n}\n\nexport function getSseLastEventId(): Promise<string | undefined> {\n  return storage.getItem('sseLastEventId');\n}\n\nexport function setSseLastEventId(lastEventId: string) {\n  return storage.setItem('sseLastEventId', lastEventId);\n}\n\nexport function loadExploreSites(\n  { isLandscape }: { isLandscape: boolean },\n): Promise<{ categories: ApiSiteCategory[]; sites: ApiSite[] }> {\n  return callBackendGet('/v2/dapp/catalog', { isLandscape });\n}\n","import type {\n  ApiChain, ApiLedgerAccount, ApiTonWallet, ApiTxTimestamps, OnApiUpdate,\n} from '../types';\n\nimport { IS_EXTENSION } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { getChainConfig } from '../../util/chain';\nimport chains from '../chains';\nimport {\n  fetchStoredAccount,\n  fetchStoredTonWallet,\n  getActiveAccountId,\n  loginResolve,\n  setActiveAccountId,\n} from '../common/accounts';\nimport { waitStorageMigration } from '../common/helpers';\nimport { sendUpdateTokens } from '../common/tokens';\nimport { callHook } from '../hooks';\nimport { storage } from '../storages';\nimport { deactivateAccountDapp, deactivateAllDapps, onActiveDappAccountUpdated } from './dapps';\n\nconst { ton, tron } = chains;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initAccounts(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function activateAccount(accountId: string, newestTxTimestamps: ApiTxTimestamps = {}) {\n  await waitStorageMigration();\n\n  const prevAccountId = getActiveAccountId();\n  const isFirstLogin = !prevAccountId;\n\n  setActiveAccountId(accountId);\n  await storage.setItem('currentAccountId', accountId);\n  loginResolve();\n\n  if (IS_EXTENSION) {\n    if (prevAccountId && parseAccountId(prevAccountId).network !== parseAccountId(accountId).network) {\n      deactivateAllDapps();\n    }\n\n    void callHook('onFirstLogin');\n    onActiveDappAccountUpdated(accountId);\n  }\n\n  if (isFirstLogin) {\n    sendUpdateTokens(onUpdate);\n  }\n\n  const account = await fetchStoredAccount(accountId);\n\n  if ('ton' in account) ton.setupPolling(accountId, onUpdate, pickChainTimestamps(newestTxTimestamps, 'ton'));\n  if ('tron' in account) void tron.setupPolling(accountId, onUpdate, pickChainTimestamps(newestTxTimestamps, 'tron'));\n}\n\nfunction pickChainTimestamps(bySlug: ApiTxTimestamps, chain: ApiChain) {\n  const { slug: nativeSlug } = getChainConfig(chain).nativeToken;\n  return Object.entries(bySlug).reduce((newBySlug, [slug, timestamp]) => {\n    if (slug === nativeSlug || slug.startsWith(`${chain}-`)) {\n      newBySlug[slug] = timestamp;\n    }\n    return newBySlug;\n  }, {} as ApiTxTimestamps);\n}\n\nexport function deactivateAllAccounts() {\n  deactivateCurrentAccount();\n  setActiveAccountId(undefined);\n\n  if (IS_EXTENSION) {\n    deactivateAllDapps();\n    void callHook('onFullLogout');\n  }\n}\n\nexport function deactivateCurrentAccount() {\n  if (IS_EXTENSION) {\n    deactivateAccountDapp(getActiveAccountId()!);\n  }\n}\n\nexport function fetchTonWallet(accountId: string): Promise<ApiTonWallet> {\n  return fetchStoredTonWallet(accountId);\n}\n\nexport function fetchLedgerAccount(accountId: string) {\n  return fetchStoredAccount<ApiLedgerAccount>(accountId);\n}\n","import type { GlobalState } from '../../global/types';\nimport type { LedgerWalletInfo } from '../../util/ledger/types';\nimport type { ApiTonWalletVersion } from '../chains/ton/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic, ApiChain,\n  ApiLedgerAccount,\n  ApiNetwork,\n  ApiTonWallet,\n  ApiTxTimestamps,\n} from '../types';\nimport { ApiCommonError } from '../types';\n\nimport { DEFAULT_WALLET_VERSION, IS_BIP39_MNEMONIC_ENABLED, IS_CORE_WALLET } from '../../config';\nimport { buildAccountId, parseAccountId } from '../../util/account';\nimport isMnemonicPrivateKey from '../../util/isMnemonicPrivateKey';\nimport chains from '../chains';\nimport { toBase64Address } from '../chains/ton/util/tonCore';\nimport {\n  fetchStoredAccounts,\n  getNewAccountId,\n  removeAccountValue,\n  removeNetworkAccountsValue,\n  setAccountValue,\n  updateStoredAccount,\n} from '../common/accounts';\nimport {\n  decryptMnemonic, encryptMnemonic, generateBip39Mnemonic, validateBip39Mnemonic,\n} from '../common/mnemonic';\nimport { nftRepository } from '../db';\nimport { getEnvironment } from '../environment';\nimport { handleServerError } from '../errors';\nimport { storage } from '../storages';\nimport { activateAccount, deactivateAllAccounts, deactivateCurrentAccount } from './accounts';\nimport { removeAccountDapps, removeAllDapps, removeNetworkDapps } from './dapps';\n\nexport { importNewWalletVersion } from '../chains/ton';\n\nconst { ton, tron } = chains;\n\nexport function generateMnemonic(isBip39 = IS_BIP39_MNEMONIC_ENABLED) {\n  if (isBip39) return generateBip39Mnemonic();\n  return ton.generateMnemonic();\n}\n\nexport function createWallet(\n  network: ApiNetwork,\n  mnemonic: string[],\n  password: string,\n  version?: ApiTonWalletVersion,\n) {\n  if (!version) version = DEFAULT_WALLET_VERSION;\n\n  return importMnemonic(network, mnemonic, password, version);\n}\n\nexport function validateMnemonic(mnemonic: string[]) {\n  return (validateBip39Mnemonic(mnemonic) && IS_BIP39_MNEMONIC_ENABLED) || chains.ton.validateMnemonic(mnemonic);\n}\n\nexport async function importMnemonic(\n  network: ApiNetwork,\n  mnemonic: string[],\n  password: string,\n  version?: ApiTonWalletVersion,\n) {\n  const isPrivateKey = isMnemonicPrivateKey(mnemonic);\n  let isBip39Mnemonic = validateBip39Mnemonic(mnemonic);\n  const isTonMnemonic = await ton.validateMnemonic(mnemonic);\n\n  if (!isPrivateKey && !isTonMnemonic && (!isBip39Mnemonic || !IS_BIP39_MNEMONIC_ENABLED)) {\n    throw new Error('Invalid mnemonic');\n  }\n\n  const accountId: string = await getNewAccountId(network);\n  const mnemonicEncrypted = await encryptMnemonic(mnemonic, password);\n\n  // This is a defensive approach against potential corrupted encryption reported by some users\n  const decryptedMnemonic = await decryptMnemonic(mnemonicEncrypted, password)\n    .catch(() => undefined);\n\n  if (!password || !decryptedMnemonic) {\n    return { error: ApiCommonError.DebugError };\n  }\n\n  let account: ApiAccountAny;\n  let tonWallet: ApiTonWallet & { lastTxId?: string } | undefined;\n  let tonAddress: string;\n  let tronAddress: string | undefined;\n\n  try {\n    if (isBip39Mnemonic && isTonMnemonic) {\n      tonWallet = await ton.getWalletFromMnemonic(mnemonic, network, version);\n      if (tonWallet.lastTxId) {\n        isBip39Mnemonic = false;\n      }\n    }\n\n    if (isBip39Mnemonic) {\n      const tronWallet = tron.getWalletFromBip39Mnemonic(network, mnemonic);\n      tonWallet = await ton.getWalletFromBip39Mnemonic(network, mnemonic);\n\n      tonAddress = tonWallet.address;\n      tronAddress = tronWallet.address;\n      account = {\n        type: 'bip39',\n        mnemonicEncrypted,\n        tron: tronWallet,\n        ton: tonWallet,\n      };\n    } else {\n      if (!tonWallet) {\n        tonWallet = isPrivateKey\n          ? await ton.getWalletFromPrivateKey(mnemonic[0], network, version)\n          : await ton.getWalletFromMnemonic(mnemonic, network, version);\n      }\n      account = {\n        type: 'ton',\n        mnemonicEncrypted,\n        ton: tonWallet,\n      };\n      tonAddress = tonWallet.address;\n    }\n\n    await setAccountValue(accountId, 'accounts', account);\n    const secondNetworkAccount = IS_CORE_WALLET ? await createAccountWithSecondNetwork({\n      accountId, network, mnemonic, mnemonicEncrypted, version,\n    }) : undefined;\n    void activateAccount(accountId);\n\n    return {\n      accountId,\n      tonAddress,\n      tronAddress,\n      secondNetworkAccount,\n    };\n  } catch (err) {\n    return handleServerError(err);\n  }\n}\n\nexport async function createAccountWithSecondNetwork(options: {\n  accountId: string;\n  network: ApiNetwork;\n  mnemonic: string[];\n  mnemonicEncrypted: string;\n  version?: ApiTonWalletVersion;\n}): Promise<GlobalState['auth']['secondNetworkAccount']> {\n  const {\n    mnemonic, version, mnemonicEncrypted,\n  } = options;\n  const { network, accountId } = options;\n  const tonWallet = await ton.getWalletFromMnemonic(mnemonic, network, version);\n\n  const secondNetwork = network === 'testnet' ? 'mainnet' : 'testnet';\n  const secondAccountId = buildAccountId({ ...parseAccountId(accountId), network: secondNetwork });\n  tonWallet.address = toBase64Address(tonWallet.address, false, secondNetwork);\n  const account = {\n    type: 'ton',\n    mnemonicEncrypted,\n    ton: tonWallet,\n  };\n  await setAccountValue(secondAccountId, 'accounts', account);\n\n  return {\n    accountId: secondAccountId,\n    addressByChain: { ton: tonWallet.address } as Record<ApiChain, string>,\n    network: secondNetwork,\n  };\n}\n\nexport async function importLedgerWallet(network: ApiNetwork, walletInfo: LedgerWalletInfo) {\n  const accountId: string = await getNewAccountId(network);\n  const {\n    publicKey, address, index, driver, deviceId, deviceName, version,\n  } = walletInfo;\n\n  await storeHardwareAccount(accountId, {\n    type: 'ledger',\n    ton: {\n      type: 'ton',\n      address,\n      publicKey,\n      version,\n      index,\n    },\n    driver,\n    deviceId,\n    deviceName,\n  });\n\n  return { accountId, address, walletInfo };\n}\n\nfunction storeHardwareAccount(accountId: string, account?: ApiLedgerAccount) {\n  return setAccountValue(accountId, 'accounts', account);\n}\n\nexport async function removeNetworkAccounts(network: ApiNetwork) {\n  deactivateAllAccounts();\n\n  await Promise.all([\n    removeNetworkAccountsValue(network, 'accounts'),\n    getEnvironment().isDappSupported && removeNetworkDapps(network),\n  ]);\n}\n\nexport async function resetAccounts() {\n  deactivateAllAccounts();\n\n  await Promise.all([\n    storage.removeItem('accounts'),\n    storage.removeItem('currentAccountId'),\n    getEnvironment().isDappSupported && removeAllDapps(),\n    nftRepository.clear(),\n  ]);\n}\n\nexport async function removeAccount(accountId: string, nextAccountId: string, newestTxTimestamps?: ApiTxTimestamps) {\n  await Promise.all([\n    removeAccountValue(accountId, 'accounts'),\n    getEnvironment().isDappSupported && removeAccountDapps(accountId),\n    nftRepository.deleteWhere({ accountId }),\n  ]);\n\n  deactivateCurrentAccount();\n  await activateAccount(nextAccountId, newestTxTimestamps);\n}\n\nexport async function changePassword(oldPassword: string, password: string) {\n  for (const [accountId, account] of Object.entries(await fetchStoredAccounts())) {\n    if (!('mnemonicEncrypted' in account)) continue;\n\n    const mnemonic = await decryptMnemonic(account.mnemonicEncrypted, oldPassword);\n    const encryptedMnemonic = await encryptMnemonic(mnemonic, password);\n\n    await updateStoredAccount<ApiAccountWithMnemonic>(accountId, {\n      mnemonicEncrypted: encryptedMnemonic,\n    });\n  }\n}\n","import generateUniqueId from '../../util/generateUniqueId';\nimport { ApiUserRejectsError } from '../errors';\n\nconst deferreds = new Map<string, Deferred>();\n\nclass Deferred<T = any> {\n  resolve!: AnyToVoidFunction;\n\n  reject!: AnyToVoidFunction;\n\n  promise = new Promise<T>((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n\nexport function createDappPromise(promiseId = generateUniqueId()) {\n  const deferred = new Deferred();\n\n  deferreds.set(promiseId, deferred);\n\n  const { promise } = deferred;\n\n  return { promiseId, promise };\n}\n\nexport function resolveDappPromise(promiseId: string, value?: any) {\n  const deferred = deferreds.get(promiseId);\n  if (!deferred) {\n    return;\n  }\n\n  deferred.resolve(value);\n  deferreds.delete(promiseId);\n}\n\nexport function rejectDappPromise(promiseId: string, reason: string = 'Unknown rejection reason') {\n  const deferred = deferreds.get(promiseId);\n  if (!deferred) {\n    return;\n  }\n\n  deferred.reject(new ApiUserRejectsError(reason));\n  deferreds.delete(promiseId);\n}\n\nexport function rejectAllDappPromises(message: string) {\n  Array.from(deferreds.keys()).forEach((id) => {\n    rejectDappPromise(id, message);\n  });\n}\n","import * as tonWebMnemonic from 'tonweb-mnemonic';\n\nimport type { ApiAccountWithMnemonic, ApiChain, ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport chains from '../chains';\nimport { fetchPrivateKey as fetchTonPrivateKey } from '../chains/ton';\nimport {\n  fetchStoredAccount,\n  fetchStoredAddress,\n  fetchStoredTonWallet,\n  getAccountWithMnemonic,\n} from '../common/accounts';\nimport * as dappPromises from '../common/dappPromises';\nimport { getMnemonic } from '../common/mnemonic';\n\nconst ton = chains.ton;\n\nexport async function fetchPrivateKey(accountId: string, password: string) {\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  const privateKey = await fetchTonPrivateKey(accountId, password, account);\n\n  return Buffer.from(privateKey!).toString('hex');\n}\n\nexport async function fetchMnemonic(accountId: string, password: string) {\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  return getMnemonic(accountId, password, account);\n}\n\nexport function getMnemonicWordList() {\n  return tonWebMnemonic.wordlists.default;\n}\n\nexport async function verifyPassword(password: string) {\n  const [accountId, account] = (await getAccountWithMnemonic()) ?? [];\n  if (!accountId || !account) {\n    throw new Error('The user is not authorized in the wallet');\n  }\n\n  return Boolean(await getMnemonic(accountId, password, account));\n}\n\nexport function confirmDappRequest(promiseId: string, data: any) {\n  dappPromises.resolveDappPromise(promiseId, data);\n}\n\nexport function confirmDappRequestConnect(promiseId: string, data: {\n  password?: string;\n  accountId?: string;\n  signature?: string;\n}) {\n  dappPromises.resolveDappPromise(promiseId, data);\n}\n\nexport function cancelDappRequest(promiseId: string, reason?: string) {\n  dappPromises.rejectDappPromise(promiseId, reason);\n}\n\nexport async function getWalletSeqno(accountId: string, address?: string) {\n  const { network } = parseAccountId(accountId);\n  if (!address) {\n    ({ address } = await fetchStoredTonWallet(accountId));\n  }\n  return ton.getWalletSeqno(network, address);\n}\n\nexport function fetchAddress(accountId: string, chain: ApiChain) {\n  return fetchStoredAddress(accountId, chain);\n}\n\nexport function isWalletInitialized(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.isAddressInitialized(network, address);\n}\n\nexport function getWalletBalance(chain: ApiChain, network: ApiNetwork, address: string) {\n  return chains[chain].getWalletBalance(network, address);\n}\n\nexport function getContractInfo(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.getContractInfo(network, address);\n}\n\nexport function getWalletInfo(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.getWalletInfo(network, address);\n}\n","import type { ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport chains from '../chains';\nimport { getTokenByAddress } from '../common/tokens';\n\nconst { ton } = chains;\n\nexport { getTokenBySlug, buildTokenSlug } from '../common/tokens';\n\nexport function fetchToken(accountId: string, address: string) {\n  const { network } = parseAccountId(accountId);\n  return ton.fetchToken(network, address);\n}\n\nexport function resolveTokenWalletAddress(network: ApiNetwork, address: string, tokenAddress: string) {\n  const chain = chains.ton;\n\n  return chain.resolveTokenWalletAddress(network, address, tokenAddress);\n}\n\nexport function resolveTokenAddress(network: ApiNetwork, tokenWalletAddress: string) {\n  const chain = chains.ton;\n\n  return chain.resolveTokenAddress(network, tokenWalletAddress);\n}\n\nexport function fetchTokenBalances(accountId: string) {\n  const chain = chains.ton;\n\n  return chain.getAccountTokenBalances(accountId);\n}\n\nexport function fetchTokenBalancesByAddress(address: string, network: ApiNetwork) {\n  const chain = chains.ton;\n\n  return chain.getTokenBalances(network, address);\n}\n\nexport function getAmountForTokenTransfer(tokenAddress: string, willClaimMintless: boolean) {\n  const chain = chains.ton;\n  const token = getTokenByAddress(tokenAddress)!;\n\n  return chain.getToncoinAmountForTransfer(token, willClaimMintless);\n}\n","import { Cell } from '@ton/core';\n\nimport type { ApiSubmitTransferWithDieselResult } from '../chains/ton/types';\nimport type {\n  ApiActivity,\n  ApiChain,\n  ApiLocalTransactionParams,\n  ApiSignedTransfer,\n  ApiTransactionActivity,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiSubmitTransferOptions, ApiSubmitTransferResult, CheckTransactionDraftOptions } from './types';\n\nimport { parseAccountId } from '../../util/account';\nimport { getChainConfig } from '../../util/chain';\nimport { compareActivities } from '../../util/compareActivities';\nimport { logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { fetchStoredAccount, fetchStoredAddress, fetchStoredTonWallet } from '../common/accounts';\nimport { buildLocalTransaction } from '../common/helpers';\nimport { getPendingTransfer, waitAndCreatePendingTransfer } from '../common/pendingTransfers';\nimport { handleServerError } from '../errors';\nimport { buildTokenSlug } from './tokens';\n\nlet onUpdate: OnApiUpdate;\n\nconst { ton, tron } = chains;\n\nexport function initTransactions(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchTokenActivitySlice(\n  accountId: string,\n  chain: ApiChain,\n  slug: string,\n  fromTimestamp?: number,\n  limit?: number,\n): Promise<ApiActivity[] | { error: string }> {\n  const { network } = parseAccountId(accountId);\n\n  try {\n    if (chain === 'ton') {\n      const transactions = await chains[chain].fetchTokenTransactionSlice(\n        accountId, slug, fromTimestamp, undefined, limit,\n      );\n      const activities = await ton.swapReplaceTransactions(accountId, transactions, network, slug);\n      await ton.fixTokenActivitiesAddressForm(network, activities);\n      return activities;\n    } else {\n      const activities = await chains[chain].getTokenTransactionSlice(\n        accountId, slug, fromTimestamp, undefined, limit,\n      );\n      return activities;\n    }\n  } catch (err) {\n    logDebugError('fetchTokenActivitySlice', err);\n    return handleServerError(err);\n  }\n}\n\nexport async function fetchAllActivitySlice(\n  accountId: string,\n  limit: number,\n  toTimestamp: number,\n  tonTokenSlugs: string[],\n  tronTokenSlugs: string[],\n): Promise<ApiActivity[] | { error: string }> {\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const { type } = await fetchStoredAccount(accountId);\n\n    const tonTransactions = await ton.getAllTransactionSlice(accountId, toTimestamp, limit, tonTokenSlugs);\n    const tonActivities = await ton.swapReplaceTransactions(accountId, tonTransactions, network);\n    await ton.fixTokenActivitiesAddressForm(network, tonActivities);\n\n    if (type !== 'bip39') {\n      return tonActivities;\n    }\n\n    const tronActivities = await tron.getAllTransactionSlice(accountId, toTimestamp, limit, tronTokenSlugs);\n\n    if (!tonActivities.length && !tronActivities.length) {\n      return [];\n    } else if (!tonActivities.length) {\n      return tronActivities;\n    } else if (!tronActivities.length) {\n      return tonActivities;\n    }\n\n    const fromTimestamp = Math.min(\n      tonActivities[tonActivities.length - 1].timestamp,\n      tronActivities && tronActivities[tronActivities.length - 1].timestamp,\n    );\n\n    return [...tronActivities, ...tonActivities]\n      .sort(compareActivities)\n      .filter(({ timestamp }) => timestamp >= fromTimestamp);\n  } catch (err) {\n    logDebugError('fetchAllActivitySlice', err);\n    return handleServerError(err);\n  }\n}\n\nexport function checkTransactionDraft(chain: ApiChain, options: CheckTransactionDraftOptions) {\n  return chains[chain].checkTransactionDraft(options);\n}\n\nexport async function submitTransfer(\n  chain: ApiChain,\n  options: ApiSubmitTransferOptions,\n  shouldCreateLocalTransaction = true,\n): Promise<(ApiSubmitTransferResult | ApiSubmitTransferWithDieselResult) & { txId?: string }> {\n  const {\n    accountId,\n    password,\n    toAddress,\n    amount,\n    tokenAddress,\n    comment,\n    fee,\n    realFee,\n    shouldEncrypt,\n    isBase64Data,\n    withDiesel,\n    dieselAmount,\n    isGaslessWithStars,\n  } = options;\n  const stateInit = typeof options.stateInit === 'string' ? Cell.fromBase64(options.stateInit) : options.stateInit;\n\n  const fromAddress = await fetchStoredAddress(accountId, chain);\n\n  let result: ApiSubmitTransferResult | ApiSubmitTransferWithDieselResult;\n\n  if (withDiesel && chain === 'ton') {\n    result = await ton.submitTransferWithDiesel({\n      accountId,\n      password,\n      toAddress,\n      amount,\n      tokenAddress: tokenAddress!,\n      data: comment,\n      shouldEncrypt,\n      dieselAmount: dieselAmount!,\n      isGaslessWithStars,\n    });\n  } else {\n    result = await chains[chain].submitTransfer({\n      accountId,\n      password,\n      toAddress,\n      amount,\n      tokenAddress,\n      data: comment,\n      shouldEncrypt,\n      isBase64Data,\n      stateInit,\n      fee,\n    });\n  }\n\n  if ('error' in result) {\n    return result;\n  }\n\n  if (!shouldCreateLocalTransaction) {\n    return result;\n  }\n\n  const slug = tokenAddress\n    ? buildTokenSlug(chain, tokenAddress)\n    : getChainConfig(chain).nativeToken.slug;\n\n  let localTransaction: ApiTransactionActivity;\n\n  if ('msgHash' in result) {\n    const { encryptedComment, msgHash } = result;\n    localTransaction = createLocalTransaction(accountId, chain, {\n      amount,\n      fromAddress,\n      toAddress,\n      comment: shouldEncrypt ? undefined : comment,\n      encryptedComment,\n      fee: realFee ?? 0n,\n      slug,\n      inMsgHash: msgHash,\n    });\n    if ('paymentLink' in result && result.paymentLink) {\n      onUpdate({ type: 'openUrl', url: result.paymentLink, isExternal: true });\n    }\n  } else {\n    const { txId } = result;\n    localTransaction = createLocalTransaction(accountId, chain, {\n      txId,\n      amount,\n      fromAddress,\n      toAddress,\n      comment,\n      fee: realFee ?? 0n,\n      slug,\n    });\n  }\n\n  return {\n    ...result,\n    txId: localTransaction.txId,\n  };\n}\n\nexport async function waitAndCreateTonPendingTransfer(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return (await waitAndCreatePendingTransfer(network, address)).id;\n}\n\nexport async function sendSignedTransferMessage(\n  accountId: string,\n  message: ApiSignedTransfer,\n  pendingTransferId: string,\n) {\n  const { msgHash } = await ton.sendSignedMessage(accountId, message, pendingTransferId);\n\n  const localTransaction = createLocalTransaction(accountId, 'ton', {\n    ...message.params,\n    inMsgHash: msgHash,\n  });\n\n  return localTransaction.txId;\n}\n\nexport function cancelPendingTransfer(id: string) {\n  getPendingTransfer(id)?.resolve();\n}\n\nexport function decryptComment(accountId: string, encryptedComment: string, fromAddress: string, password: string) {\n  const chain = chains.ton;\n\n  return chain.decryptComment(accountId, encryptedComment, fromAddress, password);\n}\n\nexport function createLocalTransaction(accountId: string, chain: ApiChain, params: ApiLocalTransactionParams) {\n  const { network } = parseAccountId(accountId);\n  const { toAddress } = params;\n\n  let normalizedAddress: string;\n  if (params.normalizedAddress) {\n    normalizedAddress = params.normalizedAddress;\n  } else if (chain === 'ton') {\n    normalizedAddress = ton.normalizeAddress(toAddress, network);\n  } else {\n    normalizedAddress = toAddress;\n  }\n\n  const localTransaction = buildLocalTransaction(params, normalizedAddress);\n\n  onUpdate({\n    type: 'newLocalTransaction',\n    transaction: localTransaction,\n    accountId,\n  });\n\n  return localTransaction;\n}\n\nexport function fetchEstimateDiesel(accountId: string, tokenAddress: string) {\n  const chain = chains.ton;\n\n  return chain.fetchEstimateDiesel(accountId, tokenAddress);\n}\n","import type { ApiNft } from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { bigintDivideToNumber } from '../../util/bigint';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { createLocalTransaction } from './transactions';\n\nconst { ton } = chains;\n\nexport function fetchNfts(accountId: string) {\n  return ton.getAccountNfts(accountId);\n}\n\nexport function checkNftTransferDraft(options: {\n  accountId: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}) {\n  return ton.checkNftTransferDraft(options);\n}\n\nexport async function submitNftTransfers(\n  accountId: string,\n  password: string,\n  nfts: ApiNft[],\n  toAddress: string,\n  comment?: string,\n  totalRealFee = 0n,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitNftTransfers({\n    accountId, password, nfts, toAddress, comment,\n  });\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const realFeePerNft = bigintDivideToNumber(totalRealFee, Object.keys(result.messages).length);\n\n  for (const [i, message] of result.messages.entries()) {\n    createLocalTransaction(accountId, 'ton', {\n      amount: message.amount,\n      fromAddress,\n      toAddress,\n      comment,\n      fee: realFeePerNft,\n      normalizedAddress: message.toAddress,\n      slug: TONCOIN.slug,\n      inMsgHash: result.msgHash,\n      type: 'nftTransferred',\n      nft: nfts?.[i],\n    });\n  }\n\n  return result;\n}\n\nexport function checkNftOwnership(accountId: string, nftAddress: string) {\n  return ton.checkNftOwnership(accountId, nftAddress);\n}\n","import type { ApiBaseCurrency } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY } from '../../config';\nimport { storage } from '../storages';\n\nexport async function getBaseCurrency() {\n  return (await storage.getItem('baseCurrency')) ?? DEFAULT_PRICE_CURRENCY;\n}\n\nexport function setBaseCurrency(currency: ApiBaseCurrency) {\n  return storage.setItem('baseCurrency', currency);\n}\n","let resolvePromise: Function;\nconst preloadPromise = new Promise((resolve) => {\n  resolvePromise = resolve;\n});\n\nexport function resolveDataPreloadPromise() {\n  resolvePromise();\n}\n\nexport async function waitDataPreload() {\n  await preloadPromise;\n}\n","import type {\n  ApiJettonStakingState,\n  ApiStakingCommonData,\n  ApiStakingHistory,\n  ApiStakingState,\n  ApiTransactionActivity,\n} from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { fromDecimal } from '../../util/decimals';\nimport { logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { setStakingCommonCache } from '../common/cache';\nimport { createLocalTransaction } from './transactions';\n\nconst { ton } = chains;\n\nexport function initStaking() {\n}\n\nexport function checkStakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  return ton.checkStakeDraft(accountId, amount, state);\n}\n\nexport function checkUnstakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  return ton.checkUnstakeDraft(accountId, amount, state);\n}\n\nexport async function submitStake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitStake(\n    accountId, password, amount, state,\n  );\n\n  if ('error' in result) {\n    return false;\n  }\n\n  let localTransaction: ApiTransactionActivity;\n\n  if (state.tokenSlug === TONCOIN.slug) {\n    localTransaction = createLocalTransaction(accountId, 'ton', {\n      amount: result.amount,\n      fromAddress,\n      toAddress: result.toAddress,\n      fee: realFee ?? 0n,\n      type: 'stake',\n      slug: state.tokenSlug,\n      inMsgHash: result.msgHash,\n    });\n  } else {\n    localTransaction = createLocalTransaction(accountId, 'ton', {\n      amount,\n      fromAddress,\n      toAddress: result.toAddress,\n      fee: realFee ?? 0n,\n      type: 'stake',\n      slug: state.tokenSlug,\n    });\n  }\n\n  return {\n    ...result,\n    txId: localTransaction.txId,\n  };\n}\n\nexport async function submitUnstake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitUnstake(accountId, password, amount, state);\n  if ('error' in result) {\n    return false;\n  }\n\n  const localTransaction = createLocalTransaction(accountId, 'ton', {\n    amount: result.amount,\n    fromAddress,\n    toAddress: result.toAddress,\n    fee: realFee ?? 0n,\n    type: 'unstakeRequest',\n    slug: TONCOIN.slug,\n    inMsgHash: result.msgHash,\n  });\n\n  return {\n    ...result,\n    txId: localTransaction.txId,\n  };\n}\n\nexport async function getStakingHistory(\n  accountId: string,\n  limit?: number,\n  offset?: number,\n): Promise<ApiStakingHistory> {\n  const { address } = await fetchStoredTonWallet(accountId);\n  return callBackendGet(`/staking/profits/${address}`, { limit, offset });\n}\n\nexport async function tryUpdateStakingCommonData() {\n  try {\n    const data = await callBackendGet('/staking/common');\n    data.round.start *= 1000;\n    data.round.end *= 1000;\n    data.round.unlock *= 1000;\n    data.prevRound.start *= 1000;\n    data.prevRound.end *= 1000;\n    data.prevRound.unlock *= 1000;\n    data.liquid.available = fromDecimal(data.liquid.available);\n\n    setStakingCommonCache(data as ApiStakingCommonData);\n  } catch (err) {\n    logDebugError('tryUpdateLiquidStakingState', err);\n  }\n}\n\nexport function fetchBackendStakingState(address: string) {\n  return ton.getBackendStakingState(address);\n}\n\nexport async function submitStakingClaim(\n  accountId: string,\n  password: string,\n  state: ApiJettonStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitStakingClaim(accountId, password, state);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const localTransaction = createLocalTransaction(accountId, 'ton', {\n    amount: result.amount,\n    fromAddress,\n    toAddress: result.toAddress,\n    fee: realFee ?? 0n,\n    slug: TONCOIN.slug,\n    inMsgHash: result.msgHash,\n  });\n\n  return {\n    ...result,\n    txId: localTransaction.txId,\n  };\n}\n","import nacl from 'tweetnacl';\n\nimport type { Theme } from '../../global/types';\nimport type { AccountCache } from '../common/cache';\nimport type { StorageKey } from '../storages/types';\nimport type { ApiCardsInfo, ApiChain, ApiNetwork } from '../types';\n\nimport { BRILLIANT_API_BASE_URL } from '../../config';\nimport { getLogs, logDebugError } from '../../util/logs';\nimport { setIsAppFocused } from '../../util/pauseOrFocus';\nimport chains from '../chains';\nimport { fetchStoredAccounts, fetchStoredTonWallet, updateStoredAccount } from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { updateAccountCache } from '../common/cache';\nimport { handleServerError } from '../errors';\nimport { storage } from '../storages';\n\nconst SIGN_MESSAGE = Buffer.from('MyTonWallet_AuthToken_n6i0k4w8pb');\n\nexport function checkApiAvailability(chain: ApiChain, network: ApiNetwork) {\n  return chains[chain].checkApiAvailability(network);\n}\n\nexport async function getBackendAuthToken(accountId: string, password: string) {\n  const accountWallet = await fetchStoredTonWallet(accountId);\n  let { authToken } = accountWallet;\n  const { publicKey, isInitialized } = accountWallet;\n\n  if (!authToken) {\n    const privateKey = await chains.ton.fetchPrivateKey(accountId, password);\n    const signature = nacl.sign.detached(SIGN_MESSAGE, privateKey!);\n    authToken = Buffer.from(signature).toString('base64');\n\n    await updateStoredAccount(accountId, {\n      ton: {\n        ...accountWallet,\n        authToken,\n      },\n    });\n  }\n\n  if (!isInitialized) {\n    authToken += `:${publicKey}`;\n  }\n\n  return authToken;\n}\n\nexport async function fetchAccountConfigForDebugPurposesOnly() {\n  try {\n    const [accounts, stateVersion, mnemonicsEncrypted] = await Promise.all([\n      fetchStoredAccounts(),\n      storage.getItem('stateVersion'),\n      storage.getItem('mnemonicsEncrypted' as StorageKey),\n    ]);\n\n    return JSON.stringify({ accounts, stateVersion, mnemonicsEncrypted });\n  } catch (err) {\n    logDebugError('fetchAccountConfigForDebugPurposesOnly', err);\n\n    return undefined;\n  }\n}\n\nexport function ping() {\n  return true;\n}\n\nexport function updateAccountMemoryCache(accountId: string, address: string, partial: Partial<AccountCache>) {\n  updateAccountCache(accountId, address, partial);\n}\n\nexport { setIsAppFocused, getLogs };\n\nexport async function getMoonpayOnrampUrl(chain: ApiChain, address: string, theme: Theme) {\n  try {\n    return await callBackendGet<{ url: string }>('/onramp-url', {\n      chain,\n      address,\n      theme,\n    });\n  } catch (err) {\n    logDebugError('getMoonpayOnrampUrl', err);\n\n    return handleServerError(err);\n  }\n}\n\nexport function getCardsInfo() {\n  return callBackendGet<ApiCardsInfo>(`${BRILLIANT_API_BASE_URL}/cards/info`);\n}\n","import type { TonTransferParams } from '../chains/ton/types';\nimport type {\n  ApiSwapActivity,\n  ApiSwapAsset,\n  ApiSwapBuildRequest,\n  ApiSwapBuildResponse,\n  ApiSwapCexCreateTransactionRequest,\n  ApiSwapCexCreateTransactionResponse,\n  ApiSwapCexEstimateRequest,\n  ApiSwapCexEstimateResponse,\n  ApiSwapEstimateRequest,\n  ApiSwapEstimateResponse,\n  ApiSwapHistoryItem,\n  ApiSwapPairAsset,\n  ApiSwapTonAsset,\n  ApiSwapTransfer,\n  OnApiUpdate,\n} from '../types';\n\nimport { SWAP_API_VERSION, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildSwapId } from '../../util/swap/buildSwapId';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { callBackendGet, callBackendPost } from '../common/backend';\nimport {\n  getSwapItemSlug, patchSwapItem, swapGetHistoryItem, swapItemToActivity,\n} from '../common/swap';\nimport { ApiServerError } from '../errors';\nimport { callHook } from '../hooks';\nimport { getBackendAuthToken } from './other';\n\nexport type SwapHistoryRange = {\n  asset: string;\n  fromLt: number;\n  toLt: number;\n  fromTime: number;\n  toTime: number;\n};\n\nconst ton = chains.ton;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initSwap(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function swapBuildTransfer(\n  accountId: string,\n  password: string,\n  request: ApiSwapBuildRequest,\n) {\n  const { network } = parseAccountId(accountId);\n  const authToken = await getBackendAuthToken(accountId, password);\n\n  const { address, version } = await fetchStoredTonWallet(accountId);\n  request.walletVersion = version;\n\n  const { id, transfers } = await swapBuild(authToken, request);\n\n  const transferList = transfers.map((transfer) => ({\n    ...transfer,\n    amount: BigInt(transfer.amount),\n    isBase64Payload: true,\n  }));\n\n  try {\n    await ton.validateDexSwapTransfers(network, address, request, transferList);\n\n    const result = await ton.checkMultiTransactionDraft(accountId, transferList, request.shouldTryDiesel);\n\n    if ('error' in result) {\n      await patchSwapItem({\n        address, swapId: id, authToken, error: result.error,\n      });\n      return result;\n    }\n\n    return { ...result, id, transfers };\n  } catch (err: any) {\n    await patchSwapItem({\n      address, swapId: id, authToken, error: errorToString(err),\n    });\n    throw err;\n  }\n}\n\nexport async function swapSubmit(\n  accountId: string,\n  password: string,\n  transfers: ApiSwapTransfer[],\n  historyItem: ApiSwapHistoryItem,\n  isGasless?: boolean,\n) {\n  const swapId = historyItem.id;\n  const authToken = await getBackendAuthToken(accountId, password);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  try {\n    const transferList: TonTransferParams[] = transfers.map((transfer) => ({\n      ...transfer,\n      amount: BigInt(transfer.amount),\n      isBase64Payload: true,\n    }));\n\n    if (historyItem.from !== TONCOIN.symbol) {\n      transferList[0] = await ton.insertMintlessPayload('mainnet', address, historyItem.from, transferList[0]);\n    }\n\n    const result = await ton.submitMultiTransfer({\n      accountId,\n      password,\n      messages: transferList,\n      isGasless,\n    });\n\n    if ('error' in result) {\n      await patchSwapItem({\n        address, swapId, authToken, error: result.error,\n      });\n      return result;\n    }\n\n    delete result.messages[0].stateInit;\n\n    const from = getSwapItemSlug(historyItem, historyItem.from);\n    const to = getSwapItemSlug(historyItem, historyItem.to);\n\n    const swap: ApiSwapActivity = {\n      ...historyItem,\n      id: buildSwapId(historyItem.id),\n      from,\n      to,\n      kind: 'swap',\n    };\n\n    await patchSwapItem({\n      address, swapId, authToken, msgHash: result.msgHash,\n    });\n\n    onUpdate({\n      type: 'newActivities',\n      chain: 'ton',\n      accountId,\n      activities: [swap],\n    });\n\n    void callHook('onSwapCreated', accountId, swap.timestamp - 1);\n\n    return result;\n  } catch (err: any) {\n    await patchSwapItem({\n      address, swapId, authToken, error: errorToString(err),\n    });\n    throw err;\n  }\n}\n\nfunction errorToString(err: Error | string) {\n  return typeof err === 'string' ? err : err.stack;\n}\n\nexport async function fetchSwaps(accountId: string, ids: string[]) {\n  const { address } = await fetchStoredTonWallet(accountId);\n  const results = await Promise.allSettled(\n    ids.map((id) => swapGetHistoryItem(address, id.replace('swap:', ''))),\n  );\n\n  const nonExistentIds: string[] = [];\n\n  const swaps = results\n    .map((result, i) => {\n      if (result.status === 'rejected') {\n        if (result.reason instanceof ApiServerError && result.reason.statusCode === 404) {\n          nonExistentIds.push(ids[i]);\n        }\n        return undefined;\n      }\n\n      return swapItemToActivity(result.value);\n    })\n    .filter(Boolean);\n\n  return { nonExistentIds, swaps };\n}\n\nexport async function swapEstimate(\n  accountId: string,\n  request: ApiSwapEstimateRequest,\n): Promise<ApiSwapEstimateResponse | { error: string }> {\n  const walletVersion = (await fetchStoredTonWallet(accountId)).version;\n\n  return callBackendPost('/swap/ton/estimate', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n    walletVersion,\n  }, {\n    isAllowBadRequest: true,\n  });\n}\n\nexport function swapBuild(authToken: string, request: ApiSwapBuildRequest): Promise<ApiSwapBuildResponse> {\n  return callBackendPost('/swap/ton/build', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n    isMsgHashMode: true,\n  }, {\n    authToken,\n  });\n}\n\nexport function swapGetAssets(): Promise<ApiSwapAsset[]> {\n  return callBackendGet('/swap/assets');\n}\n\nexport function swapGetTonCurrencies(): Promise<ApiSwapTonAsset[]> {\n  return callBackendGet('/swap/ton/tokens');\n}\n\nexport function swapGetPairs(symbolOrTokenAddress: string): Promise<ApiSwapPairAsset[]> {\n  return callBackendGet('/swap/pairs', { asset: symbolOrTokenAddress });\n}\n\nexport function swapCexEstimate(\n  request: ApiSwapCexEstimateRequest,\n): Promise<ApiSwapCexEstimateResponse | { error: string }> {\n  return callBackendPost<ApiSwapCexEstimateResponse | { error: string }>(\n    '/swap/cex/estimate',\n    request,\n    { isAllowBadRequest: true },\n  );\n}\n\nexport function swapCexValidateAddress(params: { slug: string; address: string }): Promise<{\n  result: boolean;\n  message?: string;\n}> {\n  return callBackendGet('/swap/cex/validate-address', params);\n}\n\nexport async function swapCexCreateTransaction(\n  accountId: string,\n  password: string,\n  request: ApiSwapCexCreateTransactionRequest,\n): Promise<{\n    swap: ApiSwapHistoryItem;\n    activity: ApiSwapActivity;\n  }> {\n  const authToken = await getBackendAuthToken(accountId, password);\n\n  const { swap } = await callBackendPost<ApiSwapCexCreateTransactionResponse>('/swap/cex/createTransaction', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n  }, {\n    authToken,\n  });\n\n  const activity = swapItemToActivity(swap);\n\n  onUpdate({\n    type: 'newActivities',\n    accountId,\n    activities: [activity],\n  });\n\n  void callHook('onSwapCreated', accountId, swap.timestamp - 1);\n\n  return { swap, activity };\n}\n","import type {\n  ApiCountryCode,\n  ApiSwapAsset,\n  ApiTokenPrice,\n  OnApiUpdate,\n} from '../types';\n\nimport { IS_AIR_APP, TONCOIN } from '../../config';\nimport { buildCollectionByKey, omit } from '../../util/iteratees';\nimport { logDebugError } from '../../util/logs';\nimport { pauseOrFocus } from '../../util/pauseOrFocus';\nimport chains from '../chains';\nimport { tryUpdateKnownAddresses } from '../common/addresses';\nimport { callBackendGet } from '../common/backend';\nimport { getPricesCache } from '../common/cache';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { getBaseCurrency } from '../common/prices';\nimport { addTokens, loadTokensCache } from '../common/tokens';\nimport { resolveDataPreloadPromise } from './preload';\nimport { tryUpdateStakingCommonData } from './staking';\nimport { swapGetAssets } from './swap';\n\nconst SEC = 1000;\nconst BACKEND_INTERVAL = 30 * SEC;\nconst LONG_BACKEND_INTERVAL = 60 * SEC;\nconst INCORRECT_TIME_DIFF = 30 * SEC;\n\nconst { ton } = chains;\n\nlet onUpdate: OnApiUpdate;\n\nexport async function initPolling(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n\n  await tryUpdatePrices();\n\n  void Promise.allSettled([\n    tryUpdateKnownAddresses(),\n    tryUpdateTokens(_onUpdate, true),\n    tryUpdateSwapTokens(_onUpdate),\n    tryUpdateStakingCommonData(),\n  ]).then(() => resolveDataPreloadPromise());\n\n  void tryUpdateConfig(_onUpdate);\n\n  void setupBackendPolling();\n  void setupLongBackendPolling();\n  if (IS_AIR_APP) void ton.setupInactiveAccountsBalancePolling(onUpdate);\n}\n\nexport async function setupBackendPolling() {\n  const localOnUpdate = onUpdate;\n\n  while (isUpdaterAlive(localOnUpdate)) {\n    await pauseOrFocus(BACKEND_INTERVAL);\n    if (!isUpdaterAlive(localOnUpdate)) return;\n\n    try {\n      await tryUpdatePrices(localOnUpdate);\n      await tryUpdateTokens(localOnUpdate);\n    } catch (err) {\n      logDebugError('setupBackendPolling', err);\n    }\n  }\n}\n\nexport async function setupLongBackendPolling() {\n  const localOnUpdate = onUpdate;\n\n  while (isUpdaterAlive(localOnUpdate)) {\n    await pauseOrFocus(LONG_BACKEND_INTERVAL);\n\n    await Promise.all([\n      tryUpdateKnownAddresses(),\n      tryUpdateStakingCommonData(),\n      tryUpdateConfig(localOnUpdate),\n      tryUpdateSwapTokens(localOnUpdate),\n    ]);\n  }\n}\n\nexport async function tryUpdatePrices(localOnUpdate?: OnApiUpdate) {\n  if (!localOnUpdate) {\n    localOnUpdate = onUpdate;\n  }\n\n  try {\n    const baseCurrency = await getBaseCurrency();\n    const pricesData = await callBackendGet<Record<string, ApiTokenPrice>>('/prices/current', {\n      base: baseCurrency,\n    });\n\n    if (!isUpdaterAlive(localOnUpdate)) return;\n\n    const prices = getPricesCache();\n    prices.bySlug = buildCollectionByKey(Object.values(pricesData), 'slug');\n    prices.baseCurrency = baseCurrency;\n  } catch (err) {\n    logDebugError('tryUpdatePrices', err);\n  }\n}\n\nexport async function tryUpdateTokens(localOnUpdate?: OnApiUpdate, isFirstRun?: boolean) {\n  if (!localOnUpdate) {\n    localOnUpdate = onUpdate;\n  }\n\n  if (isFirstRun) {\n    await loadTokensCache();\n  }\n\n  try {\n    let tokens = await callBackendGet<any[]>('/known-tokens');\n    tokens = tokens.map((token) => ({\n      ...omit(token, ['minterAddress']),\n      tokenAddress: token.minterAddress,\n      chain: 'ton',\n    }));\n\n    if (!isUpdaterAlive(localOnUpdate)) return;\n\n    await addTokens(tokens, onUpdate, true);\n  } catch (err) {\n    logDebugError('tryUpdateTokens', err);\n  }\n}\n\nexport async function tryUpdateSwapTokens(localOnUpdate?: OnApiUpdate) {\n  if (!localOnUpdate) {\n    localOnUpdate = onUpdate;\n  }\n\n  try {\n    const assets = await swapGetAssets();\n\n    if (!isUpdaterAlive(localOnUpdate)) return;\n\n    const prices = getPricesCache();\n    const tokens = assets.reduce((acc: Record<string, ApiSwapAsset>, asset) => {\n      acc[asset.slug] = {\n        // Fix legacy variable names\n        ...omit(asset as any, ['blockchain']) as ApiSwapAsset,\n        chain: 'blockchain' in asset ? asset.blockchain as string : asset.chain,\n        tokenAddress: 'contract' in asset && asset.contract !== TONCOIN.symbol\n          ? asset.contract as string\n          : asset.tokenAddress,\n        price: prices.bySlug[asset.slug]?.price ?? 0,\n      };\n      return acc;\n    }, {});\n\n    onUpdate({\n      type: 'updateSwapTokens',\n      tokens,\n    });\n  } catch (err) {\n    logDebugError('tryUpdateSwapTokens', err);\n  }\n}\n\nexport async function tryUpdateConfig(localOnUpdate: OnApiUpdate) {\n  try {\n    const {\n      isLimited,\n      isCopyStorageEnabled = false,\n      supportAccountsCount = 1,\n      now: serverUtc,\n      country: countryCode,\n      isUpdateRequired: isAppUpdateRequired,\n    } = await callBackendGet<{\n      isLimited: boolean;\n      isCopyStorageEnabled?: boolean;\n      supportAccountsCount?: number;\n      now: number;\n      country: ApiCountryCode;\n      isUpdateRequired: boolean;\n    }>('/utils/get-config');\n\n    if (!isUpdaterAlive(localOnUpdate)) return;\n\n    onUpdate({\n      type: 'updateConfig',\n      isLimited,\n      isCopyStorageEnabled,\n      supportAccountsCount,\n      countryCode,\n      isAppUpdateRequired,\n    });\n\n    const localUtc = (new Date()).getTime();\n    if (Math.abs(serverUtc - localUtc) > INCORRECT_TIME_DIFF) {\n      onUpdate({\n        type: 'incorrectTime',\n      });\n    }\n  } catch (err) {\n    logDebugError('tryUpdateRegion', err);\n  }\n}\n","import type { CHAIN, ConnectEventError, ConnectEventSuccess } from '@tonconnect/protocol';\n\nexport interface TransactionPayload {\n  valid_until?: number;\n  network?: CHAIN;\n  from?: string; // https://github.com/ton-blockchain/ton-connect/blob/main/wallet-guidelines.md#multi-accounts\n  messages: TransactionPayloadMessage[];\n}\n\nexport interface TransactionPayloadMessage {\n  address: string;\n  amount: string;\n  payload?: string;\n  stateInit?: string;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport enum CONNECT_EVENT_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  MANIFEST_NOT_FOUND_ERROR = 2,\n  MANIFEST_CONTENT_ERROR = 3,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport enum SEND_TRANSACTION_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport enum SIGN_DATA_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\nexport type AllErrorCodes = CONNECT_EVENT_ERROR_CODES | SEND_TRANSACTION_ERROR_CODES | SIGN_DATA_ERROR_CODES;\nexport type ConnectEvent = ConnectEventSuccess | ConnectEventError;\n\nexport interface ApiTonConnectProof {\n  timestamp: number;\n  domain: string;\n  payload: string;\n}\n","import type { DeviceInfo } from '@tonconnect/protocol';\n\nimport {\n  APP_NAME, IS_EXTENSION, IS_TELEGRAM_APP, TONCONNECT_PROTOCOL_VERSION,\n} from '../config';\nimport packageJson from '../../package.json';\nimport { W5_MAX_MESSAGES } from '../api/chains/ton/constants';\n\ntype DevicePlatform = DeviceInfo['platform'];\n\n/*\n This function is called in TonConnect `connect` method (where we know the wallet version)\n and in JS Bridge (where no account is selected, so we show maximum number of messages).\n*/\nexport function tonConnectGetDeviceInfo(maxMessages = W5_MAX_MESSAGES): DeviceInfo {\n  return {\n    platform: getPlatform()!,\n    appName: APP_NAME,\n    appVersion: packageJson.version,\n    maxProtocolVersion: TONCONNECT_PROTOCOL_VERSION,\n    features: [\n      'SendTransaction', // TODO DEPRECATED\n      { name: 'SendTransaction', maxMessages },\n    ],\n  };\n}\n\nfunction getPlatform(): DevicePlatform {\n  const { userAgent } = navigator;\n  const platform = navigator.platform || navigator?.userAgentData?.platform || '';\n\n  const macosPlatforms = ['macOS', 'Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n  const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];\n  const iphonePlatforms = ['iPhone'];\n  const ipadPlatforms = ['iPad', 'iPod'];\n\n  let devicePlatform: DevicePlatform | undefined;\n\n  if (IS_EXTENSION || IS_TELEGRAM_APP) {\n    devicePlatform = 'browser';\n  } else if (/Android/.test(userAgent)) {\n    devicePlatform = 'android';\n  } else if (iphonePlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'iphone';\n  } else if (ipadPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'ipad';\n  } else if (macosPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'mac';\n  } else if (windowsPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'windows';\n  } else if (/Linux/.test(platform)) {\n    devicePlatform = 'linux';\n  } else {\n    devicePlatform = 'browser';\n  }\n\n  return devicePlatform;\n}\n","// eslint-disable-next-line max-classes-per-file\nimport type { ApiAnyDisplayError } from '../types';\nimport type { AllErrorCodes } from './types';\nimport { ApiTransactionError } from '../types';\nimport { CONNECT_EVENT_ERROR_CODES } from './types';\n\nimport { ApiBaseError } from '../errors';\n\nexport class TonConnectError extends ApiBaseError {\n  code: number;\n\n  constructor(message: string, code: AllErrorCodes = 0, displayError?: ApiAnyDisplayError) {\n    super(message);\n    this.code = code;\n    this.displayError = displayError;\n  }\n}\n\nexport class ManifestContentError extends TonConnectError {\n  constructor(message = 'Manifest content error') {\n    super(message, CONNECT_EVENT_ERROR_CODES.MANIFEST_CONTENT_ERROR);\n  }\n}\n\nexport class UnknownError extends TonConnectError {\n  constructor(message = 'Unknown error.') {\n    super(message, 0);\n  }\n}\n\nexport class BadRequestError extends TonConnectError {\n  constructor(message = 'Bad request', displayError?: ApiAnyDisplayError) {\n    super(message, 1, displayError);\n  }\n}\n\nexport class UnknownAppError extends TonConnectError {\n  constructor(message = 'Unknown app error') {\n    super(message, 100);\n  }\n}\n\nexport class UserRejectsError extends TonConnectError {\n  constructor(message = 'The user rejected the action') {\n    super(message, 300);\n  }\n}\n\nexport class InsufficientBalance extends BadRequestError {\n  constructor(message = 'Insufficient balance') {\n    super(message, ApiTransactionError.InsufficientBalance);\n  }\n}\n","import type { ApiDappTransfer, ApiParsedPayload } from '../types';\n\nimport { isNftTransferPayload, isTokenTransferPayload } from '../../util/ton/transfer';\nimport { ONE_TON } from '../chains/ton/constants';\n\nconst MAX_SINGLE_AMOUNT_AS_FEE = 1n * ONE_TON;\nconst MAX_TOTAL_AMOUNT_AS_FEE = 3n * ONE_TON;\n\nexport function isValidString(value: any, maxLength = 100) {\n  return typeof value === 'string' && value.length <= maxLength;\n}\n\nexport function isValidUrl(url: string) {\n  const isString = isValidString(url, 255);\n  if (!isString) return false;\n\n  try {\n    // eslint-disable-next-line no-new\n    new URL(url);\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function getTransferActualToAddress(toAddress: string, payload: ApiParsedPayload | undefined) {\n  // This function implementation is not complete. That is, other transfer types may have another actual \"to\" address.\n  if (isNftTransferPayload(payload)) {\n    return payload.newOwner;\n  }\n  if (isTokenTransferPayload(payload)) {\n    return payload.destination;\n  }\n  return toAddress;\n}\n\nexport function isTransferPayloadDangerous(payload: ApiParsedPayload | undefined) {\n  return payload?.type === 'unknown';\n}\n\n/**\n * If applicable and safe, makes the transfers' amounts act as a fee. Returns a mapped list of the given dapp transfers.\n */\nexport function showDappTransferAmountsAsFee(transfers: ApiDappTransfer[]) {\n  // Large TON amounts should be shown as a fee, because the fee is barely noticeable in the UI. This function doesn't\n  // consider the emulated `received` amount, because it's not reliable and can be tampered by scammers.\n\n  const totalAmountAsFee = transfers.reduce((sum, transfer) => (\n    sum + (shouldShowTransferAmountAsFee(transfer) ? transfer.displayedAmount : 0n)\n  ), 0n);\n\n  if (totalAmountAsFee === 0n || totalAmountAsFee > MAX_TOTAL_AMOUNT_AS_FEE) {\n    return transfers;\n  }\n\n  return transfers.map((transfer) => {\n    if (!shouldShowTransferAmountAsFee(transfer)) {\n      return transfer;\n    }\n    return {\n      ...transfer,\n      displayedAmount: 0n,\n      fullFee: transfer.fullFee + transfer.displayedAmount,\n    };\n  });\n}\n\nfunction shouldShowTransferAmountAsFee({ amount, payload }: ApiDappTransfer) {\n  return amount <= MAX_SINGLE_AMOUNT_AS_FEE\n    && (isNftTransferPayload(payload) || isTokenTransferPayload(payload));\n}\n","/* TonConnect specification https://github.com/ton-blockchain/ton-connect */\n\nimport { Address, Cell } from '@ton/core';\nimport type {\n  ConnectEventError,\n  ConnectItemReply,\n  ConnectRequest,\n  DisconnectRpcRequest,\n  DisconnectRpcResponse,\n  SendTransactionRpcRequest,\n  SendTransactionRpcResponse,\n  SignDataRpcRequest,\n  TonProofItem,\n  TonProofItemReplySuccess,\n} from '@tonconnect/protocol';\nimport { CHAIN } from '@tonconnect/protocol';\nimport nacl from 'tweetnacl';\n\nimport type { ApiCheckMultiTransactionDraftResult, TonTransferParams } from '../chains/ton/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic,\n  ApiAnyDisplayError,\n  ApiDappMetadata,\n  ApiDappRequest,\n  ApiDappTransfer,\n  ApiNetwork,\n  ApiSignedTransfer,\n  ApiTonWallet,\n  OnApiUpdate,\n} from '../types';\nimport type {\n  ApiTonConnectProof, ConnectEvent, TransactionPayload, TransactionPayloadMessage,\n} from './types';\nimport { ApiCommonError, ApiTransactionError } from '../types';\nimport { CONNECT_EVENT_ERROR_CODES, SEND_TRANSACTION_ERROR_CODES, SIGN_DATA_ERROR_CODES } from './types';\n\nimport { IS_EXTENSION, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { bigintDivideToNumber } from '../../util/bigint';\nimport { logDebugError } from '../../util/logs';\nimport { fetchJsonMetadata } from '../../util/metadata';\nimport safeExec from '../../util/safeExec';\nimport { tonConnectGetDeviceInfo } from '../../util/tonConnectEnvironment';\nimport chains from '../chains';\nimport { getContractInfo, parsePayloadBase64 } from '../chains/ton';\nimport { fetchKeyPair } from '../chains/ton/auth';\nimport { DEFAULT_MAX_MESSAGES, LEDGER_MAX_MESSAGES, W5_MAX_MESSAGES } from '../chains/ton/constants';\nimport {\n  getIsRawAddress, getWalletPublicKey, toBase64Address, toRawAddress,\n} from '../chains/ton/util/tonCore';\nimport {\n  fetchStoredAccount,\n  getCurrentAccountId,\n  getCurrentAccountIdOrFail,\n} from '../common/accounts';\nimport { getKnownAddressInfo } from '../common/addresses';\nimport { createDappPromise } from '../common/dappPromises';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { bytesToBase64, hexToBytes, sha256 } from '../common/utils';\nimport * as apiErrors from '../errors';\nimport { ApiServerError } from '../errors';\nimport { callHook } from '../hooks';\nimport {\n  activateDapp,\n  addDapp,\n  deactivateAccountDapp,\n  deactivateDapp,\n  deleteDapp,\n  findLastConnectedAccount,\n  getDapp,\n  getDappsByOrigin,\n  updateDapp,\n} from '../methods/dapps';\nimport { createLocalTransaction } from '../methods/transactions';\nimport * as errors from './errors';\nimport { UnknownAppError } from './errors';\nimport {\n  getTransferActualToAddress,\n  isTransferPayloadDangerous,\n  isValidString,\n  isValidUrl,\n  showDappTransferAmountsAsFee,\n} from './utils';\n\nconst BLANK_GIF_DATA_URL = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n\nconst ton = chains.ton;\n\nlet resolveInit: AnyFunction;\nconst initPromise = new Promise((resolve) => {\n  resolveInit = resolve;\n});\n\nlet onPopupUpdate: OnApiUpdate;\n\nexport function initTonConnect(_onPopupUpdate: OnApiUpdate) {\n  onPopupUpdate = _onPopupUpdate;\n  resolveInit();\n}\n\nexport async function connect(request: ApiDappRequest, message: ConnectRequest, id: number): Promise<ConnectEvent> {\n  try {\n    await openExtensionPopup(true);\n\n    onPopupUpdate({\n      type: 'dappLoading',\n      connectionType: 'connect',\n      isSse: request && 'sseOptions' in request,\n    });\n\n    const dappMetadata = await fetchDappMetadata(message.manifestUrl);\n\n    if (!IS_EXTENSION) {\n      request.origin = dappMetadata.origin;\n    }\n\n    const { origin } = await validateRequest(request, true);\n\n    const addressItem = message.items.find(({ name }) => name === 'ton_addr');\n    const proofItem = message.items.find(({ name }) => name === 'ton_proof') as TonProofItem | undefined;\n    const proof = proofItem ? {\n      timestamp: Math.round(Date.now() / 1000),\n      domain: new URL(origin).host,\n      payload: proofItem.payload,\n    } : undefined;\n\n    if (!addressItem) {\n      throw new errors.BadRequestError(\"Missing 'ton_addr'\");\n    }\n\n    if (proof && !proof.domain.includes('.')) {\n      throw new errors.BadRequestError('Invalid domain');\n    }\n\n    let accountId = await getCurrentAccountOrFail();\n\n    const { promiseId, promise } = createDappPromise();\n\n    const dapp = {\n      ...dappMetadata,\n      origin,\n      connectedAt: Date.now(),\n      ...('sseOptions' in request && {\n        sse: request.sseOptions,\n      }),\n    };\n\n    onPopupUpdate({\n      type: 'dappConnect',\n      identifier: 'identifier' in request ? request.identifier : undefined,\n      promiseId,\n      accountId,\n      dapp,\n      permissions: {\n        address: true,\n        proof: !!proof,\n      },\n      proof,\n    });\n\n    const promiseResult: {\n      accountId?: string;\n      password?: string;\n      signature?: string;\n    } | undefined = await promise;\n\n    accountId = promiseResult!.accountId!;\n    request.accountId = accountId;\n    await addDapp(accountId, dapp);\n    activateDapp(accountId, origin);\n\n    const account = await fetchStoredAccount(accountId);\n    const { address } = account.ton;\n\n    const maxMessages = getMaxMessages(account);\n    const deviceInfo = tonConnectGetDeviceInfo(maxMessages);\n    const items: ConnectItemReply[] = [\n      await buildTonAddressReplyItem(accountId, account.ton),\n    ];\n\n    if (proof) {\n      const { password, signature } = promiseResult!;\n\n      let proofReplyItem: TonProofItemReplySuccess;\n      if (password) {\n        proofReplyItem = await signTonProof(accountId, account as ApiAccountWithMnemonic, password, address, proof!);\n      } else {\n        proofReplyItem = buildTonProofReplyItem(proof, signature!);\n      }\n\n      items.push(proofReplyItem);\n    }\n\n    onPopupUpdate({ type: 'updateDapps' });\n    onPopupUpdate({ type: 'dappConnectComplete' });\n\n    return {\n      event: 'connect',\n      id,\n      payload: {\n        items,\n        device: deviceInfo,\n      },\n    };\n  } catch (err) {\n    logDebugError('tonConnect:connect', err);\n\n    safeExec(() => {\n      onPopupUpdate({\n        type: 'dappCloseLoading',\n      });\n    });\n\n    return formatConnectError(id, err as Error);\n  }\n}\n\nexport async function reconnect(request: ApiDappRequest, id: number): Promise<ConnectEvent> {\n  try {\n    const { origin, accountId } = await validateRequest(request);\n\n    activateDapp(accountId, origin);\n    const currentDapp = await getDapp(accountId, origin);\n    if (!currentDapp) {\n      throw new UnknownAppError();\n    }\n\n    await updateDapp(accountId, origin, { connectedAt: Date.now() });\n\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n\n    const maxMessages = getMaxMessages(account);\n    const deviceInfo = tonConnectGetDeviceInfo(maxMessages);\n    const items: ConnectItemReply[] = [\n      await buildTonAddressReplyItem(accountId, account.ton),\n    ];\n\n    return {\n      event: 'connect',\n      id,\n      payload: {\n        items,\n        device: deviceInfo,\n      },\n    };\n  } catch (e) {\n    logDebugError('tonConnect:reconnect', e);\n    return formatConnectError(id, e as Error);\n  }\n}\n\nfunction getMaxMessages(account: ApiAccountAny) {\n  const { type, ton: { version } } = account;\n\n  if (type === 'ledger') {\n    return LEDGER_MAX_MESSAGES;\n  } else if (version === 'W5') {\n    return W5_MAX_MESSAGES;\n  } else {\n    return DEFAULT_MAX_MESSAGES;\n  }\n}\n\nexport async function disconnect(\n  request: ApiDappRequest,\n  message: DisconnectRpcRequest,\n): Promise<DisconnectRpcResponse> {\n  try {\n    const { origin, accountId } = await validateRequest(request);\n\n    await deleteDapp(accountId, origin, true);\n    deactivateAccountDapp(accountId);\n    onPopupUpdate({ type: 'updateDapps' });\n  } catch (err) {\n    logDebugError('tonConnect:disconnect', err);\n  }\n  return {\n    id: message.id,\n    result: {},\n  };\n}\n\nexport async function sendTransaction(\n  request: ApiDappRequest,\n  message: SendTransactionRpcRequest,\n): Promise<SendTransactionRpcResponse> {\n  try {\n    const { origin, accountId } = await validateRequest(request);\n    const { network } = parseAccountId(accountId);\n\n    const txPayload = JSON.parse(message.params[0]) as TransactionPayload;\n    const { messages, network: dappNetworkRaw } = txPayload;\n\n    const account = await fetchStoredAccount(accountId);\n    const {\n      type, ton: {\n        address,\n        publicKey: publicKeyHex,\n      },\n    } = account;\n\n    const maxMessages = getMaxMessages(account);\n\n    if (messages.length > maxMessages) {\n      throw new errors.BadRequestError(`Payload contains more than ${maxMessages} messages, which exceeds limit`);\n    }\n\n    const dappNetwork = dappNetworkRaw\n      ? (dappNetworkRaw === CHAIN.MAINNET ? 'mainnet' : 'testnet')\n      : undefined;\n    let validUntil = txPayload.valid_until;\n    if (validUntil && validUntil > 10 ** 10) {\n      // If milliseconds were passed instead of seconds\n      validUntil = Math.round(validUntil / 1000);\n    }\n\n    const isLedger = type === 'ledger';\n\n    let vestingAddress: string | undefined;\n\n    if (txPayload.from && toBase64Address(txPayload.from) !== toBase64Address(address)) {\n      const publicKey = hexToBytes(publicKeyHex);\n      if (isLedger && await checkIsHisVestingWallet(network, publicKey, txPayload.from)) {\n        vestingAddress = txPayload.from;\n      } else {\n        throw new errors.BadRequestError(undefined, ApiTransactionError.WrongAddress);\n      }\n    }\n\n    if (dappNetwork && network !== dappNetwork) {\n      throw new errors.BadRequestError(undefined, ApiTransactionError.WrongNetwork);\n    }\n\n    await openExtensionPopup(true);\n\n    onPopupUpdate({\n      type: 'dappLoading',\n      connectionType: 'sendTransaction',\n      accountId,\n      isSse: Boolean('sseOptions' in request && request.sseOptions),\n    });\n\n    const {\n      preparedMessages,\n      checkResult,\n    } = await checkTransactionMessages(accountId, messages, network);\n\n    const dapp = (await getDappsByOrigin(accountId))[origin];\n    const transactionsForRequest = await prepareTransactionForRequest(network, messages, checkResult);\n\n    const { promiseId, promise } = createDappPromise();\n\n    onPopupUpdate({\n      type: 'dappSendTransactions',\n      promiseId,\n      accountId,\n      dapp,\n      transactions: transactionsForRequest,\n      vestingAddress,\n    });\n\n    // eslint-disable-next-line prefer-const\n    const response: string | ApiSignedTransfer[] = await promise;\n\n    if (validUntil && validUntil < (Date.now() / 1000)) {\n      throw new errors.BadRequestError('The confirmation timeout has expired');\n    }\n\n    let boc: string | undefined;\n    let error: string | undefined;\n    let msgHash: string | undefined;\n\n    if (isLedger) {\n      const signedTransfers = response as ApiSignedTransfer[];\n      ({ boc, msgHash } = await ton.sendSignedMessage(accountId, signedTransfers[0]));\n    } else {\n      const password = response as string;\n      const submitResult = await ton.submitMultiTransfer({\n        accountId, password, messages: preparedMessages, expireAt: validUntil,\n      });\n      if ('error' in submitResult) {\n        error = submitResult.error;\n      } else {\n        ({ boc, msgHash } = submitResult);\n      }\n    }\n\n    if (error) {\n      throw new errors.UnknownError(error);\n    }\n\n    transactionsForRequest.forEach(({ amount, normalizedAddress, payload }) => {\n      const comment = payload?.type === 'comment' ? payload.comment : undefined;\n      createLocalTransaction(accountId, 'ton', {\n        amount,\n        fromAddress: address,\n        toAddress: normalizedAddress,\n        comment,\n        fee: checkResult.fee!,\n        slug: TONCOIN.slug,\n        inMsgHash: msgHash,\n      });\n    });\n\n    return {\n      result: boc!,\n      id: message.id,\n    };\n  } catch (err) {\n    logDebugError('tonConnect:sendTransaction', err);\n\n    safeExec(() => {\n      onPopupUpdate({\n        type: 'dappCloseLoading',\n      });\n    });\n\n    let code = SEND_TRANSACTION_ERROR_CODES.UNKNOWN_ERROR;\n    let errorMessage = 'Unhandled error';\n    let displayError: ApiAnyDisplayError | undefined;\n\n    if (err instanceof apiErrors.ApiUserRejectsError) {\n      code = SEND_TRANSACTION_ERROR_CODES.USER_REJECTS_ERROR;\n      errorMessage = err.message;\n    } else if (err instanceof errors.TonConnectError) {\n      code = err.code;\n      errorMessage = err.message;\n      displayError = err.displayError;\n    } else if (err instanceof ApiServerError) {\n      displayError = err.displayError;\n    } else {\n      displayError = ApiCommonError.Unexpected;\n    }\n\n    if (onPopupUpdate && isUpdaterAlive(onPopupUpdate) && displayError) {\n      onPopupUpdate({\n        type: 'showError',\n        error: displayError,\n      });\n    }\n    return {\n      error: {\n        code,\n        message: errorMessage,\n      },\n      id: message.id,\n    };\n  }\n}\n\nasync function checkIsHisVestingWallet(network: ApiNetwork, ownerPublicKey: Uint8Array, address: string) {\n  const [info, publicKey] = await Promise.all([\n    getContractInfo(network, address),\n    getWalletPublicKey(network, address),\n  ]);\n\n  return info.contractInfo?.name === 'vesting' && areDeepEqual(ownerPublicKey, publicKey);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function signData(request: ApiDappRequest, message: SignDataRpcRequest) {\n  return {\n    error: {\n      code: SIGN_DATA_ERROR_CODES.METHOD_NOT_SUPPORTED,\n      message: 'Method not supported',\n    },\n    id: message.id,\n  };\n}\n\nasync function checkTransactionMessages(\n  accountId: string,\n  messages: TransactionPayloadMessage[],\n  network: ApiNetwork,\n) {\n  const preparedMessages: TonTransferParams[] = messages.map((msg) => {\n    const {\n      address: toAddress,\n      amount,\n      payload,\n      stateInit,\n    } = msg;\n\n    return {\n      toAddress: getIsRawAddress(toAddress)\n        ? toBase64Address(toAddress, true, network)\n        : toAddress,\n      amount: BigInt(amount),\n      payload: payload ? Cell.fromBase64(payload) : undefined,\n      stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    };\n  });\n\n  const checkResult = await ton.checkMultiTransactionDraft(accountId, preparedMessages, false, true);\n\n  return {\n    preparedMessages,\n    checkResult,\n  };\n}\n\nasync function prepareTransactionForRequest(\n  network: ApiNetwork,\n  messages: TransactionPayloadMessage[],\n  checkResult: ApiCheckMultiTransactionDraftResult,\n) {\n  if (!checkResult.emulation && checkResult.fee === undefined) {\n    throw new Error('Both `emulation` and `fee` miss in the check result');\n  }\n\n  const transactions = await Promise.all(messages.map(\n    async ({\n      address,\n      amount: rawAmount,\n      payload: rawPayload,\n      stateInit,\n    }, index): Promise<ApiDappTransfer> => {\n      const amount = BigInt(rawAmount);\n      const toAddress = getIsRawAddress(address) ? toBase64Address(address, true, network) : address;\n      // Fix address format for `waitTxComplete` to work properly\n      const normalizedAddress = toBase64Address(address, undefined, network);\n      const payload = rawPayload ? await parsePayloadBase64(network, toAddress, rawPayload) : undefined;\n      const { isScam } = getKnownAddressInfo(normalizedAddress) || {};\n      const emulationResult = checkResult.emulation?.byTransactionIndex[index];\n\n      return {\n        toAddress,\n        amount,\n        rawPayload,\n        payload,\n        stateInit,\n        normalizedAddress,\n        isScam,\n        isDangerous: isTransferPayloadDangerous(payload),\n        displayedToAddress: getTransferActualToAddress(toAddress, payload),\n        displayedAmount: amount,\n        fullFee: emulationResult?.fee ?? bigintDivideToNumber(checkResult.fee!, messages.length),\n        received: emulationResult?.received ?? 0n,\n      };\n    },\n  ));\n\n  return showDappTransferAmountsAsFee(transactions);\n}\n\nexport async function deactivate(request: ApiDappRequest) {\n  try {\n    const { origin } = await validateRequest(request, true);\n\n    deactivateDapp(origin);\n  } catch (err) {\n    logDebugError('tonConnect:deactivate', err);\n  }\n}\n\nfunction formatConnectError(id: number, error: Error): ConnectEventError {\n  let code = CONNECT_EVENT_ERROR_CODES.UNKNOWN_ERROR;\n  let message = 'Unhandled error';\n\n  if (error instanceof apiErrors.ApiUserRejectsError) {\n    code = CONNECT_EVENT_ERROR_CODES.USER_REJECTS_ERROR;\n    message = error.message;\n  } else if (error instanceof errors.TonConnectError) {\n    code = error.code;\n    message = error.message;\n  }\n\n  return {\n    id,\n    event: 'connect_error',\n    payload: {\n      code,\n      message,\n    },\n  };\n}\n\nasync function buildTonAddressReplyItem(accountId: string, wallet: ApiTonWallet): Promise<ConnectItemReply> {\n  const { network } = parseAccountId(accountId);\n  const { publicKey, address } = wallet;\n\n  const stateInit = await ton.getWalletStateInit(accountId, wallet);\n\n  return {\n    name: 'ton_addr',\n    address: toRawAddress(address),\n    network: network === 'mainnet' ? CHAIN.MAINNET : CHAIN.TESTNET,\n    publicKey,\n    walletStateInit: stateInit\n      .toBoc({ idx: true, crc32: true })\n      .toString('base64'),\n  };\n}\n\nasync function signTonProof(\n  accountId: string,\n  account: ApiAccountWithMnemonic,\n  password: string,\n  walletAddress: string,\n  proof: ApiTonConnectProof,\n): Promise<TonProofItemReplySuccess> {\n  const keyPair = await fetchKeyPair(accountId, password, account);\n  const { timestamp, domain, payload } = proof;\n\n  const timestampBuffer = Buffer.allocUnsafe(8);\n  timestampBuffer.writeBigInt64LE(BigInt(timestamp));\n\n  const domainBuffer = Buffer.from(domain);\n  const domainLengthBuffer = Buffer.allocUnsafe(4);\n  domainLengthBuffer.writeInt32LE(domainBuffer.byteLength);\n\n  const address = Address.parse(walletAddress);\n\n  const addressWorkchainBuffer = Buffer.allocUnsafe(4);\n  addressWorkchainBuffer.writeInt32BE(address.workChain);\n\n  const addressBuffer = Buffer.concat([\n    addressWorkchainBuffer,\n    address.hash,\n  ]);\n\n  const messageBuffer = Buffer.concat([\n    Buffer.from('ton-proof-item-v2/', 'utf8'),\n    addressBuffer,\n    domainLengthBuffer,\n    domainBuffer,\n    timestampBuffer,\n    Buffer.from(payload),\n  ]);\n\n  const bufferToSign = Buffer.concat([\n    Buffer.from('ffff', 'hex'),\n    Buffer.from('ton-connect', 'utf8'),\n    Buffer.from(await sha256(messageBuffer)),\n  ]);\n\n  const signature = nacl.sign.detached(\n    Buffer.from(await sha256(bufferToSign)),\n    keyPair!.secretKey,\n  );\n\n  return buildTonProofReplyItem(proof, bytesToBase64(signature));\n}\n\nfunction buildTonProofReplyItem(proof: ApiTonConnectProof, signature: string): TonProofItemReplySuccess {\n  const { timestamp, domain, payload } = proof;\n  const domainBuffer = Buffer.from(domain);\n\n  return {\n    name: 'ton_proof',\n    proof: {\n      timestamp,\n      domain: {\n        lengthBytes: domainBuffer.byteLength,\n        value: domainBuffer.toString('utf8'),\n      },\n      signature,\n      payload,\n    },\n  };\n}\n\nexport async function fetchDappMetadata(manifestUrl: string, origin?: string): Promise<ApiDappMetadata> {\n  try {\n    const data = await fetchJsonMetadata(manifestUrl);\n\n    const { url, name, iconUrl } = await data;\n    const safeIconUrl = (iconUrl.startsWith('data:') || iconUrl === '') ? BLANK_GIF_DATA_URL : iconUrl;\n    if (!isValidUrl(url) || !isValidString(name) || !isValidUrl(safeIconUrl)) {\n      throw new Error('Invalid data');\n    }\n\n    return {\n      origin: origin ?? new URL(url).origin,\n      url,\n      name,\n      iconUrl: safeIconUrl,\n      manifestUrl,\n    };\n  } catch (err) {\n    logDebugError('fetchDapp', err);\n    throw new errors.ManifestContentError();\n  }\n}\n\nasync function validateRequest(request: ApiDappRequest, skipConnection = false) {\n  const { origin } = request;\n  if (!origin) {\n    throw new errors.BadRequestError('Invalid origin');\n  }\n\n  let accountId = '';\n  if (request.accountId) {\n    accountId = request.accountId;\n  } else if (!skipConnection) {\n    const { network } = parseAccountId(await getCurrentAccountIdOrFail());\n    const lastAccountId = await findLastConnectedAccount(network, origin);\n    if (!lastAccountId) {\n      throw new errors.BadRequestError('The connection is outdated, try relogin');\n    }\n    accountId = lastAccountId;\n  }\n\n  return { origin, accountId };\n}\n\nasync function openExtensionPopup(force?: boolean) {\n  if (!IS_EXTENSION || (!force && onPopupUpdate && isUpdaterAlive(onPopupUpdate))) {\n    return false;\n  }\n\n  await callHook('onWindowNeeded');\n  await initPromise;\n\n  return true;\n}\n\nasync function getCurrentAccountOrFail() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) {\n    throw new errors.BadRequestError('The user is not authorized in the wallet');\n  }\n  return accountId;\n}\n","import type {\n  AppRequest,\n  ConnectRequest,\n  DisconnectEvent,\n  RpcRequests,\n} from '@tonconnect/protocol';\nimport nacl, { randomBytes } from 'tweetnacl';\n\nimport type { ApiDappRequest, ApiSseOptions, OnApiUpdate } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport { handleFetchErrors } from '../../util/fetch';\nimport { extractKey } from '../../util/iteratees';\nimport { logDebug, logDebugError } from '../../util/logs';\nimport safeExec from '../../util/safeExec';\nimport { getCurrentNetwork, waitLogin } from '../common/accounts';\nimport { bytesToHex } from '../common/utils';\nimport { getDappsState, getSseLastEventId, setSseLastEventId } from '../methods/dapps';\nimport * as tonConnect from './index';\n\ntype SseDapp = {\n  accountId: string;\n  origin: string;\n} & ApiSseOptions;\n\ntype ReturnStrategy = 'back' | 'none' | string;\n\nconst BRIDGE_URL = 'https://tonconnectbridge.mytonwallet.org/bridge';\nconst TTL_SEC = 300;\nconst NONCE_SIZE = 24;\nconst MAX_CONFIRM_DURATION = 60 * 1000;\n\nlet sseEventSource: EventSource | undefined;\nlet sseDapps: SseDapp[] = [];\nlet delayedReturnParams: {\n  validUntil: number;\n  url: string;\n  isFromInAppBrowser?: boolean;\n} | undefined;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initSse(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function startSseConnection({\n  url, isFromInAppBrowser, identifier,\n}: {\n  url: string;\n  isFromInAppBrowser?: boolean;\n  identifier?: string;\n}): Promise<ReturnStrategy | undefined> {\n  const { searchParams: params, origin } = new URL(url);\n\n  const ret: ReturnStrategy = params.get('ret') || 'back';\n  const version = Number(params.get('v') as string);\n  const appClientId = params.get('id') as string;\n  // `back` strategy cannot be implemented\n  const shouldOpenUrl = ret !== 'back' && ret !== 'none';\n  const r = params.get('r');\n\n  if (!r) {\n    if (shouldOpenUrl) {\n      delayedReturnParams = {\n        validUntil: Date.now() + MAX_CONFIRM_DURATION,\n        url: ret,\n        isFromInAppBrowser,\n      };\n    }\n    return undefined;\n  }\n\n  const connectRequest: ConnectRequest | null = safeExec(() => JSON.parse(r)) || JSON.parse(decodeURIComponent(r));\n\n  logDebug('SSE Start connection:', {\n    version, appClientId, connectRequest, ret, origin, identifier,\n  });\n\n  const { secretKey: secretKeyArray, publicKey: publicKeyArray } = nacl.box.keyPair();\n  const secretKey = bytesToHex(secretKeyArray);\n  const clientId = bytesToHex(publicKeyArray);\n\n  const lastOutputId = 0;\n  const request: ApiDappRequest = {\n    identifier,\n    sseOptions: {\n      clientId,\n      appClientId,\n      secretKey,\n      lastOutputId,\n    },\n  };\n\n  await waitLogin();\n\n  if (!connectRequest) {\n    onUpdate({\n      type: 'showError',\n      error: 'Invalid TON Connect link',\n    });\n\n    return undefined;\n  }\n\n  const result = await tonConnect.connect(request, connectRequest, lastOutputId);\n\n  await sendMessage(result, secretKey, clientId, appClientId);\n\n  if (result.event !== 'connect_error') {\n    await resetupSseConnection();\n  }\n\n  if (!shouldOpenUrl) {\n    return undefined;\n  }\n\n  return ret;\n}\n\nexport async function resetupSseConnection() {\n  const [lastEventId, dappsState, network] = await Promise.all([\n    getSseLastEventId(),\n    getDappsState(),\n    getCurrentNetwork(),\n  ]);\n\n  if (!dappsState || !network) {\n    return;\n  }\n\n  sseDapps = Object.entries(dappsState).reduce((result, [accountId, dapps]) => {\n    if (parseAccountId(accountId).network === network) {\n      for (const dapp of Object.values(dapps)) {\n        if (dapp.sse?.clientId) {\n          result.push({\n            ...dapp.sse,\n            accountId,\n            origin: dapp.origin,\n          });\n        }\n      }\n    }\n    return result;\n  }, [] as SseDapp[]);\n\n  const clientIds = extractKey(sseDapps, 'clientId').filter(Boolean);\n  if (!clientIds.length) {\n    return;\n  }\n\n  closeEventSource();\n  sseEventSource = openEventSource(clientIds, lastEventId);\n\n  sseEventSource.onopen = () => {\n    logDebug('EventSource opened');\n  };\n\n  sseEventSource.onerror = (e) => {\n    logDebugError('EventSource', e.type);\n  };\n\n  sseEventSource.onmessage = async (event) => {\n    const { from, message: encryptedMessage } = JSON.parse(event.data);\n\n    const sseDapp = sseDapps.find(({ appClientId }) => appClientId === from);\n    if (!sseDapp) {\n      logDebug(`Dapp with clientId ${from} not found`);\n      return;\n    }\n\n    const {\n      accountId, clientId, appClientId, secretKey, origin, lastOutputId,\n    } = sseDapp;\n    const message = decryptMessage(encryptedMessage, appClientId, secretKey) as AppRequest<keyof RpcRequests>;\n\n    logDebug('SSE Event:', message);\n\n    await setSseLastEventId(event.lastEventId);\n    const sseOptions = {\n      clientId,\n      appClientId,\n      secretKey,\n      lastOutputId,\n    };\n\n    // @ts-ignore\n    const result = await tonConnect[message.method]({ origin, accountId, sseOptions }, message);\n\n    await sendMessage(result, secretKey, clientId, appClientId);\n\n    if (delayedReturnParams) {\n      const { validUntil, url, isFromInAppBrowser } = delayedReturnParams;\n      if (validUntil > Date.now()) {\n        onUpdate({ type: 'openUrl', url, isExternal: !isFromInAppBrowser });\n      }\n      delayedReturnParams = undefined;\n    }\n  };\n}\n\nexport async function sendSseDisconnect(accountId: string, origin: string) {\n  const sseDapp = sseDapps.find((dapp) => dapp.origin === origin && dapp.accountId === accountId);\n  if (!sseDapp) return;\n\n  const { secretKey, clientId, appClientId } = sseDapp;\n  const lastOutputId = sseDapp.lastOutputId + 1;\n\n  const response: DisconnectEvent = {\n    event: 'disconnect',\n    id: lastOutputId,\n    payload: {},\n  };\n\n  await sendMessage(response, secretKey, clientId, appClientId);\n}\n\nfunction sendMessage(\n  message: AnyLiteral, secretKey: string, clientId: string, toId: string, topic?: 'signTransaction' | 'signData',\n) {\n  const buffer = Buffer.from(JSON.stringify(message));\n  const encryptedMessage = encryptMessage(buffer, toId, secretKey);\n  return sendRawMessage(encryptedMessage, clientId, toId, topic);\n}\n\nasync function sendRawMessage(body: string, clientId: string, toId: string, topic?: 'signTransaction' | 'signData') {\n  const url = new URL(`${BRIDGE_URL}/message`);\n  url.searchParams.set('client_id', clientId);\n  url.searchParams.set('to', toId);\n  url.searchParams.set('ttl', TTL_SEC.toString());\n  if (topic) {\n    url.searchParams.set('topic', topic);\n  }\n\n  const response = await fetch(url, { method: 'POST', body });\n  await handleFetchErrors(response);\n}\n\nfunction closeEventSource() {\n  if (!sseEventSource) return;\n\n  safeExec(() => { sseEventSource!.close(); });\n  sseEventSource = undefined;\n}\n\nfunction openEventSource(clientIds: string[], lastEventId?: string) {\n  const url = new URL(`${BRIDGE_URL}/events`);\n  url.searchParams.set('client_id', clientIds.join(','));\n  if (lastEventId) {\n    url.searchParams.set('last_event_id', lastEventId);\n  }\n  return new EventSource(url);\n}\n\nfunction encryptMessage(message: Uint8Array, publicKey: string, secretKey: string) {\n  const nonce = randomBytes(NONCE_SIZE);\n  const encrypted = nacl.box(\n    message, nonce, Buffer.from(publicKey, 'hex'), Buffer.from(secretKey, 'hex'),\n  );\n  return Buffer.concat([nonce, encrypted]).toString('base64');\n}\n\nfunction decryptMessage(message: string, publicKey: string, secretKey: string) {\n  const fullBuffer = Buffer.from(message, 'base64');\n  const nonce = fullBuffer.subarray(0, NONCE_SIZE);\n  const encrypted = fullBuffer.subarray(NONCE_SIZE);\n  const decrypted = nacl.box.open(\n    encrypted,\n    nonce,\n    Buffer.from(publicKey, 'hex'),\n    Buffer.from(secretKey, 'hex'),\n  );\n  const jsonText = new TextDecoder('utf-8').decode(decrypted!);\n  return JSON.parse(jsonText);\n}\n","import type { ApiBaseCurrency, ApiHistoryList, ApiPriceHistoryPeriod } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY, TONCOIN } from '../../config';\nimport { callBackendGet } from '../common/backend';\nimport { waitDataPreload } from './preload';\nimport { getTokenBySlug } from './tokens';\n\nexport { setBaseCurrency, getBaseCurrency } from '../common/prices';\n\nexport async function fetchPriceHistory(\n  slug: string,\n  period: ApiPriceHistoryPeriod,\n  baseCurrency: ApiBaseCurrency = DEFAULT_PRICE_CURRENCY,\n): Promise<ApiHistoryList | undefined> {\n  await waitDataPreload();\n  const token = getTokenBySlug(slug);\n\n  if (!token) {\n    return [];\n  }\n\n  const assetId = token.chain === TONCOIN.chain && token.tokenAddress ? token.tokenAddress : token.symbol;\n\n  return callBackendGet(`/prices/chart/${assetId}`, {\n    base: baseCurrency,\n    period,\n  });\n}\n","import type {\n  ApiSubscribeNotificationsProps, ApiSubscribeNotificationsResult, ApiUnsubscribeNotificationsProps,\n} from '../types';\n\nimport { logDebugError } from '../../util/logs';\nimport { callBackendPost } from '../common/backend';\nimport { handleServerError } from '../errors';\n\nexport async function subscribeNotifications(props: ApiSubscribeNotificationsProps) {\n  try {\n    return await callBackendPost<ApiSubscribeNotificationsResult>(\n      '/notifications/subscribe', props, { shouldRetry: true },\n    );\n  } catch (err) {\n    logDebugError('subscribeNotifications', err);\n    return handleServerError(err);\n  }\n}\n\nexport async function unsubscribeNotifications(props: ApiUnsubscribeNotificationsProps) {\n  try {\n    return await callBackendPost<{ ok: true }>(\n      '/notifications/unsubscribe', props, { shouldRetry: true },\n    );\n  } catch (err) {\n    logDebugError('unsubscribeNotifications', err);\n    return handleServerError(err);\n  }\n}\n","import type { ApiInitArgs, OnApiUpdate } from '../types';\n\nimport { IS_EXTENSION } from '../../config';\nimport { initWindowConnector } from '../../util/windowProvider/connector';\nimport chains from '../chains';\nimport { callBackendGet } from '../common/backend';\nimport { connectUpdater, startStorageMigration } from '../common/helpers';\nimport { setEnvironment } from '../environment';\nimport { addHooks } from '../hooks';\nimport { storage } from '../storages';\nimport * as tonConnect from '../tonConnect';\nimport * as tonConnectSse from '../tonConnect/sse';\nimport * as methods from '.';\n\naddHooks({\n  onDappDisconnected: tonConnectSse.sendSseDisconnect,\n  onDappsChanged: tonConnectSse.resetupSseConnection,\n});\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport default async function init(onUpdate: OnApiUpdate, args: ApiInitArgs) {\n  connectUpdater(onUpdate);\n  const environment = setEnvironment(args);\n\n  if (!IS_EXTENSION) {\n    initWindowConnector();\n  }\n\n  methods.initAccounts(onUpdate);\n  void methods.initPolling(onUpdate);\n  methods.initTransactions(onUpdate);\n  methods.initStaking();\n  methods.initSwap(onUpdate);\n\n  if (environment.isDappSupported) {\n    methods.initDapps(onUpdate);\n    tonConnect.initTonConnect(onUpdate);\n  }\n\n  if (environment.isSseSupported) {\n    tonConnectSse.initSse(onUpdate);\n  }\n\n  await startStorageMigration(onUpdate, chains.ton);\n\n  if (environment.isSseSupported) {\n    void tonConnectSse.resetupSseConnection();\n  }\n\n  void saveReferrer(args);\n}\n\nasync function saveReferrer(args: ApiInitArgs) {\n  let referrer = await storage.getItem('referrer');\n\n  if (referrer !== undefined) return;\n\n  if (args.referrer) {\n    referrer = args.referrer;\n  } else {\n    ({ referrer } = await callBackendGet<{ referrer?: string }>('/referrer/get'));\n  }\n\n  // An empty string means no referrer\n  await storage.setItem('referrer', referrer ?? '');\n}\n","import type { StorageKey } from '../storages/types';\n\nimport { storage } from '../storages';\n\ntype OldAccount = {\n  address: string;\n  publicKey: string;\n  version: string;\n  ledger?: {\n    index: number;\n    driver: string;\n    deviceId?: string;\n    deviceName?: string;\n  };\n  authToken?: string;\n  isInitialized?: boolean;\n};\n\nexport async function start() {\n  const oldAccountById: Record<string, OldAccount> | undefined = await storage.getItem('accounts');\n\n  if (!oldAccountById) return;\n\n  const mnemonicById: Record<string, string> = await storage.getItem('mnemonicsEncrypted' as StorageKey);\n  const newAccountById: Record<string, any> = {};\n\n  for (const [accountId, oldAccount] of Object.entries(oldAccountById)) {\n    const {\n      address, version, publicKey, authToken, ledger, isInitialized,\n    } = oldAccount;\n\n    const tonWallet = {\n      type: 'ton',\n      address,\n      version,\n      publicKey,\n      authToken,\n      isInitialized,\n      index: ledger?.index ?? 0,\n    };\n\n    newAccountById[accountId] = ledger ? {\n      type: 'ledger',\n      ton: tonWallet,\n      driver: ledger.driver,\n      deviceId: ledger.deviceId,\n      deviceName: ledger.deviceName,\n    } : {\n      type: 'ton',\n      mnemonicEncrypted: mnemonicById[accountId],\n      ton: tonWallet,\n    };\n  }\n\n  await storage.setItem('accounts', newAccountById);\n}\n","import type {\n  MethodArgs, Methods,\n} from '../../methods/types';\nimport type { TonConnectMethodArgs, TonConnectMethods } from '../../tonConnect/types/misc';\nimport type {\n  ApiInitArgs, OnApiUpdate,\n} from '../../types';\n\nimport { createPostMessageInterface } from '../../../util/createPostMessageInterface';\nimport * as methods from '../../methods';\nimport init from '../../methods/init';\nimport * as tonConnectApi from '../../tonConnect';\n\ncreatePostMessageInterface((name: string, origin?: string, ...args: any[]) => {\n  if (name === 'init') {\n    return init(args[0] as OnApiUpdate, args[1] as ApiInitArgs);\n  } else {\n    if (name.startsWith('tonConnect_')) {\n      name = name.replace('tonConnect_', '');\n      const method = tonConnectApi[name as keyof TonConnectMethods];\n      // @ts-ignore\n      return method(...args as TonConnectMethodArgs<keyof TonConnectMethods>);\n    }\n\n    const method = methods[name as keyof Methods];\n\n    // @ts-ignore\n    return method(...args as MethodArgs<keyof Methods>);\n  }\n});\n","export enum ApiCommonError {\n  Unexpected = 'Unexpected',\n  ServerError = 'ServerError',\n  DebugError = 'DebugError',\n  UnsupportedVersion = 'UnsupportedVersion',\n}\n\nexport enum ApiAuthError {\n  InvalidMnemonic = 'InvalidMnemonic',\n}\n\nexport enum ApiTransactionDraftError {\n  InvalidAmount = 'InvalidAmount',\n  InvalidToAddress = 'InvalidToAddress',\n  InsufficientBalance = 'InsufficientBalance',\n  InvalidStateInit = 'InvalidStateInit',\n  StateInitWithoutBin = 'StateInitWithoutBin',\n  DomainNotResolved = 'DomainNotResolved',\n  WalletNotInitialized = 'WalletNotInitialized',\n  InvalidAddressFormat = 'InvalidAddressFormat',\n  InactiveContract = 'InactiveContract',\n}\n\nexport enum ApiTransactionError {\n  PartialTransactionFailure = 'PartialTransactionFailure',\n  IncorrectDeviceTime = 'IncorrectDeviceTime',\n  InsufficientBalance = 'InsufficientBalance',\n  UnsuccesfulTransfer = 'UnsuccesfulTransfer',\n  NotSupportedHardwareOperation = 'NotSupportedHardwareOperation',\n  HardwareBlindSigningNotEnabled = 'HardwareBlindSigningNotEnabled',\n  WrongAddress = 'WrongAddress',\n  WrongNetwork = 'WrongNetwork',\n}\n\nexport type ApiAnyDisplayError = ApiCommonError | ApiAuthError | ApiTransactionDraftError | ApiTransactionError;\n","import type { ApiTonWalletVersion } from '../chains/ton/types';\nimport type { ApiParsedPayload } from './payload';\nimport type { ApiSseOptions } from './storage';\n\nexport type ApiChain = 'ton' | 'tron';\nexport type ApiNetwork = 'mainnet' | 'testnet';\nexport type ApiLedgerDriver = 'HID' | 'USB';\n\nexport interface AccountIdParsed {\n  id: number;\n  network: ApiNetwork;\n}\n\nexport interface ApiInitArgs {\n  isElectron: boolean;\n  isNativeBottomSheet: boolean;\n  isIosApp: boolean;\n  isAndroidApp: boolean;\n  referrer?: string;\n}\n\nexport interface ApiToken {\n  name: string;\n  symbol: string;\n  slug: string;\n  decimals: number;\n  chain: ApiChain;\n  tokenAddress?: string;\n  image?: string;\n  isPopular?: boolean;\n  keywords?: string[];\n  cmcSlug?: string;\n  color?: string;\n  isGaslessEnabled?: boolean;\n  isStarsEnabled?: boolean;\n  isTiny?: boolean;\n  customPayloadApiUrl?: string;\n  codeHash?: string;\n}\n\nexport interface ApiTokenWithPrice extends ApiToken {\n  quote: ApiTokenPrice;\n}\n\nexport interface ApiTokenPrice {\n  slug: string;\n  price: number;\n  priceUsd: number;\n  percentChange24h: number;\n}\n\nexport type ApiKnownAddresses = Record<string, ApiAddressInfo>;\n\nexport interface ApiAddressInfo {\n  name?: string;\n  isScam?: boolean;\n  isMemoRequired?: boolean;\n}\n\nexport type ApiTxTimestamps = Record<string, number | undefined>;\nexport type ApiTransactionType = 'stake' | 'unstake' | 'unstakeRequest' | 'swap'\n| 'nftTransferred' | 'nftReceived' | undefined;\n\nexport interface ApiTransaction {\n  txId: string;\n  timestamp: number;\n  amount: bigint;\n  fromAddress: string;\n  toAddress: string;\n  comment?: string;\n  encryptedComment?: string;\n  fee: bigint;\n  slug: string;\n  isIncoming: boolean;\n  normalizedAddress: string; // Only for TON now\n  inMsgHash?: string; // Only for TON\n  shouldHide?: boolean;\n  type?: ApiTransactionType;\n  metadata?: ApiTransactionMetadata;\n  nft?: ApiNft;\n}\n\nexport interface ApiTransactionMetadata extends ApiAddressInfo {\n}\n\nexport type ApiMtwCardType = 'black' | 'platinum' | 'gold' | 'silver' | 'standard';\nexport type ApiMtwCardTextType = 'light' | 'dark';\nexport type ApiMtwCardBorderShineType = 'up' | 'down' | 'left' | 'right' | 'radioactive';\n\nexport interface ApiNftMetadata {\n  lottie?: string;\n  imageUrl?: string;\n  fragmentUrl?: string;\n  mtwCardId?: number;\n  mtwCardType?: ApiMtwCardType;\n  mtwCardTextType?: ApiMtwCardTextType;\n  mtwCardBorderShineType?: ApiMtwCardBorderShineType;\n}\n\nexport interface ApiNft {\n  index: number;\n  ownerAddress?: string;\n  name?: string;\n  address: string;\n  thumbnail: string;\n  image: string;\n  description?: string;\n  collectionName?: string;\n  collectionAddress?: string;\n  isOnSale: boolean;\n  isHidden?: boolean;\n  isOnFragment?: boolean;\n  isScam?: boolean;\n  metadata: ApiNftMetadata;\n}\n\nexport type ApiHistoryList = Array<[number, number]>;\n\nexport type ApiStakingType = 'nominators' | 'liquid' | 'jetton';\n\ntype BaseStakingState = {\n  id: string;\n  tokenSlug: string;\n  annualYield: number;\n  yieldType: ApiYieldType;\n  balance: bigint;\n  pool: string;\n  isUnstakeRequested?: boolean;\n};\n\nexport type ApiNominatorsStakingState = BaseStakingState & {\n  type: 'nominators';\n  start: number;\n  end: number;\n  pendingDepositAmount: bigint;\n};\n\nexport type ApiLiquidStakingState = BaseStakingState & {\n  type: 'liquid';\n  tokenBalance: bigint;\n  unstakeRequestAmount: bigint;\n  instantAvailable: bigint;\n};\n\nexport type ApiJettonStakingState = BaseStakingState & {\n  type: 'jetton';\n  tokenAddress: string;\n  unclaimedRewards: bigint;\n  stakeWalletAddress: string;\n  tokenAmount: bigint;\n  period: number;\n  tvl: bigint;\n  dailyReward: bigint;\n  poolWallets?: string[];\n};\n\nexport type ApiYieldType = 'APY' | 'APR';\nexport type ApiStakingState = ApiNominatorsStakingState | ApiLiquidStakingState | ApiJettonStakingState;\nexport type ApiToncoinStakingState = ApiNominatorsStakingState | ApiLiquidStakingState;\n\nexport interface ApiNominatorsPool {\n  address: string;\n  apy: number;\n  start: number;\n  end: number;\n}\n\nexport interface ApiBackendStakingState {\n  balance: bigint;\n  totalProfit: bigint;\n  type?: ApiStakingType;\n  nominatorsPool: ApiNominatorsPool;\n  loyaltyType?: ApiLoyaltyType;\n  shouldUseNominators?: boolean;\n  stakedAt?: number;\n}\n\nexport type ApiStakingHistory = {\n  timestamp: number;\n  profit: string;\n}[];\n\nexport interface ApiDappPermissions {\n  isAddressRequired?: boolean;\n  isPasswordRequired?: boolean;\n}\n\nexport type ApiDappRequest = {\n  origin?: string;\n  accountId?: string;\n  identifier?: string;\n  sseOptions?: ApiSseOptions;\n} | {\n  origin: string;\n  accountId: string;\n};\n\nexport interface ApiTransferToSign {\n  toAddress: string;\n  amount: bigint;\n  rawPayload?: string;\n  payload?: ApiParsedPayload;\n  stateInit?: string;\n}\n\nexport interface ApiDappTransfer extends ApiTransferToSign {\n  isScam?: boolean;\n  /** Whether the transfer should be treated with cautiousness, because its payload is unclear */\n  isDangerous: boolean;\n  normalizedAddress: string;\n  /** The transfer address to show in the UI */\n  displayedToAddress: string;\n  /**\n   * The transaction TON amount that should be shown in the UI.\n   * It may be less than `amount` because the difference is added to `fullFee`.\n   */\n  displayedAmount: bigint;\n  /** The transaction full fee to show in the UI. Includes the network fee and the TON amount used as a fee. */\n  fullFee: bigint;\n  /**\n   * The TON amount that will be returned back as a result of the transaction.\n   * - If `fullFee`  `excess`, the UI should show the difference as the real fee;\n   * - Otherwise, the UI should show the difference as the returned amount.\n   */\n  received: bigint;\n}\n\nexport interface ApiSignedTransfer {\n  base64: string;\n  seqno: number;\n  params: Omit<ApiLocalTransactionParams, 'inMsgHash'>;\n}\n\n/**\n * The `fee` field should contain the final (real) fee, because we want to show the real fee in local transactions\n */\nexport type ApiLocalTransactionParams = Omit<\nApiTransaction, 'txId' | 'timestamp' | 'isIncoming' | 'normalizedAddress'\n> & {\n  txId?: string;\n  normalizedAddress?: string;\n};\n\nexport type ApiBaseCurrency = 'USD' | 'EUR' | 'RUB' | 'CNY' | 'BTC' | 'TON';\n\nexport enum ApiLiquidUnstakeMode {\n  Default,\n  Instant,\n  BestRate,\n}\n\nexport type ApiLoyaltyType = 'black' | 'platinum' | 'gold' | 'silver' | 'standard';\n\nexport type ApiBalanceBySlug = Record<string, bigint>;\n\nexport type ApiWalletInfo = {\n  address: string;\n  version: ApiTonWalletVersion;\n  balance: bigint;\n  isInitialized: boolean;\n  lastTxId?: string;\n};\n\n// Country codes from ISO-3166-1 spec\nexport type ApiCountryCode = 'AF' | 'AX' | 'AL' | 'DZ' | 'AS' | 'AD' | 'AO' | 'AI' | 'AQ' | 'AG' | 'AR'\n| 'AM' | 'AW' | 'AU' | 'AT' | 'AZ' | 'BS' | 'BH' | 'BD' | 'BB' | 'BY' | 'BE' | 'BZ' | 'BJ' | 'BM'\n| 'BT' | 'BO' | 'BQ' | 'BA' | 'BW' | 'BV' | 'BR' | 'IO' | 'BN' | 'BG' | 'BF' | 'BI' | 'CV' | 'KH'\n| 'CM' | 'CA' | 'KY' | 'CF' | 'TD' | 'CL' | 'CN' | 'CX' | 'CC' | 'CO' | 'KM' | 'CG' | 'CD' | 'CK'\n| 'CR' | 'CI' | 'HR' | 'CU' | 'CW' | 'CY' | 'CZ' | 'DK' | 'DJ' | 'DM' | 'DO' | 'EC' | 'EG' | 'SV'\n| 'GQ' | 'ER' | 'EE' | 'SZ' | 'ET' | 'FK' | 'FO' | 'FJ' | 'FI' | 'FR' | 'GF' | 'PF' | 'TF' | 'GA'\n| 'GM' | 'GE' | 'DE' | 'GH' | 'GI' | 'GR' | 'GL' | 'GD' | 'GP' | 'GU' | 'GT' | 'GG' | 'GN' | 'GW'\n| 'GY' | 'HT' | 'HM' | 'VA' | 'HN' | 'HK' | 'HU' | 'IS' | 'IN' | 'ID' | 'IR' | 'IQ' | 'IE' | 'IM'\n| 'IL' | 'IT' | 'JM' | 'JP' | 'JE' | 'JO' | 'KZ' | 'KE' | 'KI' | 'KP' | 'KR' | 'KW' | 'KG' | 'LA'\n| 'LV' | 'LB' | 'LS' | 'LR' | 'LY' | 'LI' | 'LT' | 'LU' | 'MO' | 'MG' | 'MW' | 'MY' | 'MV' | 'ML'\n| 'MT' | 'MH' | 'MQ' | 'MR' | 'MU' | 'YT' | 'MX' | 'FM' | 'MD' | 'MC' | 'MN' | 'ME' | 'MS' | 'MA'\n| 'MZ' | 'MM' | 'NA' | 'NR' | 'NP' | 'NL' | 'NC' | 'NZ' | 'NI' | 'NE' | 'NG' | 'NU' | 'NF' | 'MP'\n| 'NO' | 'OM' | 'PK' | 'PW' | 'PS' | 'PA' | 'PG' | 'PY' | 'PE' | 'PH' | 'PN' | 'PL' | 'PT' | 'PR'\n| 'QA' | 'MK' | 'RO' | 'RU' | 'RW' | 'RE' | 'BL' | 'SH' | 'KN' | 'LC' | 'MF' | 'PM' | 'VC' | 'WS'\n| 'SM' | 'ST' | 'SA' | 'SN' | 'RS' | 'SC' | 'SL' | 'SG' | 'SX' | 'SK' | 'SI' | 'SB' | 'SO' | 'ZA'\n| 'GS' | 'SS' | 'ES' | 'LK' | 'SD' | 'SR' | 'SJ' | 'SE' | 'CH' | 'SY' | 'TW' | 'TJ' | 'TZ' | 'TH'\n| 'TL' | 'TG' | 'TK' | 'TO' | 'TT' | 'TN' | 'TR' | 'TM' | 'TC' | 'TV' | 'UG' | 'UA' | 'AE' | 'GB'\n| 'US' | 'UM' | 'UY' | 'UZ' | 'VU' | 'VE' | 'VN' | 'VG' | 'VI' | 'WF' | 'EH' | 'YE' | 'ZM' | 'ZW';\n","import type { ApiTonWalletVersion } from './api/chains/ton/types';\nimport type {\n  ApiBaseCurrency,\n  ApiLiquidStakingState,\n  ApiNominatorsStakingState,\n  ApiSwapAsset,\n  ApiSwapDexLabel,\n} from './api/types';\nimport type { LangItem, TokenPeriod } from './global/types';\n\nexport const APP_ENV = process.env.APP_ENV;\n\nexport const IS_CORE_WALLET = process.env.IS_CORE_WALLET === '1';\nexport const APP_NAME = process.env.APP_NAME || (IS_CORE_WALLET ? 'TON Wallet' : 'MyTonWallet');\nexport const APP_VERSION = process.env.APP_VERSION!;\nexport const APP_ENV_MARKER = APP_ENV === 'staging' ? 'Beta' : APP_ENV === 'development' ? 'Dev' : undefined;\nexport const EXTENSION_NAME = IS_CORE_WALLET ? 'TON Wallet' : 'MyTonWallet  My TON Wallet';\nexport const EXTENSION_DESCRIPTION = IS_CORE_WALLET\n  ? 'Set up your own TON Wallet on The Open Network'\n  // eslint-disable-next-line max-len\n  : 'The most feature-rich TON extension  with support of multi-accounts, tokens, NFT, TON DNS, TON Sites, TON Proxy, and TON Magic.';\n\nexport const DEBUG = APP_ENV !== 'production' && APP_ENV !== 'perf' && APP_ENV !== 'test';\nexport const DEBUG_MORE = false;\nexport const DEBUG_API = false;\n\nexport const IS_PRODUCTION = APP_ENV === 'production';\nexport const IS_TEST = APP_ENV === 'test';\nexport const IS_PERF = APP_ENV === 'perf';\nexport const IS_EXTENSION = process.env.IS_EXTENSION === '1';\nexport const IS_FIREFOX_EXTENSION = process.env.IS_FIREFOX_EXTENSION === '1';\nexport const IS_OPERA_EXTENSION = process.env.IS_OPERA_EXTENSION === '1';\nexport const IS_PACKAGED_ELECTRON = process.env.IS_PACKAGED_ELECTRON === '1';\nexport const IS_CAPACITOR = process.env.IS_CAPACITOR === '1';\nexport const IS_ANDROID_DIRECT = process.env.IS_ANDROID_DIRECT === '1';\nexport const IS_AIR_APP = process.env.IS_AIR_APP === '1';\nexport const IS_TELEGRAM_APP = process.env.IS_TELEGRAM_APP === '1';\n\nexport const ELECTRON_HOST_URL = 'https://dumb-host';\nexport const INACTIVE_MARKER = '[Inactive]';\nexport const PRODUCTION_URL = IS_CORE_WALLET ? 'https://wallet.ton.org' : 'https://mytonwallet.app';\nexport const BETA_URL = IS_CORE_WALLET ? 'https://beta.wallet.ton.org' : 'https://beta.mytonwallet.app';\nexport const APP_INSTALL_URL = 'https://get.mytonwallet.io/';\nexport const APP_REPO_URL = 'https://github.com/mytonwalletorg/mytonwallet';\nexport const BASE_URL = process.env.BASE_URL;\n\nexport const BOT_USERNAME = process.env.BOT_USERNAME || 'MyTonWalletBot';\n\nexport const SWAP_FEE_ADDRESS = process.env.SWAP_FEE_ADDRESS || 'UQDUkQbpTVIgt7v66-JTFR-3-eXRFz_4V66F-Ufn6vOg0GOp';\nexport const DIESEL_ADDRESS = process.env.DIESEL_ADDRESS || 'UQC9lQOaEHC6YASiJJ2NrKEOlITMMQmc8j0_iZEHy-4sl3tG';\n\nexport const STRICTERDOM_ENABLED = DEBUG && !IS_PACKAGED_ELECTRON;\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\n\nexport const PIN_LENGTH = 4;\nexport const NATIVE_BIOMETRICS_USERNAME = IS_CORE_WALLET ? 'TonWallet' : 'MyTonWallet';\nexport const NATIVE_BIOMETRICS_SERVER = IS_CORE_WALLET ? 'https://wallet.ton.org' : 'https://mytonwallet.app';\n\nexport const IS_BIP39_MNEMONIC_ENABLED = !IS_CORE_WALLET;\nexport const MNEMONIC_COUNT = 24;\nexport const MNEMONIC_COUNTS = IS_BIP39_MNEMONIC_ENABLED ? [12, 24] : [24];\n\nexport const PRIVATE_KEY_HEX_LENGTH = 64;\nexport const MNEMONIC_CHECK_COUNT = 3;\n\nexport const MOBILE_SCREEN_MAX_WIDTH = 700; // px\n\nexport const ANIMATION_END_DELAY = 50;\n\nexport const ANIMATED_STICKER_TINY_ICON_PX = 16;\nexport const ANIMATED_STICKER_ICON_PX = 30;\nexport const ANIMATED_STICKER_TINY_SIZE_PX = 70;\nexport const ANIMATED_STICKER_SMALL_SIZE_PX = 110;\nexport const ANIMATED_STICKER_MIDDLE_SIZE_PX = 120;\nexport const ANIMATED_STICKER_DEFAULT_PX = 150;\nexport const ANIMATED_STICKER_BIG_SIZE_PX = 156;\nexport const ANIMATED_STICKER_HUGE_SIZE_PX = 192;\n\nexport const DEFAULT_LANDSCAPE_ACTION_TAB_ID = 0;\nexport const TRANSACTION_ADDRESS_SHIFT = 4;\n\nexport const WHOLE_PART_DELIMITER = ''; // https://www.compart.com/en/unicode/U+202F\n\nexport const DEFAULT_SLIPPAGE_VALUE = 5;\n\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_KEY = IS_CORE_WALLET ? 'tonwallet-global-state' : 'mytonwallet-global-state';\n\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MAX;\nexport const THEME_DEFAULT = 'system';\n\nexport const MAIN_ACCOUNT_ID = '0-ton-mainnet';\n\nexport const TONCENTER_MAINNET_URL = process.env.TONCENTER_MAINNET_URL || 'https://toncenter.mytonwallet.org';\nexport const TONCENTER_MAINNET_KEY = process.env.TONCENTER_MAINNET_KEY;\nexport const ELECTRON_TONCENTER_MAINNET_KEY = process.env.ELECTRON_TONCENTER_MAINNET_KEY;\nexport const TONAPIIO_MAINNET_URL = process.env.TONAPIIO_MAINNET_URL || 'https://tonapiio.mytonwallet.org';\n\nexport const TONCENTER_TESTNET_URL = process.env.TONCENTER_TESTNET_URL || 'https://toncenter-testnet.mytonwallet.org';\nexport const TONCENTER_TESTNET_KEY = process.env.TONCENTER_TESTNET_KEY;\nexport const ELECTRON_TONCENTER_TESTNET_KEY = process.env.ELECTRON_TONCENTER_TESTNET_KEY;\nexport const TONAPIIO_TESTNET_URL = process.env.TONAPIIO_TESTNET_URL || 'https://tonapiio-testnet.mytonwallet.org';\n\nexport const BRILLIANT_API_BASE_URL = process.env.BRILLIANT_API_BASE_URL || 'https://api.mytonwallet.org';\n\nexport const TRON_MAINNET_API_URL = process.env.TRON_MAINNET_API_URL || 'https://tronapi.mytonwallet.org';\nexport const TRON_TESTNET_API_URL = process.env.TRON_TESTNET_API_URL || 'https://api.shasta.trongrid.io';\n\nexport const FRACTION_DIGITS = 9;\nexport const SHORT_FRACTION_DIGITS = 2;\n\nexport const MAX_PUSH_NOTIFICATIONS_ACCOUNT_COUNT = 3;\n\nexport const SUPPORT_USERNAME = 'mysupport';\nexport const MTW_TIPS_CHANNEL_NAME = { en: 'MyTonWalletTips', ru: 'MyTonWalletTipsRu' };\nexport const MTW_CARDS_BASE_URL = 'https://static.mytonwallet.org/cards/';\nexport const MYTONWALLET_PROMO_URL = 'https://mytonwallet.io/';\nexport const TELEGRAM_WEB_URL = 'https://web.telegram.org/a/';\nexport const NFT_MARKETPLACE_URL = 'https://getgems.io/';\nexport const NFT_MARKETPLACE_TITLE = 'GetGems';\nexport const GETGEMS_BASE_MAINNET_URL = 'https://getgems.io/';\nexport const GETGEMS_BASE_TESTNET_URL = 'https://testnet.getgems.io/';\nexport const HELPCENTER_URL = { en: 'https://help.mytonwallet.io/', ru: 'https://help.mytonwallet.io/ru' };\nexport const EMPTY_HASH_VALUE = 'NOHASH';\n\nexport const CHANGELLY_SUPPORT_EMAIL = 'support@changelly.com';\nexport const CHANGELLY_LIVE_CHAT_URL = 'https://changelly.com/';\nexport const CHANGELLY_SECURITY_EMAIL = 'security@changelly.com';\nexport const CHANGELLY_TERMS_OF_USE = 'https://changelly.com/terms-of-use';\nexport const CHANGELLY_PRIVACY_POLICY = 'https://changelly.com/privacy-policy';\nexport const CHANGELLY_AML_KYC = 'https://changelly.com/aml-kyc';\nexport const CHANGELLY_WAITING_DEADLINE = 3 * 60 * 60 * 1000; // 3 hour\n\nexport const PROXY_HOSTS = process.env.PROXY_HOSTS;\n\nexport const TINY_TRANSFER_MAX_COST = 0.01;\n\nexport const IMAGE_CACHE_NAME = 'mtw-image';\nexport const LANG_CACHE_NAME = 'mtw-lang-178';\n\nexport const LANG_LIST: LangItem[] = [{\n  langCode: 'en',\n  name: 'English',\n  nativeName: 'English',\n  rtl: false,\n}, {\n  langCode: 'es',\n  name: 'Spanish',\n  nativeName: 'Espaol',\n  rtl: false,\n}, {\n  langCode: 'ru',\n  name: 'Russian',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'zh-Hans',\n  name: 'Chinese (Simplified)',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'zh-Hant',\n  name: 'Chinese (Traditional)',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'tr',\n  name: 'Turkish',\n  nativeName: 'Trke',\n  rtl: false,\n}, {\n  langCode: 'de',\n  name: 'German',\n  nativeName: 'Deutsch',\n  rtl: false,\n}, {\n  langCode: 'th',\n  name: 'Thai',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'uk',\n  name: 'Ukrainian',\n  nativeName: '',\n  rtl: false,\n}, {\n  langCode: 'pl',\n  name: 'Polish',\n  nativeName: 'Polski',\n  rtl: false,\n}];\n\nexport const IS_STAKING_DISABLED = IS_CORE_WALLET;\nexport const STAKING_CYCLE_DURATION_MS = 131_072_000; // 36.4 hours\nexport const VALIDATION_PERIOD_MS = 65_536_000; // 18.2 h.\nexport const ONE_TON = 1_000_000_000n;\nexport const DEFAULT_FEE = 15_000_000n; // 0.015 TON\n\nexport const STAKING_POOLS = process.env.STAKING_POOLS ? process.env.STAKING_POOLS.split(' ') : [];\nexport const LIQUID_POOL = process.env.LIQUID_POOL || 'EQD2_4d91M4TVbEBVyBF8J1UwpMJc361LKVCz6bBlffMW05o';\nexport const LIQUID_JETTON = process.env.LIQUID_JETTON || 'EQCqC6EhRJ_tpWngKxL6dV0k6DSnRUrs9GSVkLbfdCqsj6TE';\nexport const STAKING_MIN_AMOUNT = ONE_TON;\nexport const NOMINATORS_STAKING_MIN_AMOUNT = 10_000n * ONE_TON;\nexport const MIN_ACTIVE_STAKING_REWARDS = 100_000_000n; // 0.1 MY\n\nexport const TONCONNECT_PROTOCOL_VERSION = 2;\nexport const TONCONNECT_WALLET_JSBRIDGE_KEY = IS_CORE_WALLET ? 'tonwallet' : 'mytonwallet';\n\nexport const NFT_FRAGMENT_COLLECTIONS = new Set([\n  '0:0e41dc1dc3c9067ed24248580e12b3359818d83dee0304fabcf80845eafafdb2', // Anonymous Telegram Numbers\n  '0:80d78a35f955a14b679faa887ff4cd5bfc0f43b4a4eea2a7e6927f3701b273c2', // Telegram Usernames\n]);\nexport const NFT_FRAGMENT_GIFT_IMAGE_URL_PREFIX = 'https://nft.fragment.com/gift/';\nexport const NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX = /^https?:\\/\\/nft\\.(fragment\\.com\\/gift\\/[\\w-]+-\\d+)\\.\\w+$/i;\n\nexport const MTW_CARDS_COLLECTION = 'EQCQE2L9hfwx1V8sgmF9keraHx1rNK9VmgR1ctVvINBGykyM';\nexport const TON_DNS_COLLECTION = 'EQC3dNlesgVD8YbAazcauIrXBPfiVhMMr5YYk2in0Mtsz0Bz';\n\nexport const TONCOIN = {\n  name: 'Toncoin',\n  symbol: 'TON',\n  slug: 'toncoin',\n  decimals: 9,\n  chain: 'ton',\n  cmcSlug: 'toncoin',\n} as const;\n\nexport const TRX = {\n  name: 'TRON',\n  symbol: 'TRX',\n  slug: 'trx',\n  decimals: 6,\n  chain: 'tron',\n  cmcSlug: 'tron',\n} as const;\n\nexport const MYCOIN = {\n  name: 'MyTonWallet Coin',\n  symbol: 'MY',\n  slug: 'ton-eqcfvnlrbn',\n  decimals: 9,\n  chain: 'ton',\n  minterAddress: 'EQCFVNlRb-NHHDQfv3Q9xvDXBLJlay855_xREsq5ZDX6KN-w',\n} as const;\n\nexport const MYCOIN_TESTNET = {\n  ...MYCOIN,\n  slug: 'ton-kqawlxpebw',\n  minterAddress: 'kQAWlxpEbwhCDFX9gp824ee2xVBhAh5VRSGWfbNFDddAbQoQ',\n} as const;\n\nexport const CHAIN_CONFIG = {\n  ton: {\n    isMemoSupported: true,\n    isDnsSupported: true,\n    addressRegex: /^([-\\w_]{48}|0:[\\da-h]{64})$/i,\n    addressPrefixRegex: /^([-\\w_]{1,48}|0:[\\da-h]{0,64})$/i,\n    nativeToken: TONCOIN,\n  },\n  tron: {\n    isMemoSupported: false,\n    isDnsSupported: false,\n    addressRegex: /^T[1-9A-HJ-NP-Za-km-z]{33}$/,\n    addressPrefixRegex: /^T[1-9A-HJ-NP-Za-km-z]{0,33}$/,\n    nativeToken: TRX,\n    mainnet: {\n      apiUrl: TRON_MAINNET_API_URL,\n      usdtAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',\n    },\n    testnet: {\n      apiUrl: TRON_TESTNET_API_URL,\n      usdtAddress: 'TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs',\n    },\n  },\n} as const;\n\nexport const TRC20_USDT_MAINNET_SLUG = 'tron-tr7nhqjekq';\nexport const TRC20_USDT_TESTNET_SLUG = 'tron-tg3xxyexbk';\nexport const TON_USDT_SLUG = 'ton-eqcxe6mutq';\nexport const STAKED_TON_SLUG = 'ton-eqcqc6ehrj';\nexport const STAKED_MYCOIN_SLUG = 'ton-eqcbzvsfwq';\nexport const TRX_SWAP_COUNT_FEE_ADDRESS = 'TW2LXSebZ7Br1zHaiA2W1zRojDkDwjGmpw';\n\nconst TRC20_USDT = {\n  name: 'Tether USD',\n  symbol: 'USDT',\n  decimals: 6,\n  chain: 'tron',\n} as const;\n\nconst TON_USDT = {\n  name: 'Tether USD',\n  symbol: 'USD',\n  chain: 'ton',\n  slug: TON_USDT_SLUG,\n  decimals: 6,\n  tokenAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',\n} as const;\n\nexport const DEFAULT_ENABLED_TOKEN_SLUGS = [\n  TONCOIN.slug, TON_USDT_SLUG, TRX.slug, TRC20_USDT_TESTNET_SLUG, TRC20_USDT_MAINNET_SLUG,\n] as string[];\n\n// Toncoin, USDT TON, TRX, USDT TRC20\nexport const DEFAULT_ENABLED_TOKEN_COUNT = 4;\n\nexport const PRIORITY_TOKEN_SLUGS = [\n  TONCOIN.slug, TON_USDT_SLUG, TRX.slug,\n] as string[];\n\nexport const TOKEN_INFO = {\n  toncoin: {\n    ...TONCOIN,\n    quote: {\n      slug: TONCOIN.slug,\n      price: 1.95,\n      priceUsd: 1.95,\n      percentChange24h: 0,\n    },\n  },\n  trx: {\n    ...TRX,\n    quote: {\n      slug: TRX.slug,\n      price: 0,\n      priceUsd: 0,\n      percentChange24h: 0,\n    },\n  },\n  [TRC20_USDT_MAINNET_SLUG]: { // mainnet\n    ...TRC20_USDT,\n    slug: TRC20_USDT_MAINNET_SLUG,\n    tokenAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',\n    quote: {\n      slug: TRC20_USDT_MAINNET_SLUG,\n      price: 0,\n      priceUsd: 0,\n      percentChange24h: 0,\n    },\n  },\n  [TRC20_USDT_TESTNET_SLUG]: { // testnet\n    ...TRC20_USDT,\n    slug: TRC20_USDT_TESTNET_SLUG,\n    tokenAddress: 'TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs',\n    quote: {\n      slug: TRC20_USDT_TESTNET_SLUG,\n      price: 0,\n      priceUsd: 0,\n      percentChange24h: 0,\n    },\n  },\n  [TON_USDT_SLUG]: {\n    ...TON_USDT,\n    // eslint-disable-next-line max-len\n    image: 'https://cache.tonapi.io/imgproxy/T3PB4s7oprNVaJkwqbGg54nexKE0zzKhcrPv8jcWYzU/rs:fill:200:200:1/g:no/aHR0cHM6Ly90ZXRoZXIudG8vaW1hZ2VzL2xvZ29DaXJjbGUucG5n.webp',\n    quote: {\n      slug: TON_USDT_SLUG,\n      price: 0,\n      priceUsd: 0,\n      percentChange24h: 0,\n    },\n  },\n  [MYCOIN.slug]: {\n    ...MYCOIN,\n    // eslint-disable-next-line max-len\n    image: 'https://cache.tonapi.io/imgproxy/Qy038wCBKISofJ0hYMlj6COWma330cx3Ju1ZSPM2LRU/rs:fill:200:200:1/g:no/aHR0cHM6Ly9teXRvbndhbGxldC5pby9sb2dvLTI1Ni1ibHVlLnBuZw.webp',\n    quote: {\n      slug: MYCOIN.slug,\n      price: 0,\n      priceUsd: 0,\n      percentChange24h: 0,\n    },\n  },\n};\n\nexport const TOKEN_WITH_LABEL: Record<string, string> = {\n  [TRC20_USDT_MAINNET_SLUG]: 'TRC-20',\n  [TRC20_USDT_TESTNET_SLUG]: 'TRC-20',\n  [TON_USDT_SLUG]: 'TON',\n};\n\nexport const INIT_SWAP_ASSETS: Record<string, ApiSwapAsset> = {\n  toncoin: {\n    name: 'Toncoin',\n    symbol: TONCOIN.symbol,\n    chain: TONCOIN.chain,\n    slug: TONCOIN.slug,\n    decimals: TONCOIN.decimals,\n    price: 0,\n    priceUsd: 0,\n    isPopular: true,\n  },\n  [TON_USDT_SLUG]: {\n    name: 'Tether USD',\n    symbol: 'USD',\n    chain: 'ton',\n    slug: TON_USDT_SLUG,\n    decimals: 9,\n    // eslint-disable-next-line max-len\n    image: 'https://cache.tonapi.io/imgproxy/T3PB4s7oprNVaJkwqbGg54nexKE0zzKhcrPv8jcWYzU/rs:fill:200:200:1/g:no/aHR0cHM6Ly90ZXRoZXIudG8vaW1hZ2VzL2xvZ29DaXJjbGUucG5n.webp',\n    tokenAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',\n    price: 0,\n    priceUsd: 0,\n    isPopular: true,\n  },\n};\n\nexport const DEFAULT_TRX_SWAP_FIRST_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_SWAP_FISRT_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_SWAP_SECOND_TOKEN_SLUG = TON_USDT_SLUG;\nexport const DEFAULT_TRANSFER_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_CEX_SWAP_SECOND_TOKEN_SLUG = TRC20_USDT_MAINNET_SLUG;\nexport const SWAP_DEX_LABELS: Record<ApiSwapDexLabel, string> = {\n  dedust: 'DeDust',\n  ston: 'STON.fi',\n};\n\nexport const MULTITAB_DATA_CHANNEL_NAME = IS_CORE_WALLET ? 'tw-multitab' : 'mtw-multitab';\nexport const ACTIVE_TAB_STORAGE_KEY = IS_CORE_WALLET ? 'tw-active-tab' : 'mtw-active-tab';\n\nexport const INDEXED_DB_NAME = 'keyval-store';\nexport const INDEXED_DB_STORE_NAME = 'keyval';\n\nexport const WINDOW_PROVIDER_CHANNEL = 'windowProvider';\n\nexport const SHOULD_SHOW_ALL_ASSETS_AND_ACTIVITY = IS_CORE_WALLET;\nexport const PORTRAIT_MIN_ASSETS_TAB_VIEW = 4;\nexport const LANDSCAPE_MIN_ASSETS_TAB_VIEW = 6;\n\nexport const DEFAULT_PRICE_CURRENCY = 'USD';\nexport const SHORT_CURRENCY_SYMBOL_MAP = {\n  USD: '$',\n  EUR: '',\n  RUB: '',\n  CNY: '',\n};\nexport const CURRENCY_LIST: { value: ApiBaseCurrency; name: string }[] = [\n  {\n    value: 'USD',\n    name: 'US Dollar',\n  }, {\n    value: 'EUR',\n    name: 'Euro',\n  }, {\n    value: 'RUB',\n    name: 'Ruble',\n  }, {\n    value: 'CNY',\n    name: 'Yuan',\n  }, {\n    value: 'BTC',\n    name: 'Bitcoin',\n  }, {\n    value: TONCOIN.symbol,\n    name: 'Toncoin',\n  },\n];\n\nexport const BURN_ADDRESS = 'UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ';\n\nexport const DEFAULT_WALLET_VERSION: ApiTonWalletVersion = 'W5';\nexport const POPULAR_WALLET_VERSIONS: ApiTonWalletVersion[] = ['v3R1', 'v3R2', 'v4R2', 'W5'];\nexport const LEDGER_WALLET_VERSIONS: ApiTonWalletVersion[] = ['v3R2', 'v4R2'];\n\nexport const DEFAULT_TIMEOUT = 10000;\nexport const DEFAULT_RETRIES = 3;\nexport const DEFAULT_ERROR_PAUSE = 500;\n\nexport const HISTORY_PERIODS: TokenPeriod[] = ['1D', '7D', '1M', '3M', '1Y', 'ALL'];\n\nexport const BROWSER_HISTORY_LIMIT = 10;\n\nexport const NFT_BATCH_SIZE = 4;\nexport const NOTCOIN_VOUCHERS_ADDRESS = 'EQDmkj65Ab_m0aZaW8IpKw4kYqIgITw_HRstYEkVQ6NIYCyW';\nexport const BURN_CHUNK_DURATION_APPROX_SEC = 30;\nexport const NOTCOIN_FORWARD_TON_AMOUNT = 30000000n; // 0.03 TON\nexport const NOTCOIN_EXCHANGERS = [\n  'EQAPZauWVPUcm2hUJT9n36pxznEhl46rEn1bzBXN0RY_yiy2',\n  'EQASgm0Qv3h2H2mF0W06ikPqYq2ctT3dyXMJH_svbEKKB3iZ',\n  'EQArlmP-RhVIG2yAFGZyPZfM3m0YccxmpvoRi6sgRzWnAA0s',\n  'EQA6pL-spYqZp1Ck6o3rpY45Cl-bvLMW_j3qdVejOkUWpLnm',\n  'EQBJ_ehYjumQKbXfWUue1KHKXdTm1GuYJB0Fj2ST_DwORvpd',\n  'EQBRmYSjxh9xlZpUqEmGjF5UjukI9v_Cm2kCTu4CoBn3XkOD',\n  'EQBkiqncd7AFT5_23H-RoA2Vynk-Nzq_dLoeMVRthAU9RF0p',\n  'EQB_OzTHXbztABe0QHgr4PtAV8T64LR6aDunXgaAoihOdxwO',\n  'EQCL-x5kLg6tKVNGryItTuj6tG3FH5mhUEu0xRqQc-kbEmbe',\n  'EQCZh2yJ46RaQH3AYmjEA8SMMXi77Oein4-3lvqkHseIAhD-',\n  'EQChKo5IK3iNqUHUGDB9gtzjCjMTPtmsFqekuCA2MdreVEyu',\n  'EQC6DNCBv076TIliRMfOt20RpbS7rNKDfSky3WrFEapFt8AH',\n  'EQDE_XFZOYae_rl3ZMsgBCtRSmYhl8B4y2BZEP7oiGBDhlgy',\n  'EQDddqpGA2ePXQF47A2DSL3GF6ZzIVmimfM2d16cdymy2noT',\n  'EQDv0hNNAamhYltCh3pTJrq3oRB9RW2ZhEYkTP6fhj5BtZNu',\n  'EQD2mP7zgO7-imUJhqYry3i07aJ_SR53DaokMupfAAobt0Xw',\n] as const;\n\nexport const CLAIM_ADDRESS = 'EQB3zOTvPi1PmwdcTpqSfFKZnhi1GNKEVJM-LdoAirdLtash';\nexport const CLAIM_AMOUNT = 30000000n; // 0.03 TON\nexport const CLAIM_COMMENT = 'claim';\n\n// eslint-disable-next-line max-len\nexport const RE_LINK_TEMPLATE = /((ftp|https?):\\/\\/)?(?<host>(www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)/g;\n// eslint-disable-next-line max-len\nexport const RE_TG_BOT_MENTION = /telegram[:\\s-]*((@[a-z0-9_]+)|(https:\\/\\/)?(t\\.me|telegram\\.me|telegram\\.dog)\\/[a-z0-9_]+)/mig;\n\nexport const STARS_SYMBOL = '';\n\nexport const GIVEAWAY_CHECKIN_URL = process.env.GIVEAWAY_CHECKIN_URL || 'https://giveaway.mytonwallet.io';\n\nexport const AUTOLOCK_OPTIONS_LIST = [\n  {\n    value: 'never',\n    name: 'Disabled',\n    selectedName: 'Disabled',\n    period: 0,\n  },\n  {\n    value: '1',\n    name: '30 seconds',\n    selectedName: 'If away for 30 sec',\n    period: 30_000,\n  },\n  {\n    value: '2',\n    name: '3 minutes',\n    selectedName: 'If away for 3 min',\n    period: 60_000 * 3,\n  },\n  {\n    value: '3',\n    name: '10 minutes',\n    selectedName: 'If away for 10 min',\n    period: 60_000 * 10,\n  },\n] as const;\n\nexport const PRICELESS_TOKEN_HASHES = new Set([\n  '82566ad72b6568fe7276437d3b0c911aab65ed701c13601941b2917305e81c11', // Stonfi V1\n  'ec614ea4aaea3f7768606f1c1632b3374d3de096a1e7c4ba43c8009c487fee9d', // Stonfi V2\n  'c0f9d14fbc8e14f0d72cba2214165eee35836ab174130912baf9dbfa43ead562', // Dedust (for example, EQBkh7Mc411WTYF0o085MtwJpYpvGhZOMBphhIFzEpzlVODp)\n  '1275095b6da3911292406f4f4386f9e780099b854c6dee9ee2895ddce70927c1', // Dedust (for example, EQCm92zFBkLe_qcFDp7WBvI6JFSDsm4WbDPvZ7xNd7nPL_6M)\n  '5d01684bdf1d5c9be2682c4e36074202432628bd3477d77518d66b0976b78cca', // USDT Storm LP (for example, EQAzm06UMMsnFQrNKEubV1myIR-mm2ZOCnoic36frCgD8MLR)\n]);\n\nexport const STAKED_TOKEN_SLUGS = new Set([\n  STAKED_TON_SLUG,\n  STAKED_MYCOIN_SLUG,\n]);\n\nexport const DEFAULT_OUR_SWAP_FEE = 0.875;\n\nexport const DEFAULT_STAKING_STATE: ApiLiquidStakingState = {\n  type: 'liquid',\n  id: 'liquid',\n  tokenSlug: TONCOIN.slug,\n  annualYield: 3.9,\n  yieldType: 'APY',\n  balance: 0n,\n  pool: LIQUID_POOL,\n  tokenBalance: 0n,\n  unstakeRequestAmount: 0n,\n  instantAvailable: 0n,\n};\n\nexport const DEFAULT_NOMINATORS_STAKING_STATE: ApiNominatorsStakingState = {\n  type: 'nominators',\n  id: 'nominators',\n  tokenSlug: TONCOIN.slug,\n  annualYield: 3.9,\n  yieldType: 'APY',\n  balance: 0n,\n  pool: 'Ef8dgIOIRyCLU0NEvF8TD6Me3wrbrkS1z3Gpjk3ppd8m8-s_',\n  start: 0,\n  end: 0,\n  pendingDepositAmount: 0n,\n};\n\nexport const SWAP_API_VERSION = 2;\n\nexport const JVAULT_URL = 'https://jvault.xyz';\n\nconst ALL_TON_DNS_ZONES = [\n  {\n    suffixes: ['ton'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[-\\da-z]{4,126}$/i,\n    resolver: 'EQC3dNlesgVD8YbAazcauIrXBPfiVhMMr5YYk2in0Mtsz0Bz',\n  },\n  {\n    suffixes: ['t.me'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[-_\\da-z]{4,32}$/i,\n    resolver: 'EQCA14o1-VWhS2efqoh_9M1b_A9DtKTuoqfmkn83AbJzwnPi',\n    isTelemint: true,\n  },\n  {\n    suffixes: ['vip', 'ton.vip', 'vip.ton'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}?[\\da-z]{1,24}$/i,\n    resolver: 'EQBWG4EBbPDv4Xj7xlPwzxd7hSyHMzwwLB5O6rY-0BBeaixS',\n    isUnofficial: true,\n  },\n  {\n    suffixes: ['gram'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[\\da-z]{1,127}$/i,\n    resolver: 'EQAic3zPce496ukFDhbco28FVsKKl2WUX_iJwaL87CBxSiLQ',\n    isUnofficial: true,\n  },\n];\n\nexport const TON_DNS_ZONES = IS_CORE_WALLET\n  ? ALL_TON_DNS_ZONES.filter(({ isUnofficial }) => !isUnofficial)\n  : ALL_TON_DNS_ZONES;\n","// Version 3.1.2\n/*! MIT License. Copyright 2015-2018 Richard Moore <me@ricmoo.com>. See LICENSE.txt. */\n(function(root) {\n  \"use strict\";\n\n  function checkInt(value) {\n    return (parseInt(value) === value);\n  }\n\n  function checkInts(arrayish) {\n    if (!checkInt(arrayish.length)) { return false; }\n\n    for (var i = 0; i < arrayish.length; i++) {\n      if (!checkInt(arrayish[i]) || arrayish[i] < 0 || arrayish[i] > 255) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function coerceArray(arg, copy) {\n\n    // ArrayBuffer view\n    if (arg.buffer && arg.name === 'Uint8Array') {\n\n      if (copy) {\n        if (arg.slice) {\n          arg = arg.slice();\n        } else {\n          arg = Array.prototype.slice.call(arg);\n        }\n      }\n\n      return arg;\n    }\n\n    // It's an array; check it is a valid representation of a byte\n    if (Array.isArray(arg)) {\n      if (!checkInts(arg)) {\n        throw new Error('Array contains invalid value: ' + arg);\n      }\n\n      return new Uint8Array(arg);\n    }\n\n    // Something else, but behaves like an array (maybe a Buffer? Arguments?)\n    if (checkInt(arg.length) && checkInts(arg)) {\n      return new Uint8Array(arg);\n    }\n\n    throw new Error('unsupported array-like object');\n  }\n\n  function createArray(length) {\n    return new Uint8Array(length);\n  }\n\n  function copyArray(sourceArray, targetArray, targetStart, sourceStart, sourceEnd) {\n    if (sourceStart != null || sourceEnd != null) {\n      if (sourceArray.slice) {\n        sourceArray = sourceArray.slice(sourceStart, sourceEnd);\n      } else {\n        sourceArray = Array.prototype.slice.call(sourceArray, sourceStart, sourceEnd);\n      }\n    }\n    targetArray.set(sourceArray, targetStart);\n  }\n\n\n\n  var convertUtf8 = (function() {\n    function toBytes(text) {\n      var result = [], i = 0;\n      text = encodeURI(text);\n      while (i < text.length) {\n        var c = text.charCodeAt(i++);\n\n        // if it is a % sign, encode the following 2 bytes as a hex value\n        if (c === 37) {\n          result.push(parseInt(text.substr(i, 2), 16))\n          i += 2;\n\n          // otherwise, just the actual byte\n        } else {\n          result.push(c)\n        }\n      }\n\n      return coerceArray(result);\n    }\n\n    function fromBytes(bytes) {\n      var result = [], i = 0;\n\n      while (i < bytes.length) {\n        var c = bytes[i];\n\n        if (c < 128) {\n          result.push(String.fromCharCode(c));\n          i++;\n        } else if (c > 191 && c < 224) {\n          result.push(String.fromCharCode(((c & 0x1f) << 6) | (bytes[i + 1] & 0x3f)));\n          i += 2;\n        } else {\n          result.push(String.fromCharCode(((c & 0x0f) << 12) | ((bytes[i + 1] & 0x3f) << 6) | (bytes[i + 2] & 0x3f)));\n          i += 3;\n        }\n      }\n\n      return result.join('');\n    }\n\n    return {\n      toBytes: toBytes,\n      fromBytes: fromBytes,\n    }\n  })();\n\n  var convertHex = (function() {\n    function toBytes(text) {\n      var result = [];\n      for (var i = 0; i < text.length; i += 2) {\n        result.push(parseInt(text.substr(i, 2), 16));\n      }\n\n      return result;\n    }\n\n    // http://ixti.net/development/javascript/2011/11/11/base64-encodedecode-of-utf8-in-browser-with-js.html\n    var Hex = '0123456789abcdef';\n\n    function fromBytes(bytes) {\n      var result = [];\n      for (var i = 0; i < bytes.length; i++) {\n        var v = bytes[i];\n        result.push(Hex[(v & 0xf0) >> 4] + Hex[v & 0x0f]);\n      }\n      return result.join('');\n    }\n\n    return {\n      toBytes: toBytes,\n      fromBytes: fromBytes,\n    }\n  })();\n\n\n  // Number of rounds by keysize\n  var numberOfRounds = {16: 10, 24: 12, 32: 14}\n\n  // Round constant words\n  var rcon = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91];\n\n  // S-box and Inverse S-box (S is for Substitution)\n  var S = [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16];\n  var Si =[0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d];\n\n  // Transformations for encryption\n  var T1 = [0xc66363a5, 0xf87c7c84, 0xee777799, 0xf67b7b8d, 0xfff2f20d, 0xd66b6bbd, 0xde6f6fb1, 0x91c5c554, 0x60303050, 0x02010103, 0xce6767a9, 0x562b2b7d, 0xe7fefe19, 0xb5d7d762, 0x4dababe6, 0xec76769a, 0x8fcaca45, 0x1f82829d, 0x89c9c940, 0xfa7d7d87, 0xeffafa15, 0xb25959eb, 0x8e4747c9, 0xfbf0f00b, 0x41adadec, 0xb3d4d467, 0x5fa2a2fd, 0x45afafea, 0x239c9cbf, 0x53a4a4f7, 0xe4727296, 0x9bc0c05b, 0x75b7b7c2, 0xe1fdfd1c, 0x3d9393ae, 0x4c26266a, 0x6c36365a, 0x7e3f3f41, 0xf5f7f702, 0x83cccc4f, 0x6834345c, 0x51a5a5f4, 0xd1e5e534, 0xf9f1f108, 0xe2717193, 0xabd8d873, 0x62313153, 0x2a15153f, 0x0804040c, 0x95c7c752, 0x46232365, 0x9dc3c35e, 0x30181828, 0x379696a1, 0x0a05050f, 0x2f9a9ab5, 0x0e070709, 0x24121236, 0x1b80809b, 0xdfe2e23d, 0xcdebeb26, 0x4e272769, 0x7fb2b2cd, 0xea75759f, 0x1209091b, 0x1d83839e, 0x582c2c74, 0x341a1a2e, 0x361b1b2d, 0xdc6e6eb2, 0xb45a5aee, 0x5ba0a0fb, 0xa45252f6, 0x763b3b4d, 0xb7d6d661, 0x7db3b3ce, 0x5229297b, 0xdde3e33e, 0x5e2f2f71, 0x13848497, 0xa65353f5, 0xb9d1d168, 0x00000000, 0xc1eded2c, 0x40202060, 0xe3fcfc1f, 0x79b1b1c8, 0xb65b5bed, 0xd46a6abe, 0x8dcbcb46, 0x67bebed9, 0x7239394b, 0x944a4ade, 0x984c4cd4, 0xb05858e8, 0x85cfcf4a, 0xbbd0d06b, 0xc5efef2a, 0x4faaaae5, 0xedfbfb16, 0x864343c5, 0x9a4d4dd7, 0x66333355, 0x11858594, 0x8a4545cf, 0xe9f9f910, 0x04020206, 0xfe7f7f81, 0xa05050f0, 0x783c3c44, 0x259f9fba, 0x4ba8a8e3, 0xa25151f3, 0x5da3a3fe, 0x804040c0, 0x058f8f8a, 0x3f9292ad, 0x219d9dbc, 0x70383848, 0xf1f5f504, 0x63bcbcdf, 0x77b6b6c1, 0xafdada75, 0x42212163, 0x20101030, 0xe5ffff1a, 0xfdf3f30e, 0xbfd2d26d, 0x81cdcd4c, 0x180c0c14, 0x26131335, 0xc3ecec2f, 0xbe5f5fe1, 0x359797a2, 0x884444cc, 0x2e171739, 0x93c4c457, 0x55a7a7f2, 0xfc7e7e82, 0x7a3d3d47, 0xc86464ac, 0xba5d5de7, 0x3219192b, 0xe6737395, 0xc06060a0, 0x19818198, 0x9e4f4fd1, 0xa3dcdc7f, 0x44222266, 0x542a2a7e, 0x3b9090ab, 0x0b888883, 0x8c4646ca, 0xc7eeee29, 0x6bb8b8d3, 0x2814143c, 0xa7dede79, 0xbc5e5ee2, 0x160b0b1d, 0xaddbdb76, 0xdbe0e03b, 0x64323256, 0x743a3a4e, 0x140a0a1e, 0x924949db, 0x0c06060a, 0x4824246c, 0xb85c5ce4, 0x9fc2c25d, 0xbdd3d36e, 0x43acacef, 0xc46262a6, 0x399191a8, 0x319595a4, 0xd3e4e437, 0xf279798b, 0xd5e7e732, 0x8bc8c843, 0x6e373759, 0xda6d6db7, 0x018d8d8c, 0xb1d5d564, 0x9c4e4ed2, 0x49a9a9e0, 0xd86c6cb4, 0xac5656fa, 0xf3f4f407, 0xcfeaea25, 0xca6565af, 0xf47a7a8e, 0x47aeaee9, 0x10080818, 0x6fbabad5, 0xf0787888, 0x4a25256f, 0x5c2e2e72, 0x381c1c24, 0x57a6a6f1, 0x73b4b4c7, 0x97c6c651, 0xcbe8e823, 0xa1dddd7c, 0xe874749c, 0x3e1f1f21, 0x964b4bdd, 0x61bdbddc, 0x0d8b8b86, 0x0f8a8a85, 0xe0707090, 0x7c3e3e42, 0x71b5b5c4, 0xcc6666aa, 0x904848d8, 0x06030305, 0xf7f6f601, 0x1c0e0e12, 0xc26161a3, 0x6a35355f, 0xae5757f9, 0x69b9b9d0, 0x17868691, 0x99c1c158, 0x3a1d1d27, 0x279e9eb9, 0xd9e1e138, 0xebf8f813, 0x2b9898b3, 0x22111133, 0xd26969bb, 0xa9d9d970, 0x078e8e89, 0x339494a7, 0x2d9b9bb6, 0x3c1e1e22, 0x15878792, 0xc9e9e920, 0x87cece49, 0xaa5555ff, 0x50282878, 0xa5dfdf7a, 0x038c8c8f, 0x59a1a1f8, 0x09898980, 0x1a0d0d17, 0x65bfbfda, 0xd7e6e631, 0x844242c6, 0xd06868b8, 0x824141c3, 0x299999b0, 0x5a2d2d77, 0x1e0f0f11, 0x7bb0b0cb, 0xa85454fc, 0x6dbbbbd6, 0x2c16163a];\n  var T2 = [0xa5c66363, 0x84f87c7c, 0x99ee7777, 0x8df67b7b, 0x0dfff2f2, 0xbdd66b6b, 0xb1de6f6f, 0x5491c5c5, 0x50603030, 0x03020101, 0xa9ce6767, 0x7d562b2b, 0x19e7fefe, 0x62b5d7d7, 0xe64dabab, 0x9aec7676, 0x458fcaca, 0x9d1f8282, 0x4089c9c9, 0x87fa7d7d, 0x15effafa, 0xebb25959, 0xc98e4747, 0x0bfbf0f0, 0xec41adad, 0x67b3d4d4, 0xfd5fa2a2, 0xea45afaf, 0xbf239c9c, 0xf753a4a4, 0x96e47272, 0x5b9bc0c0, 0xc275b7b7, 0x1ce1fdfd, 0xae3d9393, 0x6a4c2626, 0x5a6c3636, 0x417e3f3f, 0x02f5f7f7, 0x4f83cccc, 0x5c683434, 0xf451a5a5, 0x34d1e5e5, 0x08f9f1f1, 0x93e27171, 0x73abd8d8, 0x53623131, 0x3f2a1515, 0x0c080404, 0x5295c7c7, 0x65462323, 0x5e9dc3c3, 0x28301818, 0xa1379696, 0x0f0a0505, 0xb52f9a9a, 0x090e0707, 0x36241212, 0x9b1b8080, 0x3ddfe2e2, 0x26cdebeb, 0x694e2727, 0xcd7fb2b2, 0x9fea7575, 0x1b120909, 0x9e1d8383, 0x74582c2c, 0x2e341a1a, 0x2d361b1b, 0xb2dc6e6e, 0xeeb45a5a, 0xfb5ba0a0, 0xf6a45252, 0x4d763b3b, 0x61b7d6d6, 0xce7db3b3, 0x7b522929, 0x3edde3e3, 0x715e2f2f, 0x97138484, 0xf5a65353, 0x68b9d1d1, 0x00000000, 0x2cc1eded, 0x60402020, 0x1fe3fcfc, 0xc879b1b1, 0xedb65b5b, 0xbed46a6a, 0x468dcbcb, 0xd967bebe, 0x4b723939, 0xde944a4a, 0xd4984c4c, 0xe8b05858, 0x4a85cfcf, 0x6bbbd0d0, 0x2ac5efef, 0xe54faaaa, 0x16edfbfb, 0xc5864343, 0xd79a4d4d, 0x55663333, 0x94118585, 0xcf8a4545, 0x10e9f9f9, 0x06040202, 0x81fe7f7f, 0xf0a05050, 0x44783c3c, 0xba259f9f, 0xe34ba8a8, 0xf3a25151, 0xfe5da3a3, 0xc0804040, 0x8a058f8f, 0xad3f9292, 0xbc219d9d, 0x48703838, 0x04f1f5f5, 0xdf63bcbc, 0xc177b6b6, 0x75afdada, 0x63422121, 0x30201010, 0x1ae5ffff, 0x0efdf3f3, 0x6dbfd2d2, 0x4c81cdcd, 0x14180c0c, 0x35261313, 0x2fc3ecec, 0xe1be5f5f, 0xa2359797, 0xcc884444, 0x392e1717, 0x5793c4c4, 0xf255a7a7, 0x82fc7e7e, 0x477a3d3d, 0xacc86464, 0xe7ba5d5d, 0x2b321919, 0x95e67373, 0xa0c06060, 0x98198181, 0xd19e4f4f, 0x7fa3dcdc, 0x66442222, 0x7e542a2a, 0xab3b9090, 0x830b8888, 0xca8c4646, 0x29c7eeee, 0xd36bb8b8, 0x3c281414, 0x79a7dede, 0xe2bc5e5e, 0x1d160b0b, 0x76addbdb, 0x3bdbe0e0, 0x56643232, 0x4e743a3a, 0x1e140a0a, 0xdb924949, 0x0a0c0606, 0x6c482424, 0xe4b85c5c, 0x5d9fc2c2, 0x6ebdd3d3, 0xef43acac, 0xa6c46262, 0xa8399191, 0xa4319595, 0x37d3e4e4, 0x8bf27979, 0x32d5e7e7, 0x438bc8c8, 0x596e3737, 0xb7da6d6d, 0x8c018d8d, 0x64b1d5d5, 0xd29c4e4e, 0xe049a9a9, 0xb4d86c6c, 0xfaac5656, 0x07f3f4f4, 0x25cfeaea, 0xafca6565, 0x8ef47a7a, 0xe947aeae, 0x18100808, 0xd56fbaba, 0x88f07878, 0x6f4a2525, 0x725c2e2e, 0x24381c1c, 0xf157a6a6, 0xc773b4b4, 0x5197c6c6, 0x23cbe8e8, 0x7ca1dddd, 0x9ce87474, 0x213e1f1f, 0xdd964b4b, 0xdc61bdbd, 0x860d8b8b, 0x850f8a8a, 0x90e07070, 0x427c3e3e, 0xc471b5b5, 0xaacc6666, 0xd8904848, 0x05060303, 0x01f7f6f6, 0x121c0e0e, 0xa3c26161, 0x5f6a3535, 0xf9ae5757, 0xd069b9b9, 0x91178686, 0x5899c1c1, 0x273a1d1d, 0xb9279e9e, 0x38d9e1e1, 0x13ebf8f8, 0xb32b9898, 0x33221111, 0xbbd26969, 0x70a9d9d9, 0x89078e8e, 0xa7339494, 0xb62d9b9b, 0x223c1e1e, 0x92158787, 0x20c9e9e9, 0x4987cece, 0xffaa5555, 0x78502828, 0x7aa5dfdf, 0x8f038c8c, 0xf859a1a1, 0x80098989, 0x171a0d0d, 0xda65bfbf, 0x31d7e6e6, 0xc6844242, 0xb8d06868, 0xc3824141, 0xb0299999, 0x775a2d2d, 0x111e0f0f, 0xcb7bb0b0, 0xfca85454, 0xd66dbbbb, 0x3a2c1616];\n  var T3 = [0x63a5c663, 0x7c84f87c, 0x7799ee77, 0x7b8df67b, 0xf20dfff2, 0x6bbdd66b, 0x6fb1de6f, 0xc55491c5, 0x30506030, 0x01030201, 0x67a9ce67, 0x2b7d562b, 0xfe19e7fe, 0xd762b5d7, 0xabe64dab, 0x769aec76, 0xca458fca, 0x829d1f82, 0xc94089c9, 0x7d87fa7d, 0xfa15effa, 0x59ebb259, 0x47c98e47, 0xf00bfbf0, 0xadec41ad, 0xd467b3d4, 0xa2fd5fa2, 0xafea45af, 0x9cbf239c, 0xa4f753a4, 0x7296e472, 0xc05b9bc0, 0xb7c275b7, 0xfd1ce1fd, 0x93ae3d93, 0x266a4c26, 0x365a6c36, 0x3f417e3f, 0xf702f5f7, 0xcc4f83cc, 0x345c6834, 0xa5f451a5, 0xe534d1e5, 0xf108f9f1, 0x7193e271, 0xd873abd8, 0x31536231, 0x153f2a15, 0x040c0804, 0xc75295c7, 0x23654623, 0xc35e9dc3, 0x18283018, 0x96a13796, 0x050f0a05, 0x9ab52f9a, 0x07090e07, 0x12362412, 0x809b1b80, 0xe23ddfe2, 0xeb26cdeb, 0x27694e27, 0xb2cd7fb2, 0x759fea75, 0x091b1209, 0x839e1d83, 0x2c74582c, 0x1a2e341a, 0x1b2d361b, 0x6eb2dc6e, 0x5aeeb45a, 0xa0fb5ba0, 0x52f6a452, 0x3b4d763b, 0xd661b7d6, 0xb3ce7db3, 0x297b5229, 0xe33edde3, 0x2f715e2f, 0x84971384, 0x53f5a653, 0xd168b9d1, 0x00000000, 0xed2cc1ed, 0x20604020, 0xfc1fe3fc, 0xb1c879b1, 0x5bedb65b, 0x6abed46a, 0xcb468dcb, 0xbed967be, 0x394b7239, 0x4ade944a, 0x4cd4984c, 0x58e8b058, 0xcf4a85cf, 0xd06bbbd0, 0xef2ac5ef, 0xaae54faa, 0xfb16edfb, 0x43c58643, 0x4dd79a4d, 0x33556633, 0x85941185, 0x45cf8a45, 0xf910e9f9, 0x02060402, 0x7f81fe7f, 0x50f0a050, 0x3c44783c, 0x9fba259f, 0xa8e34ba8, 0x51f3a251, 0xa3fe5da3, 0x40c08040, 0x8f8a058f, 0x92ad3f92, 0x9dbc219d, 0x38487038, 0xf504f1f5, 0xbcdf63bc, 0xb6c177b6, 0xda75afda, 0x21634221, 0x10302010, 0xff1ae5ff, 0xf30efdf3, 0xd26dbfd2, 0xcd4c81cd, 0x0c14180c, 0x13352613, 0xec2fc3ec, 0x5fe1be5f, 0x97a23597, 0x44cc8844, 0x17392e17, 0xc45793c4, 0xa7f255a7, 0x7e82fc7e, 0x3d477a3d, 0x64acc864, 0x5de7ba5d, 0x192b3219, 0x7395e673, 0x60a0c060, 0x81981981, 0x4fd19e4f, 0xdc7fa3dc, 0x22664422, 0x2a7e542a, 0x90ab3b90, 0x88830b88, 0x46ca8c46, 0xee29c7ee, 0xb8d36bb8, 0x143c2814, 0xde79a7de, 0x5ee2bc5e, 0x0b1d160b, 0xdb76addb, 0xe03bdbe0, 0x32566432, 0x3a4e743a, 0x0a1e140a, 0x49db9249, 0x060a0c06, 0x246c4824, 0x5ce4b85c, 0xc25d9fc2, 0xd36ebdd3, 0xacef43ac, 0x62a6c462, 0x91a83991, 0x95a43195, 0xe437d3e4, 0x798bf279, 0xe732d5e7, 0xc8438bc8, 0x37596e37, 0x6db7da6d, 0x8d8c018d, 0xd564b1d5, 0x4ed29c4e, 0xa9e049a9, 0x6cb4d86c, 0x56faac56, 0xf407f3f4, 0xea25cfea, 0x65afca65, 0x7a8ef47a, 0xaee947ae, 0x08181008, 0xbad56fba, 0x7888f078, 0x256f4a25, 0x2e725c2e, 0x1c24381c, 0xa6f157a6, 0xb4c773b4, 0xc65197c6, 0xe823cbe8, 0xdd7ca1dd, 0x749ce874, 0x1f213e1f, 0x4bdd964b, 0xbddc61bd, 0x8b860d8b, 0x8a850f8a, 0x7090e070, 0x3e427c3e, 0xb5c471b5, 0x66aacc66, 0x48d89048, 0x03050603, 0xf601f7f6, 0x0e121c0e, 0x61a3c261, 0x355f6a35, 0x57f9ae57, 0xb9d069b9, 0x86911786, 0xc15899c1, 0x1d273a1d, 0x9eb9279e, 0xe138d9e1, 0xf813ebf8, 0x98b32b98, 0x11332211, 0x69bbd269, 0xd970a9d9, 0x8e89078e, 0x94a73394, 0x9bb62d9b, 0x1e223c1e, 0x87921587, 0xe920c9e9, 0xce4987ce, 0x55ffaa55, 0x28785028, 0xdf7aa5df, 0x8c8f038c, 0xa1f859a1, 0x89800989, 0x0d171a0d, 0xbfda65bf, 0xe631d7e6, 0x42c68442, 0x68b8d068, 0x41c38241, 0x99b02999, 0x2d775a2d, 0x0f111e0f, 0xb0cb7bb0, 0x54fca854, 0xbbd66dbb, 0x163a2c16];\n  var T4 = [0x6363a5c6, 0x7c7c84f8, 0x777799ee, 0x7b7b8df6, 0xf2f20dff, 0x6b6bbdd6, 0x6f6fb1de, 0xc5c55491, 0x30305060, 0x01010302, 0x6767a9ce, 0x2b2b7d56, 0xfefe19e7, 0xd7d762b5, 0xababe64d, 0x76769aec, 0xcaca458f, 0x82829d1f, 0xc9c94089, 0x7d7d87fa, 0xfafa15ef, 0x5959ebb2, 0x4747c98e, 0xf0f00bfb, 0xadadec41, 0xd4d467b3, 0xa2a2fd5f, 0xafafea45, 0x9c9cbf23, 0xa4a4f753, 0x727296e4, 0xc0c05b9b, 0xb7b7c275, 0xfdfd1ce1, 0x9393ae3d, 0x26266a4c, 0x36365a6c, 0x3f3f417e, 0xf7f702f5, 0xcccc4f83, 0x34345c68, 0xa5a5f451, 0xe5e534d1, 0xf1f108f9, 0x717193e2, 0xd8d873ab, 0x31315362, 0x15153f2a, 0x04040c08, 0xc7c75295, 0x23236546, 0xc3c35e9d, 0x18182830, 0x9696a137, 0x05050f0a, 0x9a9ab52f, 0x0707090e, 0x12123624, 0x80809b1b, 0xe2e23ddf, 0xebeb26cd, 0x2727694e, 0xb2b2cd7f, 0x75759fea, 0x09091b12, 0x83839e1d, 0x2c2c7458, 0x1a1a2e34, 0x1b1b2d36, 0x6e6eb2dc, 0x5a5aeeb4, 0xa0a0fb5b, 0x5252f6a4, 0x3b3b4d76, 0xd6d661b7, 0xb3b3ce7d, 0x29297b52, 0xe3e33edd, 0x2f2f715e, 0x84849713, 0x5353f5a6, 0xd1d168b9, 0x00000000, 0xeded2cc1, 0x20206040, 0xfcfc1fe3, 0xb1b1c879, 0x5b5bedb6, 0x6a6abed4, 0xcbcb468d, 0xbebed967, 0x39394b72, 0x4a4ade94, 0x4c4cd498, 0x5858e8b0, 0xcfcf4a85, 0xd0d06bbb, 0xefef2ac5, 0xaaaae54f, 0xfbfb16ed, 0x4343c586, 0x4d4dd79a, 0x33335566, 0x85859411, 0x4545cf8a, 0xf9f910e9, 0x02020604, 0x7f7f81fe, 0x5050f0a0, 0x3c3c4478, 0x9f9fba25, 0xa8a8e34b, 0x5151f3a2, 0xa3a3fe5d, 0x4040c080, 0x8f8f8a05, 0x9292ad3f, 0x9d9dbc21, 0x38384870, 0xf5f504f1, 0xbcbcdf63, 0xb6b6c177, 0xdada75af, 0x21216342, 0x10103020, 0xffff1ae5, 0xf3f30efd, 0xd2d26dbf, 0xcdcd4c81, 0x0c0c1418, 0x13133526, 0xecec2fc3, 0x5f5fe1be, 0x9797a235, 0x4444cc88, 0x1717392e, 0xc4c45793, 0xa7a7f255, 0x7e7e82fc, 0x3d3d477a, 0x6464acc8, 0x5d5de7ba, 0x19192b32, 0x737395e6, 0x6060a0c0, 0x81819819, 0x4f4fd19e, 0xdcdc7fa3, 0x22226644, 0x2a2a7e54, 0x9090ab3b, 0x8888830b, 0x4646ca8c, 0xeeee29c7, 0xb8b8d36b, 0x14143c28, 0xdede79a7, 0x5e5ee2bc, 0x0b0b1d16, 0xdbdb76ad, 0xe0e03bdb, 0x32325664, 0x3a3a4e74, 0x0a0a1e14, 0x4949db92, 0x06060a0c, 0x24246c48, 0x5c5ce4b8, 0xc2c25d9f, 0xd3d36ebd, 0xacacef43, 0x6262a6c4, 0x9191a839, 0x9595a431, 0xe4e437d3, 0x79798bf2, 0xe7e732d5, 0xc8c8438b, 0x3737596e, 0x6d6db7da, 0x8d8d8c01, 0xd5d564b1, 0x4e4ed29c, 0xa9a9e049, 0x6c6cb4d8, 0x5656faac, 0xf4f407f3, 0xeaea25cf, 0x6565afca, 0x7a7a8ef4, 0xaeaee947, 0x08081810, 0xbabad56f, 0x787888f0, 0x25256f4a, 0x2e2e725c, 0x1c1c2438, 0xa6a6f157, 0xb4b4c773, 0xc6c65197, 0xe8e823cb, 0xdddd7ca1, 0x74749ce8, 0x1f1f213e, 0x4b4bdd96, 0xbdbddc61, 0x8b8b860d, 0x8a8a850f, 0x707090e0, 0x3e3e427c, 0xb5b5c471, 0x6666aacc, 0x4848d890, 0x03030506, 0xf6f601f7, 0x0e0e121c, 0x6161a3c2, 0x35355f6a, 0x5757f9ae, 0xb9b9d069, 0x86869117, 0xc1c15899, 0x1d1d273a, 0x9e9eb927, 0xe1e138d9, 0xf8f813eb, 0x9898b32b, 0x11113322, 0x6969bbd2, 0xd9d970a9, 0x8e8e8907, 0x9494a733, 0x9b9bb62d, 0x1e1e223c, 0x87879215, 0xe9e920c9, 0xcece4987, 0x5555ffaa, 0x28287850, 0xdfdf7aa5, 0x8c8c8f03, 0xa1a1f859, 0x89898009, 0x0d0d171a, 0xbfbfda65, 0xe6e631d7, 0x4242c684, 0x6868b8d0, 0x4141c382, 0x9999b029, 0x2d2d775a, 0x0f0f111e, 0xb0b0cb7b, 0x5454fca8, 0xbbbbd66d, 0x16163a2c];\n\n  // Transformations for decryption\n  var T5 = [0x51f4a750, 0x7e416553, 0x1a17a4c3, 0x3a275e96, 0x3bab6bcb, 0x1f9d45f1, 0xacfa58ab, 0x4be30393, 0x2030fa55, 0xad766df6, 0x88cc7691, 0xf5024c25, 0x4fe5d7fc, 0xc52acbd7, 0x26354480, 0xb562a38f, 0xdeb15a49, 0x25ba1b67, 0x45ea0e98, 0x5dfec0e1, 0xc32f7502, 0x814cf012, 0x8d4697a3, 0x6bd3f9c6, 0x038f5fe7, 0x15929c95, 0xbf6d7aeb, 0x955259da, 0xd4be832d, 0x587421d3, 0x49e06929, 0x8ec9c844, 0x75c2896a, 0xf48e7978, 0x99583e6b, 0x27b971dd, 0xbee14fb6, 0xf088ad17, 0xc920ac66, 0x7dce3ab4, 0x63df4a18, 0xe51a3182, 0x97513360, 0x62537f45, 0xb16477e0, 0xbb6bae84, 0xfe81a01c, 0xf9082b94, 0x70486858, 0x8f45fd19, 0x94de6c87, 0x527bf8b7, 0xab73d323, 0x724b02e2, 0xe31f8f57, 0x6655ab2a, 0xb2eb2807, 0x2fb5c203, 0x86c57b9a, 0xd33708a5, 0x302887f2, 0x23bfa5b2, 0x02036aba, 0xed16825c, 0x8acf1c2b, 0xa779b492, 0xf307f2f0, 0x4e69e2a1, 0x65daf4cd, 0x0605bed5, 0xd134621f, 0xc4a6fe8a, 0x342e539d, 0xa2f355a0, 0x058ae132, 0xa4f6eb75, 0x0b83ec39, 0x4060efaa, 0x5e719f06, 0xbd6e1051, 0x3e218af9, 0x96dd063d, 0xdd3e05ae, 0x4de6bd46, 0x91548db5, 0x71c45d05, 0x0406d46f, 0x605015ff, 0x1998fb24, 0xd6bde997, 0x894043cc, 0x67d99e77, 0xb0e842bd, 0x07898b88, 0xe7195b38, 0x79c8eedb, 0xa17c0a47, 0x7c420fe9, 0xf8841ec9, 0x00000000, 0x09808683, 0x322bed48, 0x1e1170ac, 0x6c5a724e, 0xfd0efffb, 0x0f853856, 0x3daed51e, 0x362d3927, 0x0a0fd964, 0x685ca621, 0x9b5b54d1, 0x24362e3a, 0x0c0a67b1, 0x9357e70f, 0xb4ee96d2, 0x1b9b919e, 0x80c0c54f, 0x61dc20a2, 0x5a774b69, 0x1c121a16, 0xe293ba0a, 0xc0a02ae5, 0x3c22e043, 0x121b171d, 0x0e090d0b, 0xf28bc7ad, 0x2db6a8b9, 0x141ea9c8, 0x57f11985, 0xaf75074c, 0xee99ddbb, 0xa37f60fd, 0xf701269f, 0x5c72f5bc, 0x44663bc5, 0x5bfb7e34, 0x8b432976, 0xcb23c6dc, 0xb6edfc68, 0xb8e4f163, 0xd731dcca, 0x42638510, 0x13972240, 0x84c61120, 0x854a247d, 0xd2bb3df8, 0xaef93211, 0xc729a16d, 0x1d9e2f4b, 0xdcb230f3, 0x0d8652ec, 0x77c1e3d0, 0x2bb3166c, 0xa970b999, 0x119448fa, 0x47e96422, 0xa8fc8cc4, 0xa0f03f1a, 0x567d2cd8, 0x223390ef, 0x87494ec7, 0xd938d1c1, 0x8ccaa2fe, 0x98d40b36, 0xa6f581cf, 0xa57ade28, 0xdab78e26, 0x3fadbfa4, 0x2c3a9de4, 0x5078920d, 0x6a5fcc9b, 0x547e4662, 0xf68d13c2, 0x90d8b8e8, 0x2e39f75e, 0x82c3aff5, 0x9f5d80be, 0x69d0937c, 0x6fd52da9, 0xcf2512b3, 0xc8ac993b, 0x10187da7, 0xe89c636e, 0xdb3bbb7b, 0xcd267809, 0x6e5918f4, 0xec9ab701, 0x834f9aa8, 0xe6956e65, 0xaaffe67e, 0x21bccf08, 0xef15e8e6, 0xbae79bd9, 0x4a6f36ce, 0xea9f09d4, 0x29b07cd6, 0x31a4b2af, 0x2a3f2331, 0xc6a59430, 0x35a266c0, 0x744ebc37, 0xfc82caa6, 0xe090d0b0, 0x33a7d815, 0xf104984a, 0x41ecdaf7, 0x7fcd500e, 0x1791f62f, 0x764dd68d, 0x43efb04d, 0xccaa4d54, 0xe49604df, 0x9ed1b5e3, 0x4c6a881b, 0xc12c1fb8, 0x4665517f, 0x9d5eea04, 0x018c355d, 0xfa877473, 0xfb0b412e, 0xb3671d5a, 0x92dbd252, 0xe9105633, 0x6dd64713, 0x9ad7618c, 0x37a10c7a, 0x59f8148e, 0xeb133c89, 0xcea927ee, 0xb761c935, 0xe11ce5ed, 0x7a47b13c, 0x9cd2df59, 0x55f2733f, 0x1814ce79, 0x73c737bf, 0x53f7cdea, 0x5ffdaa5b, 0xdf3d6f14, 0x7844db86, 0xcaaff381, 0xb968c43e, 0x3824342c, 0xc2a3405f, 0x161dc372, 0xbce2250c, 0x283c498b, 0xff0d9541, 0x39a80171, 0x080cb3de, 0xd8b4e49c, 0x6456c190, 0x7bcb8461, 0xd532b670, 0x486c5c74, 0xd0b85742];\n  var T6 = [0x5051f4a7, 0x537e4165, 0xc31a17a4, 0x963a275e, 0xcb3bab6b, 0xf11f9d45, 0xabacfa58, 0x934be303, 0x552030fa, 0xf6ad766d, 0x9188cc76, 0x25f5024c, 0xfc4fe5d7, 0xd7c52acb, 0x80263544, 0x8fb562a3, 0x49deb15a, 0x6725ba1b, 0x9845ea0e, 0xe15dfec0, 0x02c32f75, 0x12814cf0, 0xa38d4697, 0xc66bd3f9, 0xe7038f5f, 0x9515929c, 0xebbf6d7a, 0xda955259, 0x2dd4be83, 0xd3587421, 0x2949e069, 0x448ec9c8, 0x6a75c289, 0x78f48e79, 0x6b99583e, 0xdd27b971, 0xb6bee14f, 0x17f088ad, 0x66c920ac, 0xb47dce3a, 0x1863df4a, 0x82e51a31, 0x60975133, 0x4562537f, 0xe0b16477, 0x84bb6bae, 0x1cfe81a0, 0x94f9082b, 0x58704868, 0x198f45fd, 0x8794de6c, 0xb7527bf8, 0x23ab73d3, 0xe2724b02, 0x57e31f8f, 0x2a6655ab, 0x07b2eb28, 0x032fb5c2, 0x9a86c57b, 0xa5d33708, 0xf2302887, 0xb223bfa5, 0xba02036a, 0x5ced1682, 0x2b8acf1c, 0x92a779b4, 0xf0f307f2, 0xa14e69e2, 0xcd65daf4, 0xd50605be, 0x1fd13462, 0x8ac4a6fe, 0x9d342e53, 0xa0a2f355, 0x32058ae1, 0x75a4f6eb, 0x390b83ec, 0xaa4060ef, 0x065e719f, 0x51bd6e10, 0xf93e218a, 0x3d96dd06, 0xaedd3e05, 0x464de6bd, 0xb591548d, 0x0571c45d, 0x6f0406d4, 0xff605015, 0x241998fb, 0x97d6bde9, 0xcc894043, 0x7767d99e, 0xbdb0e842, 0x8807898b, 0x38e7195b, 0xdb79c8ee, 0x47a17c0a, 0xe97c420f, 0xc9f8841e, 0x00000000, 0x83098086, 0x48322bed, 0xac1e1170, 0x4e6c5a72, 0xfbfd0eff, 0x560f8538, 0x1e3daed5, 0x27362d39, 0x640a0fd9, 0x21685ca6, 0xd19b5b54, 0x3a24362e, 0xb10c0a67, 0x0f9357e7, 0xd2b4ee96, 0x9e1b9b91, 0x4f80c0c5, 0xa261dc20, 0x695a774b, 0x161c121a, 0x0ae293ba, 0xe5c0a02a, 0x433c22e0, 0x1d121b17, 0x0b0e090d, 0xadf28bc7, 0xb92db6a8, 0xc8141ea9, 0x8557f119, 0x4caf7507, 0xbbee99dd, 0xfda37f60, 0x9ff70126, 0xbc5c72f5, 0xc544663b, 0x345bfb7e, 0x768b4329, 0xdccb23c6, 0x68b6edfc, 0x63b8e4f1, 0xcad731dc, 0x10426385, 0x40139722, 0x2084c611, 0x7d854a24, 0xf8d2bb3d, 0x11aef932, 0x6dc729a1, 0x4b1d9e2f, 0xf3dcb230, 0xec0d8652, 0xd077c1e3, 0x6c2bb316, 0x99a970b9, 0xfa119448, 0x2247e964, 0xc4a8fc8c, 0x1aa0f03f, 0xd8567d2c, 0xef223390, 0xc787494e, 0xc1d938d1, 0xfe8ccaa2, 0x3698d40b, 0xcfa6f581, 0x28a57ade, 0x26dab78e, 0xa43fadbf, 0xe42c3a9d, 0x0d507892, 0x9b6a5fcc, 0x62547e46, 0xc2f68d13, 0xe890d8b8, 0x5e2e39f7, 0xf582c3af, 0xbe9f5d80, 0x7c69d093, 0xa96fd52d, 0xb3cf2512, 0x3bc8ac99, 0xa710187d, 0x6ee89c63, 0x7bdb3bbb, 0x09cd2678, 0xf46e5918, 0x01ec9ab7, 0xa8834f9a, 0x65e6956e, 0x7eaaffe6, 0x0821bccf, 0xe6ef15e8, 0xd9bae79b, 0xce4a6f36, 0xd4ea9f09, 0xd629b07c, 0xaf31a4b2, 0x312a3f23, 0x30c6a594, 0xc035a266, 0x37744ebc, 0xa6fc82ca, 0xb0e090d0, 0x1533a7d8, 0x4af10498, 0xf741ecda, 0x0e7fcd50, 0x2f1791f6, 0x8d764dd6, 0x4d43efb0, 0x54ccaa4d, 0xdfe49604, 0xe39ed1b5, 0x1b4c6a88, 0xb8c12c1f, 0x7f466551, 0x049d5eea, 0x5d018c35, 0x73fa8774, 0x2efb0b41, 0x5ab3671d, 0x5292dbd2, 0x33e91056, 0x136dd647, 0x8c9ad761, 0x7a37a10c, 0x8e59f814, 0x89eb133c, 0xeecea927, 0x35b761c9, 0xede11ce5, 0x3c7a47b1, 0x599cd2df, 0x3f55f273, 0x791814ce, 0xbf73c737, 0xea53f7cd, 0x5b5ffdaa, 0x14df3d6f, 0x867844db, 0x81caaff3, 0x3eb968c4, 0x2c382434, 0x5fc2a340, 0x72161dc3, 0x0cbce225, 0x8b283c49, 0x41ff0d95, 0x7139a801, 0xde080cb3, 0x9cd8b4e4, 0x906456c1, 0x617bcb84, 0x70d532b6, 0x74486c5c, 0x42d0b857];\n  var T7 = [0xa75051f4, 0x65537e41, 0xa4c31a17, 0x5e963a27, 0x6bcb3bab, 0x45f11f9d, 0x58abacfa, 0x03934be3, 0xfa552030, 0x6df6ad76, 0x769188cc, 0x4c25f502, 0xd7fc4fe5, 0xcbd7c52a, 0x44802635, 0xa38fb562, 0x5a49deb1, 0x1b6725ba, 0x0e9845ea, 0xc0e15dfe, 0x7502c32f, 0xf012814c, 0x97a38d46, 0xf9c66bd3, 0x5fe7038f, 0x9c951592, 0x7aebbf6d, 0x59da9552, 0x832dd4be, 0x21d35874, 0x692949e0, 0xc8448ec9, 0x896a75c2, 0x7978f48e, 0x3e6b9958, 0x71dd27b9, 0x4fb6bee1, 0xad17f088, 0xac66c920, 0x3ab47dce, 0x4a1863df, 0x3182e51a, 0x33609751, 0x7f456253, 0x77e0b164, 0xae84bb6b, 0xa01cfe81, 0x2b94f908, 0x68587048, 0xfd198f45, 0x6c8794de, 0xf8b7527b, 0xd323ab73, 0x02e2724b, 0x8f57e31f, 0xab2a6655, 0x2807b2eb, 0xc2032fb5, 0x7b9a86c5, 0x08a5d337, 0x87f23028, 0xa5b223bf, 0x6aba0203, 0x825ced16, 0x1c2b8acf, 0xb492a779, 0xf2f0f307, 0xe2a14e69, 0xf4cd65da, 0xbed50605, 0x621fd134, 0xfe8ac4a6, 0x539d342e, 0x55a0a2f3, 0xe132058a, 0xeb75a4f6, 0xec390b83, 0xefaa4060, 0x9f065e71, 0x1051bd6e, 0x8af93e21, 0x063d96dd, 0x05aedd3e, 0xbd464de6, 0x8db59154, 0x5d0571c4, 0xd46f0406, 0x15ff6050, 0xfb241998, 0xe997d6bd, 0x43cc8940, 0x9e7767d9, 0x42bdb0e8, 0x8b880789, 0x5b38e719, 0xeedb79c8, 0x0a47a17c, 0x0fe97c42, 0x1ec9f884, 0x00000000, 0x86830980, 0xed48322b, 0x70ac1e11, 0x724e6c5a, 0xfffbfd0e, 0x38560f85, 0xd51e3dae, 0x3927362d, 0xd9640a0f, 0xa621685c, 0x54d19b5b, 0x2e3a2436, 0x67b10c0a, 0xe70f9357, 0x96d2b4ee, 0x919e1b9b, 0xc54f80c0, 0x20a261dc, 0x4b695a77, 0x1a161c12, 0xba0ae293, 0x2ae5c0a0, 0xe0433c22, 0x171d121b, 0x0d0b0e09, 0xc7adf28b, 0xa8b92db6, 0xa9c8141e, 0x198557f1, 0x074caf75, 0xddbbee99, 0x60fda37f, 0x269ff701, 0xf5bc5c72, 0x3bc54466, 0x7e345bfb, 0x29768b43, 0xc6dccb23, 0xfc68b6ed, 0xf163b8e4, 0xdccad731, 0x85104263, 0x22401397, 0x112084c6, 0x247d854a, 0x3df8d2bb, 0x3211aef9, 0xa16dc729, 0x2f4b1d9e, 0x30f3dcb2, 0x52ec0d86, 0xe3d077c1, 0x166c2bb3, 0xb999a970, 0x48fa1194, 0x642247e9, 0x8cc4a8fc, 0x3f1aa0f0, 0x2cd8567d, 0x90ef2233, 0x4ec78749, 0xd1c1d938, 0xa2fe8cca, 0x0b3698d4, 0x81cfa6f5, 0xde28a57a, 0x8e26dab7, 0xbfa43fad, 0x9de42c3a, 0x920d5078, 0xcc9b6a5f, 0x4662547e, 0x13c2f68d, 0xb8e890d8, 0xf75e2e39, 0xaff582c3, 0x80be9f5d, 0x937c69d0, 0x2da96fd5, 0x12b3cf25, 0x993bc8ac, 0x7da71018, 0x636ee89c, 0xbb7bdb3b, 0x7809cd26, 0x18f46e59, 0xb701ec9a, 0x9aa8834f, 0x6e65e695, 0xe67eaaff, 0xcf0821bc, 0xe8e6ef15, 0x9bd9bae7, 0x36ce4a6f, 0x09d4ea9f, 0x7cd629b0, 0xb2af31a4, 0x23312a3f, 0x9430c6a5, 0x66c035a2, 0xbc37744e, 0xcaa6fc82, 0xd0b0e090, 0xd81533a7, 0x984af104, 0xdaf741ec, 0x500e7fcd, 0xf62f1791, 0xd68d764d, 0xb04d43ef, 0x4d54ccaa, 0x04dfe496, 0xb5e39ed1, 0x881b4c6a, 0x1fb8c12c, 0x517f4665, 0xea049d5e, 0x355d018c, 0x7473fa87, 0x412efb0b, 0x1d5ab367, 0xd25292db, 0x5633e910, 0x47136dd6, 0x618c9ad7, 0x0c7a37a1, 0x148e59f8, 0x3c89eb13, 0x27eecea9, 0xc935b761, 0xe5ede11c, 0xb13c7a47, 0xdf599cd2, 0x733f55f2, 0xce791814, 0x37bf73c7, 0xcdea53f7, 0xaa5b5ffd, 0x6f14df3d, 0xdb867844, 0xf381caaf, 0xc43eb968, 0x342c3824, 0x405fc2a3, 0xc372161d, 0x250cbce2, 0x498b283c, 0x9541ff0d, 0x017139a8, 0xb3de080c, 0xe49cd8b4, 0xc1906456, 0x84617bcb, 0xb670d532, 0x5c74486c, 0x5742d0b8];\n  var T8 = [0xf4a75051, 0x4165537e, 0x17a4c31a, 0x275e963a, 0xab6bcb3b, 0x9d45f11f, 0xfa58abac, 0xe303934b, 0x30fa5520, 0x766df6ad, 0xcc769188, 0x024c25f5, 0xe5d7fc4f, 0x2acbd7c5, 0x35448026, 0x62a38fb5, 0xb15a49de, 0xba1b6725, 0xea0e9845, 0xfec0e15d, 0x2f7502c3, 0x4cf01281, 0x4697a38d, 0xd3f9c66b, 0x8f5fe703, 0x929c9515, 0x6d7aebbf, 0x5259da95, 0xbe832dd4, 0x7421d358, 0xe0692949, 0xc9c8448e, 0xc2896a75, 0x8e7978f4, 0x583e6b99, 0xb971dd27, 0xe14fb6be, 0x88ad17f0, 0x20ac66c9, 0xce3ab47d, 0xdf4a1863, 0x1a3182e5, 0x51336097, 0x537f4562, 0x6477e0b1, 0x6bae84bb, 0x81a01cfe, 0x082b94f9, 0x48685870, 0x45fd198f, 0xde6c8794, 0x7bf8b752, 0x73d323ab, 0x4b02e272, 0x1f8f57e3, 0x55ab2a66, 0xeb2807b2, 0xb5c2032f, 0xc57b9a86, 0x3708a5d3, 0x2887f230, 0xbfa5b223, 0x036aba02, 0x16825ced, 0xcf1c2b8a, 0x79b492a7, 0x07f2f0f3, 0x69e2a14e, 0xdaf4cd65, 0x05bed506, 0x34621fd1, 0xa6fe8ac4, 0x2e539d34, 0xf355a0a2, 0x8ae13205, 0xf6eb75a4, 0x83ec390b, 0x60efaa40, 0x719f065e, 0x6e1051bd, 0x218af93e, 0xdd063d96, 0x3e05aedd, 0xe6bd464d, 0x548db591, 0xc45d0571, 0x06d46f04, 0x5015ff60, 0x98fb2419, 0xbde997d6, 0x4043cc89, 0xd99e7767, 0xe842bdb0, 0x898b8807, 0x195b38e7, 0xc8eedb79, 0x7c0a47a1, 0x420fe97c, 0x841ec9f8, 0x00000000, 0x80868309, 0x2bed4832, 0x1170ac1e, 0x5a724e6c, 0x0efffbfd, 0x8538560f, 0xaed51e3d, 0x2d392736, 0x0fd9640a, 0x5ca62168, 0x5b54d19b, 0x362e3a24, 0x0a67b10c, 0x57e70f93, 0xee96d2b4, 0x9b919e1b, 0xc0c54f80, 0xdc20a261, 0x774b695a, 0x121a161c, 0x93ba0ae2, 0xa02ae5c0, 0x22e0433c, 0x1b171d12, 0x090d0b0e, 0x8bc7adf2, 0xb6a8b92d, 0x1ea9c814, 0xf1198557, 0x75074caf, 0x99ddbbee, 0x7f60fda3, 0x01269ff7, 0x72f5bc5c, 0x663bc544, 0xfb7e345b, 0x4329768b, 0x23c6dccb, 0xedfc68b6, 0xe4f163b8, 0x31dccad7, 0x63851042, 0x97224013, 0xc6112084, 0x4a247d85, 0xbb3df8d2, 0xf93211ae, 0x29a16dc7, 0x9e2f4b1d, 0xb230f3dc, 0x8652ec0d, 0xc1e3d077, 0xb3166c2b, 0x70b999a9, 0x9448fa11, 0xe9642247, 0xfc8cc4a8, 0xf03f1aa0, 0x7d2cd856, 0x3390ef22, 0x494ec787, 0x38d1c1d9, 0xcaa2fe8c, 0xd40b3698, 0xf581cfa6, 0x7ade28a5, 0xb78e26da, 0xadbfa43f, 0x3a9de42c, 0x78920d50, 0x5fcc9b6a, 0x7e466254, 0x8d13c2f6, 0xd8b8e890, 0x39f75e2e, 0xc3aff582, 0x5d80be9f, 0xd0937c69, 0xd52da96f, 0x2512b3cf, 0xac993bc8, 0x187da710, 0x9c636ee8, 0x3bbb7bdb, 0x267809cd, 0x5918f46e, 0x9ab701ec, 0x4f9aa883, 0x956e65e6, 0xffe67eaa, 0xbccf0821, 0x15e8e6ef, 0xe79bd9ba, 0x6f36ce4a, 0x9f09d4ea, 0xb07cd629, 0xa4b2af31, 0x3f23312a, 0xa59430c6, 0xa266c035, 0x4ebc3774, 0x82caa6fc, 0x90d0b0e0, 0xa7d81533, 0x04984af1, 0xecdaf741, 0xcd500e7f, 0x91f62f17, 0x4dd68d76, 0xefb04d43, 0xaa4d54cc, 0x9604dfe4, 0xd1b5e39e, 0x6a881b4c, 0x2c1fb8c1, 0x65517f46, 0x5eea049d, 0x8c355d01, 0x877473fa, 0x0b412efb, 0x671d5ab3, 0xdbd25292, 0x105633e9, 0xd647136d, 0xd7618c9a, 0xa10c7a37, 0xf8148e59, 0x133c89eb, 0xa927eece, 0x61c935b7, 0x1ce5ede1, 0x47b13c7a, 0xd2df599c, 0xf2733f55, 0x14ce7918, 0xc737bf73, 0xf7cdea53, 0xfdaa5b5f, 0x3d6f14df, 0x44db8678, 0xaff381ca, 0x68c43eb9, 0x24342c38, 0xa3405fc2, 0x1dc37216, 0xe2250cbc, 0x3c498b28, 0x0d9541ff, 0xa8017139, 0x0cb3de08, 0xb4e49cd8, 0x56c19064, 0xcb84617b, 0x32b670d5, 0x6c5c7448, 0xb85742d0];\n\n  // Transformations for decryption key expansion\n  var U1 = [0x00000000, 0x0e090d0b, 0x1c121a16, 0x121b171d, 0x3824342c, 0x362d3927, 0x24362e3a, 0x2a3f2331, 0x70486858, 0x7e416553, 0x6c5a724e, 0x62537f45, 0x486c5c74, 0x4665517f, 0x547e4662, 0x5a774b69, 0xe090d0b0, 0xee99ddbb, 0xfc82caa6, 0xf28bc7ad, 0xd8b4e49c, 0xd6bde997, 0xc4a6fe8a, 0xcaaff381, 0x90d8b8e8, 0x9ed1b5e3, 0x8ccaa2fe, 0x82c3aff5, 0xa8fc8cc4, 0xa6f581cf, 0xb4ee96d2, 0xbae79bd9, 0xdb3bbb7b, 0xd532b670, 0xc729a16d, 0xc920ac66, 0xe31f8f57, 0xed16825c, 0xff0d9541, 0xf104984a, 0xab73d323, 0xa57ade28, 0xb761c935, 0xb968c43e, 0x9357e70f, 0x9d5eea04, 0x8f45fd19, 0x814cf012, 0x3bab6bcb, 0x35a266c0, 0x27b971dd, 0x29b07cd6, 0x038f5fe7, 0x0d8652ec, 0x1f9d45f1, 0x119448fa, 0x4be30393, 0x45ea0e98, 0x57f11985, 0x59f8148e, 0x73c737bf, 0x7dce3ab4, 0x6fd52da9, 0x61dc20a2, 0xad766df6, 0xa37f60fd, 0xb16477e0, 0xbf6d7aeb, 0x955259da, 0x9b5b54d1, 0x894043cc, 0x87494ec7, 0xdd3e05ae, 0xd33708a5, 0xc12c1fb8, 0xcf2512b3, 0xe51a3182, 0xeb133c89, 0xf9082b94, 0xf701269f, 0x4de6bd46, 0x43efb04d, 0x51f4a750, 0x5ffdaa5b, 0x75c2896a, 0x7bcb8461, 0x69d0937c, 0x67d99e77, 0x3daed51e, 0x33a7d815, 0x21bccf08, 0x2fb5c203, 0x058ae132, 0x0b83ec39, 0x1998fb24, 0x1791f62f, 0x764dd68d, 0x7844db86, 0x6a5fcc9b, 0x6456c190, 0x4e69e2a1, 0x4060efaa, 0x527bf8b7, 0x5c72f5bc, 0x0605bed5, 0x080cb3de, 0x1a17a4c3, 0x141ea9c8, 0x3e218af9, 0x302887f2, 0x223390ef, 0x2c3a9de4, 0x96dd063d, 0x98d40b36, 0x8acf1c2b, 0x84c61120, 0xaef93211, 0xa0f03f1a, 0xb2eb2807, 0xbce2250c, 0xe6956e65, 0xe89c636e, 0xfa877473, 0xf48e7978, 0xdeb15a49, 0xd0b85742, 0xc2a3405f, 0xccaa4d54, 0x41ecdaf7, 0x4fe5d7fc, 0x5dfec0e1, 0x53f7cdea, 0x79c8eedb, 0x77c1e3d0, 0x65daf4cd, 0x6bd3f9c6, 0x31a4b2af, 0x3fadbfa4, 0x2db6a8b9, 0x23bfa5b2, 0x09808683, 0x07898b88, 0x15929c95, 0x1b9b919e, 0xa17c0a47, 0xaf75074c, 0xbd6e1051, 0xb3671d5a, 0x99583e6b, 0x97513360, 0x854a247d, 0x8b432976, 0xd134621f, 0xdf3d6f14, 0xcd267809, 0xc32f7502, 0xe9105633, 0xe7195b38, 0xf5024c25, 0xfb0b412e, 0x9ad7618c, 0x94de6c87, 0x86c57b9a, 0x88cc7691, 0xa2f355a0, 0xacfa58ab, 0xbee14fb6, 0xb0e842bd, 0xea9f09d4, 0xe49604df, 0xf68d13c2, 0xf8841ec9, 0xd2bb3df8, 0xdcb230f3, 0xcea927ee, 0xc0a02ae5, 0x7a47b13c, 0x744ebc37, 0x6655ab2a, 0x685ca621, 0x42638510, 0x4c6a881b, 0x5e719f06, 0x5078920d, 0x0a0fd964, 0x0406d46f, 0x161dc372, 0x1814ce79, 0x322bed48, 0x3c22e043, 0x2e39f75e, 0x2030fa55, 0xec9ab701, 0xe293ba0a, 0xf088ad17, 0xfe81a01c, 0xd4be832d, 0xdab78e26, 0xc8ac993b, 0xc6a59430, 0x9cd2df59, 0x92dbd252, 0x80c0c54f, 0x8ec9c844, 0xa4f6eb75, 0xaaffe67e, 0xb8e4f163, 0xb6edfc68, 0x0c0a67b1, 0x02036aba, 0x10187da7, 0x1e1170ac, 0x342e539d, 0x3a275e96, 0x283c498b, 0x26354480, 0x7c420fe9, 0x724b02e2, 0x605015ff, 0x6e5918f4, 0x44663bc5, 0x4a6f36ce, 0x587421d3, 0x567d2cd8, 0x37a10c7a, 0x39a80171, 0x2bb3166c, 0x25ba1b67, 0x0f853856, 0x018c355d, 0x13972240, 0x1d9e2f4b, 0x47e96422, 0x49e06929, 0x5bfb7e34, 0x55f2733f, 0x7fcd500e, 0x71c45d05, 0x63df4a18, 0x6dd64713, 0xd731dcca, 0xd938d1c1, 0xcb23c6dc, 0xc52acbd7, 0xef15e8e6, 0xe11ce5ed, 0xf307f2f0, 0xfd0efffb, 0xa779b492, 0xa970b999, 0xbb6bae84, 0xb562a38f, 0x9f5d80be, 0x91548db5, 0x834f9aa8, 0x8d4697a3];\n  var U2 = [0x00000000, 0x0b0e090d, 0x161c121a, 0x1d121b17, 0x2c382434, 0x27362d39, 0x3a24362e, 0x312a3f23, 0x58704868, 0x537e4165, 0x4e6c5a72, 0x4562537f, 0x74486c5c, 0x7f466551, 0x62547e46, 0x695a774b, 0xb0e090d0, 0xbbee99dd, 0xa6fc82ca, 0xadf28bc7, 0x9cd8b4e4, 0x97d6bde9, 0x8ac4a6fe, 0x81caaff3, 0xe890d8b8, 0xe39ed1b5, 0xfe8ccaa2, 0xf582c3af, 0xc4a8fc8c, 0xcfa6f581, 0xd2b4ee96, 0xd9bae79b, 0x7bdb3bbb, 0x70d532b6, 0x6dc729a1, 0x66c920ac, 0x57e31f8f, 0x5ced1682, 0x41ff0d95, 0x4af10498, 0x23ab73d3, 0x28a57ade, 0x35b761c9, 0x3eb968c4, 0x0f9357e7, 0x049d5eea, 0x198f45fd, 0x12814cf0, 0xcb3bab6b, 0xc035a266, 0xdd27b971, 0xd629b07c, 0xe7038f5f, 0xec0d8652, 0xf11f9d45, 0xfa119448, 0x934be303, 0x9845ea0e, 0x8557f119, 0x8e59f814, 0xbf73c737, 0xb47dce3a, 0xa96fd52d, 0xa261dc20, 0xf6ad766d, 0xfda37f60, 0xe0b16477, 0xebbf6d7a, 0xda955259, 0xd19b5b54, 0xcc894043, 0xc787494e, 0xaedd3e05, 0xa5d33708, 0xb8c12c1f, 0xb3cf2512, 0x82e51a31, 0x89eb133c, 0x94f9082b, 0x9ff70126, 0x464de6bd, 0x4d43efb0, 0x5051f4a7, 0x5b5ffdaa, 0x6a75c289, 0x617bcb84, 0x7c69d093, 0x7767d99e, 0x1e3daed5, 0x1533a7d8, 0x0821bccf, 0x032fb5c2, 0x32058ae1, 0x390b83ec, 0x241998fb, 0x2f1791f6, 0x8d764dd6, 0x867844db, 0x9b6a5fcc, 0x906456c1, 0xa14e69e2, 0xaa4060ef, 0xb7527bf8, 0xbc5c72f5, 0xd50605be, 0xde080cb3, 0xc31a17a4, 0xc8141ea9, 0xf93e218a, 0xf2302887, 0xef223390, 0xe42c3a9d, 0x3d96dd06, 0x3698d40b, 0x2b8acf1c, 0x2084c611, 0x11aef932, 0x1aa0f03f, 0x07b2eb28, 0x0cbce225, 0x65e6956e, 0x6ee89c63, 0x73fa8774, 0x78f48e79, 0x49deb15a, 0x42d0b857, 0x5fc2a340, 0x54ccaa4d, 0xf741ecda, 0xfc4fe5d7, 0xe15dfec0, 0xea53f7cd, 0xdb79c8ee, 0xd077c1e3, 0xcd65daf4, 0xc66bd3f9, 0xaf31a4b2, 0xa43fadbf, 0xb92db6a8, 0xb223bfa5, 0x83098086, 0x8807898b, 0x9515929c, 0x9e1b9b91, 0x47a17c0a, 0x4caf7507, 0x51bd6e10, 0x5ab3671d, 0x6b99583e, 0x60975133, 0x7d854a24, 0x768b4329, 0x1fd13462, 0x14df3d6f, 0x09cd2678, 0x02c32f75, 0x33e91056, 0x38e7195b, 0x25f5024c, 0x2efb0b41, 0x8c9ad761, 0x8794de6c, 0x9a86c57b, 0x9188cc76, 0xa0a2f355, 0xabacfa58, 0xb6bee14f, 0xbdb0e842, 0xd4ea9f09, 0xdfe49604, 0xc2f68d13, 0xc9f8841e, 0xf8d2bb3d, 0xf3dcb230, 0xeecea927, 0xe5c0a02a, 0x3c7a47b1, 0x37744ebc, 0x2a6655ab, 0x21685ca6, 0x10426385, 0x1b4c6a88, 0x065e719f, 0x0d507892, 0x640a0fd9, 0x6f0406d4, 0x72161dc3, 0x791814ce, 0x48322bed, 0x433c22e0, 0x5e2e39f7, 0x552030fa, 0x01ec9ab7, 0x0ae293ba, 0x17f088ad, 0x1cfe81a0, 0x2dd4be83, 0x26dab78e, 0x3bc8ac99, 0x30c6a594, 0x599cd2df, 0x5292dbd2, 0x4f80c0c5, 0x448ec9c8, 0x75a4f6eb, 0x7eaaffe6, 0x63b8e4f1, 0x68b6edfc, 0xb10c0a67, 0xba02036a, 0xa710187d, 0xac1e1170, 0x9d342e53, 0x963a275e, 0x8b283c49, 0x80263544, 0xe97c420f, 0xe2724b02, 0xff605015, 0xf46e5918, 0xc544663b, 0xce4a6f36, 0xd3587421, 0xd8567d2c, 0x7a37a10c, 0x7139a801, 0x6c2bb316, 0x6725ba1b, 0x560f8538, 0x5d018c35, 0x40139722, 0x4b1d9e2f, 0x2247e964, 0x2949e069, 0x345bfb7e, 0x3f55f273, 0x0e7fcd50, 0x0571c45d, 0x1863df4a, 0x136dd647, 0xcad731dc, 0xc1d938d1, 0xdccb23c6, 0xd7c52acb, 0xe6ef15e8, 0xede11ce5, 0xf0f307f2, 0xfbfd0eff, 0x92a779b4, 0x99a970b9, 0x84bb6bae, 0x8fb562a3, 0xbe9f5d80, 0xb591548d, 0xa8834f9a, 0xa38d4697];\n  var U3 = [0x00000000, 0x0d0b0e09, 0x1a161c12, 0x171d121b, 0x342c3824, 0x3927362d, 0x2e3a2436, 0x23312a3f, 0x68587048, 0x65537e41, 0x724e6c5a, 0x7f456253, 0x5c74486c, 0x517f4665, 0x4662547e, 0x4b695a77, 0xd0b0e090, 0xddbbee99, 0xcaa6fc82, 0xc7adf28b, 0xe49cd8b4, 0xe997d6bd, 0xfe8ac4a6, 0xf381caaf, 0xb8e890d8, 0xb5e39ed1, 0xa2fe8cca, 0xaff582c3, 0x8cc4a8fc, 0x81cfa6f5, 0x96d2b4ee, 0x9bd9bae7, 0xbb7bdb3b, 0xb670d532, 0xa16dc729, 0xac66c920, 0x8f57e31f, 0x825ced16, 0x9541ff0d, 0x984af104, 0xd323ab73, 0xde28a57a, 0xc935b761, 0xc43eb968, 0xe70f9357, 0xea049d5e, 0xfd198f45, 0xf012814c, 0x6bcb3bab, 0x66c035a2, 0x71dd27b9, 0x7cd629b0, 0x5fe7038f, 0x52ec0d86, 0x45f11f9d, 0x48fa1194, 0x03934be3, 0x0e9845ea, 0x198557f1, 0x148e59f8, 0x37bf73c7, 0x3ab47dce, 0x2da96fd5, 0x20a261dc, 0x6df6ad76, 0x60fda37f, 0x77e0b164, 0x7aebbf6d, 0x59da9552, 0x54d19b5b, 0x43cc8940, 0x4ec78749, 0x05aedd3e, 0x08a5d337, 0x1fb8c12c, 0x12b3cf25, 0x3182e51a, 0x3c89eb13, 0x2b94f908, 0x269ff701, 0xbd464de6, 0xb04d43ef, 0xa75051f4, 0xaa5b5ffd, 0x896a75c2, 0x84617bcb, 0x937c69d0, 0x9e7767d9, 0xd51e3dae, 0xd81533a7, 0xcf0821bc, 0xc2032fb5, 0xe132058a, 0xec390b83, 0xfb241998, 0xf62f1791, 0xd68d764d, 0xdb867844, 0xcc9b6a5f, 0xc1906456, 0xe2a14e69, 0xefaa4060, 0xf8b7527b, 0xf5bc5c72, 0xbed50605, 0xb3de080c, 0xa4c31a17, 0xa9c8141e, 0x8af93e21, 0x87f23028, 0x90ef2233, 0x9de42c3a, 0x063d96dd, 0x0b3698d4, 0x1c2b8acf, 0x112084c6, 0x3211aef9, 0x3f1aa0f0, 0x2807b2eb, 0x250cbce2, 0x6e65e695, 0x636ee89c, 0x7473fa87, 0x7978f48e, 0x5a49deb1, 0x5742d0b8, 0x405fc2a3, 0x4d54ccaa, 0xdaf741ec, 0xd7fc4fe5, 0xc0e15dfe, 0xcdea53f7, 0xeedb79c8, 0xe3d077c1, 0xf4cd65da, 0xf9c66bd3, 0xb2af31a4, 0xbfa43fad, 0xa8b92db6, 0xa5b223bf, 0x86830980, 0x8b880789, 0x9c951592, 0x919e1b9b, 0x0a47a17c, 0x074caf75, 0x1051bd6e, 0x1d5ab367, 0x3e6b9958, 0x33609751, 0x247d854a, 0x29768b43, 0x621fd134, 0x6f14df3d, 0x7809cd26, 0x7502c32f, 0x5633e910, 0x5b38e719, 0x4c25f502, 0x412efb0b, 0x618c9ad7, 0x6c8794de, 0x7b9a86c5, 0x769188cc, 0x55a0a2f3, 0x58abacfa, 0x4fb6bee1, 0x42bdb0e8, 0x09d4ea9f, 0x04dfe496, 0x13c2f68d, 0x1ec9f884, 0x3df8d2bb, 0x30f3dcb2, 0x27eecea9, 0x2ae5c0a0, 0xb13c7a47, 0xbc37744e, 0xab2a6655, 0xa621685c, 0x85104263, 0x881b4c6a, 0x9f065e71, 0x920d5078, 0xd9640a0f, 0xd46f0406, 0xc372161d, 0xce791814, 0xed48322b, 0xe0433c22, 0xf75e2e39, 0xfa552030, 0xb701ec9a, 0xba0ae293, 0xad17f088, 0xa01cfe81, 0x832dd4be, 0x8e26dab7, 0x993bc8ac, 0x9430c6a5, 0xdf599cd2, 0xd25292db, 0xc54f80c0, 0xc8448ec9, 0xeb75a4f6, 0xe67eaaff, 0xf163b8e4, 0xfc68b6ed, 0x67b10c0a, 0x6aba0203, 0x7da71018, 0x70ac1e11, 0x539d342e, 0x5e963a27, 0x498b283c, 0x44802635, 0x0fe97c42, 0x02e2724b, 0x15ff6050, 0x18f46e59, 0x3bc54466, 0x36ce4a6f, 0x21d35874, 0x2cd8567d, 0x0c7a37a1, 0x017139a8, 0x166c2bb3, 0x1b6725ba, 0x38560f85, 0x355d018c, 0x22401397, 0x2f4b1d9e, 0x642247e9, 0x692949e0, 0x7e345bfb, 0x733f55f2, 0x500e7fcd, 0x5d0571c4, 0x4a1863df, 0x47136dd6, 0xdccad731, 0xd1c1d938, 0xc6dccb23, 0xcbd7c52a, 0xe8e6ef15, 0xe5ede11c, 0xf2f0f307, 0xfffbfd0e, 0xb492a779, 0xb999a970, 0xae84bb6b, 0xa38fb562, 0x80be9f5d, 0x8db59154, 0x9aa8834f, 0x97a38d46];\n  var U4 = [0x00000000, 0x090d0b0e, 0x121a161c, 0x1b171d12, 0x24342c38, 0x2d392736, 0x362e3a24, 0x3f23312a, 0x48685870, 0x4165537e, 0x5a724e6c, 0x537f4562, 0x6c5c7448, 0x65517f46, 0x7e466254, 0x774b695a, 0x90d0b0e0, 0x99ddbbee, 0x82caa6fc, 0x8bc7adf2, 0xb4e49cd8, 0xbde997d6, 0xa6fe8ac4, 0xaff381ca, 0xd8b8e890, 0xd1b5e39e, 0xcaa2fe8c, 0xc3aff582, 0xfc8cc4a8, 0xf581cfa6, 0xee96d2b4, 0xe79bd9ba, 0x3bbb7bdb, 0x32b670d5, 0x29a16dc7, 0x20ac66c9, 0x1f8f57e3, 0x16825ced, 0x0d9541ff, 0x04984af1, 0x73d323ab, 0x7ade28a5, 0x61c935b7, 0x68c43eb9, 0x57e70f93, 0x5eea049d, 0x45fd198f, 0x4cf01281, 0xab6bcb3b, 0xa266c035, 0xb971dd27, 0xb07cd629, 0x8f5fe703, 0x8652ec0d, 0x9d45f11f, 0x9448fa11, 0xe303934b, 0xea0e9845, 0xf1198557, 0xf8148e59, 0xc737bf73, 0xce3ab47d, 0xd52da96f, 0xdc20a261, 0x766df6ad, 0x7f60fda3, 0x6477e0b1, 0x6d7aebbf, 0x5259da95, 0x5b54d19b, 0x4043cc89, 0x494ec787, 0x3e05aedd, 0x3708a5d3, 0x2c1fb8c1, 0x2512b3cf, 0x1a3182e5, 0x133c89eb, 0x082b94f9, 0x01269ff7, 0xe6bd464d, 0xefb04d43, 0xf4a75051, 0xfdaa5b5f, 0xc2896a75, 0xcb84617b, 0xd0937c69, 0xd99e7767, 0xaed51e3d, 0xa7d81533, 0xbccf0821, 0xb5c2032f, 0x8ae13205, 0x83ec390b, 0x98fb2419, 0x91f62f17, 0x4dd68d76, 0x44db8678, 0x5fcc9b6a, 0x56c19064, 0x69e2a14e, 0x60efaa40, 0x7bf8b752, 0x72f5bc5c, 0x05bed506, 0x0cb3de08, 0x17a4c31a, 0x1ea9c814, 0x218af93e, 0x2887f230, 0x3390ef22, 0x3a9de42c, 0xdd063d96, 0xd40b3698, 0xcf1c2b8a, 0xc6112084, 0xf93211ae, 0xf03f1aa0, 0xeb2807b2, 0xe2250cbc, 0x956e65e6, 0x9c636ee8, 0x877473fa, 0x8e7978f4, 0xb15a49de, 0xb85742d0, 0xa3405fc2, 0xaa4d54cc, 0xecdaf741, 0xe5d7fc4f, 0xfec0e15d, 0xf7cdea53, 0xc8eedb79, 0xc1e3d077, 0xdaf4cd65, 0xd3f9c66b, 0xa4b2af31, 0xadbfa43f, 0xb6a8b92d, 0xbfa5b223, 0x80868309, 0x898b8807, 0x929c9515, 0x9b919e1b, 0x7c0a47a1, 0x75074caf, 0x6e1051bd, 0x671d5ab3, 0x583e6b99, 0x51336097, 0x4a247d85, 0x4329768b, 0x34621fd1, 0x3d6f14df, 0x267809cd, 0x2f7502c3, 0x105633e9, 0x195b38e7, 0x024c25f5, 0x0b412efb, 0xd7618c9a, 0xde6c8794, 0xc57b9a86, 0xcc769188, 0xf355a0a2, 0xfa58abac, 0xe14fb6be, 0xe842bdb0, 0x9f09d4ea, 0x9604dfe4, 0x8d13c2f6, 0x841ec9f8, 0xbb3df8d2, 0xb230f3dc, 0xa927eece, 0xa02ae5c0, 0x47b13c7a, 0x4ebc3774, 0x55ab2a66, 0x5ca62168, 0x63851042, 0x6a881b4c, 0x719f065e, 0x78920d50, 0x0fd9640a, 0x06d46f04, 0x1dc37216, 0x14ce7918, 0x2bed4832, 0x22e0433c, 0x39f75e2e, 0x30fa5520, 0x9ab701ec, 0x93ba0ae2, 0x88ad17f0, 0x81a01cfe, 0xbe832dd4, 0xb78e26da, 0xac993bc8, 0xa59430c6, 0xd2df599c, 0xdbd25292, 0xc0c54f80, 0xc9c8448e, 0xf6eb75a4, 0xffe67eaa, 0xe4f163b8, 0xedfc68b6, 0x0a67b10c, 0x036aba02, 0x187da710, 0x1170ac1e, 0x2e539d34, 0x275e963a, 0x3c498b28, 0x35448026, 0x420fe97c, 0x4b02e272, 0x5015ff60, 0x5918f46e, 0x663bc544, 0x6f36ce4a, 0x7421d358, 0x7d2cd856, 0xa10c7a37, 0xa8017139, 0xb3166c2b, 0xba1b6725, 0x8538560f, 0x8c355d01, 0x97224013, 0x9e2f4b1d, 0xe9642247, 0xe0692949, 0xfb7e345b, 0xf2733f55, 0xcd500e7f, 0xc45d0571, 0xdf4a1863, 0xd647136d, 0x31dccad7, 0x38d1c1d9, 0x23c6dccb, 0x2acbd7c5, 0x15e8e6ef, 0x1ce5ede1, 0x07f2f0f3, 0x0efffbfd, 0x79b492a7, 0x70b999a9, 0x6bae84bb, 0x62a38fb5, 0x5d80be9f, 0x548db591, 0x4f9aa883, 0x4697a38d];\n\n  function convertToInt32(bytes) {\n    var result = [];\n    for (var i = 0; i < bytes.length; i += 4) {\n      result.push(\n        (bytes[i    ] << 24) |\n        (bytes[i + 1] << 16) |\n        (bytes[i + 2] <<  8) |\n        bytes[i + 3]\n      );\n    }\n    return result;\n  }\n\n  var AES = function(key) {\n    if (!(this instanceof AES)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    Object.defineProperty(this, 'key', {\n      value: coerceArray(key, true)\n    });\n\n    this._prepare();\n  }\n\n\n  AES.prototype._prepare = function() {\n\n    var rounds = numberOfRounds[this.key.length];\n    if (rounds == null) {\n      throw new Error('invalid key size (must be 16, 24 or 32 bytes)');\n    }\n\n    // encryption round keys\n    this._Ke = [];\n\n    // decryption round keys\n    this._Kd = [];\n\n    for (var i = 0; i <= rounds; i++) {\n      this._Ke.push([0, 0, 0, 0]);\n      this._Kd.push([0, 0, 0, 0]);\n    }\n\n    var roundKeyCount = (rounds + 1) * 4;\n    var KC = this.key.length / 4;\n\n    // convert the key into ints\n    var tk = convertToInt32(this.key);\n\n    // copy values into round key arrays\n    var index;\n    for (var i = 0; i < KC; i++) {\n      index = i >> 2;\n      this._Ke[index][i % 4] = tk[i];\n      this._Kd[rounds - index][i % 4] = tk[i];\n    }\n\n    // key expansion (fips-197 section 5.2)\n    var rconpointer = 0;\n    var t = KC, tt;\n    while (t < roundKeyCount) {\n      tt = tk[KC - 1];\n      tk[0] ^= ((S[(tt >> 16) & 0xFF] << 24) ^\n        (S[(tt >>  8) & 0xFF] << 16) ^\n        (S[ tt        & 0xFF] <<  8) ^\n        S[(tt >> 24) & 0xFF]        ^\n        (rcon[rconpointer] << 24));\n      rconpointer += 1;\n\n      // key expansion (for non-256 bit)\n      if (KC != 8) {\n        for (var i = 1; i < KC; i++) {\n          tk[i] ^= tk[i - 1];\n        }\n\n        // key expansion for 256-bit keys is \"slightly different\" (fips-197)\n      } else {\n        for (var i = 1; i < (KC / 2); i++) {\n          tk[i] ^= tk[i - 1];\n        }\n        tt = tk[(KC / 2) - 1];\n\n        tk[KC / 2] ^= (S[ tt        & 0xFF]        ^\n          (S[(tt >>  8) & 0xFF] <<  8) ^\n          (S[(tt >> 16) & 0xFF] << 16) ^\n          (S[(tt >> 24) & 0xFF] << 24));\n\n        for (var i = (KC / 2) + 1; i < KC; i++) {\n          tk[i] ^= tk[i - 1];\n        }\n      }\n\n      // copy values into round key arrays\n      var i = 0, r, c;\n      while (i < KC && t < roundKeyCount) {\n        r = t >> 2;\n        c = t % 4;\n        this._Ke[r][c] = tk[i];\n        this._Kd[rounds - r][c] = tk[i++];\n        t++;\n      }\n    }\n\n    // inverse-cipher-ify the decryption round key (fips-197 section 5.3)\n    for (var r = 1; r < rounds; r++) {\n      for (var c = 0; c < 4; c++) {\n        tt = this._Kd[r][c];\n        this._Kd[r][c] = (U1[(tt >> 24) & 0xFF] ^\n          U2[(tt >> 16) & 0xFF] ^\n          U3[(tt >>  8) & 0xFF] ^\n          U4[ tt        & 0xFF]);\n      }\n    }\n  }\n\n  AES.prototype.encrypt = function(plaintext) {\n    if (plaintext.length != 16) {\n      throw new Error('invalid plaintext size (must be 16 bytes)');\n    }\n\n    var rounds = this._Ke.length - 1;\n    var a = [0, 0, 0, 0];\n\n    // convert plaintext to (ints ^ key)\n    var t = convertToInt32(plaintext);\n    for (var i = 0; i < 4; i++) {\n      t[i] ^= this._Ke[0][i];\n    }\n\n    // apply round transforms\n    for (var r = 1; r < rounds; r++) {\n      for (var i = 0; i < 4; i++) {\n        a[i] = (T1[(t[ i         ] >> 24) & 0xff] ^\n          T2[(t[(i + 1) % 4] >> 16) & 0xff] ^\n          T3[(t[(i + 2) % 4] >>  8) & 0xff] ^\n          T4[ t[(i + 3) % 4]        & 0xff] ^\n          this._Ke[r][i]);\n      }\n      t = a.slice();\n    }\n\n    // the last round is special\n    var result = createArray(16), tt;\n    for (var i = 0; i < 4; i++) {\n      tt = this._Ke[rounds][i];\n      result[4 * i    ] = (S[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;\n      result[4 * i + 1] = (S[(t[(i + 1) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;\n      result[4 * i + 2] = (S[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;\n      result[4 * i + 3] = (S[ t[(i + 3) % 4]        & 0xff] ^  tt       ) & 0xff;\n    }\n\n    return result;\n  }\n\n  AES.prototype.decrypt = function(ciphertext) {\n    if (ciphertext.length != 16) {\n      throw new Error('invalid ciphertext size (must be 16 bytes)');\n    }\n\n    var rounds = this._Kd.length - 1;\n    var a = [0, 0, 0, 0];\n\n    // convert plaintext to (ints ^ key)\n    var t = convertToInt32(ciphertext);\n    for (var i = 0; i < 4; i++) {\n      t[i] ^= this._Kd[0][i];\n    }\n\n    // apply round transforms\n    for (var r = 1; r < rounds; r++) {\n      for (var i = 0; i < 4; i++) {\n        a[i] = (T5[(t[ i          ] >> 24) & 0xff] ^\n          T6[(t[(i + 3) % 4] >> 16) & 0xff] ^\n          T7[(t[(i + 2) % 4] >>  8) & 0xff] ^\n          T8[ t[(i + 1) % 4]        & 0xff] ^\n          this._Kd[r][i]);\n      }\n      t = a.slice();\n    }\n\n    // the last round is special\n    var result = createArray(16), tt;\n    for (var i = 0; i < 4; i++) {\n      tt = this._Kd[rounds][i];\n      result[4 * i    ] = (Si[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;\n      result[4 * i + 1] = (Si[(t[(i + 3) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;\n      result[4 * i + 2] = (Si[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;\n      result[4 * i + 3] = (Si[ t[(i + 1) % 4]        & 0xff] ^  tt       ) & 0xff;\n    }\n\n    return result;\n  }\n\n\n  /**\n   *  Mode Of Operation - Electonic Codebook (ECB)\n   */\n  var ModeOfOperationECB = function(key) {\n    if (!(this instanceof ModeOfOperationECB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Electronic Code Block\";\n    this.name = \"ecb\";\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationECB.prototype.encrypt = function(plaintext) {\n    plaintext = coerceArray(plaintext);\n\n    if ((plaintext.length % 16) !== 0) {\n      throw new Error('invalid plaintext size (must be multiple of 16 bytes)');\n    }\n\n    var ciphertext = createArray(plaintext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < plaintext.length; i += 16) {\n      copyArray(plaintext, block, 0, i, i + 16);\n      block = this._aes.encrypt(block);\n      copyArray(block, ciphertext, i);\n    }\n\n    return ciphertext;\n  }\n\n  ModeOfOperationECB.prototype.decrypt = function(ciphertext) {\n    ciphertext = coerceArray(ciphertext);\n\n    if ((ciphertext.length % 16) !== 0) {\n      throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');\n    }\n\n    var plaintext = createArray(ciphertext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < ciphertext.length; i += 16) {\n      copyArray(ciphertext, block, 0, i, i + 16);\n      block = this._aes.decrypt(block);\n      copyArray(block, plaintext, i);\n    }\n\n    return plaintext;\n  }\n\n\n  /**\n   *  Mode Of Operation - Cipher Block Chaining (CBC)\n   */\n  var ModeOfOperationCBC = function(key, iv) {\n    if (!(this instanceof ModeOfOperationCBC)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Cipher Block Chaining\";\n    this.name = \"cbc\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 bytes)');\n    }\n\n    this._lastCipherblock = coerceArray(iv, true);\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCBC.prototype.encrypt = function(plaintext) {\n    plaintext = coerceArray(plaintext);\n\n    if ((plaintext.length % 16) !== 0) {\n      throw new Error('invalid plaintext size (must be multiple of 16 bytes)');\n    }\n\n    var ciphertext = createArray(plaintext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < plaintext.length; i += 16) {\n      copyArray(plaintext, block, 0, i, i + 16);\n\n      for (var j = 0; j < 16; j++) {\n        block[j] ^= this._lastCipherblock[j];\n      }\n\n      this._lastCipherblock = this._aes.encrypt(block);\n      copyArray(this._lastCipherblock, ciphertext, i);\n    }\n\n    return ciphertext;\n  }\n\n  ModeOfOperationCBC.prototype.decrypt = function(ciphertext) {\n    ciphertext = coerceArray(ciphertext);\n\n    if ((ciphertext.length % 16) !== 0) {\n      throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');\n    }\n\n    var plaintext = createArray(ciphertext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < ciphertext.length; i += 16) {\n      copyArray(ciphertext, block, 0, i, i + 16);\n      block = this._aes.decrypt(block);\n\n      for (var j = 0; j < 16; j++) {\n        plaintext[i + j] = block[j] ^ this._lastCipherblock[j];\n      }\n\n      copyArray(ciphertext, this._lastCipherblock, 0, i, i + 16);\n    }\n\n    return plaintext;\n  }\n\n\n  /**\n   *  Mode Of Operation - Cipher Feedback (CFB)\n   */\n  var ModeOfOperationCFB = function(key, iv, segmentSize) {\n    if (!(this instanceof ModeOfOperationCFB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Cipher Feedback\";\n    this.name = \"cfb\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 size)');\n    }\n\n    if (!segmentSize) { segmentSize = 1; }\n\n    this.segmentSize = segmentSize;\n\n    this._shiftRegister = coerceArray(iv, true);\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCFB.prototype.encrypt = function(plaintext) {\n    if ((plaintext.length % this.segmentSize) != 0) {\n      throw new Error('invalid plaintext size (must be segmentSize bytes)');\n    }\n\n    var encrypted = coerceArray(plaintext, true);\n\n    var xorSegment;\n    for (var i = 0; i < encrypted.length; i += this.segmentSize) {\n      xorSegment = this._aes.encrypt(this._shiftRegister);\n      for (var j = 0; j < this.segmentSize; j++) {\n        encrypted[i + j] ^= xorSegment[j];\n      }\n\n      // Shift the register\n      copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);\n      copyArray(encrypted, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);\n    }\n\n    return encrypted;\n  }\n\n  ModeOfOperationCFB.prototype.decrypt = function(ciphertext) {\n    if ((ciphertext.length % this.segmentSize) != 0) {\n      throw new Error('invalid ciphertext size (must be segmentSize bytes)');\n    }\n\n    var plaintext = coerceArray(ciphertext, true);\n\n    var xorSegment;\n    for (var i = 0; i < plaintext.length; i += this.segmentSize) {\n      xorSegment = this._aes.encrypt(this._shiftRegister);\n\n      for (var j = 0; j < this.segmentSize; j++) {\n        plaintext[i + j] ^= xorSegment[j];\n      }\n\n      // Shift the register\n      copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);\n      copyArray(ciphertext, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);\n    }\n\n    return plaintext;\n  }\n\n  /**\n   *  Mode Of Operation - Output Feedback (OFB)\n   */\n  var ModeOfOperationOFB = function(key, iv) {\n    if (!(this instanceof ModeOfOperationOFB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Output Feedback\";\n    this.name = \"ofb\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 bytes)');\n    }\n\n    this._lastPrecipher = coerceArray(iv, true);\n    this._lastPrecipherIndex = 16;\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationOFB.prototype.encrypt = function(plaintext) {\n    var encrypted = coerceArray(plaintext, true);\n\n    for (var i = 0; i < encrypted.length; i++) {\n      if (this._lastPrecipherIndex === 16) {\n        this._lastPrecipher = this._aes.encrypt(this._lastPrecipher);\n        this._lastPrecipherIndex = 0;\n      }\n      encrypted[i] ^= this._lastPrecipher[this._lastPrecipherIndex++];\n    }\n\n    return encrypted;\n  }\n\n  // Decryption is symetric\n  ModeOfOperationOFB.prototype.decrypt = ModeOfOperationOFB.prototype.encrypt;\n\n\n  /**\n   *  Counter object for CTR common mode of operation\n   */\n  var Counter = function(initialValue) {\n    if (!(this instanceof Counter)) {\n      throw Error('Counter must be instanitated with `new`');\n    }\n\n    // We allow 0, but anything false-ish uses the default 1\n    if (initialValue !== 0 && !initialValue) { initialValue = 1; }\n\n    if (typeof(initialValue) === 'number') {\n      this._counter = createArray(16);\n      this.setValue(initialValue);\n\n    } else {\n      this.setBytes(initialValue);\n    }\n  }\n\n  Counter.prototype.setValue = function(value) {\n    if (typeof(value) !== 'number' || parseInt(value) != value) {\n      throw new Error('invalid counter value (must be an integer)');\n    }\n\n    // We cannot safely handle numbers beyond the safe range for integers\n    if (value > Number.MAX_SAFE_INTEGER) {\n      throw new Error('integer value out of safe range');\n    }\n\n    for (var index = 15; index >= 0; --index) {\n      this._counter[index] = value % 256;\n      value = parseInt(value / 256);\n    }\n  }\n\n  Counter.prototype.setBytes = function(bytes) {\n    bytes = coerceArray(bytes, true);\n\n    if (bytes.length != 16) {\n      throw new Error('invalid counter bytes size (must be 16 bytes)');\n    }\n\n    this._counter = bytes;\n  };\n\n  Counter.prototype.increment = function() {\n    for (var i = 15; i >= 0; i--) {\n      if (this._counter[i] === 255) {\n        this._counter[i] = 0;\n      } else {\n        this._counter[i]++;\n        break;\n      }\n    }\n  }\n\n\n  /**\n   *  Mode Of Operation - Counter (CTR)\n   */\n  var ModeOfOperationCTR = function(key, counter) {\n    if (!(this instanceof ModeOfOperationCTR)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Counter\";\n    this.name = \"ctr\";\n\n    if (!(counter instanceof Counter)) {\n      counter = new Counter(counter)\n    }\n\n    this._counter = counter;\n\n    this._remainingCounter = null;\n    this._remainingCounterIndex = 16;\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCTR.prototype.encrypt = function(plaintext) {\n    var encrypted = coerceArray(plaintext, true);\n\n    for (var i = 0; i < encrypted.length; i++) {\n      if (this._remainingCounterIndex === 16) {\n        this._remainingCounter = this._aes.encrypt(this._counter._counter);\n        this._remainingCounterIndex = 0;\n        this._counter.increment();\n      }\n      encrypted[i] ^= this._remainingCounter[this._remainingCounterIndex++];\n    }\n\n    return encrypted;\n  }\n\n  // Decryption is symetric\n  ModeOfOperationCTR.prototype.decrypt = ModeOfOperationCTR.prototype.encrypt;\n\n\n  ///////////////////////\n  // Padding\n\n  // See:https://tools.ietf.org/html/rfc2315\n  function pkcs7pad(data) {\n    data = coerceArray(data, true);\n    var padder = 16 - (data.length % 16);\n    var result = createArray(data.length + padder);\n    copyArray(data, result);\n    for (var i = data.length; i < result.length; i++) {\n      result[i] = padder;\n    }\n    return result;\n  }\n\n  function pkcs7strip(data) {\n    data = coerceArray(data, true);\n    if (data.length < 16) { throw new Error('PKCS#7 invalid length'); }\n\n    var padder = data[data.length - 1];\n    if (padder > 16) { throw new Error('PKCS#7 padding byte out of range'); }\n\n    var length = data.length - padder;\n    for (var i = 0; i < padder; i++) {\n      if (data[length + i] !== padder) {\n        throw new Error('PKCS#7 invalid padding byte');\n      }\n    }\n\n    var result = createArray(length);\n    copyArray(data, result, 0, 0, length);\n    return result;\n  }\n\n  ///////////////////////\n  // Exporting\n\n\n  // The block cipher\n  var aesjs = {\n    AES: AES,\n    Counter: Counter,\n\n    ModeOfOperation: {\n      ecb: ModeOfOperationECB,\n      cbc: ModeOfOperationCBC,\n      cfb: ModeOfOperationCFB,\n      ofb: ModeOfOperationOFB,\n      ctr: ModeOfOperationCTR\n    },\n\n    utils: {\n      hex: convertHex,\n      utf8: convertUtf8\n    },\n\n    padding: {\n      pkcs7: {\n        pad: pkcs7pad,\n        strip: pkcs7strip\n      }\n    },\n\n    _arrayTest: {\n      coerceArray: coerceArray,\n      createArray: createArray,\n      copyArray: copyArray,\n    }\n  };\n\n\n  // node.js\n  if (typeof exports !== 'undefined') {\n    module.exports = aesjs\n\n    // RequireJS/AMD\n    // http://www.requirejs.org/docs/api.html\n    // https://github.com/amdjs/amdjs-api/wiki/AMD\n  } else if (typeof(define) === 'function' && define.amd) {\n    define([], function() { return aesjs; });\n\n    // Web Browsers\n  } else {\n\n    // If there was an existing library at \"aesjs\" make sure it's still available\n    if (root.aesjs) {\n      aesjs._aesjs = root.aesjs;\n    }\n\n    root.aesjs = aesjs;\n  }\n\n\n})(this);\n","// Version 1.7.3\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n      (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.nobleEd25519 = {}));\n})(this, (function (exports) { 'use strict';\n\n  const _nodeResolve_empty = {};\n\n  const nodeCrypto = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    'default': _nodeResolve_empty\n  });\n\n  /*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */\n  const _0n = BigInt(0);\n  const _1n = BigInt(1);\n  const _2n = BigInt(2);\n  const _8n = BigInt(8);\n  const CU_O = BigInt('7237005577332262213973186563042994240857116359379907606001950938285454250989');\n  const CURVE = Object.freeze({\n    a: BigInt(-1),\n    d: BigInt('37095705934669439343138083508754565189542113879843219016388785533085940283555'),\n    P: BigInt('57896044618658097711785492504343953926634992332820282019728792003956564819949'),\n    l: CU_O,\n    n: CU_O,\n    h: BigInt(8),\n    Gx: BigInt('15112221349535400772501151409588531511454012693041857206046113283949847762202'),\n    Gy: BigInt('46316835694926478169428394003475163141307993866256225615783033603165251855960'),\n  });\n  const POW_2_256 = BigInt('0x10000000000000000000000000000000000000000000000000000000000000000');\n  const SQRT_M1 = BigInt('19681161376707505956807079304988542015446066515923890162744021073123829784752');\n  BigInt('6853475219497561581579357271197624642482790079785650197046958215289687604742');\n  const SQRT_AD_MINUS_ONE = BigInt('25063068953384623474111414158702152701244531502492656460079210482610430750235');\n  const INVSQRT_A_MINUS_D = BigInt('54469307008909316920995813868745141605393597292927456921205312896311721017578');\n  const ONE_MINUS_D_SQ = BigInt('1159843021668779879193775521855586647937357759715417654439879720876111806838');\n  const D_MINUS_ONE_SQ = BigInt('40440834346308536858101042469323190826248399146238708352240133220865137265952');\n  class ExtendedPoint {\n    constructor(x, y, z, t) {\n      this.x = x;\n      this.y = y;\n      this.z = z;\n      this.t = t;\n    }\n    static fromAffine(p) {\n      if (!(p instanceof Point)) {\n        throw new TypeError('ExtendedPoint#fromAffine: expected Point');\n      }\n      if (p.equals(Point.ZERO))\n        return ExtendedPoint.ZERO;\n      return new ExtendedPoint(p.x, p.y, _1n, mod(p.x * p.y));\n    }\n    static toAffineBatch(points) {\n      const toInv = invertBatch(points.map((p) => p.z));\n      return points.map((p, i) => p.toAffine(toInv[i]));\n    }\n    static normalizeZ(points) {\n      return this.toAffineBatch(points).map(this.fromAffine);\n    }\n    equals(other) {\n      assertExtPoint(other);\n      const { x: X1, y: Y1, z: Z1 } = this;\n      const { x: X2, y: Y2, z: Z2 } = other;\n      const X1Z2 = mod(X1 * Z2);\n      const X2Z1 = mod(X2 * Z1);\n      const Y1Z2 = mod(Y1 * Z2);\n      const Y2Z1 = mod(Y2 * Z1);\n      return X1Z2 === X2Z1 && Y1Z2 === Y2Z1;\n    }\n    negate() {\n      return new ExtendedPoint(mod(-this.x), this.y, this.z, mod(-this.t));\n    }\n    double() {\n      const { x: X1, y: Y1, z: Z1 } = this;\n      const { a } = CURVE;\n      const A = mod(X1 * X1);\n      const B = mod(Y1 * Y1);\n      const C = mod(_2n * mod(Z1 * Z1));\n      const D = mod(a * A);\n      const x1y1 = X1 + Y1;\n      const E = mod(mod(x1y1 * x1y1) - A - B);\n      const G = D + B;\n      const F = G - C;\n      const H = D - B;\n      const X3 = mod(E * F);\n      const Y3 = mod(G * H);\n      const T3 = mod(E * H);\n      const Z3 = mod(F * G);\n      return new ExtendedPoint(X3, Y3, Z3, T3);\n    }\n    add(other) {\n      assertExtPoint(other);\n      const { x: X1, y: Y1, z: Z1, t: T1 } = this;\n      const { x: X2, y: Y2, z: Z2, t: T2 } = other;\n      const A = mod((Y1 - X1) * (Y2 + X2));\n      const B = mod((Y1 + X1) * (Y2 - X2));\n      const F = mod(B - A);\n      if (F === _0n)\n        return this.double();\n      const C = mod(Z1 * _2n * T2);\n      const D = mod(T1 * _2n * Z2);\n      const E = D + C;\n      const G = B + A;\n      const H = D - C;\n      const X3 = mod(E * F);\n      const Y3 = mod(G * H);\n      const T3 = mod(E * H);\n      const Z3 = mod(F * G);\n      return new ExtendedPoint(X3, Y3, Z3, T3);\n    }\n    subtract(other) {\n      return this.add(other.negate());\n    }\n    precomputeWindow(W) {\n      const windows = 1 + 256 / W;\n      const points = [];\n      let p = this;\n      let base = p;\n      for (let window = 0; window < windows; window++) {\n        base = p;\n        points.push(base);\n        for (let i = 1; i < 2 ** (W - 1); i++) {\n          base = base.add(p);\n          points.push(base);\n        }\n        p = base.double();\n      }\n      return points;\n    }\n    wNAF(n, affinePoint) {\n      if (!affinePoint && this.equals(ExtendedPoint.BASE))\n        affinePoint = Point.BASE;\n      const W = (affinePoint && affinePoint._WINDOW_SIZE) || 1;\n      if (256 % W) {\n        throw new Error('Point#wNAF: Invalid precomputation window, must be power of 2');\n      }\n      let precomputes = affinePoint && pointPrecomputes.get(affinePoint);\n      if (!precomputes) {\n        precomputes = this.precomputeWindow(W);\n        if (affinePoint && W !== 1) {\n          precomputes = ExtendedPoint.normalizeZ(precomputes);\n          pointPrecomputes.set(affinePoint, precomputes);\n        }\n      }\n      let p = ExtendedPoint.ZERO;\n      let f = ExtendedPoint.BASE;\n      const windows = 1 + 256 / W;\n      const windowSize = 2 ** (W - 1);\n      const mask = BigInt(2 ** W - 1);\n      const maxNumber = 2 ** W;\n      const shiftBy = BigInt(W);\n      for (let window = 0; window < windows; window++) {\n        const offset = window * windowSize;\n        let wbits = Number(n & mask);\n        n >>= shiftBy;\n        if (wbits > windowSize) {\n          wbits -= maxNumber;\n          n += _1n;\n        }\n        const offset1 = offset;\n        const offset2 = offset + Math.abs(wbits) - 1;\n        const cond1 = window % 2 !== 0;\n        const cond2 = wbits < 0;\n        if (wbits === 0) {\n          f = f.add(constTimeNegate(cond1, precomputes[offset1]));\n        }\n        else {\n          p = p.add(constTimeNegate(cond2, precomputes[offset2]));\n        }\n      }\n      return ExtendedPoint.normalizeZ([p, f])[0];\n    }\n    multiply(scalar, affinePoint) {\n      return this.wNAF(normalizeScalar(scalar, CURVE.l), affinePoint);\n    }\n    multiplyUnsafe(scalar) {\n      let n = normalizeScalar(scalar, CURVE.l, false);\n      const G = ExtendedPoint.BASE;\n      const P0 = ExtendedPoint.ZERO;\n      if (n === _0n)\n        return P0;\n      if (this.equals(P0) || n === _1n)\n        return this;\n      if (this.equals(G))\n        return this.wNAF(n);\n      let p = P0;\n      let d = this;\n      while (n > _0n) {\n        if (n & _1n)\n          p = p.add(d);\n        d = d.double();\n        n >>= _1n;\n      }\n      return p;\n    }\n    isSmallOrder() {\n      return this.multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO);\n    }\n    isTorsionFree() {\n      let p = this.multiplyUnsafe(CURVE.l / _2n).double();\n      if (CURVE.l % _2n)\n        p = p.add(this);\n      return p.equals(ExtendedPoint.ZERO);\n    }\n    toAffine(invZ) {\n      const { x, y, z } = this;\n      const is0 = this.equals(ExtendedPoint.ZERO);\n      if (invZ == null)\n        invZ = is0 ? _8n : invert(z);\n      const ax = mod(x * invZ);\n      const ay = mod(y * invZ);\n      const zz = mod(z * invZ);\n      if (is0)\n        return Point.ZERO;\n      if (zz !== _1n)\n        throw new Error('invZ was invalid');\n      return new Point(ax, ay);\n    }\n    fromRistrettoBytes() {\n      legacyRist();\n    }\n    toRistrettoBytes() {\n      legacyRist();\n    }\n    fromRistrettoHash() {\n      legacyRist();\n    }\n  }\n  ExtendedPoint.BASE = new ExtendedPoint(CURVE.Gx, CURVE.Gy, _1n, mod(CURVE.Gx * CURVE.Gy));\n  ExtendedPoint.ZERO = new ExtendedPoint(_0n, _1n, _1n, _0n);\n  function constTimeNegate(condition, item) {\n    const neg = item.negate();\n    return condition ? neg : item;\n  }\n  function assertExtPoint(other) {\n    if (!(other instanceof ExtendedPoint))\n      throw new TypeError('ExtendedPoint expected');\n  }\n  function assertRstPoint(other) {\n    if (!(other instanceof RistrettoPoint))\n      throw new TypeError('RistrettoPoint expected');\n  }\n  function legacyRist() {\n    throw new Error('Legacy method: switch to RistrettoPoint');\n  }\n  class RistrettoPoint {\n    constructor(ep) {\n      this.ep = ep;\n    }\n    static calcElligatorRistrettoMap(r0) {\n      const { d } = CURVE;\n      const r = mod(SQRT_M1 * r0 * r0);\n      const Ns = mod((r + _1n) * ONE_MINUS_D_SQ);\n      let c = BigInt(-1);\n      const D = mod((c - d * r) * mod(r + d));\n      let { isValid: Ns_D_is_sq, value: s } = uvRatio(Ns, D);\n      let s_ = mod(s * r0);\n      if (!edIsNegative(s_))\n        s_ = mod(-s_);\n      if (!Ns_D_is_sq)\n        s = s_;\n      if (!Ns_D_is_sq)\n        c = r;\n      const Nt = mod(c * (r - _1n) * D_MINUS_ONE_SQ - D);\n      const s2 = s * s;\n      const W0 = mod((s + s) * D);\n      const W1 = mod(Nt * SQRT_AD_MINUS_ONE);\n      const W2 = mod(_1n - s2);\n      const W3 = mod(_1n + s2);\n      return new ExtendedPoint(mod(W0 * W3), mod(W2 * W1), mod(W1 * W3), mod(W0 * W2));\n    }\n    static hashToCurve(hex) {\n      hex = ensureBytes(hex, 64);\n      const r1 = bytes255ToNumberLE(hex.slice(0, 32));\n      const R1 = this.calcElligatorRistrettoMap(r1);\n      const r2 = bytes255ToNumberLE(hex.slice(32, 64));\n      const R2 = this.calcElligatorRistrettoMap(r2);\n      return new RistrettoPoint(R1.add(R2));\n    }\n    static fromHex(hex) {\n      hex = ensureBytes(hex, 32);\n      const { a, d } = CURVE;\n      const emsg = 'RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint';\n      const s = bytes255ToNumberLE(hex);\n      if (!equalBytes(numberTo32BytesLE(s), hex) || edIsNegative(s))\n        throw new Error(emsg);\n      const s2 = mod(s * s);\n      const u1 = mod(_1n + a * s2);\n      const u2 = mod(_1n - a * s2);\n      const u1_2 = mod(u1 * u1);\n      const u2_2 = mod(u2 * u2);\n      const v = mod(a * d * u1_2 - u2_2);\n      const { isValid, value: I } = invertSqrt(mod(v * u2_2));\n      const Dx = mod(I * u2);\n      const Dy = mod(I * Dx * v);\n      let x = mod((s + s) * Dx);\n      if (edIsNegative(x))\n        x = mod(-x);\n      const y = mod(u1 * Dy);\n      const t = mod(x * y);\n      if (!isValid || edIsNegative(t) || y === _0n)\n        throw new Error(emsg);\n      return new RistrettoPoint(new ExtendedPoint(x, y, _1n, t));\n    }\n    toRawBytes() {\n      let { x, y, z, t } = this.ep;\n      const u1 = mod(mod(z + y) * mod(z - y));\n      const u2 = mod(x * y);\n      const u2sq = mod(u2 * u2);\n      const { value: invsqrt } = invertSqrt(mod(u1 * u2sq));\n      const D1 = mod(invsqrt * u1);\n      const D2 = mod(invsqrt * u2);\n      const zInv = mod(D1 * D2 * t);\n      let D;\n      if (edIsNegative(t * zInv)) {\n        let _x = mod(y * SQRT_M1);\n        let _y = mod(x * SQRT_M1);\n        x = _x;\n        y = _y;\n        D = mod(D1 * INVSQRT_A_MINUS_D);\n      }\n      else {\n        D = D2;\n      }\n      if (edIsNegative(x * zInv))\n        y = mod(-y);\n      let s = mod((z - y) * D);\n      if (edIsNegative(s))\n        s = mod(-s);\n      return numberTo32BytesLE(s);\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n    toString() {\n      return this.toHex();\n    }\n    equals(other) {\n      assertRstPoint(other);\n      const a = this.ep;\n      const b = other.ep;\n      const one = mod(a.x * b.y) === mod(a.y * b.x);\n      const two = mod(a.y * b.y) === mod(a.x * b.x);\n      return one || two;\n    }\n    add(other) {\n      assertRstPoint(other);\n      return new RistrettoPoint(this.ep.add(other.ep));\n    }\n    subtract(other) {\n      assertRstPoint(other);\n      return new RistrettoPoint(this.ep.subtract(other.ep));\n    }\n    multiply(scalar) {\n      return new RistrettoPoint(this.ep.multiply(scalar));\n    }\n    multiplyUnsafe(scalar) {\n      return new RistrettoPoint(this.ep.multiplyUnsafe(scalar));\n    }\n  }\n  RistrettoPoint.BASE = new RistrettoPoint(ExtendedPoint.BASE);\n  RistrettoPoint.ZERO = new RistrettoPoint(ExtendedPoint.ZERO);\n  const pointPrecomputes = new WeakMap();\n  class Point {\n    constructor(x, y) {\n      this.x = x;\n      this.y = y;\n    }\n    _setWindowSize(windowSize) {\n      this._WINDOW_SIZE = windowSize;\n      pointPrecomputes.delete(this);\n    }\n    static fromHex(hex, strict = true) {\n      const { d, P } = CURVE;\n      hex = ensureBytes(hex, 32);\n      const normed = hex.slice();\n      normed[31] = hex[31] & ~0x80;\n      const y = bytesToNumberLE(normed);\n      if (strict && y >= P)\n        throw new Error('Expected 0 < hex < P');\n      if (!strict && y >= POW_2_256)\n        throw new Error('Expected 0 < hex < 2**256');\n      const y2 = mod(y * y);\n      const u = mod(y2 - _1n);\n      const v = mod(d * y2 + _1n);\n      let { isValid, value: x } = uvRatio(u, v);\n      if (!isValid)\n        throw new Error('Point.fromHex: invalid y coordinate');\n      const isXOdd = (x & _1n) === _1n;\n      const isLastByteOdd = (hex[31] & 0x80) !== 0;\n      if (isLastByteOdd !== isXOdd) {\n        x = mod(-x);\n      }\n      return new Point(x, y);\n    }\n    static async fromPrivateKey(privateKey) {\n      return (await getExtendedPublicKey(privateKey)).point;\n    }\n    toRawBytes() {\n      const bytes = numberTo32BytesLE(this.y);\n      bytes[31] |= this.x & _1n ? 0x80 : 0;\n      return bytes;\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n    toX25519() {\n      const { y } = this;\n      const u = mod((_1n + y) * invert(_1n - y));\n      return numberTo32BytesLE(u);\n    }\n    isTorsionFree() {\n      return ExtendedPoint.fromAffine(this).isTorsionFree();\n    }\n    equals(other) {\n      return this.x === other.x && this.y === other.y;\n    }\n    negate() {\n      return new Point(mod(-this.x), this.y);\n    }\n    add(other) {\n      return ExtendedPoint.fromAffine(this).add(ExtendedPoint.fromAffine(other)).toAffine();\n    }\n    subtract(other) {\n      return this.add(other.negate());\n    }\n    multiply(scalar) {\n      return ExtendedPoint.fromAffine(this).multiply(scalar, this).toAffine();\n    }\n  }\n  Point.BASE = new Point(CURVE.Gx, CURVE.Gy);\n  Point.ZERO = new Point(_0n, _1n);\n  class Signature {\n    constructor(r, s) {\n      this.r = r;\n      this.s = s;\n      this.assertValidity();\n    }\n    static fromHex(hex) {\n      const bytes = ensureBytes(hex, 64);\n      const r = Point.fromHex(bytes.slice(0, 32), false);\n      const s = bytesToNumberLE(bytes.slice(32, 64));\n      return new Signature(r, s);\n    }\n    assertValidity() {\n      const { r, s } = this;\n      if (!(r instanceof Point))\n        throw new Error('Expected Point instance');\n      normalizeScalar(s, CURVE.l, false);\n      return this;\n    }\n    toRawBytes() {\n      const u8 = new Uint8Array(64);\n      u8.set(this.r.toRawBytes());\n      u8.set(numberTo32BytesLE(this.s), 32);\n      return u8;\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n  }\n  function concatBytes(...arrays) {\n    if (!arrays.every((a) => a instanceof Uint8Array))\n      throw new Error('Expected Uint8Array list');\n    if (arrays.length === 1)\n      return arrays[0];\n    const length = arrays.reduce((a, arr) => a + arr.length, 0);\n    const result = new Uint8Array(length);\n    for (let i = 0, pad = 0; i < arrays.length; i++) {\n      const arr = arrays[i];\n      result.set(arr, pad);\n      pad += arr.length;\n    }\n    return result;\n  }\n  const hexes = Array.from({ length: 256 }, (v, i) => i.toString(16).padStart(2, '0'));\n  function bytesToHex(uint8a) {\n    if (!(uint8a instanceof Uint8Array))\n      throw new Error('Uint8Array expected');\n    let hex = '';\n    for (let i = 0; i < uint8a.length; i++) {\n      hex += hexes[uint8a[i]];\n    }\n    return hex;\n  }\n  function hexToBytes(hex) {\n    if (typeof hex !== 'string') {\n      throw new TypeError('hexToBytes: expected string, got ' + typeof hex);\n    }\n    if (hex.length % 2)\n      throw new Error('hexToBytes: received invalid unpadded hex');\n    const array = new Uint8Array(hex.length / 2);\n    for (let i = 0; i < array.length; i++) {\n      const j = i * 2;\n      const hexByte = hex.slice(j, j + 2);\n      const byte = Number.parseInt(hexByte, 16);\n      if (Number.isNaN(byte) || byte < 0)\n        throw new Error('Invalid byte sequence');\n      array[i] = byte;\n    }\n    return array;\n  }\n  function numberTo32BytesBE(num) {\n    const length = 32;\n    const hex = num.toString(16).padStart(length * 2, '0');\n    return hexToBytes(hex);\n  }\n  function numberTo32BytesLE(num) {\n    return numberTo32BytesBE(num).reverse();\n  }\n  function edIsNegative(num) {\n    return (mod(num) & _1n) === _1n;\n  }\n  function bytesToNumberLE(uint8a) {\n    if (!(uint8a instanceof Uint8Array))\n      throw new Error('Expected Uint8Array');\n    return BigInt('0x' + bytesToHex(Uint8Array.from(uint8a).reverse()));\n  }\n  const MAX_255B = BigInt('0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff');\n  function bytes255ToNumberLE(bytes) {\n    return mod(bytesToNumberLE(bytes) & MAX_255B);\n  }\n  function mod(a, b = CURVE.P) {\n    const res = a % b;\n    return res >= _0n ? res : b + res;\n  }\n  function invert(number, modulo = CURVE.P) {\n    if (number === _0n || modulo <= _0n) {\n      throw new Error(`invert: expected positive integers, got n=${number} mod=${modulo}`);\n    }\n    let a = mod(number, modulo);\n    let b = modulo;\n    let x = _0n, u = _1n;\n    while (a !== _0n) {\n      const q = b / a;\n      const r = b % a;\n      const m = x - u * q;\n      b = a, a = r, x = u, u = m;\n    }\n    const gcd = b;\n    if (gcd !== _1n)\n      throw new Error('invert: does not exist');\n    return mod(x, modulo);\n  }\n  function invertBatch(nums, p = CURVE.P) {\n    const tmp = new Array(nums.length);\n    const lastMultiplied = nums.reduce((acc, num, i) => {\n      if (num === _0n)\n        return acc;\n      tmp[i] = acc;\n      return mod(acc * num, p);\n    }, _1n);\n    const inverted = invert(lastMultiplied, p);\n    nums.reduceRight((acc, num, i) => {\n      if (num === _0n)\n        return acc;\n      tmp[i] = mod(acc * tmp[i], p);\n      return mod(acc * num, p);\n    }, inverted);\n    return tmp;\n  }\n  function pow2(x, power) {\n    const { P } = CURVE;\n    let res = x;\n    while (power-- > _0n) {\n      res *= res;\n      res %= P;\n    }\n    return res;\n  }\n  function pow_2_252_3(x) {\n    const { P } = CURVE;\n    const _5n = BigInt(5);\n    const _10n = BigInt(10);\n    const _20n = BigInt(20);\n    const _40n = BigInt(40);\n    const _80n = BigInt(80);\n    const x2 = (x * x) % P;\n    const b2 = (x2 * x) % P;\n    const b4 = (pow2(b2, _2n) * b2) % P;\n    const b5 = (pow2(b4, _1n) * x) % P;\n    const b10 = (pow2(b5, _5n) * b5) % P;\n    const b20 = (pow2(b10, _10n) * b10) % P;\n    const b40 = (pow2(b20, _20n) * b20) % P;\n    const b80 = (pow2(b40, _40n) * b40) % P;\n    const b160 = (pow2(b80, _80n) * b80) % P;\n    const b240 = (pow2(b160, _80n) * b80) % P;\n    const b250 = (pow2(b240, _10n) * b10) % P;\n    const pow_p_5_8 = (pow2(b250, _2n) * x) % P;\n    return { pow_p_5_8, b2 };\n  }\n  function uvRatio(u, v) {\n    const v3 = mod(v * v * v);\n    const v7 = mod(v3 * v3 * v);\n    const pow = pow_2_252_3(u * v7).pow_p_5_8;\n    let x = mod(u * v3 * pow);\n    const vx2 = mod(v * x * x);\n    const root1 = x;\n    const root2 = mod(x * SQRT_M1);\n    const useRoot1 = vx2 === u;\n    const useRoot2 = vx2 === mod(-u);\n    const noRoot = vx2 === mod(-u * SQRT_M1);\n    if (useRoot1)\n      x = root1;\n    if (useRoot2 || noRoot)\n      x = root2;\n    if (edIsNegative(x))\n      x = mod(-x);\n    return { isValid: useRoot1 || useRoot2, value: x };\n  }\n  function invertSqrt(number) {\n    return uvRatio(_1n, number);\n  }\n  function modlLE(hash) {\n    return mod(bytesToNumberLE(hash), CURVE.l);\n  }\n  function equalBytes(b1, b2) {\n    if (b1.length !== b2.length) {\n      return false;\n    }\n    for (let i = 0; i < b1.length; i++) {\n      if (b1[i] !== b2[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n  function ensureBytes(hex, expectedLength) {\n    const bytes = hex instanceof Uint8Array ? Uint8Array.from(hex) : hexToBytes(hex);\n    if (typeof expectedLength === 'number' && bytes.length !== expectedLength)\n      throw new Error(`Expected ${expectedLength} bytes`);\n    return bytes;\n  }\n  function normalizeScalar(num, max, strict = true) {\n    if (!max)\n      throw new TypeError('Specify max value');\n    if (typeof num === 'number' && Number.isSafeInteger(num))\n      num = BigInt(num);\n    if (typeof num === 'bigint' && num < max) {\n      if (strict) {\n        if (_0n < num)\n          return num;\n      }\n      else {\n        if (_0n <= num)\n          return num;\n      }\n    }\n    throw new TypeError('Expected valid scalar: 0 < scalar < max');\n  }\n  function adjustBytes25519(bytes) {\n    bytes[0] &= 248;\n    bytes[31] &= 127;\n    bytes[31] |= 64;\n    return bytes;\n  }\n  function decodeScalar25519(n) {\n    return bytesToNumberLE(adjustBytes25519(ensureBytes(n, 32)));\n  }\n  function checkPrivateKey(key) {\n    key =\n      typeof key === 'bigint' || typeof key === 'number'\n        ? numberTo32BytesBE(normalizeScalar(key, POW_2_256))\n        : ensureBytes(key);\n    if (key.length !== 32)\n      throw new Error(`Expected 32 bytes`);\n    return key;\n  }\n  function getKeyFromHash(hashed) {\n    const head = adjustBytes25519(hashed.slice(0, 32));\n    const prefix = hashed.slice(32, 64);\n    const scalar = modlLE(head);\n    const point = Point.BASE.multiply(scalar);\n    const pointBytes = point.toRawBytes();\n    return { head, prefix, scalar, point, pointBytes };\n  }\n  let _sha512Sync;\n  function sha512s(...m) {\n    if (typeof _sha512Sync !== 'function')\n      throw new Error('utils.sha512Sync must be set to use sync methods');\n    return _sha512Sync(...m);\n  }\n  async function getExtendedPublicKey(key) {\n    return getKeyFromHash(await utils.sha512(checkPrivateKey(key)));\n  }\n  function getExtendedPublicKeySync(key) {\n    return getKeyFromHash(sha512s(checkPrivateKey(key)));\n  }\n  async function getPublicKey(privateKey) {\n    return (await getExtendedPublicKey(privateKey)).pointBytes;\n  }\n  function getPublicKeySync(privateKey) {\n    return getExtendedPublicKeySync(privateKey).pointBytes;\n  }\n  async function sign(message, privateKey) {\n    message = ensureBytes(message);\n    const { prefix, scalar, pointBytes } = await getExtendedPublicKey(privateKey);\n    const r = modlLE(await utils.sha512(prefix, message));\n    const R = Point.BASE.multiply(r);\n    const k = modlLE(await utils.sha512(R.toRawBytes(), pointBytes, message));\n    const s = mod(r + k * scalar, CURVE.l);\n    return new Signature(R, s).toRawBytes();\n  }\n  function signSync(message, privateKey) {\n    message = ensureBytes(message);\n    const { prefix, scalar, pointBytes } = getExtendedPublicKeySync(privateKey);\n    const r = modlLE(sha512s(prefix, message));\n    const R = Point.BASE.multiply(r);\n    const k = modlLE(sha512s(R.toRawBytes(), pointBytes, message));\n    const s = mod(r + k * scalar, CURVE.l);\n    return new Signature(R, s).toRawBytes();\n  }\n  function prepareVerification(sig, message, publicKey) {\n    message = ensureBytes(message);\n    if (!(publicKey instanceof Point))\n      publicKey = Point.fromHex(publicKey, false);\n    const { r, s } = sig instanceof Signature ? sig.assertValidity() : Signature.fromHex(sig);\n    const SB = ExtendedPoint.BASE.multiplyUnsafe(s);\n    return { r, s, SB, pub: publicKey, msg: message };\n  }\n  function finishVerification(publicKey, r, SB, hashed) {\n    const k = modlLE(hashed);\n    const kA = ExtendedPoint.fromAffine(publicKey).multiplyUnsafe(k);\n    const RkA = ExtendedPoint.fromAffine(r).add(kA);\n    return RkA.subtract(SB).multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO);\n  }\n  async function verify(sig, message, publicKey) {\n    const { r, SB, msg, pub } = prepareVerification(sig, message, publicKey);\n    const hashed = await utils.sha512(r.toRawBytes(), pub.toRawBytes(), msg);\n    return finishVerification(pub, r, SB, hashed);\n  }\n  function verifySync(sig, message, publicKey) {\n    const { r, SB, msg, pub } = prepareVerification(sig, message, publicKey);\n    const hashed = sha512s(r.toRawBytes(), pub.toRawBytes(), msg);\n    return finishVerification(pub, r, SB, hashed);\n  }\n  const sync = {\n    getExtendedPublicKey: getExtendedPublicKeySync,\n    getPublicKey: getPublicKeySync,\n    sign: signSync,\n    verify: verifySync,\n  };\n  async function getSharedSecret(privateKey, publicKey) {\n    const { head } = await getExtendedPublicKey(privateKey);\n    const u = Point.fromHex(publicKey).toX25519();\n    return curve25519.scalarMult(head, u);\n  }\n  Point.BASE._setWindowSize(8);\n  function cswap(swap, x_2, x_3) {\n    const dummy = mod(swap * (x_2 - x_3));\n    x_2 = mod(x_2 - dummy);\n    x_3 = mod(x_3 + dummy);\n    return [x_2, x_3];\n  }\n  function montgomeryLadder(pointU, scalar) {\n    const { P } = CURVE;\n    const u = normalizeScalar(pointU, P);\n    const k = normalizeScalar(scalar, P);\n    const a24 = BigInt(121665);\n    const x_1 = u;\n    let x_2 = _1n;\n    let z_2 = _0n;\n    let x_3 = u;\n    let z_3 = _1n;\n    let swap = _0n;\n    let sw;\n    for (let t = BigInt(255 - 1); t >= _0n; t--) {\n      const k_t = (k >> t) & _1n;\n      swap ^= k_t;\n      sw = cswap(swap, x_2, x_3);\n      x_2 = sw[0];\n      x_3 = sw[1];\n      sw = cswap(swap, z_2, z_3);\n      z_2 = sw[0];\n      z_3 = sw[1];\n      swap = k_t;\n      const A = x_2 + z_2;\n      const AA = mod(A * A);\n      const B = x_2 - z_2;\n      const BB = mod(B * B);\n      const E = AA - BB;\n      const C = x_3 + z_3;\n      const D = x_3 - z_3;\n      const DA = mod(D * A);\n      const CB = mod(C * B);\n      const dacb = DA + CB;\n      const da_cb = DA - CB;\n      x_3 = mod(dacb * dacb);\n      z_3 = mod(x_1 * mod(da_cb * da_cb));\n      x_2 = mod(AA * BB);\n      z_2 = mod(E * (AA + mod(a24 * E)));\n    }\n    sw = cswap(swap, x_2, x_3);\n    x_2 = sw[0];\n    x_3 = sw[1];\n    sw = cswap(swap, z_2, z_3);\n    z_2 = sw[0];\n    z_3 = sw[1];\n    const { pow_p_5_8, b2 } = pow_2_252_3(z_2);\n    const xp2 = mod(pow2(pow_p_5_8, BigInt(3)) * b2);\n    return mod(x_2 * xp2);\n  }\n  function encodeUCoordinate(u) {\n    return numberTo32BytesLE(mod(u, CURVE.P));\n  }\n  function decodeUCoordinate(uEnc) {\n    const u = ensureBytes(uEnc, 32);\n    u[31] &= 127;\n    return bytesToNumberLE(u);\n  }\n  const curve25519 = {\n    BASE_POINT_U: '0900000000000000000000000000000000000000000000000000000000000000',\n    scalarMult(privateKey, publicKey) {\n      const u = decodeUCoordinate(publicKey);\n      const p = decodeScalar25519(privateKey);\n      const pu = montgomeryLadder(u, p);\n      if (pu === _0n)\n        throw new Error('Invalid private or public key received');\n      return encodeUCoordinate(pu);\n    },\n    scalarMultBase(privateKey) {\n      return curve25519.scalarMult(privateKey, curve25519.BASE_POINT_U);\n    },\n  };\n  const crypto = {\n    node: nodeCrypto,\n    web: typeof self === 'object' && 'crypto' in self ? self.crypto : undefined,\n  };\n  const utils = {\n    bytesToHex,\n    hexToBytes,\n    concatBytes,\n    getExtendedPublicKey,\n    mod,\n    invert,\n    TORSION_SUBGROUP: [\n      '0100000000000000000000000000000000000000000000000000000000000000',\n      'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a',\n      '0000000000000000000000000000000000000000000000000000000000000080',\n      '26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05',\n      'ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f',\n      '26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85',\n      '0000000000000000000000000000000000000000000000000000000000000000',\n      'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa',\n    ],\n    hashToPrivateScalar: (hash) => {\n      hash = ensureBytes(hash);\n      if (hash.length < 40 || hash.length > 1024)\n        throw new Error('Expected 40-1024 bytes of private key as per FIPS 186');\n      return mod(bytesToNumberLE(hash), CURVE.l - _1n) + _1n;\n    },\n    randomBytes: (bytesLength = 32) => {\n      if (crypto.web) {\n        return crypto.web.getRandomValues(new Uint8Array(bytesLength));\n      }\n      else if (crypto.node) {\n        const { randomBytes } = crypto.node;\n        return new Uint8Array(randomBytes(bytesLength).buffer);\n      }\n      else {\n        throw new Error(\"The environment doesn't have randomBytes function\");\n      }\n    },\n    randomPrivateKey: () => {\n      return utils.randomBytes(32);\n    },\n    sha512: async (...messages) => {\n      const message = concatBytes(...messages);\n      if (crypto.web) {\n        const buffer = await crypto.web.subtle.digest('SHA-512', message.buffer);\n        return new Uint8Array(buffer);\n      }\n      else if (crypto.node) {\n        return Uint8Array.from(crypto.node.createHash('sha512').update(message).digest());\n      }\n      else {\n        throw new Error(\"The environment doesn't have sha512 function\");\n      }\n    },\n    precompute(windowSize = 8, point = Point.BASE) {\n      const cached = point.equals(Point.BASE) ? point : new Point(point.x, point.y);\n      cached._setWindowSize(windowSize);\n      cached.multiply(_2n);\n      return cached;\n    },\n    sha512Sync: undefined,\n  };\n  Object.defineProperties(utils, {\n    sha512Sync: {\n      configurable: false,\n      get() {\n        return _sha512Sync;\n      },\n      set(val) {\n        if (!_sha512Sync)\n          _sha512Sync = val;\n      },\n    },\n  });\n\n  exports.CURVE = CURVE;\n  exports.ExtendedPoint = ExtendedPoint;\n  exports.Point = Point;\n  exports.RistrettoPoint = RistrettoPoint;\n  exports.Signature = Signature;\n  exports.curve25519 = curve25519;\n  exports.getPublicKey = getPublicKey;\n  exports.getSharedSecret = getSharedSecret;\n  exports.sign = sign;\n  exports.sync = sync;\n  exports.utils = utils;\n  exports.verify = verify;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","export class AssertionError extends Error {\n  constructor(\n    message: string,\n    // Any additional information for the error to help debug it. Don't put sensitive information here.\n    public metadata?: unknown,\n  ) {\n    super(message);\n  }\n}\n\nexport function assert(condition: boolean, message: string, metadata?: unknown) {\n  if (!condition) {\n    throw new AssertionError(message, metadata);\n  }\n}\n","import type { LangCode } from '../global/types';\nimport type { LangFn } from './langProvider';\n\nimport withCache from './withCache';\n\nexport const SECOND = 1000;\nexport const MINUTE = SECOND * 60;\nexport const HOUR = MINUTE * 60;\nexport const DAY = HOUR * 24;\n\nconst formatDayToStringWithCache = withCache((\n  langCode: LangCode,\n  dayStartAt: number,\n  noYear?: boolean,\n  monthFormat: 'short' | 'long' | 'numeric' | false = 'short',\n  noDay?: boolean,\n  withTime = false,\n) => {\n  return new Date(dayStartAt).toLocaleString(\n    langCode,\n    {\n      year: noYear ? undefined : 'numeric',\n      month: monthFormat || undefined,\n      day: noDay ? undefined : 'numeric',\n      hour: withTime ? 'numeric' : undefined,\n      minute: withTime ? 'numeric' : undefined,\n      hourCycle: 'h23',\n    },\n  );\n});\n\nexport function formatRelativeHumanDateTime(\n  langCode: LangCode = 'en',\n  time: number,\n) {\n  const total = time - Date.now();\n  const minutes = Math.floor((total / 1000 / 60) % 60);\n  const hours = Math.floor((total / (1000 * 3600)) % 24);\n  const days = Math.floor(total / 1000 / 3600 / 24);\n\n  const rtf = new Intl.RelativeTimeFormat(langCode, {\n    localeMatcher: 'best fit',\n    numeric: 'always',\n    style: 'long',\n  });\n\n  const result: string[] = [];\n\n  if (days > 0) {\n    const [daysPlural, daysValue] = rtf.formatToParts(days, 'day').reverse();\n    result.push(`${daysValue.value}${daysPlural.value}`);\n  }\n  if (hours > 0) {\n    const [hoursPlural, hoursValue] = rtf.formatToParts(hours, 'hour').reverse();\n    result.push(`${hoursValue.value}${hoursPlural.value}`);\n  }\n  if (minutes > 0) {\n    const [minutesPlural, minutesValue] = rtf.formatToParts(minutes, 'minute').reverse();\n    result.push(`${minutesValue.value}${minutesPlural.value}`);\n  }\n\n  return result.join(' ');\n}\n\nexport function formatHumanDay(lang: LangFn, datetime: string | number) {\n  if (isToday(datetime)) {\n    return lang('Today');\n  }\n\n  if (isYesterday(datetime)) {\n    return lang('Yesterday');\n  }\n\n  return formatFullDay(lang.code!, datetime);\n}\n\nexport function formatFullDay(langCode: LangCode, datetime: string | number | Date) {\n  const date = new Date(datetime);\n  const dayStartAt = getDayStartAt(date);\n  const today = getDayStart(new Date());\n  const noYear = date.getFullYear() === today.getFullYear();\n\n  return formatDayToStringWithCache(langCode, dayStartAt, noYear, 'long');\n}\n\nexport function formatShortDay(langCode: LangCode, datetime: string | number | Date, withTime = false, noYear = false) {\n  const date = new Date(datetime);\n  const dayStartAt = getDayStartAt(date);\n  const today = getDayStart(new Date());\n  const todayStartAt = getDayStartAt(today);\n  const noDate = withTime && dayStartAt === todayStartAt;\n  const targetAt = withTime ? getMinuteStart(date).getTime() : dayStartAt;\n\n  noYear ||= date.getFullYear() === today.getFullYear();\n\n  return formatDayToStringWithCache(langCode, targetAt, noYear, !noDate && 'short', noDate, withTime);\n}\n\nexport function formatTime(datetime: string | number) {\n  const date = new Date(datetime);\n\n  return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\n}\n\nexport function getCountDaysToDate(datetime: string | number | Date) {\n  const today = new Date();\n  const date = datetime instanceof Date ? datetime\n    : new Date(datetime);\n\n  return Math.ceil((date.getTime() - today.getTime()) / DAY);\n}\n\nexport function getDayStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nexport function getDayStartAt(datetime: number | Date) {\n  return getDayStart(datetime).getTime();\n}\n\nexport function getMinuteStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setSeconds(0, 0);\n  return date;\n}\n\nfunction isToday(datetime: string | number) {\n  return getDayStartAt(new Date()) === getDayStartAt(new Date(datetime));\n}\n\nfunction isYesterday(datetime: string | number) {\n  const yesterday = new Date();\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  return getDayStartAt(yesterday) === getDayStartAt(new Date(datetime));\n}\n","import { IS_EXTENSION } from '../config';\n\nexport const IS_EXTENSION_PAGE_SCRIPT = IS_EXTENSION\n  // eslint-disable-next-line no-restricted-globals\n  && !['chrome-extension:', 'moz-extension:'].includes(self.location.protocol);\n","import {\n  BRILLIANT_API_BASE_URL, DEFAULT_ERROR_PAUSE, DEFAULT_RETRIES, DEFAULT_TIMEOUT,\n} from '../config';\nimport { ApiServerError } from '../api/errors';\nimport { logDebug } from './logs';\nimport { pause } from './schedulers';\n\ntype QueryParams = Record<string, string | number | boolean | string[]>;\n\nconst MAX_TIMEOUT = 30000; // 30 sec\n\nexport async function fetchJsonWithProxy(url: string | URL, data?: QueryParams, init?: RequestInit) {\n  try {\n    return await fetchJson(url, data, init);\n  } catch (err) {\n    if (err instanceof ApiServerError && (!err.statusCode || err.statusCode === 403)) {\n      return fetchJson(`${BRILLIANT_API_BASE_URL}/proxy/?url=${url.toString()}`, data, init);\n    }\n    throw err;\n  }\n}\n\nexport async function fetchJson(url: string | URL, data?: QueryParams, init?: RequestInit) {\n  const urlObject = new URL(url);\n  if (data) {\n    Object.entries(data).forEach(([key, value]) => {\n      if (value === undefined) {\n        return;\n      }\n\n      if (Array.isArray(value)) {\n        value.forEach((item) => {\n          urlObject.searchParams.append(key, item.toString());\n        });\n      } else {\n        urlObject.searchParams.set(key, value.toString());\n      }\n    });\n  }\n\n  const response = await fetchWithRetry(urlObject, init);\n\n  return response.json();\n}\n\nexport async function fetchWithRetry(url: string | URL, init?: RequestInit, options?: {\n  retries?: number;\n  timeouts?: number | number[];\n  shouldSkipRetryFn?: (message?: string, statusCode?: number) => boolean;\n}) {\n  const {\n    retries = DEFAULT_RETRIES,\n    timeouts = DEFAULT_TIMEOUT,\n    shouldSkipRetryFn = isNotTemporaryError,\n  } = options ?? {};\n\n  let message = 'Unknown error.';\n  let statusCode: number | undefined;\n\n  for (let i = 1; i <= retries; i++) {\n    try {\n      if (i > 1) {\n        logDebug(`Retry request #${i}:`, url.toString(), statusCode);\n      }\n\n      const timeout = Array.isArray(timeouts)\n        ? timeouts[i - 1] ?? timeouts[timeouts.length - 1]\n        : Math.min(timeouts * i, MAX_TIMEOUT);\n      const response = await fetchWithTimeout(url, init, timeout);\n      statusCode = response.status;\n\n      if (statusCode >= 400) {\n        const { error } = await response.json().catch(() => {});\n        throw new Error(error ?? `HTTP Error ${statusCode}`);\n      }\n\n      return response;\n    } catch (err: any) {\n      message = typeof err === 'string' ? err : err.message ?? message;\n\n      const shouldSkipRetry = shouldSkipRetryFn(message, statusCode);\n\n      if (shouldSkipRetry) {\n        throw new ApiServerError(message, statusCode);\n      }\n\n      if (i < retries) {\n        await pause(DEFAULT_ERROR_PAUSE * i);\n      }\n    }\n  }\n\n  throw new ApiServerError(message);\n}\n\nexport async function fetchWithTimeout(url: string | URL, init?: RequestInit, timeout = DEFAULT_TIMEOUT) {\n  const controller = new AbortController();\n  const id = setTimeout(() => {\n    controller.abort();\n  }, timeout);\n\n  try {\n    return await fetch(url, {\n      ...init,\n      signal: controller.signal,\n      cache: 'no-cache', // TODO Remove it after a few releases\n    });\n  } finally {\n    clearTimeout(id);\n  }\n}\n\nexport async function handleFetchErrors(response: Response, ignoreHttpCodes?: number[]) {\n  if (!response.ok && (!ignoreHttpCodes?.includes(response.status))) {\n    // eslint-disable-next-line prefer-const\n    let { error, errors } = await response.json().catch(() => undefined);\n    if (!error && errors && errors.length) {\n      error = errors[0]?.msg;\n    }\n\n    throw new ApiServerError(error ?? `HTTP Error ${response.status}`, response.status);\n  }\n  return response;\n}\n\nfunction isNotTemporaryError(message?: string, statusCode?: number) {\n  return statusCode && [400, 404].includes(statusCode);\n}\n","import { APP_ENV, DEBUG_ALERT_MSG } from '../config';\nimport { SECOND } from './dateFormat';\nimport { IS_EXTENSION_PAGE_SCRIPT } from './environment';\nimport { logDebugError } from './logs';\nimport { throttle } from './schedulers';\n\nconst shouldShowAlert = (APP_ENV === 'development' || APP_ENV === 'staging')\n  && typeof window === 'object'\n  && !IS_EXTENSION_PAGE_SCRIPT;\n\n// eslint-disable-next-line no-alert\nconst throttledAlert = throttle((message) => window.alert(message), 10 * SECOND);\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('error', handleErrorEvent);\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('unhandledrejection', handleErrorEvent);\n\nfunction handleErrorEvent(e: ErrorEvent | PromiseRejectionEvent) {\n  // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n  if (e instanceof ErrorEvent && e.message === 'ResizeObserver loop limit exceeded') {\n    return;\n  }\n\n  e.preventDefault();\n\n  handleError(e instanceof ErrorEvent ? (e.error || e.message) : e.reason);\n}\n\nexport function handleError(err: Error | string) {\n  logDebugError('handleError', err);\n\n  const message = typeof err === 'string' ? err : err.message;\n  const stack = typeof err === 'object' ? err.stack : undefined;\n\n  if (message.endsWith('Failed to import rlottie-wasm.js')) {\n    return;\n  }\n\n  if (shouldShowAlert) {\n    throttledAlert(`${DEBUG_ALERT_MSG}\\n\\n${(message) || err}\\n${stack}`);\n  }\n}\n","import { DEBUG, DEBUG_API } from '../config';\nimport { AssertionError } from './assert';\nimport { omit } from './iteratees';\n\nexport interface Log {\n  message: string;\n  args: any[];\n  time: Date;\n  level: 'debug' | 'debugError';\n}\n\nconst MAX_LOG_LENGTH = 999;\nconst logs: Log[] = [];\n\nexport function errorReplacer(_: string, value: any) {\n  if (value instanceof Error) {\n    return {\n      name: value.name,\n      message: value.message,\n      stack: value.stack,\n      metadata: value instanceof AssertionError ? value.metadata : undefined,\n    };\n  }\n  return value;\n}\n\nexport function addLog(log: Omit<Log, 'time'>) {\n  if (logs.length > MAX_LOG_LENGTH) {\n    logs.shift();\n  }\n\n  logs.push({\n    ...log,\n    args: log.args.map((arg) => JSON.stringify(arg, errorReplacer)),\n    time: new Date(),\n  });\n}\n\nexport function getLogs() {\n  return logs;\n}\n\nexport function logActionHandling(name: string, payload?: any) {\n  if (!DEBUG_API) return;\n  if (name === 'apiUpdate') {\n    if (typeof payload?.type === 'object' && payload.type !== 'updatingStatus') {\n      logDebugApi(`Update: ${payload.type}`, omit(payload, ['type']));\n    }\n  } else {\n    logDebugApi(`Action: ${name}`, payload);\n  }\n}\n\nexport function logDebugError(message: string, ...args: any[]) {\n  addLog({ message, level: 'debugError', args });\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.error(`[DEBUG][${message}]`, ...args);\n  }\n}\n\nexport function logDebug(message: any, ...args: any[]) {\n  addLog({ message, level: 'debug', args });\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log(`[DEBUG] ${message}`, ...args);\n  }\n}\n\nexport function logDebugApi(message: any, obj1: any, obj2?: any) {\n  if (DEBUG_API) {\n    // eslint-disable-next-line no-console\n    console.debug(`[DEBUG] ${message}`);\n    // eslint-disable-next-line no-console\n    if (obj1) console.dir(obj1);\n    // eslint-disable-next-line no-console\n    if (obj2) console.dir(obj2);\n  }\n}\n\nexport function logSelfXssWarnings() {\n  const selfXssWarnings: AnyLiteral = {\n    en: 'WARNING! This console can be a way for bad people to take over your crypto wallet through something called '\n        + 'a Self-XSS attack. So, don\\'t put in or paste code you don\\'t understand. Stay safe!',\n    ru: '!             '\n        + '  Self-XSS.       ,    .  !',\n    es: 'ADVERTENCIA! Esta consola puede ser una forma en que las personas malintencionadas se apoderen de su '\n        + 'billetera de criptomonedas mediante un ataque llamado Self-XSS. Por lo tanto, '\n        + 'no introduzca ni pegue cdigo que no comprenda. Cudese!',\n    zh: 'Self-XSS',\n  };\n\n  const langCode = navigator.language.split('-')[0];\n  const text = selfXssWarnings[langCode] || selfXssWarnings.en;\n\n  // eslint-disable-next-line no-console\n  console.log('%c%s', 'color: red; background: yellow; font-size: 18px;', text);\n}\n","import { DEBUG_MORE } from '../config';\nimport { handleError } from './handleError';\n\nconst SAFE_EXEC_ENABLED = !DEBUG_MORE;\n\ntype SafeExecOptions = {\n  rescue?: (err: Error) => void;\n  always?: NoneToVoidFunction;\n  shouldIgnoreError?: boolean;\n};\n\nexport async function safeExecAsync<T extends AnyAsyncFunction>(\n  cb: T,\n  options?: SafeExecOptions,\n): Promise<ReturnType<T> | undefined> {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return await cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n\nexport default function safeExec<T extends AnyFunction>(cb: T, options?: SafeExecOptions): ReturnType<T> | undefined {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n","export type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\nexport function throttle<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n) {\n  let interval: number | undefined;\n  let isPending: boolean;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    isPending = true;\n    args = _args;\n\n    if (!interval) {\n      if (shouldRunFirst) {\n        isPending = false;\n        fn(...args);\n      }\n\n      // eslint-disable-next-line no-restricted-globals\n      interval = self.setInterval(() => {\n        if (!isPending) {\n          // eslint-disable-next-line no-restricted-globals\n          self.clearInterval(interval!);\n          interval = undefined;\n          return;\n        }\n\n        isPending = false;\n        fn(...args);\n      }, ms);\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    void Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nconst IDLE_TIMEOUT = 500;\n\nlet onIdleCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onIdle(callback: NoneToVoidFunction) {\n  // eslint-disable-next-line no-restricted-globals\n  if (!self.requestIdleCallback) {\n    onTickEnd(callback);\n    return;\n  }\n\n  if (!onIdleCallbacks) {\n    onIdleCallbacks = [callback];\n\n    requestIdleCallback((deadline) => {\n      const currentCallbacks = onIdleCallbacks!;\n      onIdleCallbacks = undefined;\n\n      while (currentCallbacks.length) {\n        const cb = currentCallbacks.shift()!;\n        cb();\n\n        if (!deadline.timeRemaining()) break;\n      }\n\n      if (currentCallbacks.length) {\n        if (onIdleCallbacks) {\n          // Prepend the remaining callbacks if the next pass is already planned\n          onIdleCallbacks = currentCallbacks.concat(onIdleCallbacks);\n        } else {\n          currentCallbacks.forEach(onIdle);\n        }\n      }\n    }, { timeout: IDLE_TIMEOUT });\n  } else {\n    onIdleCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n    // eslint-disable-next-line no-restricted-globals\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n\nexport async function waitFor(cb: () => boolean, interval: number, attempts: number) {\n  let i = 0;\n  let result = cb();\n\n  while (!result && i < attempts) {\n    await pause(interval);\n\n    i++;\n    result = cb();\n  }\n\n  return result;\n}\n","const cache = new WeakMap<AnyFunction, Map<string, any>>();\n\nexport default function withCache<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    let fnCache = cache.get(fn);\n    const cacheKey = args.map(String).join('_');\n\n    if (fnCache) {\n      const cached = fnCache.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    } else {\n      fnCache = new Map();\n      cache.set(fn, fnCache);\n    }\n\n    const newValue = fn(...args);\n\n    fnCache.set(cacheKey, newValue);\n\n    return newValue;\n  };\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [494,362,776], () => (__webpack_require__(22100)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"362\":\"1dbe55c972e9075fe06c\",\"494\":\"2a76b4246c2b484142fb\",\"776\":\"28cf5f93438bdbe59349\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t941: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkmytonwallet\"] = self[\"webpackChunkmytonwallet\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["deferred","next","JettonStakingOpCodes","GET_STATIC_DATA","REPORT_STATIC_DATA","GET_STORAGE_DATA","REPORT_STORAGE_DATA","EXCESSES","TRANSFER_JETTON","INTERNAL_TRANSFER","TRANSFER_NOTIFICATION","PROVIDE_WALLET_ADDRESS","TAKE_WALLET_ADDRESS","BURN_JETTON","STAKE_JETTONS","ADD_REWARDS","SEND_CLAIMED_REWARDS","SEND_UNSTAKED_JETTONS","APPROVE_STAKE","CANCEL_STAKE","ADD_REWARD_JETTONS","CLAIM_COMMISSIONS","REQUEST_UPDATE_REWARDS","CLAIM_REWARDS","RECEIVE_JETTONS","UNSTAKE_JETTONS","UNSTAKE_REQUEST","CANCEL_UNSTAKE_REQUEST","UPDATE_REWARDS","CONFIRM_TRANSFER","DEPLOY_NEW_POOL","SEND_COMMISSIONS","SET_CODE","CHANGE_CREATION_FEE","CHANGE_CONTENT","UPDATE_CODES","JettonStakingGas","MIN_RESERVE","DEPLOY_POOL","NOTIFICATION","JETTON_TRANSFER","BURN_JETTONS","CANCEL_UNSTAKE","SIMPLE_UPDATE_REQUEST","APPROVE_TRANSFER","SAVE_UPDATED_REWARDS","MIN_EXCESS","SEND_STAKED_JETTONS","Dividers","COMMISSION_DIVIDER","REWARDS_DIVIDER","DISTRIBUTION_SPEED_DIVIDER","BigInt","DISTRIBUTED_REWARDS_DIVIDER","ApiBaseError","Error","constructor","message","displayError","super","this","name","ApiUserRejectsError","arguments","length","undefined","ApiServerError","statusCode","ApiCommonError","ServerError","AbortOperationError","handleServerError","err","error","MAX_DP","NAME","INVALID","INVALID_DP","INVALID_RM","DIV_BY_ZERO","P","UNDEFINED","NUMERIC","round","x","sd","rm","more","xc","c","RM","e","unshift","pop","stringify","doExponential","isNonzero","s","join","n","charAt","slice","abs","cmp","y","isneg","yc","i","j","k","l","div","Big","a","b","dp","DP","bl","bt","ri","bz","ai","al","r","rl","q","qc","qi","p","push","shift","eq","gt","gte","lt","lte","minus","sub","t","xlty","plus","xe","ye","reverse","mod","ygtx","times","neg","add","pow","one","prec","sqrt","half","Math","toExponential","indexOf","mul","Array","toFixed","Symbol","for","toJSON","toString","NE","PE","toNumber","Number","strict","toPrecision","valueOf","_Big_","TypeError","String","nl","test","replace","search","substring","parse","prototype","roundDown","roundHalfUp","roundHalfEven","roundUp","ten","fromDecimal","value","decimals","TONCOIN","toBig","noFloor","randomBytes","size","self","crypto","getRandomValues","Uint8Array","BIGINT_PREFIX","bigintReviver","key","startsWith","bigintDivideToNumber","num","ONE_TON","bigintMultiplyToNumber","callbackState","Map","parseAccountId","accountId","parts","split","id","network","buildAccountId","account","isMnemonicPrivateKey","mnemonic","PRIVATE_KEY_HEX_LENGTH","pathRegex","replaceDerive","val","derivePath","path","seed","offset","map","some","isNaN","isValidPath","chainCode","I","createHmac","update","Buffer","from","digest","getMasterKeyFromSeed","el","parseInt","reduce","parentKeys","segment","CKDPriv","_ref","index","indexBuffer","allocUnsafe","writeUInt32BE","data","concat","alloc","getDnsDomainZone","domain","zone","TON_DNS_ZONES","suffixes","baseFormat","suffix","endsWith","base","buildCollectionByKey","collection","byKey","member","mapValues","callback","Object","keys","newByKey","pick","object","result","omit","stringKeys","Set","filter","has","omitUndefined","stringKey","range","start","end","arr","fromKeyValueArrays","values","acc","isArray","extractKey","array","DnsItem","address","init","createFromAddress","createFromConfig","config","code","workchain","beginCell","endCell","contractAddress","getDomain","provider","get","stack","readString","getTelemintDomain","getNftData","res","readBigNumber","collectionAddress","readAddress","owner","readAddressOpt","sha256","bytes","subtle","bytesToHex","hexToBytes","hex","base64ToBytes","base64","isKnownStakingPool","STAKING_POOLS","poolPart","environment","setEnvironment","args","_self","isDappSupported","IS_EXTENSION","IS_CAPACITOR","isElectron","isSseSupported","isNativeBottomSheet","apiHeaders","origin","toncenterMainnetKey","ELECTRON_TONCENTER_MAINNET_KEY","TONCENTER_MAINNET_KEY","toncenterTestnetKey","ELECTRON_TONCENTER_TESTNET_KEY","TONCENTER_TESTNET_KEY","getEnvironment","TON_BIP39_PATH","TOKEN_TRANSFER_AMOUNT","TINY_TOKEN_TRANSFER_AMOUNT","TOKEN_TRANSFER_REAL_AMOUNT","TINY_TOKEN_TRANSFER_REAL_AMOUNT","TINIEST_TOKEN_TRANSFER_REAL_AMOUNT","TOKEN_TRANSFER_FORWARD_AMOUNT","CLAIM_MINTLESS_AMOUNT","NFT_TRANSFER_AMOUNT","NFT_TRANSFER_REAL_AMOUNT","NFT_TRANSFER_FORWARD_AMOUNT","NFT_PAYLOAD_SAFE_MARGIN","TON_GAS","stakeNominators","unstakeNominators","stakeLiquid","unstakeLiquid","stakeJettonsForward","stakeJettons","unstakeJettons","claimJettons","STAKE_COMMENT","UNSTAKE_COMMENT","ATTEMPTS","DEFAULT_DECIMALS","DEFAULT_IS_BOUNCEABLE","FEE_FACTOR","ALL_WALLET_VERSIONS","Workchain","WORKCHAIN","BaseChain","TRANSFER_TIMEOUT_SEC","DEFAULT_MAX_MESSAGES","LEDGER_MAX_MESSAGES","W5_MAX_MESSAGES","OpCode","JettonOpCode","NftOpCode","LiquidStakingOpCode","VestingV1OpCode","SingleNominatorOpCode","DnsOpCode","OtherOpCode","ContractType","DnsCategory","DNS_CATEGORY_HASH_MAP","dns_next_resolver","wallet","site","storage","KnownContracts","simpleR1","hash","type","Wallet","simpleR2","simpleR3","v2R1","v2R2","v3R1","v3R2","v4R1","v4R2","W5","highloadV2","nominatorPool","Staking","multisig","multisigV2","vesting","multisigNew","dedustPool","isSwapAllowed","dedustVaultNative","dedustVaultJetton","stonPtonWallet","stonRouter","stonRouterV2_1","stonPoolV2_1","stonRouterV2_2","stonPoolV2_2","stonPtonWalletV2","megatonWtonMaster","megatonRouter","stringifyTxId","parseTxId","txId","generateQueryId","randomNumber","randomBigInt","bigintRandom","TON_MAX_COMMENT_BYTES","clientByNetwork","walletClassMap","WalletContractV1R1","WalletContractV1R2","WalletContractV1R3","WalletContractV2R1","WalletContractV2R2","WalletContractV3R1","WalletContractV3R2","WalletContractV4","WalletContractV5R1","getTonClient","mainnet","TonClient","endpoint","TONCENTER_MAINNET_URL","timeout","DEFAULT_TIMEOUT","apiKey","headers","testnet","TONCENTER_TESTNET_URL","getTonWalletContract","publicKeyHex","version","walletClass","publicKey","create","resolveTokenWalletAddress","withCacheAsync","async","tokenAddress","minter","open","JettonMinter","Address","toBase64Address","getWalletAddress","resolveTokenAddress","tokenWalletAddress","tokenWallet","JettonWallet","getWalletData","getWalletPublicKey","callGetMethod","padStart","logDebugError","getJettonPoolStakeWallet","poolAddress","period","tonClient","pool","StakingPool","walletAddress","StakeWallet","oneCellFromBoc","Cell","fromBoc","isBounceable","urlSafe","bounceable","testOnly","toRawAddress","toRawString","buildTokenTransferBody","params","queryId","tokenAmount","toAddress","responseAddress","forwardAmount","customPayload","forwardPayload","builder","Builder","storeUint","Transfer","storeCoins","storeAddress","storeMaybeRef","packBytesAsSnake","availableBits","storeBit","storeBuffer","storeRef","commentToBytes","comment","buffer","startBuffer","Comment","set","maxBytes","packBytesAsSnakeCell","_headCell","bytesPerCell","headCell","ceil","cellOffset","cellLength","min","cellBuffer","byteOffset","nextHeadCell","EMPTY","packBytesAsSnakeForEncryptedData","subarray","buildLiquidStakingDepositBody","Deposit","asCell","getTokenBalance","getJettonBalance","parseAddress","isRaw","parseRaw","isValid","isFriendly","parseFriendly","isUserFriendly","getIsRawAddress","Boolean","buildJettonUnstakePayload","jettonsToUnstake","forceUnstake","buildJettonClaimPayload","poolWallets","rewardsToClaim","Dictionary","empty","Keys","Values","Bool","poolWallet","storeDict","unpackDicts","obj","isSimpleObject","getPrototypeOf","connector","StorageType","generateUniqueId","Date","now","random","ConnectorClass","target","onUpdate","channel","shouldUseJson","targetOrigin","_defineProperty","destroy","_len","_key","postMessage","request","messageData","requestStates","requestStatesByCallback","messageId","payload","requestState","promise","Promise","resolve","reject","assign","withCallback","catch","finally","delete","cancelCallback","progressCallback","isCanceled","onMessage","JSON","response","_requestState$callbac","call","callbackArgs","_data$error","_data$error2","rawData","callWindow","methodName","cache","getItem","force","isAndroidApp","setItem","removeItem","clear","getKeys","chrome","local","_await$storage$get","remove","bind","getAll","setMany","getMany","store","idb","INDEXED_DB_NAME","INDEXED_DB_STORE_NAME","items","entries","withPromise","fn","localStorage","extensionStorage","capacitorStorage","MIN_ACCOUNT_NUMBER","IndexedDb","LocalStorage","ExtensionLocal","CapacitorStorage","loginResolve","loginPromise","activeAccountId","getActiveAccountId","setActiveAccountId","getNewAccountId","ids","getAccountIds","max","fetchStoredAddress","chain","fetchStoredAccount","fetchStoredTonWallet","ton","fetchStoredTronWallet","tron","getAccountValue","fetchStoredAccounts","updateStoredAccount","partial","setAccountValue","updateStoredTonWallet","_await$storage$getIte","removeAccountValue","removedValue","restData","removeNetworkAccountsValue","getCurrentNetwork","getCurrentAccountId","PBKDF2_IMPORT_KEY_ARGS","PBKDF2_DERIVE_KEY_ARGS","iterations","PBKDF2_DERIVE_KEY_TYPE","validateBip39Mnemonic","bip39","encryptMnemonic","password","plaintext","salt","keyMaterial","importKey","TextEncoder","encode","deriveKey","iv","ptUint8","ctBuffer","encrypt","ctArray","ctBase64","btoa","fromCharCode","ivHex","decryptMnemonic","encrypted","includes","pwUtf8","pwHash","match","byte","alg","ctStr","atob","ctUint8","ch","charCodeAt","plainBuffer","decrypt","TextDecoder","decode","decryptMnemonicLegacy","saltHex","encryptedData","getMnemonic","mnemonicEncrypted","decryptedMnemonic","DebugError","console","tryMigratingMnemonicEncryption","ADDRESS_BOOK_CHUNK_SIZE","VERSION_MAP","fetchTransactions","options","limit","toTimestamp","fromTimestamp","shouldIncludeFrom","shouldIncludeTo","callApiV3","start_utime","msToSec","end_utime","sort","transactions","rawTransactions","address_book","addressBook","rawTx","total_fees","totalFees","description","compute_ph","exit_code","exitCode","timestamp","isIncoming","in_msg","source","inMsgHash","msgs","out_msgs","oneMsgFee","msg","destination","fwd_fee","fwdFee","fromAddress","user_friendly","normalizedAddress","fee","amount","slug","shouldHide","extraData","body","getRawBody","parseRawTransaction","flat","fetchLatestTxId","message_content","fetchAddressBook","addresses","chunks","chunkSize","all","chunk","fixAddressFormat","url","fetchJson","ms","floor","MAX_LIMIT","EVENTS_LIMIT","apiByNetwork","getApi","Api","HttpClient","baseUrl","TONAPIIO_MAINNET_URL","baseApiParams","customFetch","fetchWithRetry","TONAPIIO_TESTNET_URL","fetchJettonBalances","accounts","getAccountJettonsBalances","supported_extensions","balances","fetchNftItems","nft","getNftItemsByAddresses","account_ids","nft_items","isAddressInitialized","walletOrAddress","getWalletInfo","isInitialized","isActiveSmartContract","isWallet","publicKeyToAddress","walletVersion","buildWallet","client","WalletClass","account_state","accountState","seqno","balance","last_transaction_id","lastTxId","getContractInfo","getAddressInfo","state","codeHashOld","contractInfo","find","info","codeHash","fromBase64","getAccountBalance","getWalletBalance","getWalletSeqno","pickBestWallet","allWallets","getWalletVersionInfos","defaultWallet","DEFAULT_WALLET_VERSION","withBiggestBalance","best","current","_best$balance","withLastTx","predicate","cursor","findLast","_ref2","v4Wallet","_ref3","walletInfos","states","wallets","addressByRaw","fromEntries","toUpperCase","getWalletStates","wallet_type","status","last_transaction_lt","last_transaction_hash","getWalletInfos","item","_walletInfos$item$add","getWalletVersions","getWalletStateInit","storedWallet","getTonWallet","storeWritable","storeStateInit","pickWalletByAddress","w","tonWallet","resolveWalletVersion","_Object$entries$find","_ref4","generateMnemonic","tonWebMnemonic","validateMnemonic","privateKeyHexToKeyPair","privateKeyHex","nacl","keyPair","fromSeed","fetchPrivateKey","secretKey","privateKey","fetchKeyPair","_account","bip39MnemonicToKeyPair","rawSign","dataHex","detached","getWalletFromBip39Mnemonic","getWalletFromKeys","getWalletFromMnemonic","getWalletFromPrivateKey","hexSeed","HDKey","importNewWalletVersion","newAddress","newAccountId","newAccount","ledger","driver","IPFS_GATEWAY_BASE_URL","fetchJsonMetadata","fixIpfsUrl","reserveUrl","BRILLIANT_API_BASE_URL","fetch","ok","json","RE_SYMBOL_WITH_COMBINING_MARKS","RE_LINEBREAK_COMBINING_MARKS","RE_SPACE_CHARS","RE_FAKE_DOTS","RE_EMPTY_CHARS","checkLNPRegex","characters","alphabetMap","confusablesMap","alts","char","cleanText","str","checkLNP","newStr","clean","BAD_REQUEST_CODE","callBackendPost","authToken","isAllowBadRequest","method","shouldRetry","retries","timeouts","URL","getBackendHeaders","shouldSkipRetryFn","handleFetchErrors","callBackendGet","APP_VERSION","APP_ENV","knownAddresses","scamMarkers","trustedSites","trustedCollections","tryUpdateKnownAddresses","RegExp","getKnownAddresses","getKnownAddressInfo","checkHasScamLink","text","matches","matchAll","RE_LINK_TEMPLATE","_match$groups","host","groups","toLowerCase","IGNORED_DEXIE_ERRORS","tryDbQuery","cb","DbRepository","table","toArray","where","put","bulkPut","deleteWhere","ApiDb","Dexie","stores","nfts","sseConnections","tokens","apiDb","nftRepository","tokenRepository","stakingCommonCache","accountCache","pricesCache","baseCurrency","DEFAULT_PRICE_CURRENCY","bySlug","getAccountCache","_accountCache","updateAccountCache","getStakingCommonCache","getPricesCache","tokensCache","TOKEN_INFO","addTokens","shouldForceSend","newTokens","token","mergedToken","mergeTokenWithCache","sendUpdateTokens","getTokensCache","getTokenBySlug","getTokenByAddress","buildTokenSlug","prices","_prices$bySlug$token$","quote","price","priceUsd","percentChange24h","OFFCHAIN_CONTENT_PREFIX","dictSnakeBufferValue","sliceToVal","v","isFirst","loadUint","loadBuffer","remainingBits","remainingRefs","loadRef","beginParse","serialize","jettonOnChainMetadataSpec","uri","image","symbol","custom_payload_api_uri","fetchJettonOffchainMetadata","parsePayloadBase64","_await$parsePayloadSl","dataToSlice","parsePayloadSlice","shouldLoadItems","transactionDebug","opCode","readSnakeBytes","Encrypted","encryptedComment","loadUintBig","_forwardPayload","loadCoins","loadAddress","responseDestination","loadMaybeAddress","loadMaybeRef","forwardPayloadOpCode","storeBits","loadBits","forEach","forwardPayloadSlice","toBoc","TransferOwnership","_nft","newOwner","readForwardPayloadCell","readComment","asSlice","rawNft","buildNft","nftAddress","nftName","OwnershipAssigned","prevOwner","Burn","addressObj","isLiquidUnstakeRequest","LIQUID_JETTON","DistributedAsset","Withdrawal","appId","AddWhitelist","Withdraw","ChangeValidator","Vote","votingAddress","expirationDate","vote","loadBit","needConfirmation","ChangeRecord","category","contract","resolver","isTelemint","getDnsItemDomain","dataSlice","endParse","dataAddress","flags","record","TokenBridgePaySwap","swapId","isForce","loadBoolean","DEBUG","_opCode","debugTxString","opCodeHex","Slice","BitReader","BitString","_forwardPayload2","buildMtwCardsNftMetadata","metadata","mtwCardType","mtwCardTextType","_metadata$attributes$","_metadata$attributes$2","_metadata$attributes$3","imageUrl","mtwCardId","attributes","attribute","trait_type","trim","mtwCardBorderShineType","rawMetadata","previews","sale","trust","render_type","renderType","lottie","hasScamLink","checkIsTrustedCollection","isWhitelisted","isScam","isHidden","imageFromPreview","resolution","isFragmentGift","NFT_FRAGMENT_GIFT_IMAGE_URL_PREFIX","MTW_CARDS_COLLECTION","fragmentUrl","NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX","ownerAddress","thumbnail","isOnSale","collectionName","isOnFragment","NFT_FRAGMENT_COLLECTIONS","compareActivities","isAsc","getChainConfig","CHAIN_CONFIG","getDieselTokenAmount","diesel","_diesel$amount","nativeToken","shortenAddress","withCache","fromRight","FILLER","getKey","TRANSACTION_ADDRESS_SHIFT","updatePoisoningCache","tx","cached","getFromCache","addToCache","ed25519","require","aesjs","getAesCbcState","ModeOfOperation","cbc","combineSecrets","hmacAlgo","hmacKey","signature","sign","hmacSha512","encryptMessageComment","myPublicKey","theirPublicKey","myPrivateKey","senderAddress","commentBytes","encryptedBytes","sharedSecret","getSharedSecret","prefix","dataLength","prefixLength","minPadding","getRandomPrefix","combined","msgKey","cbcStateSecret","encryptDataWithPrefix","encryptDataImpl","prefixedEncrypted","encryptData","decryptMessageComment","decryptedBytes","decryptedData","gotMsgKey","doDecrypt","decryptDataImpl","decryptData","DIESEL_URL","sendExternal","gaslessType","neededInit","isContractDeployed","ext","external","to","cell","storeMessage","isW5Gasless","msgHash","bodyMessageHash","boc","paymentLink","isAddition","dieselW5SendRequest","dieselSendBoc","sendFile","areDeepEqual","value1","value2","type1","isArray1","array1","array2","every","member1","object1","object2","keys1","keys2","key1","hasOwnProperty","key2","localCounter","getNextLocalId","migrationEnsurePromise","currentOnUpdate","updateTransactionMetadata","transaction","isNftTransfer","hasScamMarkers","sm","hasScamInComment","RE_TG_BOT_MENTION","isAlive","_onUpdate","isUpdaterAlive","isAccountActive","buildOldAccountId","iosBackupAndMigrateKeychainMode","backupKey","assert","backupValue","shouldRewrite","Deferred","resolved","byId","byAddress","waitAndCreatePendingTransfer","prevPending","pendingTransfer","getPendingTransfer","DAYS_IN_YEAR","FIRST_TRANSACTIONS_LIMIT","Opcodes","action_send_msg","action_set_code","action_extended_set_data","action_extended_add_extension","action_extended_remove_extension","action_extended_set_signature_auth_allowed","auth_extension","auth_signed","auth_signed_internal","ActionSendMsg","mode","outMsg","tag","SendMode","IGNORE_ERRORS","storeMessageRelaxed","packActionsListOut","actions","action","rest","storeSlice","packActionsListExtended","outActions","parseSmartContractAddressImpl","prefix0","prefix1","byte0","byte1","hashPart","parseNextResolverRecord","parseStorageBagIdRecord","dnsResolveImpl","dnsAddress","rawDomainBytes","oneStep","len","domainCell","categoryBN","categoryBytes","categoryHashHex","categoryToBigInt","resultLen","readNumber","readCell","DnsNextResolver","parseSmartContractAddressRecord","Site","parseAdnlAddressRecord","parseSiteRecord","BagId","nextAddress","resolveAddress","resolvedAddress","zoneMatch","rootDnsAddress","part","rawDomain","domainToBytes","dnsResolve","_err$message","resolveAddressByDomain","known","normalizeAddress","_domain","getAccountTokenBalances","getTokenBalances","balanceRaw","jetton","wallet_address","buildTokenByMetadata","jettonWallet","parseTokenBalance","insertMintlessPayload","transfer","customPayloadApiUrl","parsedPayload","mintlessTokenBalance","isMintlessClaimed","stateInit","getMintlessParams","newPayload","isBase64Payload","buildTokenTransfer","shouldSkipMintless","isTokenWalletDeployed","toncoinAmount","realAmount","getToncoinAmountForTransfer","calculateTokenBalanceWithMintless","runMethod","readBoolean","checkMintlessTokenWalletIsClaimed","rawAddress","fetchJsonWithProxy","fetchMintlessTokenWalletData","isExpired","compressed_info","expired_at","getTime","custom_payload","state_init","fetchToken","content","getJettonData","getJettonMinterData","contentUri","dict","loadDict","_dict$get","sha256Key","parseJettonOnchainMetadata","fetchJettonMetadata","image_data","imageData","willClaimMintless","TON_USDT_SLUG","isTiny","GET_TRANSACTIONS_LIMIT","GET_TRANSACTIONS_MAX_LIMIT","WAIT_TRANSFER_TIMEOUT","WAIT_PAUSE","MAX_BALANCE_WITH_CHECK_DIESEL","PENDING_DIESEL_TIMEOUT","DIESEL_NOT_AVAILABLE","nativeAmount","remainingFee","realFee","checkHasTransaction","checkTransactionDraft","shouldEncrypt","isBase64Data","stateInitString","allowGasless","checkToAddress","ApiTransactionDraftError","StateInitWithoutBin","InvalidStateInit","isToAddressNew","InactiveContract","InvalidAmount","WalletNotInitialized","isWalletInitialized","toncoinBalance","tokenTransfer","realToncoinAmount","isFullTonTransfer","signTransaction","isFullBalance","blockchainFee","calculateFee","safeBlockchainFee","isEnoughBalance","canTransferGasfully","getDiesel","tokenBalance","InsufficientBalance","DomainNotResolved","addressName","isMemoRequired","isTestOnly","InvalidToAddress","isUrlSafe","InvalidAddressFormat","submitTransfer","stringToPayload","ApiTransactionError","retrySendBoc","resolveTransactionError","submitTransferWithDiesel","dieselAmount","isGaslessWithStars","messages","DIESEL_ADDRESS","submitMultiTransfer","isGasless","parseBase64","toPublicKey","IncorrectDeviceTime","UnsuccesfulTransfer","expireAt","logDebug","loadStateInit","sendMode","CARRY_ALL_REMAINING_BALANCE","PAY_GAS_SEPARATELY","createTransfer","internal","bounce","getAccountNewestTxId","fetchNewestTxId","fetchAccountTransactionSlice","_transaction$extraDat","parseWalletTransactionBody","nftAddresses","addressesForFixFormat","rawNfts","nftsByAddress","populateTransactions","updateTransactionType","omitExtraData","transactionToActivity","getAllTransactionSlice","tokenSlugs","tonTxs","tokenResults","fetchTokenTransactionSlice","allTxs","tokenSlug","parsedData","InternalTransfer","jettonAmount","forwardOpCode","operation","parseJettonWalletMsgBody","parseTokenTransaction","_transaction$metadata","normalizedFromAddress","normalizedToAddress","kind","checkMultiTransactionDraft","withDiesel","withEmulation","totalAmount","_result$emulation$tot","_result$emulation","isMainnet","signMultiTransaction","emulation","safeExecAsync","externalMessage","buildExternalBoc","ignore_chksig","include_code_data","with_actions","fetchEmulateTrace","emulateTrace","opcode","parseTransaction","byHash","groupKey","byTransactionIndex","processTrace","trace","_index","txs","tx_hash","received","children","totalFee","sum","totalReceived","parseEmulation","withW5Gasless","clearedMessages","_ref5","hasPayload","preparedMessages","actionsList","createBody","toExternalMessage","waitUntil","walletInfo","pause","source_fees","fees","estimateExternalMessageFee","initCode","initData","ignoreSignature","in_fwd_fee","storage_fee","gas_fee","sendSignedMessage","pendingTransferId","sendSignedMessages","attempts","firstBoc","attempt","msgHashes","_pendingTransfer","successNumber","decryptComment","waitUntilTransactionAppears","latestTxId","fixTokenActivitiesAddressForm","activities","tokenAddresses","activity","fetchEstimateDiesel","_ref6","_toncoinBalance","_tokenBalance","storedTonWallet","isGaslessEnabled","isStarsEnabled","isStars","DEFAULT_FEE","getDieselToncoinFee","toncoinNeeded","rawDiesel","isW5","estimateDiesel","toDecimal","accountAddress","getTokenBalanceWithMintless","canPayDiesel","isAwaitingNotExpiredPrevious","pendingCreatedAt","getAccountNfts","getAccountNftItems","indirect_ownership","fetchAccountNfts","checkNftOwnership","getNftItemByAddress","fetchNftByAddress","getNftUpdates","fromSec","_events$0$timestamp","_events$","events","getAccountEvents","start_date","fetchAccountEvents","updates","event","isPurchase","NftPurchase","NftItemTransfer","sender","recipient","rawNftAddress","buyer","newOwnerAddress","checkNftTransferDraft","NFT_BATCH_SIZE","buildNftTransferMessage","transactionResult","batchFee","calculateNftTransferFee","submitNftTransfers","NOTCOIN_VOUCHERS_ADDRESS","BURN_ADDRESS","NOTCOIN_EXCHANGERS","buildNftTransferPayload","nftIndex","first4Bits","readUint8","NOTCOIN_FORWARD_TON_AMOUNT","buildNotcoinVoucherExchange","totalNftCount","estimatedBatchSize","estimatedBatchBlockchainFee","amountPerNft","remainingBatchSize","NominatorPool","getListNominators","readTuple","tupleItems","tuple","TupleReader","pendingDepositAmount","withdrawRequested","clientId","getClientId","referrer","checkStakeDraft","LIQUID_POOL","stakePayload","checkUnstakeDraft","commonData","liquid","currentRate","buildLiquidStakingWithdraw","stakeWalletAddress","submitStake","stakedAt","submitUnstake","instantAvailable","ApiLiquidUnstakeMode","Default","BestRate","waitTillRoundEnd","fillOrKill","buildLiquidStakingWithdrawCustomPayload","buildLiquidStakingWithdrawBody","Instant","getStakingStates","backendState","loyaltyType","shouldUseNominators","backendType","promises","buildLiquidState","poolConfig","jettonPools","buildJettonState","_currentNominator$pen","_currentNominator","_currentNominator$wit","_currentNominator2","apy","nominatorsPool","isPrevRoundUnlocked","prevRound","unlock","currentNominator","nominators","addressObject","equals","annualYield","yieldType","isUnstakeRequested","buildNominatorsState","_accountCache$stakedA","_backendState$stakedA","getLiquidStakingTokenBalance","unstakeAmount","_nft$name","billAmount","liquidAvailable","VALIDATION_PERIOD_MS","available","liquidApy","loyaltyApy","unstakeRequestAmount","poolData","getStorageData","tvl","rewardJettons","rewardsDeposits","dailyReward","startTime","endTime","distributionSpeed","apr","calcJettonStakingApr","periodConfig","periods","stakeWallet","walletData","unclaimedRewards","poolWalletAddress","rewards","getAvailableRewards","jettonBalance","getBackendStakingState","stakingState","totalProfit","fetchBackendStakingState","submitStakingClaim","packPayloadToBoc","storeStringTail","checkApiAvailability","getMasterchainInfo","isNftTransferPayload","isTokenTransferPayload","buildSwapId","backendId","swapGetHistory","swapVersion","SWAP_API_VERSION","swapItemToActivity","swap","getSwapItemSlug","asset","cex","_getTokenByAddress$sl","_getTokenByAddress","patchSwapItem","FEE_ADDRESSES","SWAP_FEE_ADDRESS","MEGATON_WTON_MINTER","MAX_NETWORK_FEE","SWAP_MAX_LT","SWAP_WAITING_TIME","SWAP_WAITING_PAUSE","MAX_OLD_SWAP_ID","validateDexSwapTransfers","transfers","condition","originalAssert","mainTransfer","feeTransfer","maxAmount","fromAmount","_request$ourFee","_request$dieselFee","ourFee","dieselFee","maxTonAmount","feePayload","tokenFeeAmount","feeDestination","swapReplaceTransactions","_getTokenBySlug$token","fromLt","toLt","fromTime","toTime","buildSwapHistoryRange","swaps","replaceTransactions","hiddenTxIds","skipLtRanges","_swap$txIds","txIds","swapActivity","ltString","shortenedTxId","startLt","endLt","firstLt","lastLt","firstTimestamp","lastTimestamp","deferreds","isFocused","pauseOrFocus","msWhenNotFocused","then","setIsAppFocused","_isFocused","d","convertToDbEntity","_nft$collectionAddres","txCallbacks","callbacks","removeCallback","runCallbacks","addCallback","hasCallbacks","createCallbackManager","updateTokenHashes","tokensToFetch","option","tokensByAddress","getAccountStates","code_hash","fetchVestings","isTestnet","BALANCE_BASED_INTERVAL","BALANCE_BASED_INTERVAL_WHEN_NOT_FOCUSED","DOUBLE_CHECK_TOKENS_PAUSE","NFT_FULL_INTERVAL","STAKING_INTERVAL","STAKING_INTERVAL_WHEN_NOT_FOCUSED","VERSIONS_INTERVAL","VERSIONS_INTERVAL_WHEN_NOT_FOCUSED","VESTING_INTERVAL","VESTING_INTERVAL_WHEN_NOT_FOCUSED","BALANCE_NOT_ACTIVE_ACCOUNTS_INTERVAL","BALANCE_NOT_ACTIVE_ACCOUNTS_INTERVAL_WHEN_NOT_FOCUSED","lastBalanceCache","setupPolling","newestTxTimestamps","nftUpdates","doubleCheckTokensTime","nftFromSec","lastNftFullUpdate","updateBalance","newBalances","changedSlugs","isToncoinBalanceChanged","updateNfts","nftResult","logAndRescue","throwErrorIfUpdaterNotAlive","dbNft","processNftUpdates","dbNfts","updateAccountNfts","updateTokenBalances","tokenBalances","updateActivities","changedTokenSlugs","newTxTimestamps","newestTxTimestamp","tokenBalanceByAddress","allTransactions","isFirstRun","isFirstLoad","pendingSwaps","isCex","waitPendingDexSwap","ranges","swapGetHistoryByRanges","swapReplaceTransactionsByRanges","processNewActivities","isUpdating","_lastBalanceCache$acc","setupBalanceBasedPolling","isLedger","publicKeyBytes","versions","LEDGER_WALLET_VERSIONS","POPULAR_WALLET_VERSIONS","lastResult","versionInfos","versionInfo","filteredVersions","currentVersion","setupWalletVersionsPolling","IS_CORE_WALLET","lastStates","common","setupStakingPolling","lastVestingInfo","vestingInfo","setupVestingPolling","setupInactiveAccountsBalancePolling","addressToAccountsMap","localOnUpdate","updateAddressToAccountsMap","accountsById","balancePollingAccount","_ref7","_ref8","_lastBalanceCache$acc2","parametersByNetwork","chainConfig","getTronClient","TronWeb","fullHost","apiUrl","getChainParameters","chainParameters","trx","energyUnitFee","param","bandwidthUnitFee","getTokenTransactionSlice","TRX","queryParams","getTrxTransactions","min_timestamp","max_timestamp","_rawData$contract$0$p","raw_data","txID","energy_fee","energyFee","net_fee","netFee","block_timestamp","parameter","fromHex","owner_address","to_address","parseRawTrxTransaction","getTrc20Transactions","contract_address","transaction_id","token_info","tokenInfo","parseRawTrc20Transaction","mainChunk","prevChunk","trxChunk","tokenChunks","mergeTransactions","trxTxs","tokenTxs","tokenTxById","trxTxsCleared","tokenTx","tronWeb","getBalance","getTrc20Balance","functions","parameters","issuerAddress","transactionBuilder","triggerSmartContract","_isConstant","constant_result","callContract","BALANCE_INTERVAL","BALANCE_INTERVAL_WHEN_NOT_FOCUSED","usdtAddress","usdtSlug","slugs","lastTrxBalance","lastUsdtBalance","trxBalance","usdtBalance","TRON_GAS","transferTrc20Estimated","ONE_TRX","SIGNATURE_SIZE","isAddress","bandwidth","getBandwidth","energy_required","energyRequired","estimateEnergy","estimateTrc20TransferFee","sendTrx","getAccount","raw_data_hex","byteLength","fromMnemonic","feeLimit","buildTrc20Transfer","signedTx","sendRawTransaction","sendTransaction","hexToString","isConnected","hooks","callHook","hook","_hooks$name2","activeDappByAccountId","initDapps","activateDapp","oldAccountId","findActiveDappAccount","getActiveDapp","deactivateDapp","deactivateAccountDapp","deactivateAllDapps","getDapp","_await$getAccountValu","addDapp","dapp","dapps","getDappsByOrigin","deleteDapp","dontNotifyDapp","isDappActive","deleteAllDapps","origins","getDapps","getDappsState","removeAccountDapps","removeAllDapps","removeNetworkDapps","loadExploreSites","isLandscape","chains","initAccounts","activateAccount","prevAccountId","isFirstLogin","activeDappOrigin","onActiveDappAccountUpdated","pickChainTimestamps","nativeSlug","newBySlug","deactivateAllAccounts","deactivateCurrentAccount","fetchTonWallet","fetchLedgerAccount","IS_BIP39_MNEMONIC_ENABLED","createWallet","importMnemonic","isPrivateKey","isBip39Mnemonic","isTonMnemonic","tonAddress","tronAddress","tronWallet","secondNetworkAccount","createAccountWithSecondNetwork","secondNetwork","secondAccountId","addressByChain","importLedgerWallet","deviceId","deviceName","storeHardwareAccount","removeNetworkAccounts","resetAccounts","removeAccount","nextAccountId","changePassword","oldPassword","encryptedMnemonic","createDappPromise","promiseId","resolveDappPromise","fetchTonPrivateKey","fetchMnemonic","getMnemonicWordList","default","verifyPassword","_await$getAccountWith","getAccountWithMnemonic","confirmDappRequest","dappPromises","confirmDappRequestConnect","cancelDappRequest","reason","fetchAddress","fetchTokenBalances","fetchTokenBalancesByAddress","getAmountForTokenTransfer","initTransactions","fetchTokenActivitySlice","fetchAllActivitySlice","tonTokenSlugs","tronTokenSlugs","tonTransactions","tonActivities","tronActivities","shouldCreateLocalTransaction","localTransaction","createLocalTransaction","isExternal","waitAndCreateTonPendingTransfer","sendSignedTransferMessage","cancelPendingTransfer","_getPendingTransfer","restParams","buildLocalTransaction","fetchNfts","totalRealFee","realFeePerNft","getBaseCurrency","setBaseCurrency","currency","resolvePromise","preloadPromise","resolveDataPreloadPromise","waitDataPreload","initStaking","getStakingHistory","tryUpdateStakingCommonData","setStakingCommonCache","SIGN_MESSAGE","getBackendAuthToken","accountWallet","fetchAccountConfigForDebugPurposesOnly","stateVersion","mnemonicsEncrypted","ping","updateAccountMemoryCache","getMoonpayOnrampUrl","theme","getCardsInfo","initSwap","swapBuildTransfer","swapBuild","transferList","shouldTryDiesel","errorToString","swapSubmit","historyItem","fetchSwaps","results","allSettled","swapGetHistoryItem","nonExistentIds","swapEstimate","isMsgHashMode","swapGetAssets","swapGetTonCurrencies","swapGetPairs","symbolOrTokenAddress","swapCexEstimate","swapCexValidateAddress","swapCexCreateTransaction","BACKEND_INTERVAL","LONG_BACKEND_INTERVAL","INCORRECT_TIME_DIFF","initPolling","tryUpdatePrices","tryUpdateTokens","tryUpdateSwapTokens","tryUpdateConfig","setupBackendPolling","setupLongBackendPolling","IS_AIR_APP","pricesData","loadTokensCache","minterAddress","assets","_prices$bySlug$asset$","_prices$bySlug$asset$2","blockchain","isLimited","isCopyStorageEnabled","supportAccountsCount","serverUtc","country","countryCode","isUpdateRequired","isAppUpdateRequired","localUtc","CONNECT_EVENT_ERROR_CODES","SEND_TRANSACTION_ERROR_CODES","SIGN_DATA_ERROR_CODES","tonConnectGetDeviceInfo","maxMessages","platform","getPlatform","appName","APP_NAME","appVersion","packageJson","maxProtocolVersion","TONCONNECT_PROTOCOL_VERSION","features","_navigator","userAgent","navigator","userAgentData","devicePlatform","IS_TELEGRAM_APP","TonConnectError","ManifestContentError","MANIFEST_CONTENT_ERROR","UnknownError","BadRequestError","UnknownAppError","MAX_SINGLE_AMOUNT_AS_FEE","MAX_TOTAL_AMOUNT_AS_FEE","isValidString","maxLength","isValidUrl","getTransferActualToAddress","isTransferPayloadDangerous","shouldShowTransferAmountAsFee","BLANK_GIF_DATA_URL","resolveInit","initPromise","onPopupUpdate","initTonConnect","_onPopupUpdate","connect","openExtensionPopup","connectionType","isSse","dappMetadata","fetchDappMetadata","manifestUrl","validateRequest","addressItem","proofItem","proof","errors","getCurrentAccountOrFail","connectedAt","sse","sseOptions","identifier","permissions","promiseResult","deviceInfo","getMaxMessages","buildTonAddressReplyItem","proofReplyItem","timestampBuffer","writeBigInt64LE","domainBuffer","domainLengthBuffer","writeInt32LE","addressWorkchainBuffer","writeInt32BE","workChain","addressBuffer","messageBuffer","bufferToSign","buildTonProofReplyItem","signTonProof","device","safeExec","formatConnectError","reconnect","updateDapp","disconnect","txPayload","dappNetworkRaw","dappNetwork","CHAIN","MAINNET","validUntil","valid_until","vestingAddress","ownerPublicKey","_info$contractInfo","checkIsHisVestingWallet","WrongAddress","WrongNetwork","checkResult","checkTransactionMessages","transactionsForRequest","_checkResult$emulatio","_emulationResult$fee","_emulationResult$rece","rawAmount","rawPayload","emulationResult","isDangerous","displayedToAddress","displayedAmount","fullFee","totalAmountAsFee","showDappTransferAmountsAsFee","prepareTransactionForRequest","signedTransfers","submitResult","UNKNOWN_ERROR","errorMessage","apiErrors","USER_REJECTS_ERROR","Unexpected","signData","METHOD_NOT_SUPPORTED","deactivate","TESTNET","walletStateInit","idx","crc32","lengthBytes","iconUrl","safeIconUrl","skipConnection","getCurrentAccountIdOrFail","lastAccountId","lastConnectedAccountId","byOrigin","findLastConnectedAccount","BRIDGE_URL","TTL_SEC","NONCE_SIZE","MAX_CONFIRM_DURATION","sseEventSource","delayedReturnParams","sseDapps","startSseConnection","isFromInAppBrowser","searchParams","ret","appClientId","shouldOpenUrl","connectRequest","decodeURIComponent","secretKeyArray","publicKeyArray","lastOutputId","tonConnect","sendMessage","resetupSseConnection","lastEventId","dappsState","_dapp$sse","clientIds","close","EventSource","openEventSource","onopen","onerror","onmessage","encryptedMessage","sseDapp","fullBuffer","nonce","decrypted","jsonText","decryptMessage","setSseLastEventId","toId","topic","encryptMessage","sendRawMessage","fetchPriceHistory","subscribeNotifications","props","unsubscribeNotifications","connectUpdater","worker","createConnector","handleMessage","addEventListener","removeEventListener","WINDOW_PROVIDER_CHANNEL","methods","currentStorage","words","isTonProxyEnabled","isTonMagicEnabled","settings","secondAddress","newAccountById","migrateCoreWallet","idbVersion","idbStorage","idbData","MAIN_ACCOUNT_ID","field","raw","oldItem","newItem","prevValue","newValue","accountDapps","byAccountId","internalAccountId","accountData","parsed","mainnetAccountId","testnetAccountId","publicKeys","oldAddress","_dapp$sse2","isIosKeychainModeMigrated","isIosApp","oldAccountById","mnemonicById","oldAccount","_ledger$index","migrations","migrateStorage","_currentOnUpdate","startStorageMigration","tonConnectSse","_referrer","saveReferrer","_hooks$name","addHooks","onDappDisconnected","onDappsChanged","api","sendToOrigin","transferables","_e$error","_e$error2","_e$reason","_e$reason2","handleErrors","_message$data","_api$init","lastArg","ArrayBuffer","ImageBitmap","arrayBuffer","createPostMessageInterface","tonConnectApi","process","DEBUG_MORE","env","IS_OPERA_EXTENSION","DEBUG_ALERT_MSG","cmcSlug","MYCOIN","isMemoSupported","isDnsSupported","addressRegex","addressPrefixRegex","TRC20_USDT_MAINNET_SLUG","TRC20_USDT_TESTNET_SLUG","TRC20_USDT","TON_USDT","toncoin","DEFAULT_RETRIES","DEFAULT_ERROR_PAUSE","ALL_TON_DNS_ZONES","isUnofficial","checkInt","checkInts","arrayish","coerceArray","arg","copy","createArray","copyArray","sourceArray","targetArray","targetStart","sourceStart","sourceEnd","Hex","convertUtf8","toBytes","encodeURI","substr","fromBytes","convertHex","numberOfRounds","rcon","S","Si","T1","T2","T3","T4","T5","T6","T7","T8","U1","U2","U3","U4","convertToInt32","AES","defineProperty","_prepare","rounds","_Ke","_Kd","roundKeyCount","KC","tk","tt","rconpointer","ciphertext","ModeOfOperationECB","_aes","block","ModeOfOperationCBC","_lastCipherblock","ModeOfOperationCFB","segmentSize","_shiftRegister","xorSegment","ModeOfOperationOFB","_lastPrecipher","_lastPrecipherIndex","Counter","initialValue","_counter","setValue","setBytes","MAX_SAFE_INTEGER","increment","ModeOfOperationCTR","counter","_remainingCounter","_remainingCounterIndex","ecb","cfb","ofb","ctr","utils","utf8","padding","pkcs7","pad","padder","strip","_arrayTest","module","exports","nodeCrypto","freeze","__proto__","_0n","_1n","_2n","_8n","CU_O","CURVE","h","Gx","Gy","POW_2_256","SQRT_M1","SQRT_AD_MINUS_ONE","INVSQRT_A_MINUS_D","ONE_MINUS_D_SQ","D_MINUS_ONE_SQ","ExtendedPoint","z","fromAffine","Point","ZERO","toAffineBatch","points","toInv","nums","tmp","inverted","invert","reduceRight","invertBatch","toAffine","normalizeZ","other","assertExtPoint","X1","Y1","Z1","X2","Y2","Z2","X1Z2","X2Z1","Y1Z2","Y2Z1","negate","double","A","B","C","D","x1y1","E","G","F","H","X3","Y3","Z3","subtract","precomputeWindow","W","windows","window","wNAF","affinePoint","BASE","_WINDOW_SIZE","precomputes","pointPrecomputes","f","windowSize","mask","maxNumber","shiftBy","wbits","offset1","offset2","cond1","cond2","constTimeNegate","multiply","scalar","normalizeScalar","multiplyUnsafe","P0","isSmallOrder","isTorsionFree","invZ","is0","ax","ay","zz","fromRistrettoBytes","legacyRist","toRistrettoBytes","fromRistrettoHash","assertRstPoint","RistrettoPoint","ep","calcElligatorRistrettoMap","r0","Ns","Ns_D_is_sq","uvRatio","s_","edIsNegative","Nt","s2","W0","W1","W2","W3","hashToCurve","r1","bytes255ToNumberLE","ensureBytes","R1","r2","R2","emsg","b1","b2","equalBytes","numberTo32BytesLE","u1","u2","u1_2","u2_2","invertSqrt","Dx","Dy","toRawBytes","u2sq","invsqrt","D1","D2","zInv","_x","_y","toHex","two","WeakMap","_setWindowSize","normed","bytesToNumberLE","y2","u","isXOdd","fromPrivateKey","getExtendedPublicKey","point","toX25519","Signature","assertValidity","u8","concatBytes","arrays","hexes","uint8a","hexByte","numberTo32BytesBE","MAX_255B","number","modulo","m","pow2","power","pow_2_252_3","_5n","_10n","_20n","_40n","_80n","b4","b5","b10","b20","b40","b80","b160","b240","b250","pow_p_5_8","v3","v7","vx2","root1","root2","useRoot1","useRoot2","noRoot","modlLE","expectedLength","isSafeInteger","adjustBytes25519","checkPrivateKey","getKeyFromHash","hashed","head","pointBytes","_sha512Sync","sha512s","sha512","getExtendedPublicKeySync","prepareVerification","sig","SB","pub","finishVerification","kA","sync","getPublicKey","R","verify","cswap","x_2","x_3","dummy","curve25519","BASE_POINT_U","scalarMult","pu","pointU","a24","x_1","sw","z_2","z_3","k_t","AA","BB","DA","CB","dacb","da_cb","xp2","montgomeryLadder","uEnc","decodeUCoordinate","scalarMultBase","node","web","TORSION_SUBGROUP","hashToPrivateScalar","bytesLength","randomPrivateKey","createHash","precompute","sha512Sync","defineProperties","configurable","factory","AssertionError","SECOND","langCode","dayStartAt","noYear","monthFormat","noDay","withTime","toLocaleString","year","month","day","hour","minute","hourCycle","IS_EXTENSION_PAGE_SCRIPT","location","protocol","MAX_TIMEOUT","urlObject","append","isNotTemporaryError","_timeouts","fetchWithTimeout","controller","AbortController","setTimeout","abort","signal","clearTimeout","ignoreHttpCodes","_error","_errors$","shouldShowAlert","throttledAlert","throttle","alert","handleErrorEvent","ErrorEvent","preventDefault","handleError","MAX_LOG_LENGTH","logs","errorReplacer","_","addLog","log","time","getLogs","level","_len2","_key2","SAFE_EXEC_ENABLED","rescue","always","shouldIgnoreError","interval","isPending","shouldRunFirst","_args","setInterval","clearInterval","fnCache","cacheKey","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","__webpack_exports__","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","splice","getter","__esModule","definition","o","enumerable","chunkId","miniCssF","g","globalThis","Function","prop","toStringTag","scriptUrl","importScripts","document","currentScript","tagName","src","scripts","getElementsByTagName","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","moreModules","runtime"],"sourceRoot":""}